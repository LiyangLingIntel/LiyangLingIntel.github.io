I"Îz<blockquote>
  <p>æœ¬æ–‡ä¸»è¦å†…å®¹è½¬è½½è‡ª<a href="https://github.com/kenwoodjw"><strong>kenwoodjw</strong></a>çš„<code class="highlighter-rouge">GitHub</code> <a href="https://github.com/kenwoodjw/python_interview_question">repo</a>, å› ä¸ºåŸæ–‡GitHubä¸­æ²¡æœ‰å¯ä»¥è·³è½¬ç›®å½•ç´¢å¼•æ‰€ä»¥è½¬è½½è¿‡æ¥é‡æ–°ç”Ÿæˆç›®å½•ï¼Œæ–¹ä¾¿é˜…è¯»ã€‚</p>

  <p>è½¬è½½è¿‡ç¨‹ä¸­å¯¹å…¶ä¸­çš„ä¸€äº›ä»£ç ç»†èŠ‚åšäº†ä¸€äº›å¾®å°çš„æ”¹åŠ¨ï¼Œæœ‰çš„åœ°æ–¹ä¹ŸåŠ å…¥ä¸€äº›è‡ªå·±çš„ç†è§£ã€‚æ•´ç¯‡å†…å®¹æ¯”è¾ƒåŸºç¡€ï¼Œé€‚åˆç”¨æ¥å¯¹pythonå¼€å‘åšä¸€ä¸ªåŸºæœ¬çš„å›é¡¾ã€‚</p>
</blockquote>

<p>[TOC]</p>

<h2 id="pythonåŸºç¡€">PythonåŸºç¡€</h2>

<h3 id="11-æœ‰ä¸€ä¸ªjsonlineæ ¼å¼çš„æ–‡ä»¶filetxt-å¤§å°çº¦ä¸º10k">1.1 æœ‰ä¸€ä¸ªjsonlineæ ¼å¼çš„æ–‡ä»¶file.txt å¤§å°çº¦ä¸º10K</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">get_lines</span><span class="p">():</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'file.txt'</span><span class="p">,</span><span class="s">'rb) as f:</span><span class="err">
</span><span class="s">        for eachline in f:</span><span class="err">
</span><span class="s">            l.append(eachline)</span><span class="err">
</span><span class="s">        return l</span><span class="err">

</span><span class="s">if __name__ == '</span><span class="n">__main__</span><span class="s">':</span><span class="err">
</span><span class="s">    for e in get_lines():</span><span class="err">
</span><span class="s">        process(e) #å¤„ç†æ¯ä¸€è¡Œæ•°æ®</span><span class="err">
</span></pre></td></tr></tbody></table></code></pre></div></div>
<p>ç°åœ¨è¦å¤„ç†ä¸€ä¸ªå¤§å°ä¸º10Gçš„æ–‡ä»¶ï¼Œä½†æ˜¯å†…å­˜åªæœ‰4Gï¼Œå¦‚æœåœ¨åªä¿®æ”¹get_lines å‡½æ•°è€Œå…¶ä»–ä»£ç ä¿æŒä¸å˜çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥å¦‚ä½•å®ç°ï¼Ÿéœ€è¦è€ƒè™‘çš„é—®é¢˜éƒ½æœ‰é‚£äº›ï¼Ÿ</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">get_lines</span><span class="p">():</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'file.txt'</span><span class="p">,</span><span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="mi">60000</span><span class="p">)</span>
    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">l</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>è¦è€ƒè™‘çš„é—®é¢˜æœ‰ï¼š</p>

<ul>
  <li>å†…å­˜åªæœ‰4Gæ— æ³•ä¸€æ¬¡æ€§è¯»å…¥10Gæ–‡ä»¶ï¼Œéœ€è¦åˆ†æ‰¹è¯»å…¥åˆ†æ‰¹è¯»å…¥æ•°æ®è¦è®°å½•<strong>æ¯æ¬¡è¯»å…¥æ•°æ®çš„ä½ç½®</strong>ã€‚</li>
  <li>åˆ†æ‰¹æ¯æ¬¡è¯»å–æ•°æ®çš„å¤§å°ï¼Œå¤ªå°ä¼šåœ¨<strong>è¯»å–æ“ä½œ</strong>èŠ±è´¹è¿‡å¤šæ—¶é—´ã€‚</li>
</ul>

<h3 id="12-è¡¥å……ç¼ºå¤±çš„ä»£ç ">1.2 è¡¥å……ç¼ºå¤±çš„ä»£ç </h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">print_directory_contents</span><span class="p">(</span><span class="n">sPath</span><span class="p">):</span>
    <span class="s">"""
    è¿™ä¸ªå‡½æ•°æ¥æ”¶æ–‡ä»¶å¤¹çš„åç§°ä½œä¸ºè¾“å…¥å‚æ•°
    è¿”å›è¯¥æ–‡ä»¶å¤¹ä¸­æ–‡ä»¶çš„è·¯å¾„
    ä»¥åŠå…¶åŒ…å«æ–‡ä»¶å¤¹ä¸­æ–‡ä»¶çš„è·¯å¾„
    """</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="k">for</span> <span class="n">sChild</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sPath</span><span class="p">):</span>
        <span class="n">sChildPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sPath</span><span class="p">,</span><span class="n">sChild</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">sChildPath</span><span class="p">):</span>
            <span class="n">print_directory_contents</span><span class="p">(</span><span class="n">sChildPath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">sChildPath</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="æ¨¡å—ä¸åŒ…">æ¨¡å—ä¸åŒ…</h2>

<h3 id="21-è¾“å…¥æ—¥æœŸ-åˆ¤æ–­è¿™ä¸€å¤©æ˜¯è¿™ä¸€å¹´çš„ç¬¬å‡ å¤©">2.1 è¾“å…¥æ—¥æœŸï¼Œ åˆ¤æ–­è¿™ä¸€å¤©æ˜¯è¿™ä¸€å¹´çš„ç¬¬å‡ å¤©ï¼Ÿ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">datetime</span>
<span class="k">def</span> <span class="nf">dayofyear</span><span class="p">():</span>
    <span class="n">year</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"è¯·è¾“å…¥å¹´ä»½: "</span><span class="p">)</span>
    <span class="n">month</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"è¯·è¾“å…¥æœˆä»½: "</span><span class="p">)</span>
    <span class="n">day</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"è¯·è¾“å…¥å¤©: "</span><span class="p">)</span>
    <span class="n">date1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">),</span><span class="n">month</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">month</span><span class="p">),</span><span class="n">day</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">day</span><span class="p">))</span>
    <span class="n">date2</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">),</span><span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">date1</span><span class="o">-</span><span class="n">date2</span><span class="p">)</span><span class="o">.</span><span class="n">days</span><span class="o">+</span><span class="mi">1</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="22-æ‰“ä¹±ä¸€ä¸ªæ’å¥½åºçš„listå¯¹è±¡alist">2.2 æ‰“ä¹±ä¸€ä¸ªæ’å¥½åºçš„listå¯¹è±¡alistï¼Ÿ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">random</span>
<span class="n">alist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">alist</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">alist</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹</h2>

<h3 id="31-ç°æœ‰å­—å…¸-d-a24g52i12k33è¯·æŒ‰valueå€¼è¿›è¡Œæ’åº">3.1 ç°æœ‰å­—å…¸ d= {â€˜aâ€™:24,â€™gâ€™:52,â€™iâ€™:12,â€™kâ€™:33}è¯·æŒ‰valueå€¼è¿›è¡Œæ’åº?</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="32-å­—å…¸æ¨å¯¼å¼">3.2 å­—å…¸æ¨å¯¼å¼</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="33-è¯·åè½¬å­—ç¬¦ä¸²-astr">3.3 è¯·åè½¬å­—ç¬¦ä¸² â€œaStrâ€?</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">print</span><span class="p">(</span><span class="s">"aStr"</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="34-å°†å­—ç¬¦ä¸²-k1-k12k23k34å¤„ç†æˆå­—å…¸-k1k12">3.4 å°†å­—ç¬¦ä¸² â€œk:1 |k1:2|k2:3|k3:4â€ï¼Œå¤„ç†æˆå­—å…¸ {k:1,k1:2,â€¦}</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">str1</span> <span class="o">=</span> <span class="s">"k:1|k1:2|k2:3|k3:4"</span>
<span class="k">def</span> <span class="nf">str2dict</span><span class="p">(</span><span class="n">str1</span><span class="p">):</span>
    <span class="n">dict1</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">iterms</span> <span class="ow">in</span> <span class="n">str1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">):</span>
        <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="o">=</span> <span class="n">iterms</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">):</span>
            <span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">dict1</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="35-è¯·æŒ‰alistä¸­å…ƒç´ çš„ageç”±å°åˆ°å¤§æ’åº">3.5 è¯·æŒ‰alistä¸­å…ƒç´ çš„ageç”±å°åˆ°å¤§æ’åº</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">alist</span> <span class="o">=</span> <span class="p">[{</span><span class="s">'name'</span><span class="p">:</span><span class="s">'a'</span><span class="p">,</span><span class="s">'age'</span><span class="p">:</span><span class="mi">20</span><span class="p">},{</span><span class="s">'name'</span><span class="p">:</span><span class="s">'b'</span><span class="p">,</span><span class="s">'age'</span><span class="p">:</span><span class="mi">30</span><span class="p">},{</span><span class="s">'name'</span><span class="p">:</span><span class="s">'c'</span><span class="p">,</span><span class="s">'age'</span><span class="p">:</span><span class="mi">25</span><span class="p">}]</span>
<span class="k">def</span> <span class="nf">sort_by_age</span><span class="p">(</span><span class="n">list1</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">alist</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s">'age'</span><span class="p">],</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="36-ä¸‹é¢ä»£ç çš„è¾“å‡ºç»“æœå°†æ˜¯ä»€ä¹ˆ">3.6 ä¸‹é¢ä»£ç çš„è¾“å‡ºç»“æœå°†æ˜¯ä»€ä¹ˆï¼Ÿ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s">'a'</span><span class="p">,</span><span class="s">'b'</span><span class="p">,</span><span class="s">'c'</span><span class="p">,</span><span class="s">'d'</span><span class="p">,</span><span class="s">'e'</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="mi">10</span><span class="p">:])</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>ä»£ç å°†è¾“å‡º[],ä¸ä¼šäº§ç”ŸIndexErroré”™è¯¯ï¼Œå°±åƒæ‰€æœŸæœ›çš„é‚£æ ·ï¼Œå°è¯•ç”¨è¶…å‡ºæˆå‘˜çš„ä¸ªæ•°çš„indexæ¥è·å–æŸä¸ªåˆ—è¡¨çš„æˆå‘˜ã€‚ä¾‹å¦‚ï¼Œå°è¯•è·å–list[10]å’Œä¹‹åçš„æˆå‘˜ï¼Œä¼šå¯¼è‡´IndexErrorã€‚ç„¶è€Œï¼Œå°è¯•è·å–åˆ—è¡¨çš„<strong>åˆ‡ç‰‡</strong>ï¼Œå¼€å§‹çš„indexè¶…è¿‡äº†æˆå‘˜ä¸ªæ•°<strong>ä¸ä¼šäº§ç”ŸIndexError</strong>ï¼Œè€Œæ˜¯ä»…ä»…è¿”å›ä¸€ä¸ªç©ºåˆ—è¡¨ã€‚è¿™æˆä¸ºç‰¹åˆ«è®©äººæ¶å¿ƒçš„ç–‘éš¾æ‚ç—‡ï¼Œå› ä¸ºè¿è¡Œçš„æ—¶å€™æ²¡æœ‰é”™è¯¯äº§ç”Ÿï¼Œå¯¼è‡´Bugå¾ˆéš¾è¢«è¿½è¸ªåˆ°ã€‚</p>
<h3 id="37-å†™ä¸€ä¸ªåˆ—è¡¨ç”Ÿæˆå¼äº§ç”Ÿä¸€ä¸ªå…¬å·®ä¸º11çš„ç­‰å·®æ•°åˆ—">3.7 å†™ä¸€ä¸ªåˆ—è¡¨ç”Ÿæˆå¼ï¼Œäº§ç”Ÿä¸€ä¸ªå…¬å·®ä¸º11çš„ç­‰å·®æ•°åˆ—</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">print</span><span class="p">([</span><span class="n">x</span><span class="o">*</span><span class="mi">11</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
<span class="k">print</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">11</span><span class="p">)])</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="38-ç»™å®šä¸¤ä¸ªåˆ—è¡¨æ€ä¹ˆæ‰¾å‡ºä»–ä»¬ç›¸åŒçš„å…ƒç´ å’Œä¸åŒçš„å…ƒç´ ">3.8 ç»™å®šä¸¤ä¸ªåˆ—è¡¨ï¼Œæ€ä¹ˆæ‰¾å‡ºä»–ä»¬ç›¸åŒçš„å…ƒç´ å’Œä¸åŒçš„å…ƒç´ ï¼Ÿ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">list1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">list2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">set1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span>
<span class="n">set2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">list2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">set1</span> <span class="o">&amp;</span> <span class="n">set2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">set1</span> <span class="o">^</span> <span class="n">set2</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="39-è¯·å†™å‡ºä¸€æ®µpythonä»£ç å®ç°åˆ é™¤listé‡Œé¢çš„é‡å¤å…ƒç´ ">3.9 è¯·å†™å‡ºä¸€æ®µpythonä»£ç å®ç°åˆ é™¤listé‡Œé¢çš„é‡å¤å…ƒç´ ï¼Ÿ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">l1</span> <span class="o">=</span> <span class="p">[</span><span class="s">'b'</span><span class="p">,</span><span class="s">'c'</span><span class="p">,</span><span class="s">'d'</span><span class="p">,</span><span class="s">'c'</span><span class="p">,</span><span class="s">'a'</span><span class="p">,</span><span class="s">'a'</span><span class="p">]</span>
<span class="n">l2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">l1</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
<span class="c1"># è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œæ˜¯é€šè¿‡list-&gt;set-&gt;listå‡ æ­¥æŠ“æ¢ä¼šæ”¹å˜åŸæœ‰listçš„å…ƒç´ é¡ºåºï¼Œæ‰€æœ‰æœ‰ä¸‹é¢çš„æ”¹åŠ¨
</span></pre></td></tr></tbody></table></code></pre></div></div>
<p>ç”¨listç±»çš„sortæ–¹æ³•:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">l1</span> <span class="o">=</span> <span class="p">[</span><span class="s">'b'</span><span class="p">,</span><span class="s">'c'</span><span class="p">,</span><span class="s">'d'</span><span class="p">,</span><span class="s">'c'</span><span class="p">,</span><span class="s">'a'</span><span class="p">,</span><span class="s">'a'</span><span class="p">]</span>
<span class="n">l2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">l1</span><span class="p">))</span>
<span class="n">l2</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">l1</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>ä¹Ÿå¯ä»¥è¿™æ ·å†™:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">l1</span> <span class="o">=</span> <span class="p">[</span><span class="s">'b'</span><span class="p">,</span><span class="s">'c'</span><span class="p">,</span><span class="s">'d'</span><span class="p">,</span><span class="s">'c'</span><span class="p">,</span><span class="s">'a'</span><span class="p">,</span><span class="s">'a'</span><span class="p">]</span>
<span class="n">l2</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">l1</span><span class="p">),</span><span class="n">key</span><span class="o">=</span><span class="n">l1</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>ä¹Ÿå¯ä»¥ç”¨éå†ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">l1</span> <span class="o">=</span> <span class="p">[</span><span class="s">'b'</span><span class="p">,</span><span class="s">'c'</span><span class="p">,</span><span class="s">'d'</span><span class="p">,</span><span class="s">'c'</span><span class="p">,</span><span class="s">'a'</span><span class="p">,</span><span class="s">'a'</span><span class="p">]</span>
<span class="n">l2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l1</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l2</span><span class="p">:</span>
        <span class="n">l2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="ä¼ä¸šé¢è¯•é¢˜">ä¼ä¸šé¢è¯•é¢˜</h2>

<h3 id="41-pythonæ–°å¼ç±»å’Œç»å…¸ç±»çš„åŒºåˆ«">4.1 pythonæ–°å¼ç±»å’Œç»å…¸ç±»çš„åŒºåˆ«ï¼Ÿ</h3>

<ol>
  <li>åœ¨pythoné‡Œå‡¡æ˜¯ç»§æ‰¿äº†objectçš„ç±»ï¼Œéƒ½æ˜¯æ–°å¼ç±»</li>
  <li>Python3é‡Œåªæœ‰æ–°å¼ç±»</li>
  <li>Python2é‡Œé¢ç»§æ‰¿objectçš„æ˜¯æ–°å¼ç±»ï¼Œæ²¡æœ‰å†™çˆ¶ç±»çš„æ˜¯ç»å…¸ç±»</li>
  <li>ç»å…¸ç±»ç›®å‰åœ¨Pythoné‡ŒåŸºæœ¬æ²¡æœ‰åº”ç”¨</li>
</ol>

<h3 id="42-pythonä¸­å†…ç½®çš„æ•°æ®ç»“æ„æœ‰å‡ ç§">4.2 pythonä¸­å†…ç½®çš„æ•°æ®ç»“æ„æœ‰å‡ ç§ï¼Ÿ</h3>

<ol>
  <li>æ•´å‹ intã€ é•¿æ•´å‹ longã€æµ®ç‚¹å‹ floatã€ å¤æ•° complex</li>
  <li>å­—ç¬¦ä¸² strã€ åˆ—è¡¨listã€ å…ƒç¥–tuple</li>
  <li>å­—å…¸ dict ã€ é›†åˆ set</li>
</ol>

<h3 id="43-pythonå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼è¯·å†™å‡ºä¸¤ç§å®ç°æ–¹å¼">4.3 pythonå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼?è¯·å†™å‡ºä¸¤ç§å®ç°æ–¹å¼?`</h3>

<blockquote>
  <p><strong>å•ä¾‹æ¨¡å¼</strong>ï¼ˆSingleton Patternï¼‰åŸæœ¬æ˜¯Javaå¼€å‘çš„åŸºæœ¬è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œå±äº<strong>åˆ›å»ºå‹</strong>æ¨¡å¼ã€‚è¿™ç§<strong>æ¨¡å¼</strong>æ¶‰åŠåˆ°ä¸€ä¸ªå•ä¸€çš„ç±»ï¼Œè¯¥ç±»è´Ÿè´£åˆ›å»ºè‡ªå·±çš„å¯¹è±¡ï¼ŒåŒæ—¶ç¡®ä¿åªæœ‰å•ä¸ªå¯¹è±¡è¢«åˆ›å»ºã€‚ è¿™ä¸ªç±»æä¾›äº†ä¸€ç§è®¿é—®å…¶å”¯ä¸€çš„å¯¹è±¡çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦<strong>å®ä¾‹</strong>åŒ–è¯¥ç±»çš„å¯¹è±¡ã€‚</p>
</blockquote>

<p>ç¬¬ä¸€ç§æ–¹æ³•:ä½¿ç”¨<strong>è£…é¥°å™¨</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">singleton</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
    <span class="c1"># è¿™ç§æ–¹æ³•ä¸‹ä¿è¯æ¯ä¸ªè¢«è£…é¥°çš„classåªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡
</span>    <span class="n">instances</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cls</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
            <span class="n">instances</span><span class="p">[</span><span class="n">cls</span><span class="p">]</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instances</span><span class="p">[</span><span class="n">cls</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="o">@</span><span class="n">singleton</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">foo1</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="n">foo2</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">foo1</span> <span class="ow">is</span> <span class="n">foo2</span><span class="p">)</span> <span class="c1">#True
</span></pre></td></tr></tbody></table></code></pre></div></div>
<p>ç¬¬äºŒç§æ–¹æ³•ï¼šä½¿ç”¨<strong>åŸºç±»</strong>
New æ˜¯çœŸæ­£åˆ›å»ºå®ä¾‹å¯¹è±¡çš„æ–¹æ³•ï¼Œæ‰€ä»¥é‡å†™åŸºç±»çš„new æ–¹æ³•ï¼Œä»¥æ­¤ä¿è¯åˆ›å»ºå¯¹è±¡çš„æ—¶å€™åªç”Ÿæˆä¸€ä¸ªå®ä¾‹</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Singleton</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="s">'_instance'</span><span class="p">):</span>
            <span class="n">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Singleton</span><span class="p">,</span><span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_instance</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">Singleton</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">foo1</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="n">foo2</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>

<span class="k">print</span> <span class="n">foo1</span> <span class="ow">is</span> <span class="n">foo2</span> <span class="c1">#True
</span></pre></td></tr></tbody></table></code></pre></div></div>
<p>ç¬¬ä¸‰ç§æ–¹æ³•ï¼š<strong>å…ƒç±»</strong>ï¼Œå…ƒç±»æ˜¯ç”¨äºåˆ›å»ºç±»å¯¹è±¡çš„ç±»ï¼Œç±»å¯¹è±¡åˆ›å»ºå®ä¾‹å¯¹è±¡æ—¶ä¸€å®šè¦è°ƒç”¨callæ–¹æ³•ï¼Œå› æ­¤åœ¨è°ƒç”¨callæ—¶å€™ä¿è¯å§‹ç»ˆåªåˆ›å»ºä¸€ä¸ªå®ä¾‹å³å¯ï¼Œtypeæ˜¯pythonçš„å…ƒç±»</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Singleton</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="s">'_instance'</span><span class="p">):</span>
            <span class="n">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Singleton</span><span class="p">,</span><span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_instance</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">Singleton</span>

<span class="n">foo1</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="n">foo2</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="k">print</span> <span class="n">foo1</span> <span class="ow">is</span> <span class="n">foo2</span> <span class="c1">#True
</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="44-åè½¬ä¸€ä¸ªæ•´æ•°ä¾‹å¦‚-123---321">4.4 åè½¬ä¸€ä¸ªæ•´æ•°ï¼Œä¾‹å¦‚-123 â€“&gt; -321</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Solution</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="o">-</span><span class="mi">10</span><span class="o">&lt;</span><span class="n">x</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span>
        <span class="n">str_x</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">str_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span><span class="s">"-"</span><span class="p">:</span>
            <span class="n">str_x</span> <span class="o">=</span> <span class="n">str_x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">str_x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">str_x</span> <span class="o">=</span> <span class="n">str_x</span><span class="p">[</span><span class="mi">1</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">str_x</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
        <span class="k">return</span> <span class="n">x</span> <span class="k">if</span> <span class="o">-</span><span class="mi">2147483648</span><span class="o">&lt;</span><span class="n">x</span><span class="o">&lt;</span><span class="mi">2147483647</span> <span class="k">else</span> <span class="mi">0</span>
    
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">()</span>
    <span class="n">reverse_int</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span><span class="o">-</span><span class="mi">120</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">reverse_int</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="45-è®¾è®¡å®ç°éå†ç›®å½•ä¸å­ç›®å½•æŠ“å–pycæ–‡ä»¶">4.5 è®¾è®¡å®ç°éå†ç›®å½•ä¸å­ç›®å½•ï¼ŒæŠ“å–.pycæ–‡ä»¶</h2>
<p>ç¬¬ä¸€ç§æ–¹æ³•ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">getFiles</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="n">suffix</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span><span class="n">dirs</span><span class="p">,</span><span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span><span class="n">suf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">suf</span> <span class="o">==</span> <span class="n">suffix</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">filename</span><span class="p">))</span>

    <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

<span class="n">getFiles</span><span class="p">(</span><span class="s">"./"</span><span class="p">,</span><span class="s">'.pyc'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>ç¬¬äºŒç§æ–¹æ³•ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">pick</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s">".pyc"</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">scan_path</span><span class="p">(</span><span class="n">ph</span><span class="p">):</span>
    <span class="n">file_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    		<span class="n">pick</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="n">scan_path</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">path</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'è¾“å…¥ç›®å½•'</span><span class="p">)</span>
    <span class="n">scan_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<blockquote>
  <p>ä¸Šé¢ä¸¤ç§æ–¹æ³•ä¸»è¦é‡‡ç”¨äº†osåº“çš„<code class="highlighter-rouge">listdir</code>å’Œ<code class="highlighter-rouge">walk</code>çš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘è§‰å¾—å¦‚æœæ¢æˆæˆ‘æ¥å†™å¯èƒ½ä¼šå†™çš„æ›´ç®€æ´ä¸€ç‚¹ã€‚</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">get_files</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">suffix</span><span class="p">):</span>
    <span class="c1"># éœ€è¦åœ¨å‡½æ•°å¤–éªŒè¯dirçš„æœ‰æ•ˆæ€§
</span>    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
		<span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span> <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="nb">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)]</span>
        <span class="n">res</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="46-ä¸€è¡Œä»£ç å®ç°1-100ä¹‹å’Œ">4.6 ä¸€è¡Œä»£ç å®ç°1-100ä¹‹å’Œ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">101</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="pythoné«˜çº§">Pythoné«˜çº§</h2>

<h3 id="51-å¯¹è®¾è®¡æ¨¡å¼çš„ç†è§£ç®€è¿°ä½ äº†è§£çš„è®¾è®¡æ¨¡å¼">5.1 å¯¹è®¾è®¡æ¨¡å¼çš„ç†è§£ï¼Œç®€è¿°ä½ äº†è§£çš„è®¾è®¡æ¨¡å¼ï¼Ÿ</h3>

<p>è®¾è®¡æ¨¡å¼æ˜¯ç»è¿‡æ€»ç»“ï¼Œä¼˜åŒ–çš„ï¼Œå¯¹æˆ‘ä»¬ç»å¸¸ä¼šç¢°åˆ°çš„ä¸€äº›ç¼–ç¨‹é—®é¢˜çš„å¯é‡ç”¨è§£å†³æ–¹æ¡ˆã€‚ä¸€ä¸ªè®¾è®¡æ¨¡å¼å¹¶ä¸åƒä¸€ä¸ªç±»æˆ–ä¸€ä¸ªåº“é‚£æ ·èƒ½å¤Ÿç›´æ¥ä½œç”¨äºæˆ‘ä»¬çš„ä»£ç ï¼Œåä¹‹ï¼Œè®¾è®¡æ¨¡å¼æ›´ä¸ºé«˜çº§ï¼Œå®ƒæ˜¯ä¸€ç§å¿…é¡»åœ¨ç‰¹å®šæƒ…å½¢ä¸‹å®ç°çš„ä¸€ç§<strong>æ–¹æ³•æ¨¡æ¿</strong>ã€‚
å¸¸è§çš„æ˜¯<strong>å·¥å‚æ¨¡å¼</strong>å’Œ<strong>å•ä¾‹æ¨¡å¼</strong>ã€‚</p>

<blockquote>
  <p><strong>å·¥å‚æ¨¡å¼</strong>ï¼ˆFactory Patternï¼‰æ˜¯ Java ä¸­æœ€å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äº<strong>åˆ›å»ºå‹</strong>æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚åœ¨å·¥å‚æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºå¯¹è±¡æ—¶ä¸ä¼šå¯¹å®¢æˆ·ç«¯æš´éœ²åˆ›å»ºé€»è¾‘ï¼Œå¹¶ä¸”æ˜¯é€šè¿‡ä½¿ç”¨ä¸€ä¸ªå…±åŒçš„æ¥å£æ¥æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚</p>
</blockquote>

<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å·¥å‚ç±»çš„ç¤ºä¾‹</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="c1">// å­ç±»å®ç°å¦‚ä¸‹</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Shape</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">draw</span><span class="o">();</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CircleShape</span> <span class="kd">implements</span> <span class="nc">Shape</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">CircleShape</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>  <span class="s">"CircleShape: created"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>  <span class="s">"draw: CircleShape"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShapeFactory</span> <span class="o">{</span>
    <span class="c1">// å·¥å‚ç±»</span>
    <span class="c1">// å…¶ä¸­æ¯ä¸ªå­ç±»éœ€è¦å•ç‹¬å®ç°</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">TAG</span> <span class="o">=</span> <span class="s">"ShapeFactory"</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Shape</span> <span class="nf">getShape</span><span class="o">(</span><span class="nc">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Shape</span> <span class="n">shape</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"circle"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CircleShape</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"rect"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RectShape</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"triangle"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TriangleShape</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">shape</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p><a href="###4.3 pythonå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼?è¯·å†™å‡ºä¸¤ç§å®ç°æ–¹å¼?"><strong>å•ä¾‹æ¨¡å¼</strong></a>ä¸Šé¢æè¿‡ï¼Œå°±ä¸å†èµ˜è¿°ã€‚</p>
</blockquote>

<h3 id="52-è¯·æ‰‹å†™ä¸€ä¸ªå•ä¾‹">5.2 è¯·æ‰‹å†™ä¸€ä¸ªå•ä¾‹</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c1"># python2
</span><span class="k">class</span> <span class="nc">Singleton</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__instance</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cls</span><span class="o">.</span><span class="n">__instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cls</span><span class="o">.</span><span class="n">__instance</span> <span class="o">=</span> <span class="n">objecet</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">__instance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">__instance</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="53-å•ä¾‹æ¨¡å¼çš„åº”ç”¨åœºæ™¯æœ‰é‚£äº›">5.3 å•ä¾‹æ¨¡å¼çš„åº”ç”¨åœºæ™¯æœ‰é‚£äº›ï¼Ÿ</h3>

<p>å•ä¾‹æ¨¡å¼åº”ç”¨çš„åœºæ™¯ä¸€èˆ¬å‘ç°åœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹ï¼š
èµ„æºå…±äº«çš„æƒ…å†µä¸‹ï¼Œé¿å…ç”±äºèµ„æºæ“ä½œæ—¶å¯¼è‡´çš„æ€§èƒ½æˆ–æŸè€—ç­‰ï¼Œå¦‚æ—¥å¿—æ–‡ä»¶ï¼Œåº”ç”¨é…ç½®ã€‚
æ§åˆ¶èµ„æºçš„æƒ…å†µä¸‹ï¼Œæ–¹ä¾¿èµ„æºä¹‹é—´çš„äº’ç›¸é€šä¿¡ã€‚å¦‚çº¿ç¨‹æ± ç­‰ï¼Œ1,ç½‘ç«™çš„è®¡æ•°å™¨ 2,åº”ç”¨é…ç½® 3.å¤šçº¿ç¨‹æ±  4æ•°æ®åº“é…ç½® æ•°æ®åº“è¿æ¥æ±  5.åº”ç”¨ç¨‹åºçš„æ—¥å¿—åº”ç”¨â€¦</p>

<h3 id="54-å¯¹è£…é¥°å™¨çš„ç†è§£å¹¶å†™å‡ºä¸€ä¸ªè®¡æ—¶å™¨è®°å½•æ–¹æ³•æ‰§è¡Œæ€§èƒ½çš„è£…é¥°å™¨">5.4 å¯¹è£…é¥°å™¨çš„ç†è§£ï¼Œå¹¶å†™å‡ºä¸€ä¸ªè®¡æ—¶å™¨è®°å½•æ–¹æ³•æ‰§è¡Œæ€§èƒ½çš„è£…é¥°å™¨ï¼Ÿ</h3>

<p>è£…é¥°å™¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªpythonå‡½æ•°ï¼Œå®ƒå¯ä»¥è®©å…¶ä»–å‡½æ•°åœ¨ä¸éœ€è¦åšä»»ä½•ä»£ç å˜åŠ¨çš„å‰æä¸‹å¢åŠ é¢å¤–åŠŸèƒ½ï¼Œè£…é¥°å™¨çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">time</span>
<span class="k">def</span> <span class="nf">timeit</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
        <span class="n">func</span><span class="p">()</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'used:'</span><span class="p">,</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>
<span class="o">@</span><span class="n">timeit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'in foo()'</span><span class="n">foo</span><span class="p">())</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="55-è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯é—­åŒ…closure">5.5 è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯é—­åŒ…(Closure)ï¼Ÿ</h3>

<p>åœ¨å‡½æ•°å†…éƒ¨å†å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°ç”¨åˆ°äº†å¤–è¾¹å‡½æ•°çš„å˜é‡ï¼Œé‚£ä¹ˆå°†è¿™ä¸ªå‡½æ•°ä»¥åŠç”¨åˆ°çš„ä¸€äº›å˜é‡ç§°ä¹‹ä¸ºé—­åŒ…ã€‚</p>

<h3 id="56-å‡½æ•°è£…é¥°å™¨æœ‰ä»€ä¹ˆä½œç”¨">5.6 å‡½æ•°è£…é¥°å™¨æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h3>

<p>è£…é¥°å™¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªpythonå‡½æ•°ï¼Œå®ƒå¯ä»¥åœ¨è®©å…¶ä»–å‡½æ•°åœ¨ä¸éœ€è¦åšä»»ä½•ä»£ç çš„å˜åŠ¨çš„å‰æä¸‹å¢åŠ é¢å¤–çš„åŠŸèƒ½ã€‚è£…é¥°å™¨çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°çš„å¯¹è±¡ï¼Œå®ƒç»å¸¸ç”¨äºæœ‰åˆ‡é¢éœ€æ±‚çš„åœºæ™¯ã€‚æ¯”å¦‚ï¼šæ’å…¥æ—¥å¿—ï¼Œæ€§èƒ½æµ‹è¯•ï¼Œäº‹åŠ¡å¤„ç†ï¼Œç¼“å­˜ã€‚æƒé™çš„æ ¡éªŒç­‰åœºæ™¯ï¼Œæœ‰äº†è£…é¥°å™¨å°±å¯ä»¥æŠ½ç¦»å‡ºå¤§é‡çš„ä¸å‡½æ•°åŠŸèƒ½æœ¬èº«æ— å…³çš„é›·åŒä»£ç å¹¶å‘å¹¶ç»§ç»­ä½¿ç”¨ã€‚</p>
<h3 id="57-ç”Ÿæˆå™¨è¿­ä»£å™¨çš„åŒºåˆ«">5.7 ç”Ÿæˆå™¨ï¼Œè¿­ä»£å™¨çš„åŒºåˆ«ï¼Ÿ</h3>

<p>è¿­ä»£å™¨ï¼ˆiteratorï¼‰æ˜¯ä¸€ä¸ªæ›´æŠ½è±¡çš„æ¦‚å¿µï¼Œä»»ä½•å¯¹è±¡ï¼Œå¦‚æœå®ƒçš„ç±»æœ‰<code class="highlighter-rouge">next</code>æ–¹æ³•å’Œ<code class="highlighter-rouge">iter</code>æ–¹æ³•è¿”å›è‡ªå·±æœ¬èº«ï¼Œå¯¹äºstring,list,dict,tupleç­‰è¿™ç±»å®¹å™¨å¯¹è±¡ï¼Œä½¿ç”¨forå¾ªç¯éå†æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œåœ¨åå°forè¯­å¥å¯¹å®¹å™¨å¯¹è±¡è°ƒç”¨iter()å‡½æ•°ï¼Œiter()æ˜¯pythonçš„å†…ç½®å‡½æ•°ï¼Œ<code class="highlighter-rouge">iter()</code>ä¼šè¿”å›ä¸€ä¸ªå®šä¹‰äº†<code class="highlighter-rouge">next()</code>æ–¹æ³•çš„è¿­ä»£å™¨å¯¹è±¡ï¼Œå®ƒåœ¨å®¹å™¨ä¸­é€ä¸ªè®¿é—®å®¹å™¨å†…å…ƒç´ ï¼Œ<code class="highlighter-rouge">next()</code>ä¹Ÿæ˜¯pythonçš„å†…ç½®å‡½æ•°ï¼Œåœ¨æ²¡æœ‰åç»­å…ƒç´ æ—¶ï¼Œ<code class="highlighter-rouge">next()</code>ä¼šæŠ›å‡ºä¸€ä¸ª<code class="highlighter-rouge">StopIteration</code>å¼‚å¸¸ã€‚
ç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰æ˜¯åˆ›å»ºè¿­ä»£å™¨çš„ç®€å•è€Œå¼ºå¤§çš„å·¥å…·ã€‚å®ƒä»¬å†™èµ·æ¥å°±åƒæ˜¯æ­£è§„çš„å‡½æ•°ï¼Œåªæ˜¯åœ¨éœ€è¦è¿”å›æ•°æ®çš„æ—¶å€™ä½¿ç”¨<code class="highlighter-rouge">yield</code>è¯­å¥ã€‚æ¯æ¬¡<code class="highlighter-rouge">next()</code>è¢«è°ƒç”¨æ—¶ï¼Œç”Ÿæˆå™¨ä¼šè¿”å›å®ƒè„±ç¦»çš„ä½ç½®ï¼ˆå®ƒè®°å¿†è¯­å¥æœ€åä¸€æ¬¡æ‰§è¡Œçš„ä½ç½®å’Œæ‰€æœ‰çš„æ•°æ®å€¼ï¼‰
åŒºåˆ«ï¼š ç”Ÿæˆå™¨èƒ½åšåˆ°è¿­ä»£å™¨èƒ½åšçš„æ‰€æœ‰äº‹ï¼Œè€Œä¸”å› ä¸ºè‡ªåŠ¨åˆ›å»º<code class="highlighter-rouge">iter()</code>å’Œ<code class="highlighter-rouge">next()</code>æ–¹æ³•ï¼Œç”Ÿæˆå™¨æ˜¾å¾—ç‰¹åˆ«ç®€æ´ï¼Œè€Œä¸”ç”Ÿæˆå™¨ä¹Ÿæ˜¯é«˜æ•ˆçš„ï¼Œä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼å–ä»£åˆ—è¡¨è§£æå¯ä»¥åŒæ—¶èŠ‚çœå†…å­˜ã€‚é™¤äº†åˆ›å»ºå’Œä¿å­˜ç¨‹åºçŠ¶æ€çš„è‡ªåŠ¨æ–¹æ³•ï¼Œå½“å‘ç”Ÿå™¨ç»ˆç»“æ—¶ï¼Œè¿˜ä¼šè‡ªåŠ¨æŠ›å‡º<code class="highlighter-rouge">StopIteration</code>å¼‚å¸¸ã€‚</p>

<h3 id="58-xæ˜¯ä»€ä¹ˆç±»å‹">5.8 Xæ˜¯ä»€ä¹ˆç±»å‹?</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">X</span> <span class="o">=</span> <span class="p">(</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ramg</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="c1"># X æ˜¯generatorç±»å‹
</span></pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="59-è¯·ç”¨ä¸€è¡Œä»£ç -å®ç°å°†1-n-çš„æ•´æ•°åˆ—è¡¨ä»¥3ä¸ºå•ä½åˆ†ç»„">5.9 è¯·ç”¨ä¸€è¡Œä»£ç  å®ç°å°†1-N çš„æ•´æ•°åˆ—è¡¨ä»¥3ä¸ºå•ä½åˆ†ç»„</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c1"># original one
</span><span class="k">print</span><span class="p">([[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)]</span> <span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">list_a</span><span class="p">),</span><span class="mi">3</span><span class="p">)])</span>
<span class="c1"># My idea
</span><span class="k">print</span><span class="p">([[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="510-pythonä¸­yieldçš„ç”¨æ³•">5.10 Pythonä¸­yieldçš„ç”¨æ³•</h3>

<p><code class="highlighter-rouge">yield</code>å°±æ˜¯ä¿å­˜å½“å‰ç¨‹åºæ‰§è¡ŒçŠ¶æ€ã€‚ä½ ç”¨forå¾ªç¯çš„æ—¶å€™ï¼Œæ¯æ¬¡å–ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™å°±ä¼šè®¡ç®—ä¸€æ¬¡ã€‚ç”¨yieldçš„å‡½æ•°å«<code class="highlighter-rouge">generator</code>,å’Œ<code class="highlighter-rouge">iterator</code>ä¸€æ ·ï¼Œå®ƒçš„å¥½å¤„æ˜¯ä¸ç”¨ä¸€æ¬¡è®¡ç®—æ‰€æœ‰å…ƒç´ ï¼Œè€Œæ˜¯ç”¨ä¸€æ¬¡ç®—ä¸€æ¬¡ï¼Œå¯ä»¥èŠ‚çœå¾ˆå¤šç©ºé—´ï¼Œgeneratoræ¯æ¬¡è®¡ç®—éœ€è¦ä¸Šä¸€æ¬¡è®¡ç®—ç»“æœï¼Œæ‰€ä»¥ç”¨yield, å¦åˆ™ä¸€returnï¼Œä¸Šæ¬¡è®¡ç®—ç»“æœå°±æ²¡äº†</p>

<h2 id="ç³»ç»Ÿç¼–ç¨‹">ç³»ç»Ÿç¼–ç¨‹</h2>

<h3 id="61-è¿›ç¨‹æ€»ç»“">6.1 è¿›ç¨‹æ€»ç»“</h3>

<p><strong>è¿›ç¨‹</strong>ï¼šç¨‹åºè¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¸Šçš„ä¸€ä¸ªå®ä¾‹ï¼Œå°±ç§°ä¹‹ä¸ºè¿›ç¨‹ã€‚è¿›ç¨‹éœ€è¦ç›¸åº”çš„ç³»ç»Ÿèµ„æºï¼šå†…å­˜ã€æ—¶é—´ç‰‡ã€pidã€‚<strong>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèµ„æºè°ƒåº¦çš„æœ€å°å•ä½</strong>ã€‚</p>

<ul>
  <li>
    <p><strong>åˆ›å»ºè¿›ç¨‹</strong>ï¼š</p>

    <p>é¦–å…ˆè¦å¯¼å…¥multiprocessingä¸­çš„Processï¼š</p>

    <p>åˆ›å»ºä¸€ä¸ªProcesså¯¹è±¡;
åˆ›å»ºProcesså¯¹è±¡æ—¶ï¼Œå¯ä»¥ä¼ é€’å‚æ•°;</p>
  </li>
</ul>

<pre><code class="language-pseudocode">    p = Process(target=XXX,args=(tuple,),kwargs={key:value})
    target = XXX æŒ‡å®šçš„ä»»åŠ¡å‡½æ•°ï¼Œä¸ç”¨åŠ (),
    args=(tuple,)kwargs={key:value} ç»™ä»»åŠ¡å‡½æ•°ä¼ é€’çš„å‚æ•°
</code></pre>
<ul>
  <li><strong>ä½¿ç”¨start()å¯åŠ¨è¿›ç¨‹</strong>:
ç»“æŸè¿›ç¨‹
ç»™å­è¿›ç¨‹æŒ‡å®šå‡½æ•°ä¼ é€’å‚æ•°Demo</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">from</span> <span class="nn">mulitprocessing</span> <span class="kn">import</span> <span class="n">Process</span>
    <span class="kn">import</span> <span class="nn">time</span>

    <span class="k">def</span> <span class="nf">pro_func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">age</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"å­è¿›ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œname=</span><span class="si">%</span><span class="s">s,age=</span><span class="si">%</span><span class="s">d,pid=</span><span class="si">%</span><span class="s">d"</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">age</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span><span class="s">"__main__"</span><span class="p">:</span>
        <span class="c1">#åˆ›å»ºProcesså¯¹è±¡
</span>        <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">pro_func</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s">'å°æ˜'</span><span class="p">,</span><span class="mi">18</span><span class="p">),</span><span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">'m'</span><span class="p">:</span><span class="mi">20</span><span class="p">})</span>
        <span class="c1">#å¯åŠ¨è¿›ç¨‹
</span>        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#1ç§’é’Ÿä¹‹åï¼Œç«‹åˆ»ç»“æŸå­è¿›ç¨‹
</span>        <span class="n">p</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p><em>æ³¨æ„ï¼šè¿›ç¨‹é—´ä¸å…±äº«å…¨å±€å˜é‡</em></p>

<ul>
  <li>
    <p>è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡: <code class="highlighter-rouge">Queue</code></p>
  </li>
  <li>
    <p>åœ¨åˆå§‹åŒ–<code class="highlighter-rouge">Queue()</code>å¯¹è±¡æ—¶ï¼ˆä¾‹å¦‚q=Queue(),è‹¥åœ¨æ‹¬å·ä¸­æ²¡æœ‰æŒ‡å®šæœ€å¤§å¯æ¥å—çš„æ¶ˆæ¯æ•°é‡ï¼Œè·æ•°é‡ä¸ºè´Ÿå€¼æ—¶ï¼Œé‚£ä¹ˆå°±ä»£è¡¨å¯æ¥å—çš„æ¶ˆæ¯æ•°é‡æ²¡æœ‰ä¸Šé™ä¸€ç›´åˆ°å†…å­˜å°½å¤´ï¼‰</p>

    <ul>
      <li>
        <p><code class="highlighter-rouge">Queue.qsize()</code>: è¿”å›å½“å‰é˜Ÿåˆ—åŒ…å«çš„æ¶ˆæ¯æ•°é‡</p>
      </li>
      <li>
        <p><code class="highlighter-rouge">Queue.empty()</code>: å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å›Trueï¼Œåä¹‹False</p>
      </li>
      <li>
        <p><code class="highlighter-rouge">Queue.full()</code>: å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œè¿”å›True,åä¹‹False</p>
      </li>
      <li>
        <p><code class="highlighter-rouge">Queue.get([block[,timeout]])</code>: è·å–é˜Ÿåˆ—ä¸­çš„ä¸€æ¡æ¶ˆæ¯ï¼Œç„¶åå°†å…¶ä»é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œblocké»˜è®¤å€¼ä¸ºTrueã€‚
å¦‚æœblockä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸”æ²¡æœ‰è®¾ç½®timeout(å•ä½ç§’),æ¶ˆæ¯é˜Ÿåˆ—å¦‚æœä¸ºç©ºï¼Œæ­¤æ—¶ç¨‹åºå°†è¢«<strong>é˜»å¡</strong>ï¼ˆåœåœ¨è¯»å–çŠ¶æ€ï¼‰ï¼Œç›´åˆ°æ¶ˆæ¯é˜Ÿåˆ—è¯»åˆ°æ¶ˆæ¯ä¸ºæ­¢ï¼Œå¦‚æœè®¾ç½®äº†timeoutï¼Œåˆ™ä¼šç­‰å¾…timeoutç§’ï¼Œè‹¥è¿˜æ²¡è¯»å–åˆ°ä»»ä½•æ¶ˆæ¯ï¼Œåˆ™æŠ›å‡ºâ€Queue.Emptyâ€å¼‚å¸¸ã€‚</p>
      </li>
      <li>
        <p><code class="highlighter-rouge">Queue.get_nowait()</code>: ç›¸å½“äº<code class="highlighter-rouge">Queue.get(False)</code></p>
      </li>
      <li>
        <p><code class="highlighter-rouge">Queue.put(item,[block[,timeout]])</code>: å°†itemæ¶ˆæ¯å†™å…¥é˜Ÿåˆ—ï¼Œblocké»˜è®¤å€¼ä¸ºTrue;
å¦‚æœblockä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸”æ²¡æœ‰è®¾ç½®timeoutï¼ˆå•ä½ç§’ï¼‰ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¦‚æœå·²ç»æ²¡æœ‰ç©ºé—´å¯å†™å…¥ï¼Œæ­¤æ—¶ç¨‹åºå°†è¢«<strong>é˜»å¡</strong>ï¼ˆåœåœ¨å†™å…¥çŠ¶æ€ï¼‰ï¼Œç›´åˆ°ä»æ¶ˆæ¯é˜Ÿåˆ—è…¾å‡ºç©ºé—´ä¸ºæ­¢ï¼Œå¦‚æœè®¾ç½®äº†timeoutï¼Œåˆ™ä¼šç­‰å¾…timeoutç§’ï¼Œè‹¥è¿˜æ²¡ç©ºé—´ï¼Œåˆ™æŠ›å‡ºâ€Queue.Fullâ€å¼‚å¸¸ã€‚
å¦‚æœblockå€¼ä¸ºFalseï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¦‚æœæ²¡æœ‰ç©ºé—´å¯å†™å…¥ï¼Œåˆ™ä¼šç«‹åˆ»æŠ›å‡ºâ€Queue.Fullâ€å¼‚å¸¸ã€‚</p>
      </li>
      <li>
        <p>Queue.put_nowait(item): ç›¸å½“<code class="highlighter-rouge">Queue.put(item,False)</code></p>

        <p>è¿›ç¨‹é—´é€šä¿¡Demo:</p>
      </li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre>    <span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Queue</span>
    <span class="kn">import</span> <span class="nn">os</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="n">random</span>
    <span class="c1"># å†™æ•°æ®è¿›ç¨‹æ‰§è¡Œçš„ä»£ç ï¼š
</span>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'A'</span><span class="p">,</span><span class="s">'B'</span><span class="p">,</span><span class="s">'C'</span><span class="p">]:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Put </span><span class="si">%</span><span class="s">s to queue..."</span><span class="p">,</span><span class="o">%</span><span class="n">value</span><span class="p">)</span>
            <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>
    <span class="c1"># è¯»æ•°æ®è¿›ç¨‹æ‰§è¡Œçš„ä»£ç 
</span>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">q</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Get </span><span class="si">%</span><span class="s">s from queue."</span><span class="p">,</span><span class="o">%</span><span class="n">value</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">'__main__'</span><span class="p">:</span>
        <span class="c1">#çˆ¶è¿›ç¨‹åˆ›å»ºQueueï¼Œå¹¶ä¼ ç»™å„ä¸ªå­è¿›ç¨‹
</span>        <span class="n">q</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
        <span class="n">pw</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">write</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">q</span><span class="p">,))</span>
        <span class="n">pr</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">read</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">q</span><span class="p">,))</span>
        <span class="c1">#å¯åŠ¨å­è¿›ç¨‹pw ï¼Œå†™å…¥ï¼š
</span>        <span class="n">pw</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="c1">#ç­‰å¾…pwç»“æŸ
</span>        <span class="n">pw</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="c1">#å¯åŠ¨å­è¿›ç¨‹prï¼Œè¯»å–ï¼š
</span>        <span class="n">pr</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">pr</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="c1">#pr è¿›ç¨‹é‡Œæ˜¯æ­»å¾ªç¯ï¼Œæ— æ³•ç­‰å¾…å…¶ç»“æŸï¼Œåªèƒ½å¼ºè¡Œç»ˆæ­¢:
</span>        <span class="k">print</span><span class="p">(</span><span class="s">''</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'æ‰€æœ‰æ•°æ®éƒ½å†™å…¥å¹¶ä¸”è¯»å®Œ'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<ul>
  <li>è¿›ç¨‹æ±  Pool</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>    <span class="c1">#coding:utf-8
</span>    <span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
    <span class="kn">import</span> <span class="nn">os</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="n">random</span>

    <span class="k">def</span> <span class="nf">worker</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
        <span class="n">t_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">s å¼€å§‹æ‰§è¡Œï¼Œè¿›ç¨‹å·ä¸º</span><span class="si">%</span><span class="s">d"</span><span class="o">%</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()))</span>
        <span class="c1"># random.random()éšæœºç”Ÿæˆ0-1ä¹‹é—´çš„æµ®ç‚¹æ•°
</span>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">t_stop</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="s">"æ‰§è¡Œå®Œæ¯•ï¼Œè€—æ—¶</span><span class="si">%0.2</span><span class="s">fâ€</span><span class="si">%</span><span class="s">ï¼ˆt_stop-t_start))</span><span class="err">

</span><span class="s">    po = Pool(3) # å®šä¹‰ä¸€ä¸ªè¿›ç¨‹æ± ï¼Œæœ€å¤§è¿›ç¨‹æ•°3</span><span class="err">
</span><span class="s">    for i in range(0,10):</span><span class="err">
</span><span class="s">        po.apply_async(worker,(i,))</span><span class="err">
</span><span class="s">        print("</span><span class="o">---</span><span class="n">start</span><span class="o">----</span><span class="s">")</span><span class="err">
</span><span class="s">        po.close()</span><span class="err">
</span><span class="s">        po.join()</span><span class="err">
</span><span class="s">        print("</span><span class="o">----</span><span class="n">end</span><span class="o">----</span><span class="s">")</span><span class="err">
</span></pre></td></tr></tbody></table></code></pre></div></div>
<ul>
  <li>è¿›ç¨‹æ± ä¸­ä½¿ç”¨ Queue
å¦‚æœè¦ä½¿ç”¨Poolåˆ›å»ºè¿›ç¨‹ï¼Œå°±éœ€è¦ä½¿ç”¨<code class="highlighter-rouge">multiprocessing.Manager()</code>ä¸­çš„<code class="highlighter-rouge">Queue()</code>,è€Œä¸æ˜¯<code class="highlighter-rouge">multiprocessing.Queue()</code>,å¦åˆ™ä¼šå¾—åˆ°å¦‚ä¸‹çš„é”™è¯¯ä¿¡æ¯ï¼š
<code class="highlighter-rouge">RuntimeError</code>ï¼š Queue objects should only be shared between processs through inheritance</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre>        <span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Manager</span><span class="p">,</span><span class="n">Pool</span>
        <span class="kn">import</span> <span class="nn">os</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="n">random</span>
        <span class="k">def</span> <span class="nf">reader</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"reader å¯åŠ¨(</span><span class="si">%</span><span class="s">s),çˆ¶è¿›ç¨‹ä¸ºï¼ˆ</span><span class="si">%</span><span class="s">s)"</span><span class="o">%</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">qsize</span><span class="p">()):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"reader ä»Queueè·å–åˆ°æ¶ˆæ¯:</span><span class="si">%</span><span class="s">s"</span><span class="o">%</span><span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">True</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">writer</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"writer å¯åŠ¨ï¼ˆ</span><span class="si">%</span><span class="s">s),çˆ¶è¿›ç¨‹ä¸º(</span><span class="si">%</span><span class="s">s)"</span><span class="o">%</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="n">ini</span> <span class="s">"itcast"</span><span class="p">:</span>
                <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"(</span><span class="si">%</span><span class="s">s)start"</span><span class="o">%</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">Manager</span><span class="p">()</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span><span class="c1">#ä½¿ç”¨Managerä¸­çš„Queue
</span>            <span class="n">po</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">()</span>
            <span class="n">po</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">wrtier</span><span class="p">,(</span><span class="n">q</span><span class="p">,))</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">po</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">reader</span><span class="p">,(</span><span class="n">q</span><span class="p">,))</span>
            <span class="n">po</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">po</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"(</span><span class="si">%</span><span class="s">s)End"</span><span class="o">%</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="62-è°ˆè°ˆä½ å¯¹å¤šè¿›ç¨‹å¤šçº¿ç¨‹ä»¥åŠåç¨‹çš„ç†è§£é¡¹ç›®æ˜¯å¦ç”¨">6.2 è°ˆè°ˆä½ å¯¹å¤šè¿›ç¨‹ï¼Œå¤šçº¿ç¨‹ï¼Œä»¥åŠåç¨‹çš„ç†è§£ï¼Œé¡¹ç›®æ˜¯å¦ç”¨ï¼Ÿ</h3>

<p>è¿™ä¸ªé—®é¢˜è¢«é—®çš„æ¦‚å¿µç›¸å½“ä¹‹å¤§ï¼Œ
<strong>è¿›ç¨‹</strong>ï¼šä¸€ä¸ªè¿è¡Œçš„ç¨‹åºï¼ˆä»£ç ï¼‰å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œæ²¡æœ‰è¿è¡Œçš„ä»£ç å«ç¨‹åºï¼Œ<strong>è¿›ç¨‹æ˜¯ç³»ç»Ÿèµ„æºåˆ†é…çš„æœ€å°å•ä½</strong>ï¼Œè¿›ç¨‹æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œæ‰€æœ‰è¿›ç¨‹é—´æ•°æ®ä¸å…±äº«ï¼Œå¼€é”€å¤§ã€‚
<strong>çº¿ç¨‹</strong>: <strong>cpuè°ƒåº¦æ‰§è¡Œçš„æœ€å°å•ä½</strong>ï¼Œä¹Ÿå«æ‰§è¡Œè·¯å¾„ï¼Œä¸èƒ½ç‹¬ç«‹å­˜åœ¨ï¼Œä¾èµ–è¿›ç¨‹å­˜åœ¨ï¼Œä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå«ä¸»çº¿ç¨‹ï¼Œè€Œå¤šä¸ªçº¿ç¨‹å…±äº«å†…å­˜ï¼ˆæ•°æ®å…±äº«ï¼Œå…±äº«å…¨å±€å˜é‡ï¼‰ï¼Œä»è€Œæå¤§åœ°æé«˜äº†ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚
<strong>åç¨‹</strong>: æ˜¯ä¸€ç§<u>ç”¨æˆ·æ€</u>çš„è½»é‡çº§çº¿ç¨‹ï¼Œ<strong><u>åç¨‹çš„è°ƒåº¦å®Œå…¨ç”±ç¨‹åºå‘˜æ§åˆ¶(ç³»ç»Ÿå†…æ ¸ä¸ç®¡)</u></strong>ã€‚åç¨‹æ‹¥æœ‰è‡ªå·±çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆã€‚åç¨‹è°ƒåº¦æ—¶ï¼Œå°†å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆä¿å­˜åˆ°å…¶ä»–åœ°æ–¹ï¼Œåœ¨åˆ‡å›æ¥çš„æ—¶å€™ï¼Œæ¢å¤å…ˆå‰ä¿å­˜çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆï¼Œç›´æ¥æ“çºµæ ˆåˆ™åŸºæœ¬æ²¡æœ‰å†…æ ¸åˆ‡æ¢çš„å¼€é”€ï¼Œå¯ä»¥ä¸åŠ é”çš„è®¿é—®å…¨å±€å˜é‡ï¼Œæ‰€ä»¥<u>ä¸Šä¸‹æ–‡çš„åˆ‡æ¢éå¸¸å¿«</u>ã€‚</p>

<h3 id="63-pythonå¼‚å¸¸ä½¿ç”¨åœºæ™¯æœ‰é‚£äº›">6.3 Pythonå¼‚å¸¸ä½¿ç”¨åœºæ™¯æœ‰é‚£äº›ï¼Ÿ</h3>

<p>å¼‚æ­¥çš„ä½¿ç”¨åœºæ™¯:
1ã€ ä¸æ¶‰åŠå…±äº«èµ„æºï¼Œè·å¯¹å…±äº«èµ„æºåªè¯»ï¼Œå³éäº’æ–¥æ“ä½œ
2ã€ æ²¡æœ‰æ—¶åºä¸Šçš„ä¸¥æ ¼å…³ç³»
3ã€ ä¸éœ€è¦åŸå­æ“ä½œï¼Œæˆ–å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼æ§åˆ¶åŸå­æ€§
4ã€ å¸¸ç”¨äºIOæ“ä½œç­‰è€—æ—¶æ“ä½œï¼Œå› ä¸ºæ¯”è¾ƒå½±å“å®¢æˆ·ä½“éªŒå’Œä½¿ç”¨æ€§èƒ½
5ã€ ä¸å½±å“ä¸»çº¿ç¨‹é€»è¾‘</p>

<h3 id="64-å¤šçº¿ç¨‹å…±åŒæ“ä½œåŒä¸€ä¸ªæ•°æ®äº’æ–¥é”åŒæ­¥">6.4 å¤šçº¿ç¨‹å…±åŒæ“ä½œåŒä¸€ä¸ªæ•°æ®äº’æ–¥é”åŒæ­¥ï¼Ÿ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre>    <span class="kn">import</span> <span class="nn">threading</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="k">class</span> <span class="nc">MyThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">global</span> <span class="n">num</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
            <span class="k">if</span> <span class="n">mutex</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">num</span> <span class="o">+=</span><span class="mi">1</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">'set num to '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">mutex</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">mutex</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">()</span>
            <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">"__main__"</span><span class="p">:</span>
        <span class="n">test</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="65-ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ç«äº‰">6.5 ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ç«äº‰ï¼Ÿ</h3>

<ul>
  <li>çº¿ç¨‹æ˜¯éç‹¬ç«‹çš„ï¼ŒåŒä¸€ä¸ªè¿›ç¨‹é‡Œçº¿ç¨‹æ˜¯æ•°æ®å…±äº«çš„ï¼Œå½“å„ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®èµ„æºæ—¶ä¼šå‡ºç°ç«äº‰çŠ¶æ€å³ï¼šæ•°æ®å‡ ä¹åŒæ­¥ä¼šè¢«å¤šä¸ªçº¿ç¨‹å ç”¨ï¼Œé€ æˆæ•°æ®æ··ä¹±ï¼Œå³æ‰€è°“çš„çº¿ç¨‹ä¸å®‰å…¨</li>
  <li>é‚£ä¹ˆæ€ä¹ˆè§£å†³å¤šçº¿ç¨‹ç«äº‰é—®é¢˜ï¼Ÿâ€”â€” é”</li>
  <li>é”çš„å¥½å¤„ï¼š ç¡®ä¿äº†æŸæ®µå…³é”®ä»£ç ï¼ˆå…±äº«æ•°æ®èµ„æºï¼‰åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹ä»å¤´åˆ°å°¾å®Œæ•´åœ°æ‰§è¡Œèƒ½è§£å†³å¤šçº¿ç¨‹èµ„æºç«äº‰ä¸‹çš„åŸå­æ“ä½œé—®é¢˜ã€‚</li>
  <li>é”çš„åå¤„ï¼šé˜»æ­¢äº†å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼ŒåŒ…å«é”çš„æŸæ®µä»£ç å®é™…ä¸Šåªèƒ½ä»¥<strong>å•çº¿ç¨‹æ¨¡å¼</strong>æ‰§è¡Œï¼Œæ•ˆç‡å°±å¤§å¤§åœ°ä¸‹é™äº†</li>
  <li>é”çš„è‡´å‘½é—®é¢˜ï¼šæ­»é”</li>
</ul>

<h3 id="66--è¯·ä»‹ç»ä¸€ä¸‹pythonçš„çº¿ç¨‹åŒæ­¥">6.6  è¯·ä»‹ç»ä¸€ä¸‹Pythonçš„çº¿ç¨‹åŒæ­¥ï¼Ÿ</h3>

<ol>
  <li><strong>setDaemon(False)</strong>
å½“ä¸€ä¸ªè¿›ç¨‹å¯åŠ¨ä¹‹åï¼Œä¼šé»˜è®¤äº§ç”Ÿä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œå› ä¸ºçº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œçš„æœ€å°å•ä½ï¼Œå½“è®¾ç½®å¤šçº¿ç¨‹æ—¶ï¼Œä¸»çº¿ç¨‹ä¼šåˆ›å»ºå¤šä¸ªå­çº¿ç¨‹ï¼Œåœ¨Pythonä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹å°±æ˜¯setDaemon(False),ä¸»çº¿ç¨‹æ‰§è¡Œå®Œè‡ªå·±çš„ä»»åŠ¡ä»¥åï¼Œå°±é€€å‡ºäº†ï¼Œæ­¤æ—¶å­çº¿ç¨‹ä¼šç»§ç»­æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡ï¼Œç›´åˆ°è‡ªå·±çš„ä»»åŠ¡ç»“æŸã€‚
ä¾‹å­</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>    <span class="kn">import</span> <span class="nn">threading</span> 
    <span class="kn">import</span> <span class="nn">time</span>
    
    <span class="k">def</span> <span class="nf">thread</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'---å­çº¿ç¨‹ç»“æŸ---'</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">thread</span><span class="p">)</span>
        <span class="n">t1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'---ä¸»çº¿ç¨‹--ç»“æŸ'</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span><span class="s">'__main__'</span><span class="p">:</span>
        <span class="n">main</span><span class="p">()</span>
        
    <span class="c1">#æ‰§è¡Œç»“æœ
</span>    <span class="o">---</span><span class="err">ä¸»çº¿ç¨‹</span><span class="o">--</span><span class="err">ç»“æŸ</span>
    <span class="o">---</span><span class="err">å­çº¿ç¨‹ç»“æŸ</span><span class="o">---</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<ol>
  <li><strong>setDaemonï¼ˆTrue)</strong>
å½“æˆ‘ä»¬ä½¿ç”¨setDaemon(True)æ—¶ï¼Œè¿™æ˜¯å­çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹ä¸€æ—¦æ‰§è¡Œç»“æŸï¼Œåˆ™å…¨éƒ¨å­çº¿ç¨‹è¢«å¼ºåˆ¶ç»ˆæ­¢
ä¾‹å­</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>    <span class="kn">import</span> <span class="nn">threading</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="k">def</span> <span class="nf">thread</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="err">â€™</span><span class="o">---</span><span class="err">å­çº¿ç¨‹ç»“æŸ</span><span class="o">---</span><span class="s">')</span><span class="err">
</span><span class="s">    def main():</span><span class="err">
</span><span class="s">        t1 = threading.Thread(target=thread)</span><span class="err">
</span><span class="s">        t1.setDaemon(True) #è®¾ç½®å­çº¿ç¨‹å®ˆæŠ¤ä¸»çº¿ç¨‹</span><span class="err">
</span><span class="s">        t1.start()</span><span class="err">
</span><span class="s">        print('</span><span class="o">---</span><span class="err">ä¸»çº¿ç¨‹ç»“æŸ</span><span class="o">---</span><span class="s">')</span><span class="err">
</span><span class="s">    </span><span class="err">
</span><span class="s">    if __name__ =='</span><span class="n">__main__</span><span class="s">':</span><span class="err">
</span><span class="s">        main()</span><span class="err">
</span><span class="s">    #æ‰§è¡Œç»“æœ</span><span class="err">
</span><span class="s">    ---ä¸»çº¿ç¨‹ç»“æŸ--- #åªæœ‰ä¸»çº¿ç¨‹ç»“æŸï¼Œå­çº¿ç¨‹æ¥ä¸åŠæ‰§è¡Œå°±è¢«å¼ºåˆ¶ç»“æŸ</span><span class="err">
</span></pre></td></tr></tbody></table></code></pre></div></div>
<ol>
  <li><strong>joinï¼ˆçº¿ç¨‹åŒæ­¥)</strong>
join æ‰€å®Œæˆçš„å·¥ä½œå°±æ˜¯çº¿ç¨‹åŒæ­¥ï¼Œå³ä¸»çº¿ç¨‹ä»»åŠ¡ç»“æŸä»¥åï¼Œè¿›å…¥å µå¡çŠ¶æ€ï¼Œä¸€ç›´ç­‰å¾…æ‰€æœ‰çš„å­çº¿ç¨‹ç»“æŸä»¥åï¼Œä¸»çº¿ç¨‹å†ç»ˆæ­¢ã€‚
å½“è®¾ç½®å®ˆæŠ¤çº¿ç¨‹æ—¶ï¼Œå«ä¹‰æ˜¯ä¸»çº¿ç¨‹å¯¹äºå­çº¿ç¨‹ç­‰å¾…timeoutçš„æ—¶é—´å°†ä¼šæ€æ­»è¯¥å­çº¿ç¨‹ï¼Œæœ€åé€€å‡ºç¨‹åºï¼Œæ‰€ä»¥è¯´ï¼Œå¦‚æœæœ‰10ä¸ªå­çº¿ç¨‹ï¼Œå…¨éƒ¨çš„ç­‰å¾…æ—¶é—´å°±æ˜¯æ¯ä¸ªtimeoutçš„ç´¯åŠ å’Œï¼Œç®€å•çš„æ¥è¯´ï¼Œå°±æ˜¯ç»™æ¯ä¸ªå­çº¿ç¨‹ä¸€ä¸ªtimeouçš„æ—¶é—´ï¼Œè®©ä»–å»æ‰§è¡Œï¼Œæ—¶é—´ä¸€åˆ°ï¼Œä¸ç®¡ä»»åŠ¡æœ‰æ²¡æœ‰å®Œæˆï¼Œç›´æ¥æ€æ­»ã€‚
æ²¡æœ‰è®¾ç½®å®ˆæŠ¤çº¿ç¨‹æ—¶ï¼Œä¸»çº¿ç¨‹å°†ä¼šç­‰å¾…timeoutçš„ç´¯åŠ å’Œè¿™æ ·çš„ä¸€æ®µæ—¶é—´ï¼Œæ—¶é—´ä¸€åˆ°ï¼Œä¸»çº¿ç¨‹ç»“æŸï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ€æ­»å­çº¿ç¨‹ï¼Œå­çº¿ç¨‹ä¾ç„¶å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°å­çº¿ç¨‹å…¨éƒ¨ç»“æŸï¼Œç¨‹åºé€€å‡ºã€‚
ä¾‹å­</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>    <span class="kn">import</span> <span class="nn">threading</span>
    <span class="kn">import</span> <span class="nn">time</span>

    <span class="k">def</span> <span class="nf">thread</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'---å­çº¿ç¨‹ç»“æŸ---'</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">thread</span><span class="p">)</span>
        <span class="n">t1</span><span class="o">.</span><span class="n">setDaemon</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">t1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">t1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="c1">#1 çº¿ç¨‹åŒæ­¥ï¼Œä¸»çº¿ç¨‹å µå¡1s ç„¶åä¸»çº¿ç¨‹ç»“æŸï¼Œå­çº¿ç¨‹ç»§ç»­æ‰§è¡Œ
</span>                          <span class="c1">#2 å¦‚æœä¸è®¾ç½®timeoutå‚æ•°å°±ç­‰å­çº¿ç¨‹ç»“æŸä¸»çº¿ç¨‹å†ç»“æŸ
</span>                          <span class="c1">#3 å¦‚æœè®¾ç½®äº†setDaemon=Trueå’Œtimeout=1ä¸»çº¿ç¨‹ç­‰å¾…1såä¼šå¼ºåˆ¶æ€æ­»å­çº¿ç¨‹ï¼Œ      
</span>                          <span class="c1">#  ç„¶åä¸»çº¿ç¨‹ç»“æŸ
</span>        <span class="k">print</span><span class="p">(</span><span class="s">'---ä¸»çº¿ç¨‹ç»“æŸ---'</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">'__main___'</span><span class="p">:</span>
        <span class="n">main</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="67-è§£é‡Šä»¥ä¸‹ä»€ä¹ˆæ˜¯é”æœ‰å“ªå‡ ç§é”">6.7 è§£é‡Šä»¥ä¸‹ä»€ä¹ˆæ˜¯é”ï¼Œæœ‰å“ªå‡ ç§é”ï¼Ÿ</h3>

<p><strong>é”(Lock)</strong>æ˜¯pythonæä¾›çš„å¯¹çº¿ç¨‹æ§åˆ¶çš„å¯¹è±¡ã€‚æœ‰äº’æ–¥é”ï¼Œå¯é‡å…¥é”ï¼Œæ­»é”ã€‚</p>

<h3 id="68-ä»€ä¹ˆæ˜¯æ­»é”">6.8 ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ</h3>

<p>è‹¥å¹²å­çº¿ç¨‹åœ¨ç³»ç»Ÿèµ„æºç«äº‰æ—¶ï¼Œéƒ½åœ¨ç­‰å¾…å¯¹æ–¹å¯¹æŸéƒ¨åˆ†èµ„æºè§£é™¤å ç”¨çŠ¶æ€ï¼Œç»“æœæ˜¯è°ä¹Ÿä¸æ„¿å…ˆè§£é”ï¼Œäº’ç›¸å¹²ç­‰ç€ï¼Œç¨‹åºæ— æ³•æ‰§è¡Œä¸‹å»ï¼Œè¿™å°±æ˜¯æ­»é”ã€‚
GILé” å…¨å±€è§£é‡Šå™¨é”ï¼ˆåªåœ¨cythoné‡Œæ‰æœ‰ï¼‰
ä½œç”¨ï¼š é™åˆ¶å¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œæ‰€ä»¥cythoné‡Œçš„å¤šçº¿ç¨‹å…¶å®æ˜¯ä¼ªå¤šçº¿ç¨‹ï¼
æ‰€ä»¥<u>pythoné‡Œå¸¸å¸¸ä½¿ç”¨åç¨‹æŠ€æœ¯æ¥ä»£æ›¿å¤šçº¿ç¨‹</u>ï¼Œåç¨‹æ˜¯ä¸€ç§æ›´è½»é‡çº§çš„çº¿ç¨‹ã€‚
è¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ‡æ¢æ—¶ç”±ç³»ç»Ÿå†³å®šï¼Œè€Œåç¨‹ç”±æˆ‘ä»¬ç¨‹åºå‘˜è‡ªå·±å†³å®šï¼Œè€Œæ¨¡å—geventä¸‹åˆ‡æ¢æ˜¯é‡åˆ°äº†è€—æ—¶æ“ä½œæ—¶æ‰ä¼šåˆ‡æ¢
ä¸‰è€…çš„å…³ç³»ï¼šè¿›ç¨‹é‡Œæœ‰çº¿ç¨‹ï¼Œçº¿ç¨‹é‡Œæœ‰åç¨‹ã€‚</p>

<h3 id="69-å¤šçº¿ç¨‹äº¤äº’è®¿é—®æ•°æ®å¦‚æœè®¿é—®åˆ°äº†å°±ä¸è®¿é—®äº†">6.9 å¤šçº¿ç¨‹äº¤äº’è®¿é—®æ•°æ®ï¼Œå¦‚æœè®¿é—®åˆ°äº†å°±ä¸è®¿é—®äº†ï¼Ÿ</h3>

<p>æ€ä¹ˆé¿å…é‡è¯»ï¼Ÿ
åˆ›å»ºä¸€ä¸ªå·²è®¿é—®æ•°æ®åˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨å·²ç»è®¿é—®è¿‡çš„æ•°æ®ï¼Œå¹¶åŠ ä¸Šäº’æ–¥é”ï¼Œåœ¨å¤šçº¿ç¨‹è®¿é—®æ•°æ®çš„æ—¶å€™å…ˆæŸ¥çœ‹æ•°æ®æ˜¯å¦åœ¨å·²è®¿é—®çš„åˆ—è¡¨ä¸­ï¼Œè‹¥å·²å­˜åœ¨å°±ç›´æ¥è·³è¿‡ã€‚</p>

<h3 id="610-ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ä»€ä¹ˆæ˜¯äº’æ–¥é”">6.10 ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Œä»€ä¹ˆæ˜¯äº’æ–¥é”ï¼Ÿ</h3>

<p>æ¯ä¸ªå¯¹è±¡éƒ½å¯¹åº”äºä¸€ä¸ªå¯ç§°ä¸ºâ€™<em>äº’æ–¥é”</em>â€˜çš„æ ‡è®°ï¼Œè¿™ä¸ªæ ‡è®°ç”¨æ¥ä¿è¯åœ¨ä»»ä¸€æ—¶åˆ»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®è¯¥å¯¹è±¡ã€‚
åŒä¸€è¿›ç¨‹ä¸­çš„å¤šçº¿ç¨‹ä¹‹é—´æ˜¯å…±äº«ç³»ç»Ÿèµ„æºçš„ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡Œæ“ä½œï¼Œä¸€ä¸ªçº¿ç¨‹æ“ä½œå°šæœªç»“æŸï¼Œå¦ä¸€çº¿ç¨‹å·²ç»å¯¹å…¶è¿›è¡Œæ“ä½œï¼Œå¯¼è‡´æœ€ç»ˆç»“æœå‡ºç°é”™è¯¯ï¼Œæ­¤æ—¶éœ€è¦å¯¹è¢«æ“ä½œå¯¹è±¡æ·»åŠ äº’æ–¥é”ï¼Œä¿è¯æ¯ä¸ªçº¿ç¨‹å¯¹è¯¥å¯¹è±¡çš„æ“ä½œéƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚</p>

<h3 id="611è¯´è¯´ä¸‹é¢å‡ ä¸ªæ¦‚å¿µåŒæ­¥å¼‚æ­¥é˜»å¡éé˜»å¡">6.11è¯´è¯´ä¸‹é¢å‡ ä¸ªæ¦‚å¿µï¼šåŒæ­¥ï¼Œå¼‚æ­¥ï¼Œé˜»å¡ï¼Œéé˜»å¡ï¼Ÿ</h3>

<p>åŒæ­¥ï¼š å¤šä¸ªä»»åŠ¡ä¹‹é—´æœ‰å…ˆåé¡ºåºæ‰§è¡Œï¼Œä¸€ä¸ªæ‰§è¡Œå®Œä¸‹ä¸ªæ‰èƒ½æ‰§è¡Œã€‚
å¼‚æ­¥ï¼š å¤šä¸ªä»»åŠ¡ä¹‹é—´æ²¡æœ‰å…ˆåé¡ºåºï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ—¶å€™ä¸€ä¸ªä»»åŠ¡å¯èƒ½è¦åœ¨å¿…è¦çš„æ—¶å€™è·å–å¦ä¸€ä¸ªåŒæ—¶æ‰§è¡Œçš„ä»»åŠ¡çš„ç»“æœï¼Œè¿™ä¸ªå°±å«å›è°ƒï¼
é˜»å¡ï¼š å¦‚æœå¡ä½äº†è°ƒç”¨è€…ï¼Œè°ƒç”¨è€…ä¸èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå°±æ˜¯è¯´è°ƒç”¨è€…é˜»å¡äº†ã€‚
éé˜»å¡ï¼š å¦‚æœä¸ä¼šå¡ä½ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œå°±æ˜¯è¯´éé˜»å¡çš„ã€‚
åŒæ­¥å¼‚æ­¥ç›¸å¯¹äº<strong>å¤šä»»åŠ¡</strong>è€Œè¨€ï¼Œé˜»å¡éé˜»å¡ç›¸å¯¹äº<strong>ä»£ç æ‰§è¡Œ</strong>è€Œè¨€ã€‚</p>

<h3 id="612-ä»€ä¹ˆæ˜¯åƒµå°¸è¿›ç¨‹å’Œå­¤å„¿è¿›ç¨‹æ€ä¹ˆé¿å…åƒµå°¸è¿›ç¨‹">6.12 ä»€ä¹ˆæ˜¯åƒµå°¸è¿›ç¨‹å’Œå­¤å„¿è¿›ç¨‹ï¼Ÿæ€ä¹ˆé¿å…åƒµå°¸è¿›ç¨‹ï¼Ÿ</h3>

<ul>
  <li><strong>å­¤å„¿è¿›ç¨‹</strong>ï¼š çˆ¶è¿›ç¨‹é€€å‡ºï¼Œå­è¿›ç¨‹è¿˜åœ¨è¿è¡Œçš„è¿™äº›å­è¿›ç¨‹éƒ½æ˜¯å­¤å„¿è¿›ç¨‹ï¼Œå­¤å„¿è¿›ç¨‹å°†è¢«init è¿›ç¨‹ï¼ˆè¿›ç¨‹å·ä¸º1ï¼‰æ‰€æ”¶å…»ï¼Œå¹¶ç”±init è¿›ç¨‹å¯¹ä»–ä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚</li>
  <li><strong>åƒµå°¸è¿›ç¨‹</strong>ï¼š è¿›ç¨‹ä½¿ç”¨fork åˆ›å»ºå­è¿›ç¨‹ï¼Œå¦‚æœå­è¿›ç¨‹é€€å‡ºï¼Œè€Œçˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰è°ƒç”¨wait è·waitpid è·å–å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œé‚£ä¹ˆå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ä»ç„¶ä¿å­˜åœ¨ç³»ç»Ÿä¸­çš„è¿™äº›è¿›ç¨‹æ˜¯åƒµå°¸è¿›ç¨‹ã€‚</li>
  <li>é¿å…åƒµå°¸è¿›ç¨‹çš„æ–¹æ³•ï¼š
    <ul>
      <li>fork ä¸¤æ¬¡ç”¨å­™å­è¿›ç¨‹å»å®Œæˆå­è¿›ç¨‹çš„ä»»åŠ¡</li>
      <li>ç”¨wait()å‡½æ•°ä½¿çˆ¶è¿›ç¨‹é˜»å¡</li>
      <li>ä½¿ç”¨ä¿¡å·é‡(semaphore)ï¼Œåœ¨signal handler ä¸­è°ƒç”¨waitpid, è¿™æ ·çˆ¶è¿›ç¨‹ä¸ç”¨é˜»å¡</li>
    </ul>
  </li>
</ul>

<h3 id="713-pythonä¸­è¿›ç¨‹ä¸çº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯">7.13 pythonä¸­è¿›ç¨‹ä¸çº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ</h3>

<p>å¤šè¿›ç¨‹é€‚åˆåœ¨CPUå¯†é›†æ“ä½œï¼ˆcpuæ“ä½œæŒ‡ä»¤æ¯”è¾ƒå¤šï¼Œå¦‚ä½å¤šçš„çš„æµ®ç‚¹è¿ç®—ï¼‰ã€‚
å¤šçº¿ç¨‹é€‚åˆåœ¨IOå¯†æ€§å‹æ“ä½œï¼ˆè¯»å†™æ•°æ®æ“ä½œæ¯”å¤šçš„çš„ï¼Œæ¯”å¦‚çˆ¬è™«ï¼‰</p>

<h3 id="714-çº¿ç¨‹æ˜¯å¹¶å‘è¿˜æ˜¯å¹¶è¡Œè¿›ç¨‹æ˜¯å¹¶å‘è¿˜æ˜¯å¹¶è¡Œ">7.14 çº¿ç¨‹æ˜¯å¹¶å‘è¿˜æ˜¯å¹¶è¡Œï¼Œè¿›ç¨‹æ˜¯å¹¶å‘è¿˜æ˜¯å¹¶è¡Œï¼Ÿ</h3>

<p><strong>çº¿ç¨‹æ˜¯å¹¶å‘ï¼Œè¿›ç¨‹æ˜¯å¹¶è¡Œ</strong>ã€‚
è¿›ç¨‹ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼Œæ˜¯ç³»ç»Ÿåˆ†é…èµ„æºçš„æœ€å°å•ä½ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹å…±äº«èµ„æºã€‚</p>

<h3 id="715-å¹¶è¡Œparallelå’Œå¹¶å‘concurrency">7.15 å¹¶è¡Œ(parallel)å’Œå¹¶å‘ï¼ˆconcurrency)?</h3>

<p><strong>å¹¶è¡Œ</strong>ï¼š åŒä¸€æ—¶åˆ»å¤šä¸ªä»»åŠ¡åŒæ—¶åœ¨è¿è¡Œ
<strong>å¹¶å‘</strong>:  åœ¨åŒä¸€æ—¶é—´é—´éš”å†…å¤šä¸ªä»»åŠ¡éƒ½åœ¨è¿è¡Œï¼Œä½†æ˜¯å¹¶ä¸ä¼šåœ¨åŒä¸€æ—¶åˆ»åŒæ—¶è¿è¡Œï¼Œå­˜åœ¨äº¤æ›¿æ‰§è¡Œçš„æƒ…å†µã€‚
å®ç°å¹¶è¡Œçš„åº“æœ‰ï¼š<code class="highlighter-rouge">multiprocessing</code>
å®ç°å¹¶å‘çš„åº“æœ‰:  <code class="highlighter-rouge">threading</code>
ç¨‹åºéœ€è¦æ‰§è¡Œè¾ƒå¤šçš„è¯»å†™ã€è¯·æ±‚å’Œå›å¤ä»»åŠ¡çš„éœ€è¦å¤§é‡çš„IOæ“ä½œï¼ŒIOå¯†é›†å‹æ“ä½œä½¿ç”¨å¹¶å‘æ›´å¥½ã€‚
CPUè¿ç®—é‡å¤§çš„ç¨‹åºï¼Œä½¿ç”¨å¹¶è¡Œä¼šæ›´å¥½ã€‚</p>

<h3 id="716-ioå¯†é›†å‹å’Œcpuå¯†é›†å‹åŒºåˆ«">7.16 IOå¯†é›†å‹å’ŒCPUå¯†é›†å‹åŒºåˆ«ï¼Ÿ</h3>

<p><strong>IOå¯†é›†å‹</strong>ï¼š ç³»ç»Ÿè¿è¡Œï¼Œå¤§éƒ¨åˆ†çš„çŠ¶å†µæ˜¯CPUåœ¨ç­‰ I/Oï¼ˆç¡¬ç›˜/å†…å­˜ï¼‰çš„è¯»/å†™
<strong>CPUå¯†é›†å‹</strong>ï¼š å¤§éƒ¨åˆ†æ—¶é—´ç”¨æ¥åšè®¡ç®—ï¼Œé€»è¾‘åˆ¤æ–­ç­‰CPUåŠ¨ä½œçš„ç¨‹åºç§°ä¹‹CPUå¯†é›†å‹ã€‚</p>
:ET