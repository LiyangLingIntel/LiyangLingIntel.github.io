<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="孤独是人生的常态吗？">
    <meta name="keywords"  content="leonling, 凌丽阳, LEON's Blog ">
    <meta name="theme-color" content="#000000">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Get to know blockchain step by step - LEON的博客 | LEON's Blog">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="
  因为贪婪，所以信任

">
    
    <meta property="article:published_time" content="2019-02-11T00:00:00Z">
    
    
    <meta property="article:author" content="charlesliuyx">
    
    
    <meta property="article:tag" content="Blockchain">
    
    <meta property="article:tag" content="Tutorial">
    
    <meta property="article:tag" content="转载">
    
    
    <meta property="og:image" content="http://localhost:4000/img/avatar_2.png">
    <meta property="og:url" content="http://localhost:4000/2019/02/11/Get-to-know-blockchain-step-by-step/">
    <meta property="og:site_name" content="LEON的博客 | LEON's Blog">
    
    <title>Get to know blockchain step by step - LEON的博客 | LEON's Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="http://localhost:4000/2019/02/11/Get-to-know-blockchain-step-by-step/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Leon Ling's Blog</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div id="huxblog_navbar">
                <div class="navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="/">Home</a>
                        </li>
                        
                        
                        
                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                        
                        
                        <li>
                            <a href="/archive/">Archive</a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    </ul>
                </div>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>
    <script>
        // Drop Bootstarp low-performance Navbar
        // Use customize navbar with high-quality material design animation
        // in high-perf jank-free CSS3 implementation
        var $body = document.body;
        var $toggle = document.querySelector('.navbar-toggle');
        var $navbar = document.querySelector('#huxblog_navbar');
        var $collapse = document.querySelector('.navbar-collapse');

        var __HuxNav__ = {
            close: function () {
                $navbar.className = " ";
                // wait until animation end.
                setTimeout(function () {
                    // prevent frequently toggle
                    if ($navbar.className.indexOf('in') < 0) {
                        $collapse.style.height = "0px"
                    }
                }, 400)
            },
            open: function () {
                $collapse.style.height = "auto"
                $navbar.className += " in";
            }
        }

        // Bind Event
        $toggle.addEventListener('click', function (e) {
            if ($navbar.className.indexOf('in') > 0) {
                __HuxNav__.close()
            } else {
                __HuxNav__.open()
            }
        })

        /**
         * Since Fastclick is used to delegate 'touchstart' globally
         * to hack 300ms delay in iOS by performing a fake 'click',
         * Using 'e.stopPropagation' to stop 'touchstart' event from 
         * $toggle/$collapse will break global delegation.
         * 
         * Instead, we use a 'e.target' filter to prevent handler
         * added to document close HuxNav.  
         *
         * Also, we use 'click' instead of 'touchstart' as compromise
         */
        document.addEventListener('click', function (e) {
            if (e.target == $toggle) return;
            if (e.target.className == 'icon-bar') return;
            __HuxNav__.close();
        })
    </script>

<script src="/js/simple-jekyll-search.min.js"></script>

    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/post-bg-blockchain_step.jpeg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/post-bg-blockchain_step.jpeg');
        background: ;
    }

    
</style>

<header class="intro-header" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=Blockchain" title="Blockchain">Blockchain</a>
                        
                        <a class="tag" href="/archive/?tag=Tutorial" title="Tutorial">Tutorial</a>
                        
                        <a class="tag" href="/archive/?tag=%E8%BD%AC%E8%BD%BD" title="转载">转载</a>
                        
                    </div>
                    <h1>Get to know blockchain step by step</h1>
                    
                    <h2 class="subheading">一步一步弄懂区块链[转载]</h2>
                    <span class="meta">Posted by charlesliuyx on February 11, 2019</span>
                </div>
            </div>
        </div>
    </div>
</header>






<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

                <blockquote>
  <p><strong>因为贪婪，所以信任</strong></p>
</blockquote>

<h1 id="加密货币">加密货币</h1>

<p>在一步一步发明发明比特币之前，解释几个直观的认知：</p>

<p>我们常说的比特币，是<strong>加密货币（Cryptocurrency）</strong>的一种，而加密货币<strong>实现去中心化</strong>的最关键的技术是<strong>区块链</strong></p>

<p>有些地方可能把加密货币又称为数字货币（或称电子货币），但实际上，加密货币是数字货币的子集，同为子集的还有<strong>虚拟货币</strong>（如Q币），<strong>加密货币</strong>的称谓要更加专业</p>

<p>加密货币一定具有下列三个特点</p>

<ul>
  <li><strong>去中心的清算</strong></li>
  <li><strong>分布式的记账</strong></li>
  <li><strong>离散化的支付</strong></li>
</ul>

<p><strong>为了实现这些特点</strong>，需要使用到<strong>区块链技术</strong>。这里的区块链技术是一个很广义的范畴，它包含了密码学，算法等很多不同的内容，其中最精彩的点子，可算是<strong>工作量证明 = 共识</strong>了</p>

<p>还有另一个层次更高的角度：从<strong>解决拜占庭将军问题</strong>的角度入手来<strong>分析和科普</strong>【区块链技术】的（可参看另一篇博客<a href="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/">【区块链】如何解决拜占庭将军问题</a>），我觉得这个角度更加接近于区块链哲学的本质，毕竟，比特币具有价值属性和交易属性，和金融有紧密的联系，但是区块链是一种<strong>分布式存储系统</strong>，若仅仅从比特币（代币）的角度来解释，非常片面。毕竟，比特币，就是<strong>分布式去中心化共识记录系统</strong>中的一个字段</p>

<h1 id="一步一步发明比特币">一步一步发明比特币</h1>

<h2 id="第一个用户需求---账本和电子签名的由来">第一个用户需求 - 账本和电子签名的由来</h2>

<blockquote>
  <p>第一个用户需求描述了<strong>中心化清算系统</strong>几个关键内容的由来，只对区块链感兴趣的读者可以跳过</p>
</blockquote>

<p>经济体的蓬勃发展离不开<strong>交易</strong>。在交易过程中，人们早已发现使用一般等价物（如金银）十分麻烦，发明了纸币（最早的来自中国，北宋时代四川地区的纸币交子的<strong>清算体系</strong>，是<strong>生产力发展的必然产物，最终的目标是提高生产效率</strong>），现如今，人们发现，<strong>携带现金也很麻烦</strong></p>

<p>这是第一个基本用户需求：<strong>摆脱现金进行交易带来的不便</strong></p>

<p><strong>【解决办法】</strong>几个用户使用<strong>公共账本</strong>记录转账记录，<strong>月底结算</strong>，<strong>账本公开</strong>，每个人都可以修改，也就是说可以在上面添加新行（一笔交易），如<code class="highlighter-rouge">小明转账给小红10块钱</code></p>

<h3 id="产生的问题1身份问题">产生的问题1：身份问题</h3>

<p>在这个账本条目上我们无法确认交易双方<code class="highlighter-rouge">小明</code>和<code class="highlighter-rouge">小红</code>是否是本人，可能出现伪造（逍遥法外电影中的伪造支票）</p>

<p><strong>【解决办法】</strong>使用<strong>电子签名</strong>，即公钥 - 私钥对</p>

<p>记住，<strong>电子签名被发明的核心目的</strong>是希望在电子文档也能有一个类似与现实中个人笔迹的签名，目的一定是：<strong>确认写这个签名的人是本人，即身份确认（验证）</strong></p>

<p>私钥顾名思义，也叫做密钥，是你<strong>本人需要需要妥善保管和保存的</strong>
Sign(信息,私钥)=电子签名Sign(信息,私钥)=电子签名
Sign在这里是一个函数，可以理解为<strong>一连串计算（变换）</strong>，这一连串计算有一个特点，就是<strong>输入值只要改变一点点</strong>，输出就会<strong>完全改变</strong>。信息和私钥一起，可以得到一个电子签名。并且这个电子签名不能被轻易的复制到其他信息里，原因是因为每一个电子签名都和<strong>这一段信息</strong>有关联。
Verify(信息,电子签名,公钥)=真/假Verify(信息,电子签名,公钥)=真/假
在进行<strong>验证</strong>的时候，Verify也是一个函数，<strong>输入值是信息，电子签名，公钥，输出是一个True or False</strong>，来判断这个<strong>电子签名</strong>是真的还是假的。</p>

<p>这个时候可能有人就要问了，这个电子签名我难道不能试出来吗？很不幸，这是一个有<strong>256bit的1/0字符串</strong>，可能性是2的256次方，2的10次方是1024，我只能告诉你这么多了。</p>

<p>解释完电子签名，我们来看看实例。<code class="highlighter-rouge">小明</code>使用自己的私钥加上<code class="highlighter-rouge">小明转给小红10块钱</code><strong>这段话</strong>通过Sign函数生成一个签名（256位），把签名放在这条转账信息的后面，通过之前的讲解，这个签名就能保证<code class="highlighter-rouge">小明</code>已经过目了，并且说：“这真的是我<code class="highlighter-rouge">小明</code>，不用怀疑了！肯定是我”</p>

<p>直观结果是，我们可以利用<strong>密码学的手段</strong>，只要有对应人的<strong>数字签名</strong>，我们保证<code class="highlighter-rouge">小明</code>和<code class="highlighter-rouge">小红</code>的<strong>身份能被100%确认真实</strong></p>

<p>但是这个解决方案有一个小漏洞：可以<strong>复制同一行信息</strong>来伪造交易记录，解决的办法是添加一个<strong>这笔交易独有的信息（比如时间戳）</strong></p>

<h3 id="产生的问题2欠债跑路问题">产生的问题2：欠债跑路问题</h3>

<p>如果<code class="highlighter-rouge">小明</code>在此时账户上已经没有足够的余额进行支付，就会出现超支问题</p>

<p><strong>【解决办法】</strong>添加余额记录，此时就不可避免的需要一个<strong>中间担保人（国家？信誉机构？银行？）</strong>为<code class="highlighter-rouge">小明</code>进行余额担保</p>

<h3 id="一个大家都遵守的协议">一个大家都遵守的协议</h3>

<p>此时，现代金融体系的框架基本建立完毕，协议内容是</p>

<ul>
  <li>任何人都可以在<strong>账本上添加新行</strong></li>
  <li>固定时间间隔时用<strong>真金白银进行清算</strong></li>
  <li>只有有<strong>签名的交易</strong>是有效的</li>
  <li>中间担保的人<strong>保证不可超支</strong></li>
</ul>

<p>此时发现一个很有趣的发现，这个比较严谨的协议有一个特点：<strong>如果所有人都按照这个协议来办事，我们可以用任何形式的东西来代替人民币了</strong>，换句话说，就是我根本不关心你在账本上添加的新行的交易内容是什么，可以是任何东西</p>

<p>利用这个提出需求再解决问题的过程，强化一个<strong>认知</strong>：<strong>货币 = 交易记录（账本），即货币的本质是交易记录</strong>，在这背后，有一个前提是，货币的另一个本质是一种<strong>共识</strong>，我们都信任它有价值的共识</p>

<h2 id="第二个用户需求账本放在哪里">第二个用户需求：账本放在哪里？</h2>

<p>传统的（现在的）解决方案当时是，使用中心代理-<strong>银行</strong>，来存放账本</p>

<p>既然是第二个用户需求，那肯定就是因为现在的解决方案大家都<strong>不满意</strong></p>

<h3 id="核心需求去中心化">核心需求：去中心化</h3>

<p>中心化的痛点大致可以说几点</p>

<ul>
  <li>银行<strong>效率低下</strong>，一笔跨国转账的等待时间较长</li>
  <li><strong>胖银行金融体系</strong>因部分准备金制度等等方便的规则，能抬升杠杆，产生金融泡沫，进一步诱发金融危机</li>
  <li><strong>私有财产神圣不可侵犯</strong>是精英与平民，剥削与被剥削者几个世纪以来博弈的风暴中心</li>
</ul>

<p>当然还有很多没有提到（比如好处，控制经济发展速度，调控供需平衡等），总之，是一种一直饱受诟病的清算方式，此时，中本聪在2009年横空出世，他提出了一种全新的<strong>清算方法</strong>，并且真正解决了陌生人间信用的问题！接下来就是真正的一步一步的发明比特币了</p>

<h3 id="如何实现分布记账去中心化">如何实现分布记账（去中心化）</h3>

<p>为了去中心化，我们可以反其道而行之：每个用户保存账本，分布记账。用户产生一笔交易就<strong>将这笔交易广播到到网络上所有的节点上</strong>，这样不就完美的去中心化了？</p>

<p><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/broadcast.gif" alt="广播示意图" /></p>

<p>只要是明眼人都能发现，太天真的，这个方法行不通。若行不通，那就把行不通的原因总结出来</p>

<blockquote>
  <p>遇到问题，总结不可行的原因，寻找解决方案。这是<strong>整个人类不断前进的核心最小单位</strong></p>
</blockquote>

<h4 id="问题核心">问题核心</h4>

<p>如何让所有人都同意这个新账本？如何保持这些账本同步？有一笔交易发生时，如何让其他人都听到并相信这一笔交易呢？</p>

<p>这些问题才是真正的核心：<strong>是否能在协议（办法，规则）中添加几行，找到办法，来决定是否接受交易，并确定交易顺序，使你可以放心的相信，世界上遵守同一协议的所有人手上的账本都和你的一模一样呢？</strong>（问题描述值得品读，只有抽象出问题才能更好的去寻找解决方案）</p>

<h4 id="解决方案">☆解决方案</h4>

<p>解决的思路是：哪个账本的<strong>计算工作量大</strong>，就信任哪个账本。换个角度来说是<strong>【让交易欺诈和账本不一的情形的计算力成本高到不能接受甚至完全不可行】</strong></p>

<h5 id="1密码学哈希函数">1、密码学：哈希函数</h5>

<p>哈希函数，<strong>输入</strong>可以是任意信息或者文件，<strong>输出</strong>是固定长度的比特串。例如256bit的1/0串，这个输出叫做这个信息的<strong>“哈希值”或者“摘要”（digest）</strong>。SHA256就是一个哈希函数</p>

<p><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/hashfunction.gif" alt="img" /></p>

<p>密码哈希函数有几个特点</p>

<ul>
  <li>特点是<strong>输入值稍微变化后，结果就会有很大的不同，完全无法预测不同输入间的规律</strong></li>
  <li><strong>逆向计算</strong>不可行，只能使用试错法（穷举法），解空间 22562256</li>
</ul>

<p>在每一个账本后添加一个<strong>特殊数字</strong>，对整个列表使用SHA256，我们要求这个<strong>特殊数字</strong>可以使得输出值的开头有<strong>30个零</strong>（关于如何确定0的个数问题，在后面部分有详细的说明）.</p>

<p>根据之前说过SHA256的性质：输入变化输出不可预测，找到这个特殊数字唯一的办法就是穷举。换言之，你很容易就证明了他们<strong>进行了海量的计算</strong>。而这个<strong>特殊数字就叫做工作量证明</strong>（proof of work）</p>

<p>这就意味着，所有的工作量证明就对应了交易列表（账本 Ledger），如果你修改了一个交易，哪怕只是其中一个字符，就会完全改变哈希值，就得<strong>重做工作量证明</strong>，直观动图如下</p>

<p><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/30zero2.gif" alt="img" /></p>

<p>修改后的重新计算</p>

<h5 id="2区块链---信任与共识的基石">2、区块链 - 信任与共识的基石</h5>

<p>每一个小账本被称为<strong>区块</strong>，<strong>每一个不同的区块链协议（产生不同的加密货币）</strong>都会规定每一个<strong>区块的大小</strong>（最初比特币为1M）</p>

<p><strong>账本组成区块，区块构成链表，区块的头包含前一块的哈希值，这就是区块链</strong></p>

<p><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/blockchain1.gif" alt="img" /></p>

<p>如此一来，<strong>任何人就不能随意修改其中的内容，或者交换顺序</strong>。如果你这么做，意味着<strong>你需要重新计算所有的特殊数字</strong></p>

<p><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/blockchain2.gif" alt="img" /></p>

<p>规定，<strong>允许世界上的每一个人建造区块</strong>。每一个新建区块的人（找到了这个特殊数字 - SHA256值有30个零）都能获得奖励，对于<strong>新建区块的这部分人（矿工）</strong>来说</p>

<ul>
  <li>没有发送者信息，不需要签名</li>
  <li>每一个新区块都会给<strong>整个币种增加新的虚拟（加密）货币</strong></li>
  <li>新建区块的过程又被称为“挖矿”：需要大量工作量并且可以向整个经济体注入新的货币</li>
  <li>挖矿的工作是：<strong>接受交易信息，建造区块，把区块广播出去，然后得到新的钱作为奖励</strong></li>
  <li>对每个矿工来说，每个区块就像一个<strong>小彩票</strong>，所有人都在拼命快速猜数字，直到有一个幸运儿找到了一个<strong>特殊数字</strong>，<strong>使得整个区块的哈希值开头有许多个零，就能得到奖励</strong>。我记得有一个知乎答主给了一个形象的比喻，区块链就像一个拥有貌美如花女儿（区块）的国王，有很多的青年翘首以盼，而国王的方法是<strong>出了一道很难得题目</strong>让所有的青年计算（学习改变人生），谁算的快（在计算哈希值过程也可能是运气好）就能抱得美人归</li>
  <li><strong>对于想用这个系统来收付款的用户来说，他们不需要收听所有的交易，而只要收听矿工们广播出来的区块，然后更新到自己保存的区块链中就可以了</strong></li>
</ul>

<h5 id="351算力-共识攻击">3、51%算力-共识攻击</h5>

<p>这里有一个小漏洞，因为网络的延迟或者有人在篡改区块链等因素，你作为一个收听网络广播的用户，如果同时接受到两条不同的区块链怎么办？其中的交易信息发生了冲突</p>

<blockquote>
  <p>注：区块链本身就是最终的大账本，发生交易的唯一方法就是把你的交易加入到大账本上。具体来说，就是让矿工把你的交易记录加入它新挖到的区块中，并把这个区块链接到区块链上。链表的纽带，当然就是工作量证明</p>
</blockquote>

<p>对于上面的问题，用户的解决方案也比较简单：即，<strong>只保留最长的且难度系数最高的，也就是包含的工作量最大的那一条</strong></p>

<p>用户保留最长的区块链</p>

<p>这里有一个Trick，<strong>即所谓信任工作量最大不仅仅是出【一道难题】，还通过等待多个区块的产生引入世界上所有矿工之间的博弈</strong>（吃瓜群众，坐看大戏，谁厉害我选谁，你们尽管斗）</p>

<p>个人观点：区块链的Idea最核心的创新就是从技术上把<strong>信任和贪婪画了等号</strong>。因为贪婪（希望去竞争建立区块的建立和交易费）所以信任（全网算力越大，用户越放心），这句话甚至带上了些许哲学和传奇的色彩</p>

<p>对于用户来说，是这样一种情景</p>

<p><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/bloackchain-conflict.gif" alt="img" /></p>

<p>其中的原因是，你可以假设Alice希望篡改一个交易信息，那么就意味着Alice需要不断的通过计算维护这个区块链了。<strong>也就是说每一次有新的区块链产生，Alice都需要不断的抢到这个彩票</strong>，理论上来说，他至少必须拥有全网51%以上的算力才能做到这一点，更多的，<strong>随着用户等待区块的增加，这个难度，幂次上升</strong>，在7-8个区块链产生后，概率上来讲，就是<strong>绝对信任</strong></p>

<p><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/bloackchain-conflict2.gif" alt="img" /></p>

<p>此时</p>

<ul>
  <li>我们用<strong>数字签名</strong>保证了不能伪造交易记录</li>
  <li>用<strong>区块链及工作量证明</strong>保证了不能篡改其中的信息</li>
</ul>

<p>这两点，就完成了：<strong>证明区块链的每一条交易记录都是可信的这一终极目标</strong></p>

<h3 id="总结---系统可行性分析">总结 - 系统可行性分析</h3>

<p>只需给出一个命题来思考：<strong>我们如何才能在这个系统下骗人呢</strong>？</p>

<ul>
  <li>如果你想篡改一笔不存在的交易记录，那么你必须比所有人都算的快，赢得这个彩票</li>
  <li>但<strong>所有用户</strong>会继续收听其他矿工的广播</li>
  <li>所以为了让所有用户继续相信这个伪造的区块</li>
  <li>你必须投入自己所有的工作量，不断给<strong>篡改后的区块链分叉</strong>增添新的区块</li>
  <li><strong>记住：根据协议，所有用户会一直信任他所知道的最长的链</strong></li>
  <li>是的，你<strong>持续的竞争过世界上所有的矿工</strong>的概率或者说代价，实在太大了，得不偿失（其实<strong>法律也是一样的道理</strong>，它强制给违法的人给予惩罚，让违法者付出他们不能承受的代价了保证公平和社会稳定运行）</li>
  <li>注意，作为一个用户，你不能立马相信你所听到的最新区块，而是应该等待多几个区块被创建过后，再确认这的确是世界所有人都在使用的区块链（比特币的原则中，<strong>等待6个区块</strong>，才确认）</li>
</ul>

<h2 id="发明过程中的关键点">发明过程中的关键点</h2>

<ul>
  <li>电子签名 Digital Signatures</li>
  <li>公共账本就是货币 The Ledger is the currency</li>
  <li>去中心化 Decentralize</li>
  <li>工作量证明 Proof of work</li>
  <li>区块链 Block Chain</li>
</ul>

<h1 id="比特币技术">比特币技术</h1>

<p>到这里，已经发明了比特币，<strong>解决了去中心化的信任这一难题</strong>。只对比特币和区块链是什么这个问题感兴趣的读者，可以停在这里了，希望大家可以在我的叙述中解决一些困惑！鞠躬！</p>

<p>针对比特币的一些实现的内在细节，继续在探索和学习的道路上披荆斩棘。新技术，新点子，要拥抱它，使用它，判断它，<strong>必须先追根究底了解它</strong></p>

<p>我们知道区块链中记载的核心内容，对于比特币（加密货币）来说就是<strong>转账记录</strong>。但是，<strong>一个概念真正落地成大众可以用的服务</strong>，有很多技术上，协议上的细节。接下里的部分主要探讨一些<strong>比特币具体实现方面的细节</strong>，如网络节点构成，比特币的计算难度系数，比特币总量的由来，比特币一笔交易发生的内部细节等</p>

<h2 id="比特币网络节点的构成">比特币网络节点的构成</h2>

<p>比特币网络是一种<strong>点对点的数字现金系统（P2P）</strong>，网络节点中每台机器都彼此对等。P2P网络不存在任何服务端、层级关系或者中心化服务。</p>

<h3 id="节点类型与分工">节点类型与分工</h3>

<p><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/AllFunctionNode.svg" alt="全功能节点" /></p>

<p>一个全功能节点包含上述4个模块【钱包<strong>W</strong>allet】【矿工<strong>M</strong>iner】【完整区块链full <strong>B</strong>lock-chain database】【网络路由节点<strong>N</strong>etwork routing】</p>

<ul>
  <li>【网络路由节点】使得节点具有<strong>参与验证并传播交易与区块信息，发现监听并维持点对点的链接</strong>的能力</li>
  <li>【完整区块链】具有此模块的节点被称为：全节点。它能够<strong>独自自主的校验所有交易</strong>，不需要任何其他信息。</li>
  <li>【钱包】比特币的所有权是通过数字密钥、比特币地址和数字签名来确定的，数字密钥实际上并不是存储在网络中，而是由用户生成并存储在一个文件或简单的数据库中，称为钱包。有些节点仅仅保留<strong>区块链的一部分</strong>，通过一种”简易支付验证“（SPV Simplified Payment Verification）的方法来完成交易</li>
  <li>【矿工】挖矿节点以相互竞争的方式创造新的区块。有一些挖矿节点也是全节点，可以独立挖矿；还有一些参与矿池挖矿的节点是轻量级节点，<strong>必须依赖矿池服务器维护全节点进行工作</strong></li>
</ul>

<p>拥有全部四个模块被称之为<strong>核心客户端（Bitcoin Core）</strong>，除了这些主要节点类型外，还有一些服务器及节点运行其他协议，如特殊矿池挖矿协议、轻量级客户端访问协议。</p>

<p>下表为扩展比特币网络的不同节点类型</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">图示</th>
      <th>名称</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/SoloMiner.svg" width="150" /></td>
      <td>独立矿工</td>
      <td>具有完整区块链副本</td>
    </tr>
    <tr>
      <td style="text-align: center"><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/FullBlockChainNode.svg" width="150" /></td>
      <td>完整区块链节点</td>
      <td>此种节点有时有中继作用，不断收听网络广播，维护完整区块链</td>
    </tr>
    <tr>
      <td style="text-align: center"><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/SPVwallet.svg" width="150" /></td>
      <td>轻量(SPV)钱包</td>
      <td>移动端，或者不想太过于笨重的桌面端，只需要进行交易广播操作</td>
    </tr>
    <tr>
      <td style="text-align: center"><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/PoolProtocolServers.svg" width="150" /></td>
      <td>矿池协议服务器</td>
      <td>将运行其他协议的节点，连接至P2P网络的网关路由器</td>
    </tr>
    <tr>
      <td style="text-align: center"><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/MiningNodes.svg" width="250" /></td>
      <td>挖矿节点</td>
      <td>不具有区块链，但具备Stratum协议的节点或其他矿池挖矿协议的网络节点</td>
    </tr>
    <tr>
      <td style="text-align: center"><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/StratumWallet.svg" width="150" /></td>
      <td>轻量 Stratum 钱包</td>
      <td>不具有区块链的钱包、运行Stratum协议的网络节点</td>
    </tr>
  </tbody>
</table>

<h3 id="扩展比特币网络">扩展比特币网络</h3>

<p>要在全世界的网络中完成整个的交易，下图描述了一个扩展比特币网络，它包含了多重类型的节点、网关服务器、边缘路由器、钱包客户端以及它们互相连接所需要的各类协议，比特币互相连接的接口一般使用<code class="highlighter-rouge">8333端口</code></p>

<p>可以参看这个文章了解Stratum协议，<a href="http://www.8btc.com/stratum_protocol">Stratum协议详解</a></p>

<p><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/BitcoinNet.png" alt="img" /></p>

<h2 id="如何控制区块产生速度恒定">如何控制区块产生速度恒定</h2>

<h3 id="难度系数">难度系数</h3>

<p>我们在发明比特币的过程已经详细说明了<strong>工作量证明</strong>寻找一个特殊数字使得SHA256函数的输出字符串的前<code class="highlighter-rouge">n</code>位是零</p>

<p>对于每一种不同的加密货币来说，都有<strong>一个值</strong>需要在建立货币的时候时候被定义，即<strong>每一个新区块在当前全网算力的条件被发现的【平均时间】</strong>，这也是难度系数的由来</p>

<blockquote>
  <p>比特币10分钟；以太坊15秒；瑞波币3.5秒；莱特币2.5分钟</p>
</blockquote>

<p>抛开代码算法层面来说，实现方法就是通过找前<code class="highlighter-rouge">n</code>位是0的方法。从概率角度来说，n值越大，意味找到这个这个数的解范围越小。</p>

<p>随着需求<code class="highlighter-rouge">0</code>的数目一个一个增加，<strong>需要的计算时间将会程指数增长</strong>。</p>

<p>那么肯定会问，这个难度值如何动态调整？由谁调整？</p>

<h3 id="难度调整方式">难度调整方式</h3>

<p>难度的调整实在每个完整节点中自动发生的。如果网络发现区块产生速率比10分钟要快时会增加难度。如果发现比10分钟慢时则降低难度。</p>

<p>例如比特币中的是这样定义的：每2016个区块后计算生成它们花费的时长，比上20160（14天）调整一次。有人可能会问，如果在这十四天内计算能力暴涨怎么办，其实这个10分钟的区块新建间隔的规定也只是一个估计要求，真实情况下，<strong>这个时间会偏离10分钟这个设定值很多，但是这种偏差并不会对整个区块链的运行产生影响</strong></p>

<p>但是有人会问，这个过程是靠脚本（代码）来实现的，还是自己手动调整的呢？答案是，本地挖矿节点根据自己看到的链上信息自己调整。</p>

<p>问题又来了，为何我不自己降低难度，让自己更加容易新建区块呢？其实，因为链上所有节点确认新的区块（只有确认了你才能得到回报）是按照最长链并且计算难度最大来判断的，你如果用很小的难度新加的区块，是肯定跑不赢全网的其他矿工的</p>

<h2 id="比特币总量的由来">比特币总量的由来</h2>

<p>我们已经知道，矿工没新建一个区块就可以得到一定数量的比特币作为奖励，最开始，一个区块可以得到<code class="highlighter-rouge">50BTC</code>的奖励，之后每210000个区块，奖励减半，直到2140年，所有的比特币将会发放完毕，可以得到公式
Total=210000×(50+25+12.5+…)=20999999980≈2100万Total=210000×(50+25+12.5+…)=20999999980≈2100万
而这个规则不同的竞争币种都可以自由设置。但是因为<strong>交易费的存在</strong>，挖矿的人还是会有收益，否则无法建立新的区块，那么整个比特币网络就瘫痪了</p>

<h2 id="比特币的交易处理能力">比特币的交易处理能力</h2>

<h3 id="现在比特币区块链的区块信息">现在比特币区块链的区块信息</h3>

<p>我现在直接从<a href="https://blockchain.info/">BLOCKCHAIN</a>上，在我写下这句话的时候，最新的区块是情况</p>

<table>
  <thead>
    <tr>
      <th>区块高度</th>
      <th>存在时间</th>
      <th>交易数量</th>
      <th>交易额</th>
      <th>创建人(矿池)</th>
      <th>大小(KB)</th>
      <th>重量(kWU)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>486883</td>
      <td>3分钟</td>
      <td>2126</td>
      <td>25992.38</td>
      <td>BTC.TOP</td>
      <td>999.34</td>
      <td>3917.54</td>
    </tr>
    <tr>
      <td>486882</td>
      <td>23分钟</td>
      <td>2422</td>
      <td>33926.89</td>
      <td>BTCC Pool</td>
      <td>1034.39</td>
      <td>3996.58</td>
    </tr>
    <tr>
      <td>486881</td>
      <td>51分钟</td>
      <td>358</td>
      <td>4480.22</td>
      <td>BTC.TOP</td>
      <td>191.92</td>
      <td>718.14</td>
    </tr>
    <tr>
      <td>486880</td>
      <td>53分钟</td>
      <td>352</td>
      <td>3770.26</td>
      <td>BTC.TOP</td>
      <td>197.27</td>
      <td>715.72</td>
    </tr>
  </tbody>
</table>

<p>其中的重量是指的实际存储的大小，这个值和交易协议有关，其实可以忽略。非常幸运的是，<strong>这几个区块放佛是专门为讲解这一节而出现的</strong>，这可能是天意吧</p>

<p>另外插一句，你会发现<strong>平均区块建立间隔时间</strong>，的确和10分钟这个设计值差距很大吧</p>

<h3 id="区块容量">区块容量</h3>

<p>比特币区块链从被<strong>第一次部署</strong>时，或者说源代码中已经规定，<strong>区块容量是1M</strong>。最初设计成1M的原因一方面，<strong>防止DOS攻击</strong>。另一方面，当年中本聪在创建区块链的时候的容量是32M，但是他通过一个说明为”Clear up“这样毫不起眼的Commit把区块容量改成了1M，为<strong>防止区块链体积增长过快</strong>，为区块容量这个问题添加了些神秘色彩。好吧，我承认，中本聪就已经非常具有神秘色彩了，是在神秘色彩上添上了些故事</p>

<p>截止2018年4月1号，完整区块链大小已经有约<strong>151GB</strong>的大小了</p>

<p>上表中，可以观察到，<strong>1M的容量</strong>意味着比特币最大的处理交易数量在<strong>约2400</strong>（486882区块1034.39的大小很接近了），从代码及技术文档来看，一个区块的最大处理交易数量在2700笔，意味着在一定程度上区块利用率可以超过100%。下面再给出<a href="http://charts.woobull.com/bitcoin-transactions-per-second/">一张时间和每秒交易数量的关系图表</a>(交互表格点击链接)</p>

<p><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/BitcoinTraPS.png" alt="img" /></p>

<blockquote>
  <p>【蓝色圆圈的大小】代表的是比特币内存池（mempool）的大小（交易在等待矿工处理之前都会暂时存在这里）直观来说，就是<strong>圆越大，在等待的交易数量越多</strong>
【纵坐标】是每秒交易数量（对数变换后）
【横坐标】是时间</p>
</blockquote>

<p>一句话总结，这是一个拥堵的网络，重负不堪。</p>

<p>再来看一张<a href="http://charts.woobull.com/bitcoin-blocksize-fees/">比特币交易费和区块使用率之间的关系图</a>(交互表格可以点击链接)</p>

<p><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/FeesVsBlocksize.png" alt="img" /></p>

<blockquote>
  <p>【蓝色的圈大小】是<strong>Mempool的大小</strong>，直观来说，就是<strong>圆越大，在等待的交易数量越多</strong>
【横坐标】是区块容量的使用情况
【纵坐标】是每一个区块的可以得到的交易费用，单位是BTC，注意这里是一个区块被新建时候所有交易费之和（大约2400交易的所有交易费加起来）</p>
</blockquote>

<p>手续费随区块使用率开始增长，甚至出现了10BTC一个区块2400笔交易的情况，意味着挖到这个区块的人通过交易费得到的回报接近了本身建立区块的回报。另，之所以可能有人看到最大交易是2700笔，应该和这个区块链大小为最大值的110%有关，从设计角度上来说，是一种<strong>缓冲</strong></p>

<p>有一个结论是，扩容后，因为每一个区块的交易承载量增加，矿工的交易费收入肯定会减少。因为，通过上表可以发现，只有当区块使用程度接近95%时候，交易费才有明显的增长</p>

<p>再看一张<a href="http://charts.woobull.com/bitcoin-blocksize-confirm-time/">用户执行交易需要等待的时长和区块使用比例间关系的图表</a>(交互图表点击链接)</p>

<p><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/TimeVSBlocksize.png" alt="img" /></p>

<blockquote>
  <p>【蓝色的圈大小】是<strong>Mempool的大小</strong>，直观来说，就是<strong>圆越大，在等待的交易数量越多</strong>
【横坐标】是区块容量的使用情况
【纵坐标】是用户平均需要等待的时间，单位是分钟。</p>
</blockquote>

<p>通过上面三张表我们可以知道，矿工的计算力是整个区块链信用的基石（记住贪婪=信任），所以对矿工的激励不能少，而对于用户来说，当然希望自己的交易越快速完成越好。</p>

<p>对于矿工来说，区块使用率超过95%是一个很好的信号，那意味着可以拿到更多的奖励。奖励太低，在区块建立奖励越来越少的情况下，安全性（信任）就慢慢的得不到保障。这么说来，<strong>这也就变成了一个Trade-off博弈过程</strong></p>

<p>分析下来，<strong>类似门罗币（menero）实现的根据网络负载来动态调整区块容量的设计似乎很合理</strong></p>

<h3 id="比特币扩容之争">比特币扩容之争</h3>

<p>这是一场复杂的博弈斗争，使用隔离见证增长区块容量，并出现了<strong>比特币现金</strong>这个新的币种。</p>

<p>如果想要了解这里面的很多技术，英文是必须过硬的，因为比特币代码开源，可以随意fork，只要英文功底过硬，阅读白皮书，文档等，这些不同技术的处理方法都是能够学到的</p>

<h2 id="比特币的一笔交易过程中到底发生了什么">比特币的一笔交易过程中到底发生了什么</h2>

<p>我们可以确认的是，每一笔都将记录在大账本中，那么我们需要研究的内容，就是区块中交易内容内的具体数据结构</p>

<h3 id="交易结构">交易结构</h3>

<p>每一个交易块包含的内容如下表所示</p>

<table>
  <thead>
    <tr>
      <th>大小</th>
      <th>字段</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>4 bytes</td>
      <td>版本</td>
      <td>明确这笔交易参照的规则</td>
    </tr>
    <tr>
      <td>1 - 9 bytes</td>
      <td>输入数量</td>
      <td>输入值的数量</td>
    </tr>
    <tr>
      <td>不定</td>
      <td>输入</td>
      <td><strong>一个或多个交易输入</strong></td>
    </tr>
    <tr>
      <td>1 - 9 bytes</td>
      <td>输出数量</td>
      <td>输出值的数量</td>
    </tr>
    <tr>
      <td>不定</td>
      <td>输出</td>
      <td><strong>一个或多个交易输出</strong></td>
    </tr>
    <tr>
      <td>4 bytes</td>
      <td>时钟时间</td>
      <td>UNIX时间戳或区块号</td>
    </tr>
  </tbody>
</table>

<p>最后这个值是解锁时间，定义了能被加到区块链里的最早交易时间。大多是时候设为0，表示<strong>立马执行</strong>。</p>

<p>一笔比特币交易是一个含有<strong>输入值</strong>和<strong>输出值</strong>的<strong>数据结构</strong>。该数据结构<strong>包含了将一笔资金从初始点（输入值）转移至目标地址（输出值）的代码信息</strong>。比特币交易的输入值和输出值与账号或者身份信息无关。可以把它理解为一种<strong>被特定秘密信息锁定的一定数量的比特币</strong>。只有拥<strong>有者或者知道这个秘密信息的人</strong>可以解锁</p>

<h3 id="交易的输入和输出">交易的输入和输出</h3>

<p>比特币交易的基本单位是<strong>未经使用的一个交易输出</strong>，简称UTXO（unspent transaction outputs）</p>

<p>可以把UTXO类比为我们使用的<strong>人民币1，5，10，20，50，100的面值</strong>，对于UTXO来说，它的面值可以是一”聪“的任意倍数（1BTC等于一亿聪）<strong>但是</strong>这个有着任意面值的”人民币“不能随意打开，还被加上一道类似<strong>红包支付口令的密码</strong>，只有拥有这个密码的人才可以使用这个UTXO，UTXO包含，币值+一段代码（锁，只有有钥匙的人才能打开）</p>

<p>被交易消耗的UTXO被称为交易输入，由交易创建的UTXO被称为交易输出</p>

<h4 id="交易输出">交易输出</h4>

<p><strong>不同面值的UTXO是由交易输出来提供的</strong>。你可以想象你需要购买一个3.1BTC的物品，你并不能从你的钱包中找到几个UTXO来得到3.1BTC，但是你刚好拥有一个4BTC的UTXO，你使用这个UTXO作为付款，那么你需要自己<strong>手动构建一个0.9的UTXO返还给你自己</strong>。</p>

<p>一个交易输出包含两个部分</p>

<ul>
  <li>一定量的比特币。被命名为“聪”（satoshis）</li>
  <li>一个<strong>锁定脚本</strong>。给这个UTXO上锁，保证只有<strong>收款人地址</strong>的私钥才可以打开</li>
</ul>

<h4 id="交易输入">交易输入</h4>

<p>每个交易输入是在构造的一笔交易（使用UTXO），比如你需要支付0.015BTC，钱包会寻找一个0.01BTC和0.005BTC的UTXO来组成这一笔交易。交易输入中还会<strong>包含一个解锁脚本</strong>，这是一个签名，可以类比成支付宝红包密码的口令</p>

<h4 id="交易费">交易费</h4>

<p>交易费 = 求和（所有输入） - 求和（所有输出）</p>

<p>这里有一个比较有意思的地方，就是因为找零的输出UTXO是交易的发起这自己构建的，如果很不幸，你忘记了自己构建找零的UTXO，那么这些多余的BTC就会变成矿工的劳务费</p>

<p>例如，我需要和小明进行交易，需要购买一个商品，花费<code class="highlighter-rouge">0.8BTC</code>，为了确保这笔交易能被更快的处理（添加到大账本上），我要在其中添加一笔交易费，假设<code class="highlighter-rouge">0.01BTC</code>（忽略人傻钱多），那就意味着这笔交易会需要我从钱包中找到几个UTXO能组成<code class="highlighter-rouge">0.81BTC</code>。但如果我的钱包内找不出这样的UTXO，只有一个<code class="highlighter-rouge">1BTC</code>的UTXO可用，那么我就需要构建一个<code class="highlighter-rouge">0.19BTC</code>的UTXO作为找零回到自己的钱包</p>

<p><strong>交易费只和交易字段使用的字节大小有关，与参与交易的比特币币值无关</strong>。UTXO是有尺寸的，比如某人想支付一笔很大的BTC交易，但是他的钱包中有很多小尺寸的UTXO，如果加入了很多个UTXO，就意味着他的交易会变复杂，存储空间需求多。当然，很多钱包会提供这方面的优化功能，保证你的交易使用的字段大小最优化</p>

<h4 id="解锁和锁定脚本">解锁和锁定脚本</h4>

<p>在实际实现的时候，这个“支付宝红包口令”被称为脚本，是一种基于逆波兰表示法的基于堆栈的执行语言。具体细节感兴趣的读者可以去<a href="https://github.com/bitcoin/bitcoin">比特币的Github</a>研究代码。关于脚本有很多细节上的定义和实现方法，这里限于篇幅不展开描述了</p>

<h3 id="矿工费和优先级">矿工费和优先级</h3>

<p>我们知道，<strong>每一笔交易都是广播到区块链上，由矿工决定是不是加入到新区块上的</strong>。那么这里就会涉及到一个问题，谁的交易的优先级更高，是先来后到？还是谁给前多谁就能加入到新区块中？</p>

<p>在<a href="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/#%E5%8C%BA%E5%9D%97%E5%AE%B9%E9%87%8F">区块容量</a>一节中，有一张图表直观的展示了现在网络中一笔交易的等待时间，其中最长的，也就是30分钟，如果你不是一个超级急性子，很多时候还是可以接受的（毕竟跨国转账1-2个工作日）</p>

<p>优先级 = 输入值块龄 * 输出值块龄 / 交易总长度</p>

<p>一个交易想成为<strong>“较高优先级”</strong>，需满足条件：<strong>优先值大于57600000</strong>，等价于1个BTC，年龄为1天，交易的大小为250字节</p>

<p>区块中前50KB的字节是保留给“较高优先级”的，其实这一机制也保证了一笔交易不会等待时间无现长。但是我们要知道，内存池（存放待处理交易的位置）中的交易，如果在没有处理后消失，所以钱包必须拥有不断重新广播未被处理交易的功能</p>

<h3 id="创币交易---coinbase">创币交易 - Coinbase</h3>

<p>每一个<strong>新建立的区块</strong>，都会有新的比特币作为奖励被产生，这个交易是一个特殊交易，被称为<strong>创币交易（Coinbase奖励）</strong></p>

<p>创币交易中不存在解锁脚本（也叫ScriptSig字段），被Coinbase的数据取代，长度最小2字节，最大100字节，除了开始的几个自己以外，矿工可以任意使用Coinbase的其他部分。比如创世区块中，Coinbase的输入中的字段是：The Times 03/Jan/2009 Chancellor on brink of second bailout for banks，是泰晤士日报当天的头版文章标题：财政大臣将再次对银行施以援手。</p>

<h2 id="merkle树">Merkle树</h2>

<p><strong>每个区块中的所有交易，都是用Merkle树来表示的</strong>。换句话说，交易的存储数据结构是，Merkle树</p>

<h3 id="什么是merkle树">什么是Merkle树</h3>

<p>Merkle树是一种<strong>哈希二叉树</strong>，它可以用来进行<strong>快速查找和检验大规模数据完整性</strong>。对于比特币网络来说，使用Merkle树来存储交易信息的目的是为了<strong>高效的查找和校验某笔交易的信息是否存在</strong></p>

<p>当N个数据元素经过加密（使用两次SHA256算法，也称double-SHA256），<strong>至多</strong>计算 2log2(N)2log2(N) 次就能<strong>检查出任意某元素是否在树中</strong></p>

<h3 id="构造merkle树">构造Merkle树</h3>

<p>假设我们有A B C D四笔交易字段，首先需要把这四个数据Hash化。然后把这些哈细化的<strong>数据通过串联相邻叶子节点</strong>的哈希值然后哈希化。基本过程如下图所示</p>

<p><img src="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/MerkleTree.png" alt="img" /></p>

<p>叶子节点必须是偶数（平衡树），如果遇到奇数的情况，把最后一个节点自身复制一个，凑偶</p>

<h3 id="merkle树的效率">Merkle树的效率</h3>

<p>下表显示了<strong>证明区块中存在某笔交易</strong>所需转化为Merkle路径的数据量</p>

<table>
  <thead>
    <tr>
      <th>交易数量</th>
      <th>区块的近似大小</th>
      <th>路径大小（哈希数量）</th>
      <th>路径大小（字节）</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>16</td>
      <td>4KB</td>
      <td>4个哈希</td>
      <td>128 bytes</td>
    </tr>
    <tr>
      <td>512</td>
      <td>128KB</td>
      <td>9个哈希</td>
      <td>288 bytes</td>
    </tr>
    <tr>
      <td>2048</td>
      <td>512KB</td>
      <td>11个哈希</td>
      <td>352 bytes</td>
    </tr>
    <tr>
      <td>65535</td>
      <td>16MB</td>
      <td>16个哈希</td>
      <td>512 bytes</td>
    </tr>
  </tbody>
</table>

<p>可以发现，即使区块容量达到16MB规模，为证明交易存在的Merkle路径长度增长也极其缓慢（幂指数增长取对数变为线性增长）</p>

<h3 id="merkle应用---简单支付验证节点spv">Merkle应用 - 简单支付验证节点（SPV）</h3>

<p>我们知道，每当一笔新的交易产生的时候，我们必须<strong>验证这笔交易是否真的存在</strong>，在SPV节点中，不保存区块链，仅仅保存区块头。<strong>使用认证路径或者Merkle路径来验证交易是否存在于区块中</strong></p>

<p>例如，一个SPV节点需要处理一笔支付，它<strong>需要验证这笔交易在某个区块中是否存在</strong>，才能决定是不是把这笔交易添加到这个区块中，那么它只需要接收少于1KB大小的，<strong>有关区块头和Merkle路径的信息</strong>，比接收完整区块（大约1MB）大小少了1千倍。简单来说，可以想象，Merkle树类似<strong>一个数组</strong>（这也是哈希表的最简单表示），<strong>下标是区块字段</strong>，下标对应<strong>数组存储的内容是这笔交易是否存在的值（True or False）</strong></p>

<h1 id="区块链比特币与金融">区块链（比特币）与金融</h1>

<p><a href="https://bitinfocharts.com/">BitInfoChart</a>是我个人觉得最好的加密货币信息网站！可以添加到收藏夹</p>

<p>因为比特币具有价值，那就必须谈到它和金融的关系。</p>

<p>限于篇幅（太长了太可怕了，一个博客写2万字莫不是有病），这部分另起一篇：<a href="https://charlesliuyx.github.io/2017/09/25/%E5%8C%BA%E5%9D%97%E9%93%BE%EF%BC%88%E6%AF%94%E7%89%B9%E5%B8%81%EF%BC%89%E4%B8%8E%E9%87%91%E8%9E%8D/">链接（直接点不会打开新标签）</a>，如果对<strong>ICO和金融方面</strong>感兴趣的读者欢迎移步讨论</p>

<h1 id="竞争币和其他技术创新">竞争币和其他技术创新</h1>

<p>所谓竞争币当然是利用区块链技术为即使，仿照比特币的基本协议架构进行的创新后的新币种，或者是新的区块链实现模式。这篇文章围绕什么是区块链展开，这部分的内容请移步<strong>（持续更新）</strong><a href="https://charlesliuyx.github.io/2017/09/25/%E7%8E%B0%E4%BB%A3%E5%8C%BA%E5%9D%97%E9%93%BE%E4%B8%8E%E6%96%B0%E6%8A%80%E6%9C%AF/">如何评估竞争币的价值与新技术创新（直接点不会打开新标签）</a></p>

<p>其中谈到了工作量证明的其他替代手段；到底什么是智能合约；以太坊开发技术栈等</p>

<h1 id="总结">总结</h1>

<p>感谢您看到这里，写这篇文章的目的一方面也是回答<strong>区块链（比特币）到底是什么</strong>这个困扰了自己很久的问题，另一方面，也是因为最近区块链技术非常火，需要<strong>一些接地气的科普文</strong></p>

<p>比如最近最新的消息称一家保险公司，使用区块链技术来赔偿航班晚点2小时，基于以太坊智能合约第一款落地应用。</p>

<p>如果你已经对区块链的实现原理有了初步的认知，就明白这些应用利用了区块链的分布式特点。说到底，并没有<strong>贪婪=信任工作量证明核心</strong>，只是一种基于云的新型运用，也很有想法，但是<strong>和比特币之类就没什么关系了</strong>（当然，这是我的个人看法，最近区块链方面的有很多突破性技术，比如侧链，闪电网络等等，太多的新概念，新名词，新技术，对此，也只能不断学习）。</p>

<p>但你只需牢记，贪婪=信任，以太坊也是利用以太币这个媒介来实现了合约价值，中本聪用人内核的贪婪来给陌生人之间加上了信任的纽带，这个代价是永远不会变的。换句话说，如何抵抗共识攻击和安全漏洞是一个永远不会消失的议题。</p>

<p>一句话来说，万变不离其宗，道生一，一生二，二生三，三生万物。中本聪给了道，是个妙人，但是<strong>万物</strong>依旧有无穷可能。<strong>信任作为一个人类社会一直以来的重要问题（痛点）</strong>，为了解决它，出现了<strong>权威机构进行信任背书（中心化）</strong>。建立信任，一定要付出代价，天底下没有免费的午餐，最终这些技术都会回归于一个投入产出的博弈过程（Trade-off），梳理主干，抓住要点，才能游刃有余！</p>

<p>转载自：<a href="https://charlesliuyx.github.io/2017/09/24/%E4%B8%80%E6%96%87%E5%BC%84%E6%87%82%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%BA%E4%BE%8B/">【区块链】一文看懂区块链：一步一步发明比特币</a></p>


                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2019/02/11/Consensus-Algorithm-and-Byzantium-Commanders-Problem/"
                            data-toggle="tooltip" data-placement="top" title="Consensus Algorithm and Byzantium Commanders Problem">
                            Previous<br>
                            <span>Consensus Algorithm and Byzantium Commanders Problem</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2019/02/20/How-to-conquer-hiccup/" data-toggle="tooltip"
                            data-placement="top" title="How to conquer hiccup">
                            Next<br>
                            <span>How to conquer hiccup</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                
                <!-- disqus 评论框 start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus 评论框 end -->
                

                
            </div>

            <!-- Side Catalog Container -->
            
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
            

            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        </a>
        
        
                <a data-sort="0043" 
                    href="/archive/?tag=Tricks"
                    title="Tricks"
                    rel="8">Tricks</a>
        
                <a data-sort="0040" 
                    href="/archive/?tag=JobHunting"
                    title="JobHunting"
                    rel="11">JobHunting</a>
        
                <a data-sort="0042" 
                    href="/archive/?tag=%E8%BD%AC%E8%BD%BD"
                    title="转载"
                    rel="9">转载</a>
        
                <a data-sort="0042" 
                    href="/archive/?tag=Foundations"
                    title="Foundations"
                    rel="9">Foundations</a>
        
                <a data-sort="0044" 
                    href="/archive/?tag=Notes"
                    title="Notes"
                    rel="7">Notes</a>
        
                <a data-sort="0044" 
                    href="/archive/?tag=Programing"
                    title="Programing"
                    rel="7">Programing</a>
        
                <a data-sort="0044" 
                    href="/archive/?tag=Python"
                    title="Python"
                    rel="7">Python</a>
        
                <a data-sort="0045" 
                    href="/archive/?tag=DataScience"
                    title="DataScience"
                    rel="6">DataScience</a>
        
                <a data-sort="0045" 
                    href="/archive/?tag=MachineLearning"
                    title="MachineLearning"
                    rel="6">MachineLearning</a>
        
                <a data-sort="0046" 
                    href="/archive/?tag=BigData"
                    title="BigData"
                    rel="5">BigData</a>
        
                <a data-sort="0046" 
                    href="/archive/?tag=Spark"
                    title="Spark"
                    rel="5">Spark
    </div>
</section>


                <!-- Friends Blog -->
                
<hr>
<h5>FRIENDS</h5>
<ul class="list-inline">
  
  <li><a href="https://cherishher.github.io/">Max Qi</a></li>
  <br>
  
  <li><a href="https://www.guchenghao.com/">Gu Chenghao</a></li>
  <br>
  
  <li><a href="https://syenpark.github.io/">Syen Park</a></li>
  <br>
  
  <li><a href="https://dojozheng.com/">DOJO Zheng</a></li>
  <br>
  
</ul>

            </div>
        </div>
    </div>

</article>

<!-- add support for mathjax by voleking-->




<!--Gitalk评论start  -->

<!-- Gitalk end -->


<!-- disqus 公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "leon_disqus";
    var disqus_identifier = "/2019/02/11/Get to know blockchain step by step";
    var disqus_url = "http://localhost:4000/2019/02/11/Get-to-know-blockchain-step-by-step/";

    (function () {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus 公共JS代码 end -->




<!-- async load function -->
<script>
    function async (u, c) {
        var d = document,
            t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) {
            o.addEventListener('load', function (e) {
                c(null, e);
            }, false);
        }
        s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async ("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js", function () {
        anchors.options = {
            visible: 'hover',
            placement: 'right',
            // icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link {
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top: -0.1em;
        }
    }
</style>


<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5ddc8a0647bb126e"></script>

    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  
  <li>
    <a target="_blank" href="https://www.zhihu.com/people/lyonling">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa  fa-stack-1x fa-inverse">知</i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="http://weibo.com/5395966937">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  
  <li>
    <a target="_blank" href="https://github.com/lyonling">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="https://www.linkedin.com/in/liyang-ling-678220117">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
</ul>

                <p class="copyright text-muted">
                    Copyright &copy; Leon Ling's Blog 2018-2019
                    <br>
                    Powered by <a href="https://jekyllrb.com/">Jekyll</a> Theme <a href="https://github.com/Huxpro/huxpro.github.io">HuxPro</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Service Worker -->

<script src="/js/snackbar.js "></script>
<script src="/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->





<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<script>
    // dynamic User by Hux
    var _gaId = 'UA-131740306-1';
    var _gaDomain = 'auto';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Baidu Tongji -->



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->




<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
