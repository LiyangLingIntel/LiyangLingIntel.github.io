<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Leon Ling's Blog</title>
    <description>å­¤ç‹¬æ˜¯äººç”Ÿçš„å¸¸æ€å—ï¼Ÿ</description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Thu, 05 Dec 2019 10:51:45 +0800</pubDate>
    <lastBuildDate>Thu, 05 Dec 2019 10:51:45 +0800</lastBuildDate>
    <generator>Jekyll v4.0.0</generator>
    
      <item>
        <title>Leon Ling's Blog é‡å¯è¯´æ˜</title>
        <description>&lt;p&gt;æ²‰å¯‚äº†ç§‹æ‹›çš„ä¸¤ä¸ªå¤šæœˆ, ç»ˆäºå†æ¬¡é‡æ–°å¯åŠ¨äº†ä¸ªäººåšå®¢çš„é¡¹ç›®ğŸ˜…, åˆå¯ä»¥å¼€å§‹å­¦ä¹ äº†å‘¢ğŸ™ƒ.&lt;/p&gt;

&lt;p&gt;è¿™æ¬¡é‡å¯, ç›¸æ¯”æ—§çš„ç‰ˆæœ¬, é¦–å…ˆçº æ­£äº†ä»¥å‰postså› ä¸ºtagæ ¼å¼ä¸å¤Ÿè§„èŒƒå¼•èµ·çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;YML&lt;/code&gt;æ–‡ä»¶å¤´ä¸¢å¤±çš„BUG, ç„¶åå‚è€ƒå…¶ä»–ä¼˜ç§€çš„åšå®¢æ¡†æ¶, å¯¹åŸæ¥çš„åšå®¢æ¡†æ¶åšå‡ºäº†ä¸€äº›è°ƒæ•´å’Œä¼˜åŒ–, ä¹Ÿå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½, å¤§æ¦‚å¦‚ä¸‹.&lt;/p&gt;

&lt;h3 id=&quot;1-æ–°åŠŸèƒ½å¼•å…¥&quot;&gt;1. æ–°åŠŸèƒ½å¼•å…¥&lt;/h3&gt;

&lt;p&gt;åœ¨èŒ«èŒ«å¤šçš„ &lt;a href=&quot;http://jekyllthemes.org/&quot;&gt;Jekyll ä¸»é¢˜&lt;/a&gt;ä¸­æˆ‘æŒ‘ä¸­äº† &lt;a href=&quot;https://github.com/kitian616&quot;&gt;kitian616&lt;/a&gt; çš„ [&lt;a href=&quot;https://tianqi.name/jekyll-TeXt-theme/&quot;&gt;&lt;strong&gt;TeXt&lt;/strong&gt;&lt;/a&gt;] å’Œ &lt;a href=&quot;&quot;&gt;Huangxuan&lt;/a&gt; çš„ [&lt;a href=&quot;https://github.com/Huxpro/huxpro.github.io&quot;&gt;&lt;strong&gt;HuxPro&lt;/strong&gt;&lt;/a&gt;]. åŸå› å¾ˆç®€å•, è¿™ä¸¤æ¬¾ä¸»é¢˜é£æ ¼éƒ½éå¸¸ç®€å•å¥½çœ‹, ç„¶åå¯¹ Markdown è¯­æ³•å’Œå†…åµŒ LaTeX æ”¯æŒè‰¯å¥½, ç„¶åä¹Ÿæœ‰ä¸€äº›ç»†èŠ‚ä¸Šçš„ç‰¹æ€§å’Œå°åŠŸèƒ½éå¸¸æœ‰è¶£.&lt;/p&gt;

&lt;p&gt;æœ€ç»ˆ, å› ä¸ºæ›´ç†Ÿæ‚‰ä¸­æ„ &lt;strong&gt;HuxPro&lt;/strong&gt; çš„é£æ ¼, è¿™é‡ŒåŸºäº Hux æä¾›çš„ Boilerplate è¿›è¡Œäº†ä¸€æ¬¡ç®€å•çš„äºŒæ¬¡å®šåˆ¶, åŠ å…¥äº†ä¸€äº› TeXt ä¸Šçœ‹åˆ°çš„å°åŠŸèƒ½.&lt;/p&gt;

&lt;h4 id=&quot;post-åˆ†äº«åŠŸèƒ½&quot;&gt;Post åˆ†äº«åŠŸèƒ½&lt;/h4&gt;

&lt;p&gt;é¦–å…ˆæ˜¯å¼•å…¥äº†&lt;strong&gt;TeXt&lt;/strong&gt;ä¸»é¢˜ä¸­ä½¿ç”¨çš„åˆ†äº«åŠŸèƒ½ â€“ &lt;a href=&quot;https://www.addthis.com/&quot;&gt;&lt;strong&gt;AddThis&lt;/strong&gt;&lt;/a&gt;. ç°åœ¨æ¯ç¯‡Postéƒ½å¯ä»¥é€šè¿‡å³ä¸‹è§’çš„å°å›¾æ ‡åšå¿«æ·åˆ†äº«.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../img/in-post/2019-11-26-Blog-é‡å¯å£°æ˜/2019-11-28_18-49-44.gif&quot; width=&quot;300&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ç«™å†…æœç´¢&quot;&gt;ç«™å†…æœç´¢&lt;/h4&gt;

&lt;p&gt;ç„¶å, ç›¸æ¯”&lt;strong&gt;TeXt&lt;/strong&gt;å’Œ&lt;strong&gt;JeKyll&lt;/strong&gt;çš„ä¸»æµä¸»é¢˜&lt;strong&gt;Next&lt;/strong&gt;, &lt;strong&gt;HuxPro&lt;/strong&gt;çš„ä¸€ä¸ªå°ç¼ºé™·æ˜¯æ²¡æœ‰ç«™å†…æœç´¢åŠŸèƒ½, å½“ä»¥åPostæ¯”è¾ƒå¤šçš„æ—¶å€™, åªé€šè¿‡Tagåˆ†ç±»æ¥æŸ¥æ‰¾çš„æ–¹æ³•å°±æ˜¾å¾—æœ‰ç‚¹ä¸å¤Ÿæ•ˆç‡.&lt;/p&gt;

&lt;p&gt;å› æ­¤, è¿™é‡Œæˆ‘é€šè¿‡ &lt;a href=&quot;https://github.com/christian-fei/Simple-Jekyll-Search&quot;&gt;&lt;strong&gt;Simple-Jekyll-Search&lt;/strong&gt;&lt;/a&gt; æ¨¡å—, å®ç°äº†ä¸€ä¸ªç®€å•çš„åœ¨ä¾§è¾¹æ çš„ç«™å†…æ¨¡ç³Šæœç´¢.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../img/in-post/2019-11-26-Blog-é‡å¯å£°æ˜/2019-11-28_19-24-15.gif&quot; width=&quot;250&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;2-æ—§ç‰ˆç»†èŠ‚ä¼˜åŒ–&quot;&gt;2. æ—§ç‰ˆç»†èŠ‚ä¼˜åŒ–&lt;/h3&gt;

&lt;p&gt;å› ä¸ºä¹‹å‰æ˜¯å‚è€ƒåŸºäº HuxPro æ­å»ºçš„ &lt;a href=&quot;https://github.com/qiubaiying/qiubaiying.github.io&quot;&gt;BY Blog&lt;/a&gt;, ç„¶åè‡ªå·±ä¹Ÿæ·»åŠ äº†ç‚¹ä¸æˆç†Ÿçš„ä¿®æ”¹, æœ€ç»ˆå¯¼è‡´å‡ºç°ä¸€äº›å°é—®é¢˜æ²¡æœ‰è§£å†³.&lt;/p&gt;

&lt;h4 id=&quot;ä»£ç å—é«˜äº®&quot;&gt;ä»£ç å—é«˜äº®&lt;/h4&gt;

&lt;p&gt;ä¹‹å‰çš„ç‰ˆæœ¬ä¸­, ä»£ç å—åªèƒ½ä»¥ plain text æ˜¾ç¤º, æ— æ³•æ ¹æ®å¯¹åº”è¯­è¨€è‡ªåŠ¨é«˜äº®. ç°åœ¨ä¿®å¤äº†è¿™ä¸ªBug. æœªæ¥è¿˜æœ‰æƒ³æ³•å®ç°å¯¹å¤šç§ä»£ç é«˜äº®é£æ ¼çš„æ”¯æŒ. (ç›®å‰è¿™æ ·é»‘è‰²ä¹ŸæŒºå¥½çœ‹çš„, ä¸æ˜¯æˆ‘æ‡’~&lt;/p&gt;

&lt;h4 id=&quot;archive-ç•Œé¢çš„ä¼˜åŒ–&quot;&gt;Archive ç•Œé¢çš„ä¼˜åŒ–&lt;/h4&gt;

&lt;p&gt;ä¹‹å‰æ˜¯é€šè¿‡é¡µé¢çš„é”šå»åšç›´æ¥æ»šåŠ¨, æ–°ç‰ˆæœ¬åˆ™æ˜¯ç›´æ¥å»åšå¼‚æ­¥è·³è½¬. ä½¿ç”¨èµ·æ¥åº”è¯¥ä¼šæ›´æ–¹ä¾¿ä¸€äº›. 
ç›´æ¥çœ‹æ•ˆæœå›¾.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Old Version:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../img/in-post/2019-11-26-Blog-é‡å¯å£°æ˜/2019-11-28_19-51-40.gif&quot; alt=&quot;2019-11-28_19-51-40&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;New Version:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../img/in-post/2019-11-26-Blog-é‡å¯å£°æ˜/2019-11-28_19-53-30.gif&quot; alt=&quot;2019-11-28_19-53-30&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;3-post-tag-è®¾è®¡è§„åˆ™&quot;&gt;3. Post Tag è®¾è®¡è§„åˆ™&lt;/h3&gt;

&lt;p&gt;æœ¬èº«æˆ‘æ­å»ºè¿™ä¸ªåšå®¢çš„ç›®çš„å°±æ˜¯ä¸€æ–¹é¢é¼“åŠ±è‡ªå·±åšæŒå­¦ä¹ , å¦ä¸€æ–¹é¢é€šè¿‡åšå®¢æ¡†æ¶çš„è‡ªåŠ¨æ ‡ç­¾åŠŸèƒ½å®ç°å¿«é€Ÿå¤šåˆ†ç±», ä»¥ä¾¿äºçŸ¥è¯†å†…å®¹çš„ç®¡ç†å’Œå¿«é€Ÿå›é¡¾. ä½†æ˜¯ä½¿ç”¨å‡ ä¸ªæœˆä¹‹åå‘ç°, å½“postå˜å¤šä¹‹å, ä¹‹å‰è‰ç‡å®šä¸‹çš„æ ‡ç­¾å°±ä¼šå‡ºç°å†—ä½™å’Œæ··ä¹±.&lt;/p&gt;

&lt;p&gt;å› æ­¤åœ¨æ–°çš„ç‰ˆæœ¬, æˆ‘åˆ¶å®šäº†ä¸€ä¸ªæ ‡ç­¾è®¾å®šè§„åˆ™å¹¶ä¸”é‡æ–°æ•´ç†äº†è¿‡å»æ‰€æœ‰postçš„æ ‡ç­¾. å…·ä½“è§„åˆ™æˆ‘ä¼šåœ¨ &lt;a href=&quot;https://lyonling.github.io/about/&quot;&gt;&lt;strong&gt;About&lt;/strong&gt;&lt;/a&gt; ä¿æŒæ›´æ–°, å†…å®¹å¦‚ä¸‹:&lt;/p&gt;

&lt;p&gt;æ ¹æ®postæ‰€å±é¢†åŸŸå’Œç›¸å…³å†…å®¹, tagä»¥å¤šçº§å½¢å¼æ’åˆ—. å…¶ä¸­ç¬¬0çº§å±äºæ ‡ç­¾åˆ†ç±», ä¸åšå®é™…ç”¨é€”.
æ­¤å¤–, æ‰€æœ‰æ ‡ç­¾ä»¥é©¼å³°æ³•å‘½å, å½“postä¸­æåˆ°ä½çº§tagæ—¶, å…¶å¯¹åº”çš„çˆ¶çº§tagä¹Ÿéœ€è¦åœ¨å‰é¢æåˆ°.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-pseudocode&quot;&gt;- ç¼–ç¨‹è¯­è¨€
  - Python
  - C++
  - Java
  - JavaScript
  - Shell
  - MarkDown
- è®¡ç®—æœºåŸºç¡€
  - OperatingSystem
    - Mac
    - Linux
    - Windows
  - ComputerNetworks
  - Database
  - Algorithm
- å¤§æ•°æ® &amp;amp; æ•°æ®ç§‘å­¦
  - Maths
  - MachineLearning
  - SocialNetworks
  - NLP
  - DataMining
  - BigData
	  - Spark
- å·¥å…· &amp;amp; æ¡†æ¶
  - Github
  - Hive
  - BlockChain
- æŠ½è±¡ç±»åˆ«
  - Foundation
  - Tutorial
  - Tricks				# å°æŠ€å·§
  - Anouncement		# Blogçš„ä¸€äº›å…¬å‘Š
  - Debug					# å†™ç¨‹åºæ—¶é‡åˆ°çš„å‘&amp;amp;Debugçš„ç»éªŒ
  - Experience		# ä¸€äº›å½¢å¦‚é¢ç»è¿™ç±»çš„ç»éªŒå†…å®¹
  - Notes					# è¯»ä¹¦ç¬”è®°
  - åŒ»ç–—å¸¸è¯†
  - è½¬è½½
- ä¼ä¸šç›¸å…³
	- Alibaba
- ä¸“æ 						# è¯»ä¹¦ç¬”è®°, ç³»ç»Ÿæ€§ä¸»é¢˜å¤ä¹ ç­‰ç­‰
  - ç™¾é¢æœºå™¨å­¦ä¹ 
  - è°·æ­Œæ–¹æ³•è®º			# å´å†›è€å¸ˆçš„ è°·æ­Œæ–¹æ³•è®º &amp;amp; ç¡…è°·æ¥ä¿¡ ç³»åˆ—å†…å®¹é˜…è¯»ç¬”è®°
	- JobHunting
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨posté‡Œ, é«˜çº§åˆ«çš„tagåº”è¯¥ç½®äºä½çº§åˆ«çš„tagä¹‹å‰, ä¸€ç¯‡postä¸­çš„tagæ•°é‡æœ€å¥½ä¸è¦è¶…è¿‡5ä¸ª (å¤šäº†å®¹æ˜“å‡ºç°ä¸¢å¤±YMLå¤´çš„BUG, æš‚æ—¶ä¸çŸ¥é“ä¸ºå•¥â€¦).&lt;/p&gt;
</description>
        <pubDate>Tue, 26 Nov 2019 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2019/11/26/Blog-%E9%87%8D%E5%90%AF%E5%A3%B0%E6%98%8E/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/11/26/Blog-%E9%87%8D%E5%90%AF%E5%A3%B0%E6%98%8E/</guid>
        
        <category>Anouncement</category>
        
        
      </item>
    
      <item>
        <title>åšå®¢è¿ç§»è¯´æ˜</title>
        <description>&lt;blockquote&gt;
  &lt;p&gt;â€œ ğŸ™‰ğŸ™‰ğŸ™‰ â€&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ä¸‡ä¸‡æ²¡æƒ³åˆ°, æœ¬æ¥å‡†å¤‡å¥½å¥½ç»è¥çš„åšå®¢ä¹Ÿæœ‰è¿ç§»çš„ä¸€å¤©.&lt;/p&gt;

&lt;p&gt;æœ¬æ¥ç»´æŠ¤è¿™æ ·ä¸€ä¸ªåšå®¢, ä¸€æ–¹é¢æ˜¯è®°å½•è‡ªå·±çš„å­¦ä¹ å†ç¨‹, å¦ä¸€æ–¹é¢ä¹Ÿæ˜¯åˆ©ç”¨åšå®¢ç³»ç»Ÿçš„tagåŠŸèƒ½ç»™è‡ªå·±çš„ç¬”è®°åšä¸ªåˆ†ç±».&lt;/p&gt;

&lt;p&gt;ç°åœ¨çœ‹æ¥è¿™ç§ç¬”è®°åˆ†ç±»æ–¹æ³•è¿˜æ˜¯æ•ˆæœä¸å¤Ÿå¥½, è€Œä¸”åšå®¢æ¡†æ¶æœ¬èº«ä¼¼ä¹ä¹Ÿå­˜åœ¨ä¸€äº›Bug, æœ€è¿‘å¿™ç€ç§‹æ‹›ä¹Ÿæ²¡æœ‰æ—¶é—´å»è°ƒè¯•.&lt;/p&gt;

&lt;p&gt;å› æ­¤, æˆ‘æŠŠæ‰€æœ‰çš„ç¬”è®°å’Œå­¦ä¹ è®°å½•é‡æ–°æ•´ç†, æ›´åŠ ç³»ç»Ÿåœ°è¿ç§»åˆ°äº†&lt;strong&gt;Notion&lt;/strong&gt;å¹³å°ä¸Š. æ¬¢è¿å¤§å®¶è®¿é—® &lt;a href=&quot;https://www.notion.so/leonling/&quot;&gt;&lt;strong&gt;ğŸ‘‰æˆ‘çš„Notion WorkspaceğŸ‘ˆ&lt;/strong&gt;&lt;/a&gt;å’Œå‘è¡¨çœ‹æ³•, å¦‚æœå­˜åœ¨æƒé™é—®é¢˜è¯·ç›´æ¥ç»™æˆ‘é‚®ä»¶(&lt;a href=&quot;mailto:leon.ling@connect.ust.hk&quot;&gt;leon.ling@connect.ust.hk&lt;/a&gt;)æˆ–è€…åœ¨æœ¬å¸–ä¸‹ç•™è¨€ç•™ä¸‹é‚®ç®±, æˆ‘è¿™è¾¹æ‰‹åŠ¨å¼€æ”¾æƒé™. åç»­æˆ‘ä¹Ÿä¼šé€æ­¥å¼€æ”¾æ•´ä¸ªnotion workspaceçš„è®¿é—®æƒé™(å½“å‰å¯èƒ½åªæœ‰éƒ¨åˆ†å·²ç»æ•´ç†å®Œæˆçš„Page).&lt;/p&gt;

&lt;p&gt;æˆ–è®¸ç­‰å·¥ä½œå’Œç”Ÿæ´»ç¯å¢ƒç¡®å®šä¸‹æ¥äº†, æˆ‘ä¼šæŠ½æ—¶é—´å†é‡æ–°å¯åŠ¨åšå®¢é¡¹ç›®, æ˜å¤©å†è§.&lt;/p&gt;

</description>
        <pubDate>Tue, 10 Sep 2019 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2019/09/10/%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E8%AF%B4%E6%98%8E/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/09/10/%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E8%AF%B4%E6%98%8E/</guid>
        
        
      </item>
    
      <item>
        <title>C++ stdä¸­vectorå’Œlistçš„åŒºåˆ«</title>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;

&lt;h3 id=&quot;1-æ•°æ®ç»“æ„è®¾è®¡&quot;&gt;1. æ•°æ®ç»“æ„è®¾è®¡&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;vectoræ•°æ®ç»“æ„&lt;/p&gt;

    &lt;p&gt;vectorå’Œæ•°ç»„ç±»ä¼¼ï¼Œæ‹¥æœ‰ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå¹¶ä¸”èµ·å§‹åœ°å€ä¸å˜ã€‚
å› æ­¤èƒ½é«˜æ•ˆçš„è¿›è¡Œéšæœºå­˜å–ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºo(1);
ä½†å› ä¸ºå†…å­˜ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶ï¼Œä¼šé€ æˆå†…å­˜å—çš„æ‹·è´ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºo(n)ã€‚
å¦å¤–ï¼Œå½“æ•°ç»„ä¸­å†…å­˜ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œä¼šé‡æ–°ç”³è¯·ä¸€å—å†…å­˜ç©ºé—´å¹¶è¿›è¡Œå†…å­˜æ‹·è´ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;listæ•°æ®ç»“æ„&lt;/p&gt;

    &lt;p&gt;listæ˜¯ç”±åŒå‘é“¾è¡¨å®ç°çš„ï¼Œå› æ­¤å†…å­˜ç©ºé—´æ˜¯ä¸è¿ç»­çš„ã€‚
åªèƒ½é€šè¿‡æŒ‡é’ˆè®¿é—®æ•°æ®ï¼Œæ‰€ä»¥listçš„éšæœºå­˜å–éå¸¸æ²¡æœ‰æ•ˆç‡ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºo(n);
ä½†ç”±äºé“¾è¡¨çš„ç‰¹ç‚¹ï¼Œèƒ½é«˜æ•ˆåœ°è¿›è¡Œæ’å…¥å’Œåˆ é™¤ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-åŒºåˆ«å’Œè”ç³»&quot;&gt;2. åŒºåˆ«å’Œè”ç³»&lt;/h3&gt;

&lt;p&gt;ç”¨ä¸€ä¸ªç®€å•çš„vectorå’Œlistä½¿ç”¨ç¤ºä¾‹è¯´æ˜ï¼š&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;#include&amp;lt;iostream&amp;gt;
#include&amp;lt;vector&amp;gt;
#include&amp;lt;list&amp;gt;
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;vector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;////å¾€vå’Œlä¸­åˆ†åˆ«æ·»åŠ å…ƒç´ &lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;push_back&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;push_back&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;v[2]=&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//cout&amp;lt;&amp;lt;&quot;l[2]=&quot;&amp;lt;&amp;lt;l[2]&amp;lt;&amp;lt;endl;  			//ç¼–è¯‘é”™è¯¯,listæ²¡æœ‰é‡è½½[]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
    &lt;span class=&quot;c1&quot;&gt;//cout&amp;lt;&amp;lt;(l.begin()&amp;lt;l.end())&amp;lt;&amp;lt;endl; 	/ç¼–è¯‘é”™è¯¯,list::iteratoræ²¡æœ‰é‡è½½&amp;lt;æˆ–&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//cout&amp;lt;&amp;lt;*(l.begin()+1)&amp;lt;&amp;lt;endl; 			//ç¼–è¯‘é”™è¯¯,list::iteratoræ²¡æœ‰é‡è½½+&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;vector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iterator&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;itv&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iterator&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;itl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;itv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;itv&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//itl=itl+2; 												//ç¼–è¯‘é”™è¯¯,list::iteratoræ²¡æœ‰é‡è½½+&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;itl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 															&lt;span class=&quot;c1&quot;&gt;//list::iteratorä¸­é‡è½½äº†++ï¼Œåªèƒ½ä½¿ç”¨++è¿›è¡Œè¿­ä»£è®¿é—®ã€‚&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;itl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;itv&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;itl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;getchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;vectoræ‹¥æœ‰ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œèƒ½å¾ˆå¥½çš„æ”¯æŒéšæœºå­˜å–ï¼Œ
å› æ­¤&lt;code class=&quot;highlighter-rouge&quot;&gt;vector&amp;lt;int&amp;gt;::iterator&lt;/code&gt;æ”¯æŒâ€œ+â€ï¼Œâ€œ+=â€ï¼Œâ€œ&amp;lt;â€ç­‰æ“ä½œç¬¦ã€‚&lt;/p&gt;

&lt;p&gt;listçš„å†…å­˜ç©ºé—´å¯ä»¥æ˜¯ä¸è¿ç»­ï¼Œå®ƒä¸æ”¯æŒéšæœºè®¿é—®ï¼Œ
å› æ­¤&lt;code class=&quot;highlighter-rouge&quot;&gt;list&amp;lt;int&amp;gt;::iterator&lt;/code&gt;åˆ™ä¸æ”¯æŒâ€œ+â€ã€â€œ+=â€ã€â€œ&amp;lt;â€ç­‰&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;vector&amp;lt;int&amp;gt;::iterator&lt;/code&gt;å’Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;list&amp;lt;int&amp;gt;::iterator&lt;/code&gt;éƒ½é‡è½½äº†â€œ++â€è¿ç®—ç¬¦ã€‚&lt;/p&gt;

&lt;h3 id=&quot;3-æ€»ç»“&quot;&gt;3. æ€»ç»“&lt;/h3&gt;

&lt;p&gt;å¦‚æœéœ€è¦&lt;u&gt;é«˜æ•ˆçš„éšæœºå­˜å–&lt;/u&gt;ï¼Œè€Œä¸åœ¨ä¹æ’å…¥å’Œåˆ é™¤çš„æ•ˆç‡ï¼Œä½¿ç”¨vector;
å¦‚æœéœ€è¦&lt;u&gt;å¤§é‡çš„æ’å…¥å’Œåˆ é™¤&lt;/u&gt;ï¼Œè€Œä¸å…³å¿ƒéšæœºå­˜å–ï¼Œåˆ™åº”ä½¿ç”¨listã€‚&lt;/p&gt;
</description>
        <pubDate>Sat, 31 Aug 2019 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2019/08/31/C++%E4%B8%AD%E7%9A%84vector%E5%92%8Clist/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/08/31/C++%E4%B8%AD%E7%9A%84vector%E5%92%8Clist/</guid>
        
        <category>C++</category>
        
        <category>Programming</category>
        
        <category>Foundations</category>
        
        
      </item>
    
      <item>
        <title>Sparkç¼–ç¨‹ä¼˜åŒ–ç»éªŒ</title>
        <description>&lt;blockquote&gt;
  &lt;p&gt;åœ¨PAç”¨sparkå»å®Œæˆä¸šåŠ¡çš„è¿‡ç¨‹ä¸­æœ‰å„ç§å„æ ·çš„é—®é¢˜, ä¹Ÿæœ‰æŸ¥é˜…å„ç§èµ„æ–™, è¿™è¾¹ç»“åˆå·²æœ‰çš„èµ„æºç§¯ç´¯å†™ä¸€ä¸ªsparkç¨‹åºçš„ç»éªŒè®°å½•.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;[TOC]&lt;/p&gt;

&lt;h3 id=&quot;1-ä¸€ä¸ªsparkcontexté‡Œè¿›è¡Œçš„actionä¸åº”è¯¥æœ‰å¤ªå¤š&quot;&gt;1. ä¸€ä¸ªSparkContexté‡Œè¿›è¡Œçš„actionä¸åº”è¯¥æœ‰å¤ªå¤š&lt;/h3&gt;

&lt;p&gt;ä¸€ä¸ª SparkContext å¯¹åº”ä¸€ä¸ª spark åº”ç”¨ç¨‹åº, åœ¨ç¨‹åºé‡Œä¼šæœ‰å¾ˆå¤šçš„ rdd transformation æ“ä½œå’Œ action æ“ä½œ, ä¸€ä¸ª action æ“ä½œåˆ’åˆ†ä¸ºä¸€ä¸ª job. ä¸€ä¸ªjobçš„æ‰§è¡Œ, ä¼šåœ¨workerç«¯çš„å†…å­˜é‡Œå­˜æ”¾å¾ˆå¤štaskç›¸å…³çš„ä¿¡æ¯, è€Œè¿™äº›taskçš„ä¿¡æ¯åªä¼šåœ¨ sparkContext ç»“æŸæ—¶æ‰ä¼šæ¸…ç†, æ‰€ä»¥å¦‚æœ actionæ“ä½œå¤ªå¤š, é‚£ä¹ˆå‰é¢å†å²jobç§¯ç´¯çš„å¤§é‡taskä¿¡æ¯ä¼šå ç”¨å¤§é‡çš„å†…å­˜ç©ºé—´, å¯¼è‡´åé¢çš„taskåˆ†é…ç©ºé—´æ—¶ä¼šæ£‰é“ƒå¤§é‡çš„GC, ä»è€Œæµªè´¹è®¡ç®—æ—¶é—´.&lt;/p&gt;

&lt;p&gt;è§£å†³åŠæ³•: å°†è¿‡å¤šçš„actionæ‹†åˆ†åˆ°å‡ ä¸ª sparkContextä¸­åŒæ—¶è¿›è¡Œ.&lt;/p&gt;

&lt;h3 id=&quot;2-rddè®¡ç®—ä»»åŠ¡çš„å¹¶è¡Œåº¦ä¸å¤Ÿé«˜&quot;&gt;2. RDDè®¡ç®—ä»»åŠ¡çš„å¹¶è¡Œåº¦ä¸å¤Ÿé«˜&lt;/h3&gt;

&lt;p&gt;RDDè®¡ç®—ä»»åŠ¡çš„å¹¶è¡Œåº¦å¤§è‡´åˆ†ä¸ºä¸¤ç§: ä¸€ç§æ˜¯åˆå§‹RDDä»»åŠ¡çš„å¹¶å‘åº¦, ä¸€ç§æ˜¯shuffleåçš„RDDä»»åŠ¡å¹¶å‘åº¦.&lt;/p&gt;

&lt;p&gt;å¦‚æœæ˜¯åˆå§‹RDDä»»åŠ¡çš„å¹¶å‘åº¦ä¸é«˜, å¯ä»¥é€šè¿‡å‘½ä»¤æé«˜partitionçš„æ•°é‡.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;repartition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# num é€šå¸¸å–å€¼ 2*CPU ~ 1000
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœæ˜¯shuffleåçš„RDDä»»åŠ¡å¹¶å‘åº¦ä¸å¤Ÿé«˜,å¯ä»¥åœ¨æ¯ä¸ªshuffleæ“ä½œå‡½æ•°ä¼ å…¥ä¸€ä¸ªnumå€¼, å¦‚&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reduceByKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;numTasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;distinct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;numTasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-åœ¨shuffleä¹‹å‰è¿‡æ»¤æ— æ•ˆæ•°æ®&quot;&gt;3. åœ¨shuffleä¹‹å‰è¿‡æ»¤æ— æ•ˆæ•°æ®&lt;/h3&gt;

&lt;p&gt;æ•°æ®åœ¨sparkè®¡ç®—çš„stageé“¾ä¸Šä»¥pipelineçš„å½¢å¼æµåŠ¨, å¯¹äºæ— æ•ˆçš„æ•°æ®å¿…é¡»åœ¨shuffleæ“ä½œä¹‹å‰è¿›è¡Œè¿‡æ»¤, è¿‡æ»¤çš„æ–¹å¼æ˜¯ä½¿ç”¨RDDçš„filteræ“ä½œ.&lt;/p&gt;

&lt;h3 id=&quot;4-è¢«å¤„ç†çš„æ•°æ®æœ€å°å•å…ƒä¸è¦æœ‰ç©ºè¡Œæˆ–è€…nullå€¼&quot;&gt;4. è¢«å¤„ç†çš„æ•°æ®æœ€å°å•å…ƒä¸è¦æœ‰ç©ºè¡Œæˆ–è€…NULLå€¼&lt;/h3&gt;

&lt;p&gt;åœ¨sparkè®¡ç®—ä»»åŠ¡ä¸­, pipelineå½¢å¼æµåŠ¨çš„æœ€å°æ•°æ®å•å…ƒä¸è¦æœ‰ç©ºè¡Œæˆ–è€…NULLå€¼, å› ä¸ºè¿™æ ·ä¼šå¯¼è‡´æŸäº›è®¡ç®—ä»»åŠ¡å‡ºç°æœªçŸ¥çš„ä½œç‰©. å¯¹ç©ºè¡Œå’Œæ§åˆ¶è¦åœ¨è¿›è¡Œè®¡ç®—å‰è¿›è¡Œfilterå¤„ç†. åœ¨æŸä¸ªè®¡ç®—ä»»åŠ¡ä¸­æ•è·å¼‚å¸¸åéœ€è¦å‘åç»§ç»­ä¼ é€’æ•°æ®æ—¶, å¯ä»¥ä¼ é€’ä¸€äº›è‡ªå®šä¹‰çš„æ— æ„ä¹‰ä¸å½±å“è®¡ç®—ç»“æœçš„æ•°æ®.&lt;/p&gt;

&lt;h3 id=&quot;5-reduceby-æ“ä½œæ›¿ä»£-groupby&quot;&gt;5. reduceBy æ“ä½œæ›¿ä»£ groupBy&lt;/h3&gt;

&lt;p&gt;åœ¨æ•°æ®é‡æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹, groupBy æ€»ä¼šåœ¨shuffleçš„æ—¶å€™æ¶ˆè€—æ‰å¤§é‡çš„æ—¶é—´.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/739727/201801/739727-20180126174937069-1579617042.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/739727/201801/739727-20180126175121959-313725154.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¦‚ä¸Šå›¾æ‰€ç¤º, reduceBy æ“ä½œåœ¨æ•°æ®shuffleä¹‹å‰ä¼šå°†æ¯ä¸ªpartitionçš„æ•°æ®è¿›è¡Œä¸€æ¬¡èšåˆ, è¿™æ ·æ•°æ®é‡å¤§å¤§å‡å°‘, è€Œ groupByåˆ™æ²¡æœ‰è¿™ç§æ“ä½œ, shuffleçš„æ—¶å€™å°±ä¼šæœ‰å¤§é‡æ•°æ®åœ¨è®¡ç®—ç½‘ç»œä¸Šè¿›è¡Œä¼ è¾“.&lt;/p&gt;

&lt;h3 id=&quot;6-å…³äºjoinçš„ä¼˜åŒ–&quot;&gt;6. å…³äºjoinçš„ä¼˜åŒ–&lt;/h3&gt;

&lt;h3 id=&quot;7-å°½é‡é¿å…åœ¨rddä¸Šæ‰§è¡Œcollectæ“ä½œ&quot;&gt;7. å°½é‡é¿å…åœ¨RDDä¸Šæ‰§è¡Œcollectæ“ä½œ&lt;/h3&gt;

&lt;p&gt;åœ¨RDDä¸Šæ‰§è¡Œcollectæ“ä½œä¸€èˆ¬ç›®çš„æ˜¯ä¸ºäº†å°†wokerç«¯çš„è®¡ç®—ç»“æœæ”¶é›†åˆ°dirverç«¯. å¦‚æœç»“æœçš„æ•°æ®é‡ç‰¹åˆ«å¤§, é‚£ä¹ˆå°±å®¹æ˜“å¯¼è‡´driverç«¯çš„OOMé—®é¢˜. åŒæ—¶é›†ç¾¤ä¸Šçš„ç½‘ç»œä¼ è¾“ä¹Ÿä¼šéå¸¸è€—æ—¶.&lt;/p&gt;

&lt;p&gt;ä¸€èˆ¬çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å…ˆæŠŠç»“æœä¿å­˜åˆ°HDFSä¸Š, ç„¶åå†ä»HDFSè¯»å–æ•°æ®.&lt;/p&gt;

&lt;h3 id=&quot;8-ç»å¸¸ä½¿ç”¨çš„ä¸­é—´rdd-å¯¹è¿™ä¸ªrddè¿›è¡Œcacheæ“ä½œ&quot;&gt;8. ç»å¸¸ä½¿ç”¨çš„ä¸­é—´RDD, å¯¹è¿™ä¸ªRDDè¿›è¡Œcacheæ“ä½œ&lt;/h3&gt;

&lt;p&gt;è¿™é‡Œæœ‰å‡ ä¸ªå…³é”®çš„çŸ¥è¯†ç‚¹.&lt;/p&gt;

&lt;p&gt;RDDæ˜¯ resilient distributed dataset, æ˜¯sparkæ•°æ®æ“ä½œçš„æœ€åŸºæœ¬å•ä½. RDDæœ¬èº«æ˜¯ä¸å¯å˜çš„, é€šè¿‡transformationå®šä¹‰RDDçš„è®¡ç®—å›¾, å› ä¸ºlazy computationæœºåˆ¶, ä¸ä¼šåŠæ—¶è§¦å‘æ“ä½œ, ç„¶ååœ¨æ¯æ¬¡æ‰§è¡Œactionæ“ä½œæ—¶, ç”Ÿæˆæ–°çš„RDD.&lt;/p&gt;

&lt;p&gt;ä¹Ÿæ˜¯å› ä¸ºlazy computation, æ¯æ¬¡æ‰§è¡Œactionæ“ä½œæ—¶, éƒ½ä¼šå°†å¯¹åº”RDDçš„è®¡ç®—å›¾å®Œæ•´æ‰§è¡Œä¸€é, è¿™æ ·å°±ä¼šå¸¦æ¥ä¸å¿…è¦çš„é‡å¤è®¡ç®—. é€šè¿‡åœ¨actionæ“ä½œå‰æŒ‡å®šcache RDD, å°±å¯ä»¥æŠŠä¸‹æ¬¡actionæ“ä½œçš„ç»“æœç¼“å­˜åˆ°å†…å­˜ä¸­, ä¸‹æ¬¡è®¡ç®—å°±ä»ç¼“å­˜çš„ä½ç½®ç»§ç»­å¼€å§‹, æé«˜è®¡ç®—æ•ˆç‡.&lt;/p&gt;

&lt;h3 id=&quot;9-å°½é‡å‡å°‘transformationå’Œactionä¸­çš„shuffleæ“ä½œ&quot;&gt;9. å°½é‡å‡å°‘transformationå’Œactionä¸­çš„shuffleæ“ä½œ&lt;/h3&gt;

&lt;p&gt;Spark Internalä¸­ä¸ºäº†æé«˜è¿è¡Œæ•ˆç‡, åœ¨æ¯æ¬¡shuffleæ“ä½œä¹‹åä¼šè‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡cacheæ“ä½œ, å½“cacheå¤šäº†ä¹‹åå°±ä¼šå ç”¨å¤§é‡å†…å­˜, é€ æˆè¾ƒå¤šçš„GCä¸Šçš„å¼€é”€.&lt;/p&gt;

&lt;p&gt;å¯¹äºéœ€è¦å¤šè¯shuffleçš„RDD, å¯ä»¥åœ¨RDDç”Ÿæˆä¹‹åè¿›è¡Œä¸€æ¬¡partitionæ“ä½œ(ä½¿ç”¨çš„partitionerå’Œshuffleçš„ä¸€æ ·), è¿™æ ·è¿™ä¸ªRDDåœ¨åç»­çš„shuffleä¸­ä¸ä¼šå†è¿›è¡Œshuffleè€Œåšç½‘ç»œä¼ è¾“äº†.&lt;/p&gt;

&lt;h3 id=&quot;10-spark-long-run-application-éœ€è¦è®¾ç½®-sparkcleanerttlå‚æ•°&quot;&gt;10. Spark Long Run Application éœ€è¦è®¾ç½® &lt;code class=&quot;highlighter-rouge&quot;&gt;spark.cleaner.ttl&lt;/code&gt;å‚æ•°&lt;/h3&gt;

&lt;p&gt;å¯¹long run application, ä¸ºå…¶åˆ†é…çš„å†…å­˜ç©ºé—´ä¼šç”±äºå†å²taskä¿¡æ¯çš„ä¸æ–­ç´¯ç§¯è€Œå‡å°‘, å¯¹äºåé¢çš„è®¡ç®—ä»»åŠ¡, è¿›è¡Œè®¡ç®—å‰éƒ½éœ€è¦å¤§é‡çš„GC, ååˆ†è€—æ—¶.&lt;/p&gt;

&lt;p&gt;è®¾ç½® &lt;code class=&quot;highlighter-rouge&quot;&gt;spark.cleaner.ttl&lt;/code&gt;å‚æ•°å, sparkç¨‹åºä¼šå®šæ—¶æ¸…é™¤å†å²çš„taskä¿¡æ¯.&lt;/p&gt;

</description>
        <pubDate>Fri, 23 Aug 2019 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2019/08/23/Spark%E7%BC%96%E7%A8%8B%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/08/23/Spark%E7%BC%96%E7%A8%8B%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/</guid>
        
        <category>Tutorial</category>
        
        <category>BigData</category>
        
        <category>Spark</category>
        
        
      </item>
    
      <item>
        <title>å‰‘æŒ‡Offer-æ•°æ®åº“&amp;SQL</title>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;

&lt;h2 id=&quot;æ•°æ®åº“åŸºç¡€&quot;&gt;&lt;strong&gt;æ•°æ®åº“åŸºç¡€&lt;/strong&gt;&lt;/h2&gt;

&lt;h3 id=&quot;1-äº‹åŠ¡&quot;&gt;1. äº‹åŠ¡&lt;/h3&gt;

&lt;p&gt;äº‹åŠ¡æŒ‡çš„æ˜¯æ»¡è¶³ ACID ç‰¹æ€§çš„ä¸€ç»„æ“ä½œï¼Œå¯ä»¥é€šè¿‡ Commit æäº¤ä¸€ä¸ªäº‹åŠ¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Rollback è¿›è¡Œå›æ»šã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/f74144be-857a-40cd-8ec7-87626ef4e20b.png&quot; width=&quot;400&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;11-acid&quot;&gt;1.1 ACID&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;åŸå­æ€§ï¼ˆAtomicityï¼‰&lt;/p&gt;

    &lt;p&gt;äº‹åŠ¡è¢«è§†ä¸ºä¸å¯åˆ†å‰²çš„æœ€å°å•å…ƒï¼Œäº‹åŠ¡çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚&lt;/p&gt;

    &lt;p&gt;å›æ»šå¯ä»¥ç”¨å›æ»šæ—¥å¿—æ¥å®ç°ï¼Œå›æ»šæ—¥å¿—è®°å½•ç€äº‹åŠ¡æ‰€æ‰§è¡Œçš„ä¿®æ”¹æ“ä½œï¼Œåœ¨å›æ»šæ—¶åå‘æ‰§è¡Œè¿™äº›ä¿®æ”¹æ“ä½œå³å¯ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰&lt;/p&gt;

    &lt;p&gt;æ•°æ®åº“åœ¨äº‹åŠ¡æ‰§è¡Œå‰åéƒ½ä¿æŒä¸€è‡´æ€§çŠ¶æ€ã€‚åœ¨ä¸€è‡´æ€§çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰äº‹åŠ¡å¯¹ä¸€ä¸ªæ•°æ®çš„è¯»å–ç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;éš”ç¦»æ€§ï¼ˆIsolationï¼‰&lt;/p&gt;

    &lt;p&gt;ä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤ä»¥å‰ï¼Œå¯¹å…¶å®ƒäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æŒä¹…æ€§ï¼ˆDurabilityï¼‰&lt;/p&gt;

    &lt;p&gt;ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å…¶æ‰€åšçš„ä¿®æ”¹å°†ä¼šæ°¸è¿œä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚å³ä½¿ç³»ç»Ÿå‘ç”Ÿå´©æºƒï¼Œäº‹åŠ¡æ‰§è¡Œçš„ç»“æœä¹Ÿä¸èƒ½ä¸¢å¤±ã€‚&lt;/p&gt;

    &lt;p&gt;ä½¿ç”¨é‡åšæ—¥å¿—æ¥ä¿è¯æŒä¹…æ€§ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;äº‹åŠ¡çš„ ACID ç‰¹æ€§æ¦‚å¿µç®€å•ï¼Œä½†ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Œä¸»è¦æ˜¯å› ä¸ºè¿™å‡ ä¸ªç‰¹æ€§ä¸æ˜¯ä¸€ç§å¹³çº§å…³ç³»ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;åªæœ‰æ»¡è¶³ä¸€è‡´æ€§ï¼Œäº‹åŠ¡çš„æ‰§è¡Œç»“æœæ‰æ˜¯æ­£ç¡®çš„ã€‚&lt;/li&gt;
  &lt;li&gt;åœ¨æ— å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œéš”ç¦»æ€§ä¸€å®šèƒ½å¤Ÿæ»¡è¶³ã€‚æ­¤æ—¶åªè¦èƒ½æ»¡è¶³åŸå­æ€§ï¼Œå°±ä¸€å®šèƒ½æ»¡è¶³ä¸€è‡´æ€§ã€‚&lt;/li&gt;
  &lt;li&gt;åœ¨å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œäº‹åŠ¡ä¸ä»…è¦æ»¡è¶³åŸå­æ€§ï¼Œè¿˜éœ€è¦æ»¡è¶³éš”ç¦»æ€§ï¼Œæ‰èƒ½æ»¡è¶³ä¸€è‡´æ€§ã€‚&lt;/li&gt;
  &lt;li&gt;äº‹åŠ¡æ»¡è¶³æŒä¹…åŒ–æ˜¯ä¸ºäº†èƒ½åº”å¯¹æ•°æ®åº“å´©æºƒçš„æƒ…å†µã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/417bc315-4409-48c6-83e0-59e8d405429e.jpg&quot; width=&quot;600&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;12-autocommit&quot;&gt;1.2 AUTOCOMMIT&lt;/h4&gt;

&lt;p&gt;MySQL é»˜è®¤é‡‡ç”¨è‡ªåŠ¨æäº¤æ¨¡å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸æ˜¾å¼ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;START TRANSACTION&lt;/code&gt;è¯­å¥æ¥å¼€å§‹ä¸€ä¸ªäº‹åŠ¡ï¼Œé‚£ä¹ˆæ¯ä¸ªæŸ¥è¯¢éƒ½ä¼šè¢«å½“åšä¸€ä¸ªäº‹åŠ¡è‡ªåŠ¨æäº¤ã€‚&lt;/p&gt;

&lt;h3 id=&quot;2-å¹¶å‘ä¸€è‡´æ€§é—®é¢˜&quot;&gt;2. å¹¶å‘ä¸€è‡´æ€§é—®é¢˜&lt;/h3&gt;

&lt;p&gt;åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œäº‹åŠ¡çš„éš”ç¦»æ€§å¾ˆéš¾ä¿è¯ï¼Œå› æ­¤ä¼šå‡ºç°å¾ˆå¤šå¹¶å‘ä¸€è‡´æ€§é—®é¢˜ã€‚&lt;/p&gt;

&lt;h4 id=&quot;21-ä¸¢å¤±ä¿®æ”¹&quot;&gt;2.1 ä¸¢å¤±ä¿®æ”¹&lt;/h4&gt;

&lt;p&gt;T1 å’Œ T2 ä¸¤ä¸ªäº‹åŠ¡éƒ½å¯¹ä¸€ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹ï¼ŒT1 å…ˆä¿®æ”¹ï¼ŒT2 éšåä¿®æ”¹ï¼ŒT2 çš„ä¿®æ”¹è¦†ç›–äº† T1 çš„ä¿®æ”¹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/75184b58-c627-4edc-8dcf-605762ebb733.png&quot; width=&quot;400&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;22-è¯»è„æ•°æ®&quot;&gt;2.2 è¯»è„æ•°æ®&lt;/h4&gt;

&lt;p&gt;T1 ä¿®æ”¹ä¸€ä¸ªæ•°æ®ï¼ŒT2 éšåè¯»å–è¿™ä¸ªæ•°æ®ã€‚å¦‚æœ T1 æ’¤é”€äº†è¿™æ¬¡ä¿®æ”¹ï¼Œé‚£ä¹ˆ T2 è¯»å–çš„æ•°æ®æ˜¯è„æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/af0e94d9-502d-4531-938f-d46dd29de52d.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;23-ä¸å¯é‡å¤è¯»&quot;&gt;2.3 ä¸å¯é‡å¤è¯»&lt;/h4&gt;

&lt;p&gt;T2 è¯»å–ä¸€ä¸ªæ•°æ®ï¼ŒT1 å¯¹è¯¥æ•°æ®åšäº†ä¿®æ”¹ã€‚å¦‚æœ T2 å†æ¬¡è¯»å–è¿™ä¸ªæ•°æ®ï¼Œæ­¤æ—¶è¯»å–çš„ç»“æœå’Œç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœä¸åŒã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/66ae164c-ad47-4905-895e-51fe38ce797a.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;24-å¹»å½±è¯»&quot;&gt;2.4 å¹»å½±è¯»&lt;/h4&gt;

&lt;p&gt;T1 è¯»å–æŸä¸ªèŒƒå›´çš„æ•°æ®ï¼ŒT2 åœ¨è¿™ä¸ªèŒƒå›´å†…æ’å…¥æ–°çš„æ•°æ®ï¼ŒT1 å†æ¬¡è¯»å–è¿™ä¸ªèŒƒå›´çš„æ•°æ®ï¼Œæ­¤æ—¶è¯»å–çš„ç»“æœå’Œå’Œç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœä¸åŒã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/8fdc577d-552d-4b43-b5e4-a8f98bc2cb51.png&quot; width=&quot;400&quot; /&gt;&lt;/p&gt;

&lt;p&gt;äº§ç”Ÿå¹¶å‘ä¸ä¸€è‡´æ€§é—®é¢˜ä¸»è¦åŸå› æ˜¯ç ´åäº†äº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œè§£å†³æ–¹æ³•æ˜¯é€šè¿‡å¹¶å‘æ§åˆ¶æ¥ä¿è¯éš”ç¦»æ€§ã€‚å¹¶å‘æ§åˆ¶å¯ä»¥é€šè¿‡å°é”æ¥å®ç°ï¼Œä½†æ˜¯å°é”æ“ä½œéœ€è¦ç”¨æˆ·è‡ªå·±æ§åˆ¶ï¼Œç›¸å½“å¤æ‚ã€‚æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæä¾›äº†äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œè®©ç”¨æˆ·ä»¥ä¸€ç§æ›´è½»æ¾çš„æ–¹å¼å¤„ç†å¹¶å‘ä¸€è‡´æ€§é—®é¢˜ã€‚&lt;/p&gt;

&lt;h3 id=&quot;3-å°é”---é€šè¿‡é”ä¿è¯äº‹åŠ¡éš”ç¦»æ€§&quot;&gt;3. å°é” - é€šè¿‡é”ä¿è¯äº‹åŠ¡éš”ç¦»æ€§&lt;/h3&gt;

&lt;h4 id=&quot;31-å°é”ç²’åº¦&quot;&gt;3.1 å°é”ç²’åº¦&lt;/h4&gt;

&lt;p&gt;MySQL ä¸­æä¾›äº†ä¸¤ç§å°é”ç²’åº¦ï¼š&lt;strong&gt;è¡Œçº§é”&lt;/strong&gt;ä»¥åŠ&lt;strong&gt;è¡¨çº§é”&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;åº”è¯¥å°½é‡åªé”å®šéœ€è¦ä¿®æ”¹çš„é‚£éƒ¨åˆ†æ•°æ®ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„èµ„æºã€‚é”å®šçš„æ•°æ®é‡è¶Šå°‘ï¼Œå‘ç”Ÿé”äº‰ç”¨çš„å¯èƒ½å°±è¶Šå°ï¼Œç³»ç»Ÿçš„&lt;u&gt;å¹¶å‘ç¨‹åº¦&lt;/u&gt;å°±è¶Šé«˜ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯åŠ é”éœ€è¦æ¶ˆè€—èµ„æºï¼Œé”çš„å„ç§æ“ä½œï¼ˆåŒ…æ‹¬è·å–é”ã€é‡Šæ”¾é”ã€ä»¥åŠæ£€æŸ¥é”çŠ¶æ€ï¼‰éƒ½ä¼šå¢åŠ ç³»ç»Ÿå¼€é”€ã€‚å› æ­¤å°é”ç²’åº¦è¶Šå°ï¼Œç³»ç»Ÿå¼€é”€å°±è¶Šå¤§ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨é€‰æ‹©å°é”ç²’åº¦æ—¶ï¼Œéœ€è¦åœ¨é”å¼€é”€å’Œå¹¶å‘ç¨‹åº¦ä¹‹é—´åšä¸€ä¸ªæƒè¡¡ã€‚&lt;/p&gt;

&lt;h4 id=&quot;32-å°é”ç±»å‹&quot;&gt;3.2 å°é”ç±»å‹&lt;/h4&gt;

&lt;h5 id=&quot;1-è¯»å†™é”&quot;&gt;1. è¯»å†™é”&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;æ’å®ƒé”ï¼ˆExclusiveï¼‰ï¼Œç®€å†™ä¸º X é”ï¼Œåˆç§°å†™é”ã€‚&lt;/li&gt;
  &lt;li&gt;å…±äº«é”ï¼ˆSharedï¼‰ï¼Œç®€å†™ä¸º S é”ï¼Œåˆç§°è¯»é”ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æœ‰ä»¥ä¸‹ä¸¤ä¸ªè§„å®šï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸€ä¸ªäº‹åŠ¡å¯¹æ•°æ®å¯¹è±¡ A åŠ äº† X é”ï¼Œå°±å¯ä»¥å¯¹ A è¿›è¡Œè¯»å–å’Œæ›´æ–°ã€‚åŠ é”æœŸé—´å…¶å®ƒäº‹åŠ¡ä¸èƒ½å¯¹ A åŠ ä»»ä½•é”ã€‚&lt;/li&gt;
  &lt;li&gt;ä¸€ä¸ªäº‹åŠ¡å¯¹æ•°æ®å¯¹è±¡ A åŠ äº† S é”ï¼Œå¯ä»¥å¯¹ A è¿›è¡Œè¯»å–æ“ä½œï¼Œä½†æ˜¯ä¸èƒ½è¿›è¡Œæ›´æ–°æ“ä½œã€‚åŠ é”æœŸé—´å…¶å®ƒäº‹åŠ¡èƒ½å¯¹ A åŠ  S é”ï¼Œä½†æ˜¯ä¸èƒ½åŠ  X é”ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é”çš„å…¼å®¹å…³ç³»å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;-&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;X&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;S&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;X&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Ã—&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Ã—&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;S&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Ã—&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;âˆš&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h5 id=&quot;2-æ„å‘é”&quot;&gt;2. æ„å‘é”&lt;/h5&gt;

&lt;p&gt;ä½¿ç”¨&lt;strong&gt;æ„å‘é”&lt;/strong&gt;ï¼ˆIntention Locksï¼‰å¯ä»¥æ›´å®¹æ˜“åœ°æ”¯æŒå¤šç²’åº¦å°é”ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å­˜åœ¨è¡Œçº§é”å’Œè¡¨çº§é”çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ T æƒ³è¦å¯¹è¡¨ A åŠ  X é”ï¼Œå°±éœ€è¦å…ˆæ£€æµ‹æ˜¯å¦æœ‰å…¶å®ƒäº‹åŠ¡å¯¹è¡¨ A æˆ–è€…è¡¨ A ä¸­çš„ä»»æ„ä¸€è¡ŒåŠ äº†é”ï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹è¡¨ A çš„æ¯ä¸€è¡Œéƒ½æ£€æµ‹ä¸€æ¬¡ï¼Œè¿™æ˜¯éå¸¸è€—æ—¶çš„ã€‚&lt;/p&gt;

&lt;p&gt;æ„å‘é”åœ¨åŸæ¥çš„ X/S é”ä¹‹ä¸Šå¼•å…¥äº† IX/ISï¼ŒIX/IS éƒ½æ˜¯è¡¨é”ï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡æƒ³è¦åœ¨è¡¨ä¸­çš„æŸä¸ªæ•°æ®è¡Œä¸ŠåŠ  X é”æˆ– S é”ã€‚æœ‰ä»¥ä¸‹ä¸¤ä¸ªè§„å®šï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸€ä¸ªäº‹åŠ¡åœ¨è·å¾—æŸä¸ªæ•°æ®è¡Œå¯¹è±¡çš„ S é”ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”æˆ–è€…æ›´å¼ºçš„é”ï¼›&lt;/li&gt;
  &lt;li&gt;ä¸€ä¸ªäº‹åŠ¡åœ¨è·å¾—æŸä¸ªæ•°æ®è¡Œå¯¹è±¡çš„ X é”ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€šè¿‡å¼•å…¥æ„å‘é”ï¼Œäº‹åŠ¡ T æƒ³è¦å¯¹è¡¨ A åŠ  X é”ï¼Œåªéœ€è¦å…ˆæ£€æµ‹æ˜¯å¦æœ‰å…¶å®ƒäº‹åŠ¡å¯¹è¡¨ A åŠ äº† X/IX/S/IS é”ï¼Œå¦‚æœåŠ äº†å°±è¡¨ç¤ºæœ‰å…¶å®ƒäº‹åŠ¡æ­£åœ¨ä½¿ç”¨è¿™ä¸ªè¡¨æˆ–è€…è¡¨ä¸­æŸä¸€è¡Œçš„é”ï¼Œå› æ­¤äº‹åŠ¡ T åŠ  X é”å¤±è´¥ã€‚&lt;/p&gt;

&lt;p&gt;å„ç§é”çš„å…¼å®¹å…³ç³»å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;-&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;X&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;IX&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;S&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;IS&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;X&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Ã—&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Ã—&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Ã—&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Ã—&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;IX&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Ã—&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;âˆš&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Ã—&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;âˆš&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;S&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Ã—&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Ã—&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;âˆš&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;âˆš&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;IS&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Ã—&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;âˆš&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;âˆš&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;âˆš&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;è§£é‡Šå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä»»æ„ IS/IX é”ä¹‹é—´éƒ½æ˜¯å…¼å®¹çš„ï¼Œå› ä¸ºå®ƒä»¬åªæ˜¯è¡¨ç¤ºæƒ³è¦å¯¹è¡¨åŠ é”ï¼Œè€Œä¸æ˜¯çœŸæ­£åŠ é”ï¼›&lt;/li&gt;
  &lt;li&gt;S é”åªä¸ S é”å’Œ IS é”å…¼å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´äº‹åŠ¡ T æƒ³è¦å¯¹æ•°æ®è¡ŒåŠ  S é”ï¼Œå…¶å®ƒäº‹åŠ¡å¯ä»¥å·²ç»è·å¾—å¯¹è¡¨æˆ–è€…è¡¨ä¸­çš„è¡Œçš„ S é”ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;33-å°é”åè®®&quot;&gt;3.3 å°é”åè®®&lt;/h4&gt;

&lt;h5 id=&quot;1-ä¸‰çº§é”åè®®&quot;&gt;1. ä¸‰çº§é”åè®®&lt;/h5&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;ä¸€çº§å°é”åè®®&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;äº‹åŠ¡ T è¦ä¿®æ”¹æ•°æ® A æ—¶å¿…é¡»åŠ  X é”ï¼Œç›´åˆ° T ç»“æŸæ‰é‡Šæ”¾é”ã€‚&lt;/p&gt;

    &lt;p&gt;å¯ä»¥è§£å†³ä¸¢å¤±ä¿®æ”¹é—®é¢˜ï¼Œå› ä¸ºä¸èƒ½åŒæ—¶æœ‰ä¸¤ä¸ªäº‹åŠ¡å¯¹åŒä¸€ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆäº‹åŠ¡çš„ä¿®æ”¹å°±ä¸ä¼šè¢«è¦†ç›–ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;T1&lt;/th&gt;
      &lt;th&gt;T2&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;lock-x(A)&lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;read A=20&lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;lock-x(A)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;wait&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;write A=19&lt;/td&gt;
      &lt;td&gt;.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;commit&lt;/td&gt;
      &lt;td&gt;.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;unlock-x(A)&lt;/td&gt;
      &lt;td&gt;.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;obtain&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;read A=19&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;write A=21&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;commit&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;unlock-x(A2)&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;äºŒçº§å°é”åè®®&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;åœ¨ä¸€çº§çš„åŸºç¡€ä¸Šï¼Œè¦æ±‚è¯»å–æ•°æ® A æ—¶å¿…é¡»åŠ  S é”ï¼Œè¯»å–å®Œé©¬ä¸Šé‡Šæ”¾ S é”ã€‚&lt;/p&gt;

    &lt;p&gt;å¯ä»¥è§£å†³è¯»è„æ•°æ®é—®é¢˜ï¼Œå› ä¸ºå¦‚æœä¸€ä¸ªäº‹åŠ¡åœ¨å¯¹æ•°æ® A è¿›è¡Œä¿®æ”¹ï¼Œæ ¹æ® 1 çº§å°é”åè®®ï¼Œä¼šåŠ  X é”ï¼Œé‚£ä¹ˆå°±ä¸èƒ½å†åŠ  S é”äº†ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šè¯»å…¥æ•°æ®ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;T1&lt;/th&gt;
      &lt;th&gt;T2&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;lock-x(A)&lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;read A=20&lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;write A=19&lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;lock-s(A)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;wait&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;rollback&lt;/td&gt;
      &lt;td&gt;.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;A=20&lt;/td&gt;
      &lt;td&gt;.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;unlock-x(A)&lt;/td&gt;
      &lt;td&gt;.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;obtain&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;read A=20&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;unlock-s(A)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;commit&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;ä¸‰çº§å°é”åè®®&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;åœ¨äºŒçº§çš„åŸºç¡€ä¸Šï¼Œè¦æ±‚è¯»å–æ•°æ® A æ—¶å¿…é¡»åŠ  S é”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸäº†æ‰èƒ½é‡Šæ”¾ S é”ã€‚&lt;/p&gt;

    &lt;p&gt;å¯ä»¥è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œå› ä¸ºè¯» A æ—¶ï¼Œå…¶å®ƒäº‹åŠ¡ä¸èƒ½å¯¹ A åŠ  X é”ï¼Œä»è€Œé¿å…äº†åœ¨è¯»çš„æœŸé—´æ•°æ®å‘ç”Ÿæ”¹å˜ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;T1&lt;/th&gt;
      &lt;th&gt;T2&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;lock-s(A)&lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;read A=20&lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;lock-x(A)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;wait&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;read A=20&lt;/td&gt;
      &lt;td&gt;.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;commit&lt;/td&gt;
      &lt;td&gt;.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;unlock-s(A)&lt;/td&gt;
      &lt;td&gt;.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;obtain&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;read A=20&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;write A=19&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;commit&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;unlock-X(A)&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h5 id=&quot;2-ä¸¤æ®µé”åè®®&quot;&gt;2. ä¸¤æ®µé”åè®®&lt;/h5&gt;

&lt;p&gt;åŠ é”å’Œè§£é”åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µè¿›è¡Œã€‚&lt;/p&gt;

&lt;p&gt;å¯ä¸²è¡ŒåŒ–è°ƒåº¦æ˜¯æŒ‡ï¼Œé€šè¿‡å¹¶å‘æ§åˆ¶ï¼Œä½¿å¾—å¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ç»“æœä¸æŸä¸ªä¸²è¡Œæ‰§è¡Œçš„äº‹åŠ¡ç»“æœç›¸åŒã€‚&lt;/p&gt;

&lt;p&gt;äº‹åŠ¡éµå¾ªä¸¤æ®µé”åè®®æ˜¯ä¿è¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦çš„å……åˆ†æ¡ä»¶ã€‚ä¾‹å¦‚ä»¥ä¸‹æ“ä½œæ»¡è¶³ä¸¤æ®µé”åè®®ï¼Œå®ƒæ˜¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;lock-x(A)...lock-s(B)...lock-s(C)...unlock(A)...unlock(C)...unlock(B)
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä½†ä¸æ˜¯å¿…è¦æ¡ä»¶ï¼Œä¾‹å¦‚ä»¥ä¸‹æ“ä½œä¸æ»¡è¶³ä¸¤æ®µé”åè®®ï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;lock-x(A)...unlock(A)...lock-s(B)...unlock(B)...lock-s(C)...unlock(C)
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;34-mysql-éšå¼ä¸æ˜¾ç¤ºé”å®š&quot;&gt;3.4 MySQL éšå¼ä¸æ˜¾ç¤ºé”å®š&lt;/h4&gt;

&lt;p&gt;MySQL çš„ InnoDB å­˜å‚¨å¼•æ“é‡‡ç”¨ä¸¤æ®µé”åè®®ï¼Œä¼šæ ¹æ®éš”ç¦»çº§åˆ«åœ¨éœ€è¦çš„æ—¶å€™è‡ªåŠ¨åŠ é”ï¼Œå¹¶ä¸”æ‰€æœ‰çš„é”éƒ½æ˜¯åœ¨åŒä¸€æ—¶åˆ»è¢«é‡Šæ”¾ï¼Œè¿™è¢«ç§°ä¸ºéšå¼é”å®šã€‚&lt;/p&gt;

&lt;p&gt;InnoDB ä¹Ÿå¯ä»¥ä½¿ç”¨ç‰¹å®šçš„è¯­å¥è¿›è¡Œæ˜¾ç¤ºé”å®šï¼š&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;LOCK&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;In&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;SHARE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;MODE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FOR&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;UPDATE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-éš”ç¦»çº§åˆ«&quot;&gt;4. éš”ç¦»çº§åˆ«&lt;/h3&gt;

&lt;h4 id=&quot;41-æœªæäº¤è¯»read-uncommitted&quot;&gt;4.1 æœªæäº¤è¯»ï¼ˆREAD UNCOMMITTEDï¼‰&lt;/h4&gt;

&lt;p&gt;äº‹åŠ¡ä¸­çš„ä¿®æ”¹ï¼Œå³ä½¿æ²¡æœ‰æäº¤ï¼Œå¯¹å…¶å®ƒäº‹åŠ¡ä¹Ÿæ˜¯å¯è§çš„ã€‚&lt;/p&gt;

&lt;h4 id=&quot;42-æäº¤è¯»read-committed&quot;&gt;4.2 æäº¤è¯»ï¼ˆREAD COMMITTEDï¼‰&lt;/h4&gt;

&lt;p&gt;ä¸€ä¸ªäº‹åŠ¡åªèƒ½è¯»å–å·²ç»æäº¤çš„äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æäº¤ä¹‹å‰å¯¹å…¶å®ƒäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚&lt;/p&gt;

&lt;h4 id=&quot;43-å¯é‡å¤è¯»repeatable-read&quot;&gt;4.3 å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰&lt;/h4&gt;

&lt;p&gt;ä¿è¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒæ ·æ•°æ®çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;

&lt;h4 id=&quot;44-å¯ä¸²è¡ŒåŒ–serializable&quot;&gt;4.4 å¯ä¸²è¡ŒåŒ–ï¼ˆSERIALIZABLEï¼‰&lt;/h4&gt;

&lt;p&gt;å¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œã€‚&lt;/p&gt;

&lt;p&gt;éœ€è¦åŠ é”å®ç°ï¼Œè€Œå…¶å®ƒéš”ç¦»çº§åˆ«é€šå¸¸ä¸éœ€è¦ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;éš”ç¦»çº§åˆ«&lt;/th&gt;
      &lt;th&gt;è„è¯»&lt;/th&gt;
      &lt;th&gt;ä¸å¯é‡å¤è¯»&lt;/th&gt;
      &lt;th&gt;å¹»å½±è¯»&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;æœªæäº¤è¯»&lt;/td&gt;
      &lt;td&gt;âˆš&lt;/td&gt;
      &lt;td&gt;âˆš&lt;/td&gt;
      &lt;td&gt;âˆš&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;æäº¤è¯»&lt;/td&gt;
      &lt;td&gt;Ã—&lt;/td&gt;
      &lt;td&gt;âˆš&lt;/td&gt;
      &lt;td&gt;âˆš&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;å¯é‡å¤è¯»&lt;/td&gt;
      &lt;td&gt;Ã—&lt;/td&gt;
      &lt;td&gt;Ã—&lt;/td&gt;
      &lt;td&gt;âˆš&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;å¯ä¸²è¡ŒåŒ–&lt;/td&gt;
      &lt;td&gt;Ã—&lt;/td&gt;
      &lt;td&gt;Ã—&lt;/td&gt;
      &lt;td&gt;Ã—&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;5å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶mvcc&quot;&gt;5.å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(MVCC)&lt;/h3&gt;

&lt;p&gt;å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMulti-Version Concurrency Control, MVCCï¼‰æ˜¯ MySQL çš„ InnoDB å­˜å‚¨å¼•æ“å®ç°éš”ç¦»çº§åˆ«çš„ä¸€ç§å…·ä½“æ–¹å¼ï¼Œç”¨äºå®ç°æäº¤è¯»å’Œå¯é‡å¤è¯»è¿™ä¸¤ç§éš”ç¦»çº§åˆ«ã€‚è€Œæœªæäº¤è¯»éš”ç¦»çº§åˆ«æ€»æ˜¯è¯»å–æœ€æ–°çš„æ•°æ®è¡Œï¼Œæ— éœ€ä½¿ç”¨ MVCCã€‚å¯ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«éœ€è¦å¯¹æ‰€æœ‰è¯»å–çš„è¡Œéƒ½åŠ é”ï¼Œå•çº¯ä½¿ç”¨ MVCC æ— æ³•å®ç°ã€‚&lt;/p&gt;

&lt;h4 id=&quot;51-ç‰ˆæœ¬å·&quot;&gt;5.1 ç‰ˆæœ¬å·&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;ç³»ç»Ÿç‰ˆæœ¬å·ï¼šæ˜¯ä¸€ä¸ªé€’å¢çš„æ•°å­—ï¼Œæ¯å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œç³»ç»Ÿç‰ˆæœ¬å·å°±ä¼šè‡ªåŠ¨é€’å¢ã€‚&lt;/li&gt;
  &lt;li&gt;äº‹åŠ¡ç‰ˆæœ¬å·ï¼šäº‹åŠ¡å¼€å§‹æ—¶çš„ç³»ç»Ÿç‰ˆæœ¬å·ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;52-éšè—çš„åˆ—&quot;&gt;5.2 éšè—çš„åˆ—&lt;/h4&gt;

&lt;p&gt;MVCC åœ¨æ¯è¡Œè®°å½•åé¢éƒ½ä¿å­˜ç€ä¸¤ä¸ªéšè—çš„åˆ—ï¼Œç”¨æ¥å­˜å‚¨ä¸¤ä¸ªç‰ˆæœ¬å·ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;åˆ›å»ºç‰ˆæœ¬å·ï¼šæŒ‡ç¤ºåˆ›å»ºä¸€ä¸ªæ•°æ®è¡Œçš„å¿«ç…§æ—¶çš„ç³»ç»Ÿç‰ˆæœ¬å·ï¼›&lt;/li&gt;
  &lt;li&gt;åˆ é™¤ç‰ˆæœ¬å·ï¼šå¦‚æœè¯¥å¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·å¤§äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬å·è¡¨ç¤ºè¯¥å¿«ç…§æœ‰æ•ˆï¼Œå¦åˆ™è¡¨ç¤ºè¯¥å¿«ç…§å·²ç»è¢«åˆ é™¤äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;53-undo-æ—¥å¿—&quot;&gt;5.3 Undo æ—¥å¿—&lt;/h4&gt;

&lt;p&gt;MVCC ä½¿ç”¨åˆ°çš„å¿«ç…§å­˜å‚¨åœ¨ Undo æ—¥å¿—ä¸­ï¼Œè¯¥æ—¥å¿—é€šè¿‡å›æ»šæŒ‡é’ˆæŠŠä¸€ä¸ªæ•°æ®è¡Œï¼ˆRecordï¼‰çš„æ‰€æœ‰å¿«ç…§è¿æ¥èµ·æ¥ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/e41405a8-7c05-4f70-8092-e961e28d3112.jpg&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;54-å®ç°è¿‡ç¨‹&quot;&gt;5,4 å®ç°è¿‡ç¨‹&lt;/h4&gt;

&lt;p&gt;ä»¥ä¸‹å®ç°è¿‡ç¨‹é’ˆå¯¹å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ã€‚&lt;/p&gt;

&lt;p&gt;å½“å¼€å§‹ä¸€ä¸ªäº‹åŠ¡æ—¶ï¼Œè¯¥äº‹åŠ¡çš„ç‰ˆæœ¬å·è‚¯å®šå¤§äºå½“å‰æ‰€æœ‰æ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·ï¼Œç†è§£è¿™ä¸€ç‚¹å¾ˆå…³é”®ã€‚æ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·æ˜¯åˆ›å»ºæ•°æ®è¡Œå¿«ç…§æ—¶çš„ç³»ç»Ÿç‰ˆæœ¬å·ï¼Œç³»ç»Ÿç‰ˆæœ¬å·éšç€åˆ›å»ºäº‹åŠ¡è€Œé€’å¢ï¼Œå› æ­¤æ–°åˆ›å»ºä¸€ä¸ªäº‹åŠ¡æ—¶ï¼Œè¿™ä¸ªäº‹åŠ¡çš„ç³»ç»Ÿç‰ˆæœ¬å·æ¯”ä¹‹å‰çš„ç³»ç»Ÿç‰ˆæœ¬å·éƒ½å¤§ï¼Œä¹Ÿå°±æ˜¯æ¯”æ‰€æœ‰æ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·éƒ½å¤§ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;SELECT&lt;/p&gt;

    &lt;p&gt;å¤šä¸ªäº‹åŠ¡å¿…é¡»è¯»å–åˆ°åŒä¸€ä¸ªæ•°æ®è¡Œçš„å¿«ç…§ï¼Œå¹¶ä¸”è¿™ä¸ªå¿«ç…§æ˜¯è·ç¦»ç°åœ¨æœ€è¿‘çš„ä¸€ä¸ªæœ‰æ•ˆå¿«ç…§ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–ï¼Œå¦‚æœæœ‰ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨ä¿®æ”¹è¯¥æ•°æ®è¡Œï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¯»å–äº‹åŠ¡æœ¬èº«æ‰€åšçš„ä¿®æ”¹ï¼Œè€Œä¸ç”¨å’Œå…¶å®ƒäº‹åŠ¡çš„è¯»å–ç»“æœä¸€è‡´ã€‚&lt;/p&gt;

    &lt;p&gt;æŠŠæ²¡æœ‰å¯¹ä¸€ä¸ªæ•°æ®è¡Œåšä¿®æ”¹çš„äº‹åŠ¡ç§°ä¸º Tï¼ŒT æ‰€è¦è¯»å–çš„æ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·å¿…é¡»å°äºç­‰äº T çš„ç‰ˆæœ¬å·ï¼Œå› ä¸ºå¦‚æœå¤§äº T çš„ç‰ˆæœ¬å·ï¼Œé‚£ä¹ˆè¡¨ç¤ºè¯¥æ•°æ®è¡Œå¿«ç…§æ˜¯å…¶å®ƒäº‹åŠ¡çš„æœ€æ–°ä¿®æ”¹ï¼Œå› æ­¤ä¸èƒ½å»è¯»å–å®ƒã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒT æ‰€è¦è¯»å–çš„æ•°æ®è¡Œå¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·å¿…é¡»æ˜¯æœªå®šä¹‰æˆ–è€…å¤§äº T çš„ç‰ˆæœ¬å·ï¼Œå› ä¸ºå¦‚æœå°äºç­‰äº T çš„ç‰ˆæœ¬å·ï¼Œé‚£ä¹ˆè¡¨ç¤ºè¯¥æ•°æ®è¡Œå¿«ç…§æ˜¯å·²ç»è¢«åˆ é™¤çš„ï¼Œä¸åº”è¯¥å»è¯»å–å®ƒã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;INSERT&lt;/p&gt;

    &lt;p&gt;å°†å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºæ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;DELETE&lt;/p&gt;

    &lt;p&gt;å°†å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºæ•°æ®è¡Œå¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;UPDATE&lt;/p&gt;

    &lt;p&gt;å°†å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºæ›´æ–°å‰çš„æ•°æ®è¡Œå¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·ï¼Œå¹¶å°†å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºæ›´æ–°åçš„æ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·ã€‚å¯ä»¥ç†è§£ä¸ºå…ˆæ‰§è¡Œ DELETE åæ‰§è¡Œ INSERTã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;55-å¿«ç…§è¯»ä¸å½“å‰è¯»&quot;&gt;5.5 å¿«ç…§è¯»ä¸å½“å‰è¯»&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;å¿«ç…§è¯»&lt;/p&gt;

    &lt;p&gt;ä½¿ç”¨ MVCC è¯»å–çš„æ˜¯å¿«ç…§ä¸­çš„æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å‡å°‘åŠ é”æ‰€å¸¦æ¥çš„å¼€é”€ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;å½“å‰è¯»&lt;/p&gt;

    &lt;p&gt;è¯»å–çš„æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œéœ€è¦åŠ é”ã€‚ä»¥ä¸‹ç¬¬ä¸€ä¸ªè¯­å¥éœ€è¦åŠ  S é”ï¼Œå…¶å®ƒéƒ½éœ€è¦åŠ  X é”ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;share&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-next-key-locks&quot;&gt;6. Next-Key Locks&lt;/h3&gt;

&lt;p&gt;Next-Key Locks æ˜¯ MySQL çš„ InnoDB å­˜å‚¨å¼•æ“çš„ä¸€ç§é”å®ç°ã€‚&lt;/p&gt;

&lt;p&gt;MVCC ä¸èƒ½è§£å†³å¹»å½±è¯»é—®é¢˜ï¼ŒNext-Key Locks å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œå­˜åœ¨çš„ã€‚åœ¨å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰éš”ç¦»çº§åˆ«ä¸‹ï¼Œä½¿ç”¨ MVCC + Next-Key Locks å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜ã€‚&lt;/p&gt;

&lt;h4 id=&quot;61-record-locks&quot;&gt;6.1 Record Locks&lt;/h4&gt;

&lt;p&gt;é”å®šä¸€ä¸ªè®°å½•ä¸Šçš„ç´¢å¼•ï¼Œè€Œä¸æ˜¯è®°å½•æœ¬èº«ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœè¡¨æ²¡æœ‰è®¾ç½®ç´¢å¼•ï¼ŒInnoDB ä¼šè‡ªåŠ¨åœ¨ä¸»é”®ä¸Šåˆ›å»ºéšè—çš„èšç°‡ç´¢å¼•ï¼Œå› æ­¤ Record Locks ä¾ç„¶å¯ä»¥ä½¿ç”¨ã€‚&lt;/p&gt;

&lt;h4 id=&quot;62-gap-locks&quot;&gt;6.2 Gap Locks&lt;/h4&gt;

&lt;p&gt;é”å®šç´¢å¼•ä¹‹é—´çš„é—´éš™ï¼Œä½†æ˜¯ä¸åŒ…å«ç´¢å¼•æœ¬èº«ã€‚ä¾‹å¦‚å½“ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä»¥ä¸‹è¯­å¥ï¼Œå…¶å®ƒäº‹åŠ¡å°±ä¸èƒ½åœ¨ t.c ä¸­æ’å…¥ 15ã€‚&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FOR&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;UPDATE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;63-next-key-locks&quot;&gt;6.3 Next-Key Locks&lt;/h4&gt;

&lt;p&gt;å®ƒæ˜¯ Record Locks å’Œ Gap Locks çš„ç»“åˆï¼Œä¸ä»…é”å®šä¸€ä¸ªè®°å½•ä¸Šçš„ç´¢å¼•ï¼Œä¹Ÿé”å®šç´¢å¼•ä¹‹é—´çš„é—´éš™ã€‚ä¾‹å¦‚ä¸€ä¸ªç´¢å¼•åŒ…å«ä»¥ä¸‹å€¼ï¼š10, 11, 13, and 20ï¼Œé‚£ä¹ˆå°±éœ€è¦é”å®šä»¥ä¸‹åŒºé—´ï¼š&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;âˆ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;âˆ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-å…³ç³»æ•°æ®åº“è®¾è®¡ç†è®º&quot;&gt;7. å…³ç³»æ•°æ®åº“è®¾è®¡ç†è®º&lt;/h3&gt;

&lt;h4 id=&quot;71-å‡½æ•°ä¾èµ–&quot;&gt;7.1 å‡½æ•°ä¾èµ–&lt;/h4&gt;

&lt;p&gt;è®° A-&amp;gt;B è¡¨ç¤º A å‡½æ•°å†³å®š Bï¼Œä¹Ÿå¯ä»¥è¯´ B å‡½æ•°ä¾èµ–äº Aã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœ {A1ï¼ŒA2ï¼Œâ€¦ ï¼ŒAn} æ˜¯å…³ç³»çš„ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§çš„é›†åˆï¼Œè¯¥é›†åˆå‡½æ•°å†³å®šäº†å…³ç³»çš„å…¶å®ƒæ‰€æœ‰å±æ€§å¹¶ä¸”æ˜¯æœ€å°çš„ï¼Œé‚£ä¹ˆè¯¥é›†åˆå°±ç§°ä¸ºé”®ç ã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äº A-&amp;gt;Bï¼Œå¦‚æœèƒ½æ‰¾åˆ° A çš„çœŸå­é›† Aâ€™ï¼Œä½¿å¾— Aâ€™-&amp;gt; Bï¼Œé‚£ä¹ˆ A-&amp;gt;B å°±æ˜¯éƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œå¦åˆ™å°±æ˜¯å®Œå…¨å‡½æ•°ä¾èµ–ã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äº A-&amp;gt;Bï¼ŒB-&amp;gt;Cï¼Œåˆ™ A-&amp;gt;C æ˜¯ä¸€ä¸ªä¼ é€’å‡½æ•°ä¾èµ–ã€‚&lt;/p&gt;

&lt;h3 id=&quot;72-å¼‚å¸¸&quot;&gt;7.2 å¼‚å¸¸&lt;/h3&gt;

&lt;p&gt;ä»¥ä¸‹çš„å­¦ç”Ÿè¯¾ç¨‹å…³ç³»çš„å‡½æ•°ä¾èµ–ä¸º {Sno, Cname} -&amp;gt; {Sname, Sdept, Mname, Grade}ï¼Œé”®ç ä¸º {Sno, Cname}ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¡®å®šå­¦ç”Ÿå’Œè¯¾ç¨‹ä¹‹åï¼Œå°±èƒ½ç¡®å®šå…¶å®ƒä¿¡æ¯ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Sno&lt;/th&gt;
      &lt;th&gt;Sname&lt;/th&gt;
      &lt;th&gt;Sdept&lt;/th&gt;
      &lt;th&gt;Mname&lt;/th&gt;
      &lt;th&gt;Cname&lt;/th&gt;
      &lt;th&gt;Grade&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;å­¦ç”Ÿ-1&lt;/td&gt;
      &lt;td&gt;å­¦é™¢-1&lt;/td&gt;
      &lt;td&gt;é™¢é•¿-1&lt;/td&gt;
      &lt;td&gt;è¯¾ç¨‹-1&lt;/td&gt;
      &lt;td&gt;90&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;å­¦ç”Ÿ-2&lt;/td&gt;
      &lt;td&gt;å­¦é™¢-2&lt;/td&gt;
      &lt;td&gt;é™¢é•¿-2&lt;/td&gt;
      &lt;td&gt;è¯¾ç¨‹-2&lt;/td&gt;
      &lt;td&gt;80&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;å­¦ç”Ÿ-2&lt;/td&gt;
      &lt;td&gt;å­¦é™¢-2&lt;/td&gt;
      &lt;td&gt;é™¢é•¿-2&lt;/td&gt;
      &lt;td&gt;è¯¾ç¨‹-1&lt;/td&gt;
      &lt;td&gt;100&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;å­¦ç”Ÿ-3&lt;/td&gt;
      &lt;td&gt;å­¦é™¢-2&lt;/td&gt;
      &lt;td&gt;é™¢é•¿-2&lt;/td&gt;
      &lt;td&gt;è¯¾ç¨‹-2&lt;/td&gt;
      &lt;td&gt;95&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ä¸ç¬¦åˆèŒƒå¼çš„å…³ç³»ï¼Œä¼šäº§ç”Ÿå¾ˆå¤šå¼‚å¸¸ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å››ç§å¼‚å¸¸ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å†—ä½™æ•°æ®ï¼šä¾‹å¦‚ &lt;code class=&quot;highlighter-rouge&quot;&gt;å­¦ç”Ÿ-2&lt;/code&gt; å‡ºç°äº†ä¸¤æ¬¡ã€‚&lt;/li&gt;
  &lt;li&gt;ä¿®æ”¹å¼‚å¸¸ï¼šä¿®æ”¹äº†ä¸€ä¸ªè®°å½•ä¸­çš„ä¿¡æ¯ï¼Œä½†æ˜¯å¦ä¸€ä¸ªè®°å½•ä¸­ç›¸åŒçš„ä¿¡æ¯å´æ²¡æœ‰è¢«ä¿®æ”¹ã€‚&lt;/li&gt;
  &lt;li&gt;åˆ é™¤å¼‚å¸¸ï¼šåˆ é™¤ä¸€ä¸ªä¿¡æ¯ï¼Œé‚£ä¹ˆä¹Ÿä¼šä¸¢å¤±å…¶å®ƒä¿¡æ¯ã€‚ä¾‹å¦‚åˆ é™¤äº† &lt;code class=&quot;highlighter-rouge&quot;&gt;è¯¾ç¨‹-1&lt;/code&gt; éœ€è¦åˆ é™¤ç¬¬ä¸€è¡Œå’Œç¬¬ä¸‰è¡Œï¼Œé‚£ä¹ˆ &lt;code class=&quot;highlighter-rouge&quot;&gt;å­¦ç”Ÿ-1&lt;/code&gt; çš„ä¿¡æ¯å°±ä¼šä¸¢å¤±ã€‚&lt;/li&gt;
  &lt;li&gt;æ’å…¥å¼‚å¸¸ï¼šä¾‹å¦‚æƒ³è¦æ’å…¥ä¸€ä¸ªå­¦ç”Ÿçš„ä¿¡æ¯ï¼Œå¦‚æœè¿™ä¸ªå­¦ç”Ÿè¿˜æ²¡é€‰è¯¾ï¼Œé‚£ä¹ˆå°±æ— æ³•æ’å…¥ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;73-èŒƒå¼&quot;&gt;7.3 èŒƒå¼&lt;/h3&gt;

&lt;p&gt;èŒƒå¼ç†è®ºæ˜¯ä¸ºäº†è§£å†³ä»¥ä¸Šæåˆ°å››ç§å¼‚å¸¸ã€‚&lt;/p&gt;

&lt;p&gt;é«˜çº§åˆ«èŒƒå¼çš„ä¾èµ–äºä½çº§åˆ«çš„èŒƒå¼ï¼Œ1NF æ˜¯æœ€ä½çº§åˆ«çš„èŒƒå¼ã€‚&lt;/p&gt;

&lt;h5 id=&quot;1-ç¬¬ä¸€èŒƒå¼-1nf&quot;&gt;1. ç¬¬ä¸€èŒƒå¼ (1NF)]&lt;/h5&gt;

&lt;p&gt;å±æ€§ä¸å¯åˆ†ã€‚&lt;/p&gt;

&lt;h5 id=&quot;2-ç¬¬äºŒèŒƒå¼-2nf&quot;&gt;2. ç¬¬äºŒèŒƒå¼ (2NF)&lt;/h5&gt;

&lt;p&gt;æ¯ä¸ªéä¸»å±æ€§å®Œå…¨å‡½æ•°ä¾èµ–äºé”®ç ã€‚&lt;/p&gt;

&lt;p&gt;å¯ä»¥é€šè¿‡åˆ†è§£æ¥æ»¡è¶³ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åˆ†è§£å‰&lt;/strong&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Sno&lt;/th&gt;
      &lt;th&gt;Sname&lt;/th&gt;
      &lt;th&gt;Sdept&lt;/th&gt;
      &lt;th&gt;Mname&lt;/th&gt;
      &lt;th&gt;Cname&lt;/th&gt;
      &lt;th&gt;Grade&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;å­¦ç”Ÿ-1&lt;/td&gt;
      &lt;td&gt;å­¦é™¢-1&lt;/td&gt;
      &lt;td&gt;é™¢é•¿-1&lt;/td&gt;
      &lt;td&gt;è¯¾ç¨‹-1&lt;/td&gt;
      &lt;td&gt;90&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;å­¦ç”Ÿ-2&lt;/td&gt;
      &lt;td&gt;å­¦é™¢-2&lt;/td&gt;
      &lt;td&gt;é™¢é•¿-2&lt;/td&gt;
      &lt;td&gt;è¯¾ç¨‹-2&lt;/td&gt;
      &lt;td&gt;80&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;å­¦ç”Ÿ-2&lt;/td&gt;
      &lt;td&gt;å­¦é™¢-2&lt;/td&gt;
      &lt;td&gt;é™¢é•¿-2&lt;/td&gt;
      &lt;td&gt;è¯¾ç¨‹-1&lt;/td&gt;
      &lt;td&gt;100&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;å­¦ç”Ÿ-3&lt;/td&gt;
      &lt;td&gt;å­¦é™¢-2&lt;/td&gt;
      &lt;td&gt;é™¢é•¿-2&lt;/td&gt;
      &lt;td&gt;è¯¾ç¨‹-2&lt;/td&gt;
      &lt;td&gt;95&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ä»¥ä¸Šå­¦ç”Ÿè¯¾ç¨‹å…³ç³»ä¸­ï¼Œ{Sno, Cname} ä¸ºé”®ç ï¼Œæœ‰å¦‚ä¸‹å‡½æ•°ä¾èµ–ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Sno -&amp;gt; Sname, Sdept&lt;/li&gt;
  &lt;li&gt;Sdept -&amp;gt; Mname&lt;/li&gt;
  &lt;li&gt;Sno, Cname-&amp;gt; Grade&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Grade å®Œå…¨å‡½æ•°ä¾èµ–äºé”®ç ï¼Œå®ƒæ²¡æœ‰ä»»ä½•å†—ä½™æ•°æ®ï¼Œæ¯ä¸ªå­¦ç”Ÿçš„æ¯é—¨è¯¾éƒ½æœ‰ç‰¹å®šçš„æˆç»©ã€‚&lt;/p&gt;

&lt;p&gt;Sname, Sdept å’Œ Mname éƒ½éƒ¨åˆ†ä¾èµ–äºé”®ç ï¼Œå½“ä¸€ä¸ªå­¦ç”Ÿé€‰ä¿®äº†å¤šé—¨è¯¾æ—¶ï¼Œè¿™äº›æ•°æ®å°±ä¼šå‡ºç°å¤šæ¬¡ï¼Œé€ æˆå¤§é‡å†—ä½™æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åˆ†è§£å&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å…³ç³»-1&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Sno&lt;/th&gt;
      &lt;th&gt;Sname&lt;/th&gt;
      &lt;th&gt;Sdept&lt;/th&gt;
      &lt;th&gt;Mname&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;å­¦ç”Ÿ-1&lt;/td&gt;
      &lt;td&gt;å­¦é™¢-1&lt;/td&gt;
      &lt;td&gt;é™¢é•¿-1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;å­¦ç”Ÿ-2&lt;/td&gt;
      &lt;td&gt;å­¦é™¢-2&lt;/td&gt;
      &lt;td&gt;é™¢é•¿-2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;å­¦ç”Ÿ-3&lt;/td&gt;
      &lt;td&gt;å­¦é™¢-2&lt;/td&gt;
      &lt;td&gt;é™¢é•¿-2&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;æœ‰ä»¥ä¸‹å‡½æ•°ä¾èµ–ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Sno -&amp;gt; Sname, Sdept&lt;/li&gt;
  &lt;li&gt;Sdept -&amp;gt; Mname&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å…³ç³»-2&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Sno&lt;/th&gt;
      &lt;th&gt;Cname&lt;/th&gt;
      &lt;th&gt;Grade&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;è¯¾ç¨‹-1&lt;/td&gt;
      &lt;td&gt;90&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;è¯¾ç¨‹-2&lt;/td&gt;
      &lt;td&gt;80&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;è¯¾ç¨‹-1&lt;/td&gt;
      &lt;td&gt;100&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;è¯¾ç¨‹-2&lt;/td&gt;
      &lt;td&gt;95&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;æœ‰ä»¥ä¸‹å‡½æ•°ä¾èµ–ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Sno, Cname -&amp;gt; Grade&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;3-ç¬¬ä¸‰èŒƒå¼-3nf&quot;&gt;3. ç¬¬ä¸‰èŒƒå¼ (3NF)&lt;/h5&gt;

&lt;p&gt;éä¸»å±æ€§ä¸ä¼ é€’å‡½æ•°ä¾èµ–äºé”®ç ã€‚&lt;/p&gt;

&lt;p&gt;ä¸Šé¢çš„ å…³ç³»-1 ä¸­å­˜åœ¨ä»¥ä¸‹ä¼ é€’å‡½æ•°ä¾èµ–ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Sno -&amp;gt; Sdept -&amp;gt; Mname&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¯ä»¥è¿›è¡Œä»¥ä¸‹åˆ†è§£ï¼š&lt;/p&gt;

&lt;p&gt;å…³ç³»-11&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Sno&lt;/th&gt;
      &lt;th&gt;Sname&lt;/th&gt;
      &lt;th&gt;Sdept&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;å­¦ç”Ÿ-1&lt;/td&gt;
      &lt;td&gt;å­¦é™¢-1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;å­¦ç”Ÿ-2&lt;/td&gt;
      &lt;td&gt;å­¦é™¢-2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;å­¦ç”Ÿ-3&lt;/td&gt;
      &lt;td&gt;å­¦é™¢-2&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;å…³ç³»-12&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Sdept&lt;/th&gt;
      &lt;th&gt;Mname&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;å­¦é™¢-1&lt;/td&gt;
      &lt;td&gt;é™¢é•¿-1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;å­¦é™¢-2&lt;/td&gt;
      &lt;td&gt;é™¢é•¿-2&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;8-er-å›¾&quot;&gt;8. ER å›¾&lt;/h3&gt;

&lt;p&gt;Entity-Relationshipï¼Œæœ‰ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼šå®ä½“ã€å±æ€§ã€è”ç³»ã€‚&lt;/p&gt;

&lt;p&gt;ç”¨æ¥è¿›è¡Œå…³ç³»å‹æ•°æ®åº“ç³»ç»Ÿçš„æ¦‚å¿µè®¾è®¡ã€‚&lt;/p&gt;

&lt;h4 id=&quot;81-å®ä½“çš„ä¸‰ç§è”ç³»&quot;&gt;8.1 å®ä½“çš„ä¸‰ç§è”ç³»&lt;/h4&gt;

&lt;p&gt;åŒ…å«ä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šä¸‰ç§ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å¦‚æœ A åˆ° B æ˜¯ä¸€å¯¹å¤šå…³ç³»ï¼Œé‚£ä¹ˆç”»ä¸ªå¸¦ç®­å¤´çš„çº¿æ®µæŒ‡å‘ Bï¼›&lt;/li&gt;
  &lt;li&gt;å¦‚æœæ˜¯ä¸€å¯¹ä¸€ï¼Œç”»ä¸¤ä¸ªå¸¦ç®­å¤´çš„çº¿æ®µï¼›&lt;/li&gt;
  &lt;li&gt;å¦‚æœæ˜¯å¤šå¯¹å¤šï¼Œç”»ä¸¤ä¸ªä¸å¸¦ç®­å¤´çš„çº¿æ®µã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸‹å›¾çš„ Course å’Œ Student æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/1d28ad05-39e5-49a2-a6a1-a6f496adba6a.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;82-è¡¨ç¤ºå‡ºç°å¤šæ¬¡çš„å…³ç³»&quot;&gt;8.2 è¡¨ç¤ºå‡ºç°å¤šæ¬¡çš„å…³ç³»&lt;/h4&gt;

&lt;p&gt;ä¸€ä¸ªå®ä½“åœ¨è”ç³»å‡ºç°å‡ æ¬¡ï¼Œå°±è¦ç”¨å‡ æ¡çº¿è¿æ¥ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹å›¾è¡¨ç¤ºä¸€ä¸ªè¯¾ç¨‹çš„å…ˆä¿®å…³ç³»ï¼Œå…ˆä¿®å…³ç³»å‡ºç°ä¸¤ä¸ª Course å®ä½“ï¼Œç¬¬ä¸€ä¸ªæ˜¯å…ˆä¿®è¯¾ç¨‹ï¼Œåä¸€ä¸ªæ˜¯åä¿®è¯¾ç¨‹ï¼Œå› æ­¤éœ€è¦ç”¨ä¸¤æ¡çº¿æ¥è¡¨ç¤ºè¿™ç§å…³ç³»ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/ac929ea3-daca-40ec-9e95-4b2fa6678243.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;83-è”ç³»çš„å¤šå‘æ€§&quot;&gt;8.3 è”ç³»çš„å¤šå‘æ€§&lt;/h4&gt;

&lt;p&gt;è™½ç„¶è€å¸ˆå¯ä»¥å¼€è®¾å¤šé—¨è¯¾ï¼Œå¹¶ä¸”å¯ä»¥æ•™æˆå¤šåå­¦ç”Ÿï¼Œä½†æ˜¯å¯¹äºç‰¹å®šçš„å­¦ç”Ÿå’Œè¯¾ç¨‹ï¼Œåªæœ‰ä¸€ä¸ªè€å¸ˆæ•™æˆï¼Œè¿™å°±æ„æˆäº†ä¸€ä¸ªä¸‰å…ƒè”ç³»ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/5bb1b38a-527e-4802-a385-267dadbd30ba.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;84-è¡¨ç¤ºå­ç±»&quot;&gt;8.4 è¡¨ç¤ºå­ç±»&lt;/h4&gt;

&lt;p&gt;ç”¨ä¸€ä¸ªä¸‰è§’å½¢å’Œä¸¤æ¡çº¿æ¥è¿æ¥ç±»å’Œå­ç±»ï¼Œä¸å­ç±»æœ‰å…³çš„å±æ€§å’Œè”ç³»éƒ½è¿åˆ°å­ç±»ä¸Šï¼Œè€Œä¸çˆ¶ç±»å’Œå­ç±»éƒ½æœ‰å…³çš„è¿åˆ°çˆ¶ç±»ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/14389ea4-8d96-4e96-9f76-564ca3324c1e.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;mysql&quot;&gt;MySQL&lt;/h2&gt;

&lt;h3 id=&quot;1-ç´¢å¼•&quot;&gt;1. ç´¢å¼•&lt;/h3&gt;

&lt;h4 id=&quot;11--b-tree-åŸç†&quot;&gt;1.1  B+ Tree åŸç†&lt;/h4&gt;

&lt;h5 id=&quot;111-æ•°æ®ç»“æ„&quot;&gt;1.1.1 æ•°æ®ç»“æ„&lt;/h5&gt;

&lt;p&gt;B Tree æŒ‡çš„æ˜¯ Balance Treeï¼Œä¹Ÿå°±æ˜¯å¹³è¡¡æ ‘ã€‚å¹³è¡¡æ ‘æ˜¯ä¸€é¢—æŸ¥æ‰¾æ ‘ï¼Œå¹¶ä¸”æ‰€æœ‰å¶å­èŠ‚ç‚¹ä½äºåŒä¸€å±‚ã€‚&lt;/p&gt;

&lt;p&gt;B+ Tree æ˜¯åŸºäº B Tree å’Œå¶å­èŠ‚ç‚¹é¡ºåºè®¿é—®æŒ‡é’ˆè¿›è¡Œå®ç°ï¼Œå®ƒå…·æœ‰ B Tree çš„å¹³è¡¡æ€§ï¼Œå¹¶ä¸”é€šè¿‡é¡ºåºè®¿é—®æŒ‡é’ˆæ¥æé«˜åŒºé—´æŸ¥è¯¢çš„æ€§èƒ½ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ B+ Tree ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„ key ä»å·¦åˆ°å³éé€’å‡æ’åˆ—ï¼Œå¦‚æœæŸä¸ªæŒ‡é’ˆçš„å·¦å³ç›¸é‚» key åˆ†åˆ«æ˜¯ keyi å’Œ keyi+1ï¼Œä¸”ä¸ä¸º nullï¼Œåˆ™è¯¥æŒ‡é’ˆæŒ‡å‘èŠ‚ç‚¹çš„æ‰€æœ‰ key å¤§äºç­‰äº keyi ä¸”å°äºç­‰äº keyi+1ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/33576849-9275-47bb-ada7-8ded5f5e7c73.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;112-æ“ä½œ&quot;&gt;1.1.2 æ“ä½œ&lt;/h5&gt;

&lt;p&gt;è¿›è¡ŒæŸ¥æ‰¾æ“ä½œæ—¶ï¼Œé¦–å…ˆåœ¨æ ¹èŠ‚ç‚¹è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ä¸€ä¸ª key æ‰€åœ¨çš„æŒ‡é’ˆï¼Œç„¶åé€’å½’åœ°åœ¨æŒ‡é’ˆæ‰€æŒ‡å‘çš„èŠ‚ç‚¹è¿›è¡ŒæŸ¥æ‰¾ã€‚ç›´åˆ°æŸ¥æ‰¾åˆ°å¶å­èŠ‚ç‚¹ï¼Œç„¶ååœ¨å¶å­èŠ‚ç‚¹ä¸Šè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾å‡º key æ‰€å¯¹åº”çš„ dataã€‚&lt;/p&gt;

&lt;p&gt;æ’å…¥åˆ é™¤æ“ä½œä¼šç ´åå¹³è¡¡æ ‘çš„å¹³è¡¡æ€§ï¼Œå› æ­¤åœ¨æ’å…¥åˆ é™¤æ“ä½œä¹‹åï¼Œéœ€è¦å¯¹æ ‘è¿›è¡Œä¸€ä¸ªåˆ†è£‚ã€åˆå¹¶ã€æ—‹è½¬ç­‰æ“ä½œæ¥ç»´æŠ¤å¹³è¡¡æ€§ã€‚&lt;/p&gt;

&lt;h5 id=&quot;113-ä¸çº¢é»‘æ ‘çš„æ¯”è¾ƒ&quot;&gt;1.1.3 ä¸çº¢é»‘æ ‘çš„æ¯”è¾ƒ&lt;/h5&gt;

&lt;p&gt;çº¢é»‘æ ‘ç­‰å¹³è¡¡æ ‘ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°ç´¢å¼•ï¼Œä½†æ˜¯æ–‡ä»¶ç³»ç»ŸåŠæ•°æ®åº“ç³»ç»Ÿæ™®éé‡‡ç”¨ B+ Tree ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªåŸå› ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;æ›´å°‘çš„æŸ¥æ‰¾æ¬¡æ•°&lt;/p&gt;

    &lt;p&gt;å¹³è¡¡æ ‘æŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å’Œæ ‘é«˜ h ç›¸å…³ï¼ŒO(h)=O(logdN)ï¼Œå…¶ä¸­ d ä¸ºæ¯ä¸ªèŠ‚ç‚¹çš„å‡ºåº¦ã€‚&lt;/p&gt;

    &lt;p&gt;çº¢é»‘æ ‘çš„å‡ºåº¦ä¸º 2ï¼Œè€Œ B+ Tree çš„å‡ºåº¦ä¸€èˆ¬éƒ½éå¸¸å¤§ï¼Œæ‰€ä»¥çº¢é»‘æ ‘çš„æ ‘é«˜ h å¾ˆæ˜æ˜¾æ¯” B+ Tree å¤§éå¸¸å¤šï¼ŒæŸ¥æ‰¾çš„æ¬¡æ•°ä¹Ÿå°±æ›´å¤šã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;åˆ©ç”¨ç£ç›˜é¢„è¯»ç‰¹æ€§&lt;/p&gt;

    &lt;p&gt;ä¸ºäº†å‡å°‘ç£ç›˜ I/O æ“ä½œï¼Œç£ç›˜å¾€å¾€ä¸æ˜¯ä¸¥æ ¼æŒ‰éœ€è¯»å–ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½ä¼šé¢„è¯»ã€‚é¢„è¯»è¿‡ç¨‹ä¸­ï¼Œç£ç›˜è¿›è¡Œé¡ºåºè¯»å–ï¼Œé¡ºåºè¯»å–ä¸éœ€è¦è¿›è¡Œç£ç›˜å¯»é“ï¼Œå¹¶ä¸”åªéœ€è¦å¾ˆçŸ­çš„ç£ç›˜æ—‹è½¬æ—¶é—´ï¼Œé€Ÿåº¦ä¼šéå¸¸å¿«ã€‚&lt;/p&gt;

    &lt;p&gt;æ“ä½œç³»ç»Ÿä¸€èˆ¬å°†å†…å­˜å’Œç£ç›˜åˆ†å‰²æˆå›ºå®šå¤§å°çš„å—ï¼Œæ¯ä¸€å—ç§°ä¸ºä¸€é¡µï¼Œå†…å­˜ä¸ç£ç›˜ä»¥é¡µä¸ºå•ä½äº¤æ¢æ•°æ®ã€‚æ•°æ®åº“ç³»ç»Ÿå°†ç´¢å¼•çš„ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ç½®ä¸ºé¡µçš„å¤§å°ï¼Œä½¿å¾—ä¸€æ¬¡ I/O å°±èƒ½å®Œå…¨è½½å…¥ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¹¶ä¸”å¯ä»¥åˆ©ç”¨é¢„è¯»ç‰¹æ€§ï¼Œç›¸é‚»çš„èŠ‚ç‚¹ä¹Ÿèƒ½å¤Ÿè¢«é¢„å…ˆè½½å…¥ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;12-mysql-ç´¢å¼•&quot;&gt;1.2 MySQL ç´¢å¼•&lt;/h4&gt;

&lt;p&gt;ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚å®ç°çš„ï¼Œè€Œä¸æ˜¯åœ¨æœåŠ¡å™¨å±‚å®ç°çš„ï¼Œæ‰€ä»¥ä¸åŒå­˜å‚¨å¼•æ“å…·æœ‰ä¸åŒçš„ç´¢å¼•ç±»å‹å’Œå®ç°ã€‚&lt;/p&gt;

&lt;h5 id=&quot;121-btree-ç´¢å¼•&quot;&gt;1.2.1 B+Tree ç´¢å¼•&lt;/h5&gt;

&lt;p&gt;æ˜¯å¤§å¤šæ•° MySQL å­˜å‚¨å¼•æ“çš„é»˜è®¤ç´¢å¼•ç±»å‹ã€‚&lt;/p&gt;

&lt;p&gt;å› ä¸ºä¸å†éœ€è¦è¿›è¡Œå…¨è¡¨æ‰«æï¼Œåªéœ€è¦å¯¹æ ‘è¿›è¡Œæœç´¢å³å¯ï¼Œæ‰€ä»¥æŸ¥æ‰¾é€Ÿåº¦å¿«å¾ˆå¤šã€‚&lt;/p&gt;

&lt;p&gt;å› ä¸º B+ Tree çš„æœ‰åºæ€§ï¼Œæ‰€ä»¥é™¤äº†ç”¨äºæŸ¥æ‰¾ï¼Œè¿˜å¯ä»¥ç”¨äºæ’åºå’Œåˆ†ç»„ã€‚&lt;/p&gt;

&lt;p&gt;å¯ä»¥æŒ‡å®šå¤šä¸ªåˆ—ä½œä¸ºç´¢å¼•åˆ—ï¼Œå¤šä¸ªç´¢å¼•åˆ—å…±åŒç»„æˆé”®ã€‚&lt;/p&gt;

&lt;p&gt;é€‚ç”¨äºå…¨é”®å€¼ã€é”®å€¼èŒƒå›´å’Œé”®å‰ç¼€æŸ¥æ‰¾ï¼Œå…¶ä¸­é”®å‰ç¼€æŸ¥æ‰¾åªé€‚ç”¨äºæœ€å·¦å‰ç¼€æŸ¥æ‰¾ã€‚å¦‚æœä¸æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„é¡ºåºè¿›è¡ŒæŸ¥æ‰¾ï¼Œåˆ™æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚&lt;/p&gt;

&lt;p&gt;InnoDB çš„ B+Tree ç´¢å¼•åˆ†ä¸ºä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•ã€‚ä¸»ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ data åŸŸè®°å½•ç€å®Œæ•´çš„æ•°æ®è®°å½•ï¼Œè¿™ç§ç´¢å¼•æ–¹å¼è¢«ç§°ä¸ºèšç°‡ç´¢å¼•ã€‚å› ä¸ºæ— æ³•æŠŠæ•°æ®è¡Œå­˜æ”¾åœ¨ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹ï¼Œæ‰€ä»¥ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/45016e98-6879-4709-8569-262b2d6d60b9.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è¾…åŠ©ç´¢å¼•çš„å¶å­èŠ‚ç‚¹çš„ data åŸŸè®°å½•ç€ä¸»é”®çš„å€¼ï¼Œå› æ­¤åœ¨ä½¿ç”¨è¾…åŠ©ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾æ—¶ï¼Œéœ€è¦å…ˆæŸ¥æ‰¾åˆ°ä¸»é”®å€¼ï¼Œç„¶åå†åˆ°ä¸»ç´¢å¼•ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/7c349b91-050b-4d72-a7f8-ec86320307ea.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;122-å“ˆå¸Œç´¢å¼•&quot;&gt;1.2.2 å“ˆå¸Œç´¢å¼•&lt;/h5&gt;

&lt;p&gt;å“ˆå¸Œç´¢å¼•èƒ½ä»¥ O(1) æ—¶é—´è¿›è¡ŒæŸ¥æ‰¾ï¼Œä½†æ˜¯å¤±å»äº†æœ‰åºæ€§ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ— æ³•ç”¨äºæ’åºä¸åˆ†ç»„ï¼›&lt;/li&gt;
  &lt;li&gt;åªæ”¯æŒç²¾ç¡®æŸ¥æ‰¾ï¼Œæ— æ³•ç”¨äºéƒ¨åˆ†æŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;InnoDB å­˜å‚¨å¼•æ“æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åŠŸèƒ½å«â€œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•â€ï¼Œå½“æŸä¸ªç´¢å¼•å€¼è¢«ä½¿ç”¨çš„éå¸¸é¢‘ç¹æ—¶ï¼Œä¼šåœ¨ B+Tree ç´¢å¼•ä¹‹ä¸Šå†åˆ›å»ºä¸€ä¸ªå“ˆå¸Œç´¢å¼•ï¼Œè¿™æ ·å°±è®© B+Tree ç´¢å¼•å…·æœ‰å“ˆå¸Œç´¢å¼•çš„ä¸€äº›ä¼˜ç‚¹ï¼Œæ¯”å¦‚å¿«é€Ÿçš„å“ˆå¸ŒæŸ¥æ‰¾ã€‚&lt;/p&gt;

&lt;h5 id=&quot;123-å…¨æ–‡ç´¢å¼•&quot;&gt;1.2.3 å…¨æ–‡ç´¢å¼•&lt;/h5&gt;

&lt;p&gt;MyISAM å­˜å‚¨å¼•æ“æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œç”¨äºæŸ¥æ‰¾æ–‡æœ¬ä¸­çš„å…³é”®è¯ï¼Œè€Œä¸æ˜¯ç›´æ¥æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;æŸ¥æ‰¾æ¡ä»¶ä½¿ç”¨ MATCH AGAINSTï¼Œè€Œä¸æ˜¯æ™®é€šçš„ WHEREã€‚&lt;/p&gt;

&lt;p&gt;å…¨æ–‡ç´¢å¼•ä½¿ç”¨å€’æ’ç´¢å¼•å®ç°ï¼Œå®ƒè®°å½•ç€å…³é”®è¯åˆ°å…¶æ‰€åœ¨æ–‡æ¡£çš„æ˜ å°„ã€‚&lt;/p&gt;

&lt;p&gt;InnoDB å­˜å‚¨å¼•æ“åœ¨ MySQL 5.6.4 ç‰ˆæœ¬ä¸­ä¹Ÿå¼€å§‹æ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚&lt;/p&gt;

&lt;h5 id=&quot;124-ç©ºé—´æ•°æ®ç´¢å¼•&quot;&gt;1.2.4. ç©ºé—´æ•°æ®ç´¢å¼•&lt;/h5&gt;

&lt;p&gt;MyISAM å­˜å‚¨å¼•æ“æ”¯æŒç©ºé—´æ•°æ®ç´¢å¼•ï¼ˆR-Treeï¼‰ï¼Œå¯ä»¥ç”¨äºåœ°ç†æ•°æ®å­˜å‚¨ã€‚ç©ºé—´æ•°æ®ç´¢å¼•ä¼šä»æ‰€æœ‰ç»´åº¦æ¥ç´¢å¼•æ•°æ®ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ä½¿ç”¨ä»»æ„ç»´åº¦æ¥è¿›è¡Œç»„åˆæŸ¥è¯¢ã€‚&lt;/p&gt;

&lt;p&gt;å¿…é¡»ä½¿ç”¨ GIS ç›¸å…³çš„å‡½æ•°æ¥ç»´æŠ¤æ•°æ®ã€‚&lt;/p&gt;

&lt;h4 id=&quot;13-ç´¢å¼•ä¼˜åŒ–&quot;&gt;1.3 ç´¢å¼•ä¼˜åŒ–&lt;/h4&gt;

&lt;h5 id=&quot;131-ç‹¬ç«‹çš„åˆ—&quot;&gt;1.3.1 ç‹¬ç«‹çš„åˆ—&lt;/h5&gt;

&lt;p&gt;åœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œç´¢å¼•åˆ—ä¸èƒ½æ˜¯è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸èƒ½æ˜¯å‡½æ•°çš„å‚æ•°ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ä¸‹é¢çš„æŸ¥è¯¢ä¸èƒ½ä½¿ç”¨ actor_id åˆ—çš„ç´¢å¼•ï¼š&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actor_id&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sakila&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;actor&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actor_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;132-å¤šåˆ—ç´¢å¼•&quot;&gt;1.3.2 å¤šåˆ—ç´¢å¼•&lt;/h5&gt;

&lt;p&gt;åœ¨éœ€è¦ä½¿ç”¨å¤šä¸ªåˆ—ä½œä¸ºæ¡ä»¶è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨å¤šåˆ—ç´¢å¼•æ¯”ä½¿ç”¨å¤šä¸ªå•åˆ—ç´¢å¼•æ€§èƒ½æ›´å¥½ã€‚ä¾‹å¦‚ä¸‹é¢çš„è¯­å¥ä¸­ï¼Œæœ€å¥½æŠŠ actor_id å’Œ film_id è®¾ç½®ä¸ºå¤šåˆ—ç´¢å¼•ã€‚&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;film_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actor_&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sakila&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;film_actor&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actor_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;film_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;133-ç´¢å¼•åˆ—çš„é¡ºåº&quot;&gt;1.3.3 ç´¢å¼•åˆ—çš„é¡ºåº&lt;/h5&gt;

&lt;p&gt;è®©é€‰æ‹©æ€§æœ€å¼ºçš„ç´¢å¼•åˆ—æ”¾åœ¨å‰é¢ã€‚&lt;/p&gt;

&lt;p&gt;ç´¢å¼•çš„é€‰æ‹©æ€§æ˜¯æŒ‡ï¼šä¸é‡å¤çš„ç´¢å¼•å€¼å’Œè®°å½•æ€»æ•°çš„æ¯”å€¼ã€‚æœ€å¤§å€¼ä¸º 1ï¼Œæ­¤æ—¶æ¯ä¸ªè®°å½•éƒ½æœ‰å”¯ä¸€çš„ç´¢å¼•ä¸å…¶å¯¹åº”ã€‚é€‰æ‹©æ€§è¶Šé«˜ï¼Œæ¯ä¸ªè®°å½•çš„åŒºåˆ†åº¦è¶Šé«˜ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¹Ÿè¶Šé«˜ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ä¸‹é¢æ˜¾ç¤ºçš„ç»“æœä¸­ customer_id çš„é€‰æ‹©æ€§æ¯” staff_id æ›´é«˜ï¼Œå› æ­¤æœ€å¥½æŠŠ customer_id åˆ—æ”¾åœ¨å¤šåˆ—ç´¢å¼•çš„å‰é¢ã€‚&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;DISTINCT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;staff_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;staff_id_selectivity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;DISTINCT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;customer_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;customer_id_selectivity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code class=&quot;language-pseudocode&quot;&gt;   staff_id_selectivity: 0.0001
customer_id_selectivity: 0.0373
               COUNT(*): 16049

&lt;/code&gt;&lt;/pre&gt;

&lt;h5 id=&quot;134-å‰ç¼€ç´¢å¼•&quot;&gt;1.3.4 å‰ç¼€ç´¢å¼•&lt;/h5&gt;

&lt;p&gt;å¯¹äº BLOBã€TEXT å’Œ VARCHAR ç±»å‹çš„åˆ—ï¼Œå¿…é¡»ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œåªç´¢å¼•å¼€å§‹çš„éƒ¨åˆ†å­—ç¬¦ã€‚&lt;/p&gt;

&lt;p&gt;å‰ç¼€é•¿åº¦çš„é€‰å–éœ€è¦æ ¹æ®ç´¢å¼•é€‰æ‹©æ€§æ¥ç¡®å®šã€‚&lt;/p&gt;

&lt;h5 id=&quot;135-è¦†ç›–ç´¢å¼•&quot;&gt;1.3.5 è¦†ç›–ç´¢å¼•&lt;/h5&gt;

&lt;p&gt;ç´¢å¼•åŒ…å«æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ã€‚&lt;/p&gt;

&lt;p&gt;å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç´¢å¼•é€šå¸¸è¿œå°äºæ•°æ®è¡Œçš„å¤§å°ï¼Œåªè¯»å–ç´¢å¼•èƒ½å¤§å¤§å‡å°‘æ•°æ®è®¿é—®é‡ã€‚&lt;/li&gt;
  &lt;li&gt;ä¸€äº›å­˜å‚¨å¼•æ“ï¼ˆä¾‹å¦‚ MyISAMï¼‰åœ¨å†…å­˜ä¸­åªç¼“å­˜ç´¢å¼•ï¼Œè€Œæ•°æ®ä¾èµ–äºæ“ä½œç³»ç»Ÿæ¥ç¼“å­˜ã€‚å› æ­¤ï¼Œåªè®¿é—®ç´¢å¼•å¯ä»¥ä¸ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ï¼ˆé€šå¸¸æ¯”è¾ƒè´¹æ—¶ï¼‰ã€‚&lt;/li&gt;
  &lt;li&gt;å¯¹äº InnoDB å¼•æ“ï¼Œè‹¥è¾…åŠ©ç´¢å¼•èƒ½å¤Ÿè¦†ç›–æŸ¥è¯¢ï¼Œåˆ™æ— éœ€è®¿é—®ä¸»ç´¢å¼•ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;14-ç´¢å¼•çš„ä¼˜ç‚¹&quot;&gt;1.4 ç´¢å¼•çš„ä¼˜ç‚¹&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;å¤§å¤§å‡å°‘äº†æœåŠ¡å™¨éœ€è¦æ‰«æçš„æ•°æ®è¡Œæ•°ã€‚&lt;/li&gt;
  &lt;li&gt;å¸®åŠ©æœåŠ¡å™¨é¿å…è¿›è¡Œæ’åºå’Œåˆ†ç»„ï¼Œä»¥åŠé¿å…åˆ›å»ºä¸´æ—¶è¡¨ï¼ˆB+Tree ç´¢å¼•æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥ç”¨äº ORDER BY å’Œ GROUP BY æ“ä½œã€‚ä¸´æ—¶è¡¨ä¸»è¦æ˜¯åœ¨æ’åºå’Œåˆ†ç»„è¿‡ç¨‹ä¸­åˆ›å»ºï¼Œä¸éœ€è¦æ’åºå’Œåˆ†ç»„ï¼Œä¹Ÿå°±ä¸éœ€è¦åˆ›å»ºä¸´æ—¶è¡¨ï¼‰ã€‚&lt;/li&gt;
  &lt;li&gt;å°†éšæœº I/O å˜ä¸ºé¡ºåº I/Oï¼ˆB+Tree ç´¢å¼•æ˜¯æœ‰åºçš„ï¼Œä¼šå°†ç›¸é‚»çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ä¸€èµ·ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;15-ç´¢å¼•çš„ä½¿ç”¨æ¡ä»¶&quot;&gt;1.5 ç´¢å¼•çš„ä½¿ç”¨æ¡ä»¶&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;å¯¹äºéå¸¸å°çš„è¡¨ã€å¤§éƒ¨åˆ†æƒ…å†µä¸‹ç®€å•çš„å…¨è¡¨æ‰«ææ¯”å»ºç«‹ç´¢å¼•æ›´é«˜æ•ˆï¼›&lt;/li&gt;
  &lt;li&gt;å¯¹äºä¸­åˆ°å¤§å‹çš„è¡¨ï¼Œç´¢å¼•å°±éå¸¸æœ‰æ•ˆï¼›&lt;/li&gt;
  &lt;li&gt;ä½†æ˜¯å¯¹äºç‰¹å¤§å‹çš„è¡¨ï¼Œå»ºç«‹å’Œç»´æŠ¤ç´¢å¼•çš„ä»£ä»·å°†ä¼šéšä¹‹å¢é•¿ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦ç”¨åˆ°ä¸€ç§æŠ€æœ¯å¯ä»¥ç›´æ¥åŒºåˆ†å‡ºéœ€è¦æŸ¥è¯¢çš„ä¸€ç»„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¡è®°å½•ä¸€æ¡è®°å½•åœ°åŒ¹é…ï¼Œä¾‹å¦‚å¯ä»¥ä½¿ç”¨åˆ†åŒºæŠ€æœ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–&quot;&gt;2. æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–&lt;/h3&gt;

&lt;h4 id=&quot;21-ä½¿ç”¨-explain-è¿›è¡Œåˆ†æ&quot;&gt;2.1 ä½¿ç”¨ Explain è¿›è¡Œåˆ†æ&lt;/h4&gt;

&lt;p&gt;Explain ç”¨æ¥åˆ†æ SELECT æŸ¥è¯¢è¯­å¥ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡åˆ†æ Explain ç»“æœæ¥ä¼˜åŒ–æŸ¥è¯¢è¯­å¥ã€‚&lt;/p&gt;

&lt;p&gt;æ¯”è¾ƒé‡è¦çš„å­—æ®µæœ‰ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;select_type : æŸ¥è¯¢ç±»å‹ï¼Œæœ‰ç®€å•æŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰&lt;/li&gt;
  &lt;li&gt;key : ä½¿ç”¨çš„ç´¢å¼•&lt;/li&gt;
  &lt;li&gt;rows : æ‰«æçš„è¡Œæ•°&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;22-ä¼˜åŒ–æ•°æ®è®¿é—®&quot;&gt;2.2 ä¼˜åŒ–æ•°æ®è®¿é—®&lt;/h4&gt;

&lt;h5 id=&quot;221-å‡å°‘è¯·æ±‚çš„æ•°æ®é‡&quot;&gt;2.2.1 å‡å°‘è¯·æ±‚çš„æ•°æ®é‡&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;åªè¿”å›å¿…è¦çš„åˆ—ï¼šæœ€å¥½ä¸è¦ä½¿ç”¨ SELECT * è¯­å¥ã€‚&lt;/li&gt;
  &lt;li&gt;åªè¿”å›å¿…è¦çš„è¡Œï¼šä½¿ç”¨ LIMIT è¯­å¥æ¥é™åˆ¶è¿”å›çš„æ•°æ®ã€‚&lt;/li&gt;
  &lt;li&gt;ç¼“å­˜é‡å¤æŸ¥è¯¢çš„æ•°æ®ï¼šä½¿ç”¨ç¼“å­˜å¯ä»¥é¿å…åœ¨æ•°æ®åº“ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œç‰¹åˆ«åœ¨è¦æŸ¥è¯¢çš„æ•°æ®ç»å¸¸è¢«é‡å¤æŸ¥è¯¢æ—¶ï¼Œç¼“å­˜å¸¦æ¥çš„æŸ¥è¯¢æ€§èƒ½æå‡å°†ä¼šæ˜¯éå¸¸æ˜æ˜¾çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;222-å‡å°‘æœåŠ¡å™¨ç«¯æ‰«æçš„è¡Œæ•°&quot;&gt;2.2.2 å‡å°‘æœåŠ¡å™¨ç«¯æ‰«æçš„è¡Œæ•°&lt;/h5&gt;

&lt;p&gt;æœ€æœ‰æ•ˆçš„æ–¹å¼æ˜¯ä½¿ç”¨ç´¢å¼•æ¥è¦†ç›–æŸ¥è¯¢ã€‚&lt;/p&gt;

&lt;h4 id=&quot;23-é‡æ„æŸ¥è¯¢æ–¹å¼&quot;&gt;2.3 é‡æ„æŸ¥è¯¢æ–¹å¼&lt;/h4&gt;

&lt;h5 id=&quot;231-åˆ‡åˆ†å¤§æŸ¥è¯¢&quot;&gt;2.3.1 åˆ‡åˆ†å¤§æŸ¥è¯¢&lt;/h5&gt;

&lt;p&gt;ä¸€ä¸ªå¤§æŸ¥è¯¢å¦‚æœä¸€æ¬¡æ€§æ‰§è¡Œçš„è¯ï¼Œå¯èƒ½ä¸€æ¬¡é”ä½å¾ˆå¤šæ•°æ®ã€å æ»¡æ•´ä¸ªäº‹åŠ¡æ—¥å¿—ã€è€—å°½ç³»ç»Ÿèµ„æºã€é˜»å¡å¾ˆå¤šå°çš„ä½†é‡è¦çš„æŸ¥è¯¢ã€‚&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;DELETE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;messages&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DATE_SUB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NOW&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INTERVAL&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;MONTH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code class=&quot;language-pseudocode&quot;&gt;rows_affected = 0
do {
    rows_affected = do_query(
    &quot;DELETE FROM messages WHERE create  &amp;lt; DATE_SUB(NOW(), INTERVAL 3 MONTH) LIMIT 10000&quot;)
} while rows_affected &amp;gt; 0
&lt;/code&gt;&lt;/pre&gt;

&lt;h5 id=&quot;232-åˆ†è§£å¤§è¿æ¥æŸ¥è¯¢&quot;&gt;2.3.2 åˆ†è§£å¤§è¿æ¥æŸ¥è¯¢&lt;/h5&gt;

&lt;p&gt;å°†ä¸€ä¸ªå¤§è¿æ¥æŸ¥è¯¢åˆ†è§£æˆå¯¹æ¯ä¸€ä¸ªè¡¨è¿›è¡Œä¸€æ¬¡å•è¡¨æŸ¥è¯¢ï¼Œç„¶ååœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œå…³è”ï¼Œè¿™æ ·åšçš„å¥½å¤„æœ‰ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;è®©ç¼“å­˜æ›´é«˜æ•ˆã€‚å¯¹äºè¿æ¥æŸ¥è¯¢ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªè¡¨å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆæ•´ä¸ªæŸ¥è¯¢ç¼“å­˜å°±æ— æ³•ä½¿ç”¨ã€‚è€Œåˆ†è§£åçš„å¤šä¸ªæŸ¥è¯¢ï¼Œå³ä½¿å…¶ä¸­ä¸€ä¸ªè¡¨å‘ç”Ÿå˜åŒ–ï¼Œå¯¹å…¶å®ƒè¡¨çš„æŸ¥è¯¢ç¼“å­˜ä¾ç„¶å¯ä»¥ä½¿ç”¨ã€‚&lt;/li&gt;
  &lt;li&gt;åˆ†è§£æˆå¤šä¸ªå•è¡¨æŸ¥è¯¢ï¼Œè¿™äº›å•è¡¨æŸ¥è¯¢çš„ç¼“å­˜ç»“æœæ›´å¯èƒ½è¢«å…¶å®ƒæŸ¥è¯¢ä½¿ç”¨åˆ°ï¼Œä»è€Œå‡å°‘å†—ä½™è®°å½•çš„æŸ¥è¯¢ã€‚&lt;/li&gt;
  &lt;li&gt;å‡å°‘é”ç«äº‰ï¼›&lt;/li&gt;
  &lt;li&gt;åœ¨åº”ç”¨å±‚è¿›è¡Œè¿æ¥ï¼Œå¯ä»¥æ›´å®¹æ˜“å¯¹æ•°æ®åº“è¿›è¡Œæ‹†åˆ†ï¼Œä»è€Œæ›´å®¹æ˜“åšåˆ°é«˜æ€§èƒ½å’Œå¯ä¼¸ç¼©ã€‚&lt;/li&gt;
  &lt;li&gt;æŸ¥è¯¢æœ¬èº«æ•ˆç‡ä¹Ÿå¯èƒ½ä¼šæœ‰æ‰€æå‡ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ IN() ä»£æ›¿è¿æ¥æŸ¥è¯¢ï¼Œå¯ä»¥è®© MySQL æŒ‰ç…§ ID é¡ºåºè¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™å¯èƒ½æ¯”éšæœºçš„è¿æ¥è¦æ›´é«˜æ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tab&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;JOIN&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tag_post&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ON&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tag_post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tag_id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;JOIN&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ON&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tag_post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post_id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tag&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'mysql'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tag&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'mysql'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tag_post&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tag_id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1234&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;123&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;456&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;567&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9098&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8904&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-å­˜å‚¨å¼•æ“&quot;&gt;3. å­˜å‚¨å¼•æ“&lt;/h3&gt;

&lt;h4 id=&quot;31-innodb&quot;&gt;3.1 InnoDB&lt;/h4&gt;

&lt;p&gt;æ˜¯ MySQL é»˜è®¤çš„äº‹åŠ¡å‹å­˜å‚¨å¼•æ“ï¼Œåªæœ‰åœ¨éœ€è¦å®ƒä¸æ”¯æŒçš„ç‰¹æ€§æ—¶ï¼Œæ‰è€ƒè™‘ä½¿ç”¨å…¶å®ƒå­˜å‚¨å¼•æ“ã€‚&lt;/p&gt;

&lt;p&gt;å®ç°äº†å››ä¸ªæ ‡å‡†çš„éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰ã€‚åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œé€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰+ Next-Key Locking é˜²æ­¢å¹»å½±è¯»ã€‚&lt;/p&gt;

&lt;p&gt;ä¸»ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼Œåœ¨ç´¢å¼•ä¸­ä¿å­˜äº†æ•°æ®ï¼Œä»è€Œé¿å…ç›´æ¥è¯»å–ç£ç›˜ï¼Œå› æ­¤å¯¹æŸ¥è¯¢æ€§èƒ½æœ‰å¾ˆå¤§çš„æå‡ã€‚&lt;/p&gt;

&lt;p&gt;å†…éƒ¨åšäº†å¾ˆå¤šä¼˜åŒ–ï¼ŒåŒ…æ‹¬ä»ç£ç›˜è¯»å–æ•°æ®æ—¶é‡‡ç”¨çš„å¯é¢„æµ‹æ€§è¯»ã€èƒ½å¤ŸåŠ å¿«è¯»æ“ä½œå¹¶ä¸”è‡ªåŠ¨åˆ›å»ºçš„è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€èƒ½å¤ŸåŠ é€Ÿæ’å…¥æ“ä½œçš„æ’å…¥ç¼“å†²åŒºç­‰ã€‚&lt;/p&gt;

&lt;p&gt;æ”¯æŒçœŸæ­£çš„åœ¨çº¿çƒ­å¤‡ä»½ã€‚å…¶å®ƒå­˜å‚¨å¼•æ“ä¸æ”¯æŒåœ¨çº¿çƒ­å¤‡ä»½ï¼Œè¦è·å–ä¸€è‡´æ€§è§†å›¾éœ€è¦åœæ­¢å¯¹æ‰€æœ‰è¡¨çš„å†™å…¥ï¼Œè€Œåœ¨è¯»å†™æ··åˆåœºæ™¯ä¸­ï¼Œåœæ­¢å†™å…¥å¯èƒ½ä¹Ÿæ„å‘³ç€åœæ­¢è¯»å–ã€‚&lt;/p&gt;

&lt;h4 id=&quot;32-myisam&quot;&gt;3.2 MyISAM&lt;/h4&gt;

&lt;p&gt;è®¾è®¡ç®€å•ï¼Œæ•°æ®ä»¥ç´§å¯†æ ¼å¼å­˜å‚¨ã€‚å¯¹äºåªè¯»æ•°æ®ï¼Œæˆ–è€…è¡¨æ¯”è¾ƒå°ã€å¯ä»¥å®¹å¿ä¿®å¤æ“ä½œï¼Œåˆ™ä¾ç„¶å¯ä»¥ä½¿ç”¨å®ƒã€‚&lt;/p&gt;

&lt;p&gt;æä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å‹ç¼©è¡¨ã€ç©ºé—´æ•°æ®ç´¢å¼•ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;ä¸æ”¯æŒäº‹åŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;ä¸æ”¯æŒè¡Œçº§é”ï¼Œåªèƒ½å¯¹æ•´å¼ è¡¨åŠ é”ï¼Œè¯»å–æ—¶ä¼šå¯¹éœ€è¦è¯»åˆ°çš„æ‰€æœ‰è¡¨åŠ å…±äº«é”ï¼Œå†™å…¥æ—¶åˆ™å¯¹è¡¨åŠ æ’å®ƒé”ã€‚ä½†åœ¨è¡¨æœ‰è¯»å–æ“ä½œçš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å¾€è¡¨ä¸­æ’å…¥æ–°çš„è®°å½•ï¼Œè¿™è¢«ç§°ä¸ºå¹¶å‘æ’å…¥ï¼ˆCONCURRENT INSERTï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;å¯ä»¥æ‰‹å·¥æˆ–è€…è‡ªåŠ¨æ‰§è¡Œæ£€æŸ¥å’Œä¿®å¤æ“ä½œï¼Œä½†æ˜¯å’Œäº‹åŠ¡æ¢å¤ä»¥åŠå´©æºƒæ¢å¤ä¸åŒï¼Œå¯èƒ½å¯¼è‡´ä¸€äº›æ•°æ®ä¸¢å¤±ï¼Œè€Œä¸”ä¿®å¤æ“ä½œæ˜¯éå¸¸æ…¢çš„ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæŒ‡å®šäº† DELAY_KEY_WRITE é€‰é¡¹ï¼Œåœ¨æ¯æ¬¡ä¿®æ”¹æ‰§è¡Œå®Œæˆæ—¶ï¼Œä¸ä¼šç«‹å³å°†ä¿®æ”¹çš„ç´¢å¼•æ•°æ®å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯ä¼šå†™åˆ°å†…å­˜ä¸­çš„é”®ç¼“å†²åŒºï¼Œåªæœ‰åœ¨æ¸…ç†é”®ç¼“å†²åŒºæˆ–è€…å…³é—­è¡¨çš„æ—¶å€™æ‰ä¼šå°†å¯¹åº”çš„ç´¢å¼•å—å†™å…¥ç£ç›˜ã€‚è¿™ç§æ–¹å¼å¯ä»¥æå¤§çš„æå‡å†™å…¥æ€§èƒ½ï¼Œä½†æ˜¯åœ¨æ•°æ®åº“æˆ–è€…ä¸»æœºå´©æºƒæ—¶ä¼šé€ æˆç´¢å¼•æŸåï¼Œéœ€è¦æ‰§è¡Œä¿®å¤æ“ä½œã€‚&lt;/p&gt;

&lt;h4 id=&quot;33-æ¯”è¾ƒ&quot;&gt;3.3 æ¯”è¾ƒ&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;äº‹åŠ¡ï¼šInnoDB æ˜¯äº‹åŠ¡å‹çš„ï¼Œå¯ä»¥ä½¿ç”¨ Commit å’Œ Rollback è¯­å¥ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å¹¶å‘ï¼šMyISAM åªæ”¯æŒè¡¨çº§é”ï¼Œè€Œ InnoDB è¿˜æ”¯æŒè¡Œçº§é”ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å¤–é”®ï¼šInnoDB æ”¯æŒå¤–é”®ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å¤‡ä»½ï¼šInnoDB æ”¯æŒåœ¨çº¿çƒ­å¤‡ä»½ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å´©æºƒæ¢å¤ï¼šMyISAM å´©æºƒåå‘ç”ŸæŸåçš„æ¦‚ç‡æ¯” InnoDB é«˜å¾ˆå¤šï¼Œè€Œä¸”æ¢å¤çš„é€Ÿåº¦ä¹Ÿæ›´æ…¢ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å…¶å®ƒç‰¹æ€§ï¼šMyISAM æ”¯æŒå‹ç¼©è¡¨å’Œç©ºé—´æ•°æ®ç´¢å¼•ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;sqlä¸­whereå’Œhavingçš„åŒºåˆ«&quot;&gt;sqlä¸­whereå’Œhavingçš„åŒºåˆ«&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;â€œWhereâ€ æ˜¯ä¸€ä¸ªçº¦æŸå£°æ˜ï¼Œä½¿ç”¨Whereæ¥çº¦æŸæ¥è‡ªæ•°æ®åº“çš„æ•°æ®ï¼ŒWhereæ˜¯åœ¨ç»“æœè¿”å›ä¹‹å‰èµ·ä½œç”¨çš„ï¼Œä¸”&lt;strong&gt;Whereä¸­ä¸èƒ½ä½¿ç”¨èšåˆå‡½æ•°&lt;/strong&gt;ã€‚&lt;/li&gt;
  &lt;li&gt;â€œHavingâ€æ˜¯ä¸€ä¸ªè¿‡æ»¤å£°æ˜ï¼Œæ˜¯åœ¨æŸ¥è¯¢è¿”å›ç»“æœé›†ä»¥åå¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œçš„è¿‡æ»¤æ“ä½œï¼Œ&lt;strong&gt;åœ¨Havingä¸­å¯ä»¥ä½¿ç”¨èšåˆå‡½æ•°&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;

</description>
        <pubDate>Fri, 16 Aug 2019 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2019/08/16/%E5%89%91%E6%8C%87Offer_%E6%95%B0%E6%8D%AE%E5%BA%93/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/08/16/%E5%89%91%E6%8C%87Offer_%E6%95%B0%E6%8D%AE%E5%BA%93/</guid>
        
        <category>JobHunting</category>
        
        <category>Foundations</category>
        
        <category>DataBase</category>
        
        
      </item>
    
      <item>
        <title>å¦‚ä½•ä¿®æ”¹ PySpark Dataframe çš„åˆ—å</title>
        <description>&lt;p&gt;åœ¨åšSpark Dataframeæ“ä½œçš„æ—¶å€™ä¼šé‡åˆ°å¾ˆå¤šéœ€æ±‚. æœ€è¿‘æˆ‘é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜, å°±æ˜¯é€šè¿‡&lt;code class=&quot;highlighter-rouge&quot;&gt;agg&lt;/code&gt;æ–¹æ³•ä¼ å…¥å¤šç§èšåˆå‡½æ•°å¯¹å¤šåˆ—è¿›è¡Œæ“ä½œ, ç„¶ååå°±ç”Ÿæˆäº†å¤šåˆ—çš„èšåˆç»“æœ. ä½†æ˜¯åˆ—åå°±æ˜¯ä»¥ åŸåˆ—å+èšåˆå‡½æ•°çš„æ–¹æ³•, ç„¶åå°±äº§ç”Ÿéœ€æ±‚ â€”- å¦‚ä½•ä¿®æ”¹è¿™äº›åˆ—åå‘¢?&lt;/p&gt;

&lt;p&gt;ç„¶åæ‰¾åˆ°äº†ä»¥ä¸‹æ–¹æ³•:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;selectExpr&lt;/code&gt;&lt;/p&gt;

    &lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sqlContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;createDataFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Alberto&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Dakota&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)],&lt;/span&gt; 
                                  &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;askdaosdka&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;printSchema&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Output
#+-------+----------+
#|   Name|askdaosdka|
#+-------+----------+
#|Alberto|         2|
#| Dakota|         2|
#+-------+----------+
#root
# |-- Name: string (nullable = true)
# |-- askdaosdka: long (nullable = true)
&lt;/span&gt;  
&lt;span class=&quot;n&quot;&gt;df&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;selectExpr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Name as name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;askdaosdka as age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;df&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;df&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;printSchema&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Output
#+-------+---+
#|   name|age|
#+-------+---+
#|Alberto|  2|
#| Dakota|  2|
#+-------+---+
#root
# |-- name: string (nullable = true)
# |-- age: long (nullable = true)
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;withColumnRenamed&lt;/code&gt;&lt;/p&gt;

    &lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;oldColumns&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;names&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;newColumns&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
  
&lt;span class=&quot;c1&quot;&gt;# è¿™é‡Œçš„reduceæ˜¯pythonçš„reduce
&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;functools&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;reduce&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;df&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;reduce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;withColumnRenamed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oldColumns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;newColumns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]),&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oldColumns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;df&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;printSchema&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;df&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;ä¸ºäº†ä¾¿äºç†è§£è¿™é‡Œç»™å‡ºpython &lt;code class=&quot;highlighter-rouge&quot;&gt;reduce&lt;/code&gt;æ–¹æ³•çš„å®˜æ–¹è§£é‡Š.&lt;/p&gt;

    &lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;functools&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;reduce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;iterable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initializer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;'''
Apply function of two arguments cumulatively to the items of sequence, from left to right, so as to reduce the sequence to a single value. 
'''&lt;/span&gt;
  
&lt;span class=&quot;c1&quot;&gt;# Roughly equivalent to:
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;reduce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;iterable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initializer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;iter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iterable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initializer&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initializer&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;element&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;element&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;ç®€å•æ€»ç»“ä¸€ä¸‹, ä¹‹å‰çœ‹åˆ°è¿™ç§å®ç°æ–¹å¼, ä»¥ä¸ºæ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;withColumnRenamed&lt;/code&gt;æœ‰ä»€ä¹ˆç‰¹åˆ«é«˜çº§çš„å®ç°, ç°åœ¨ç»“åˆä¸¤éƒ¨åˆ†ä»£ä¹°åˆ†æä¸€ä¸‹, ç®€å•æ¥è¯´è¿˜æ˜¯å°±æ˜¯é€šè¿‡å¾ªç¯, åå¤è°ƒç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;withColumnRenamed&lt;/code&gt;æ–¹æ³•ç»™dfçš„columné‡å‘½åâ€¦â€¦&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;alias&lt;/code&gt;&lt;/p&gt;

    &lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pyspark.sql.functions&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
  
&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alias&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;askdaosdka&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alias&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  
&lt;span class=&quot;c1&quot;&gt;# Output
#+-------+---+
#|   name|age|
#+-------+---+
#|Alberto|  2|
#| Dakota|  2|
#+-------+---+
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;sqlContext.sql&lt;/code&gt;&lt;/p&gt;

    &lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;sqlContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;registerDataFrameAsTable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;myTable&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;df2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sqlContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SELECT Name AS name, askdaosdka as age from myTable&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  
&lt;span class=&quot;n&quot;&gt;df2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  
&lt;span class=&quot;c1&quot;&gt;# Output
#+-------+---+
#|   name|age|
#+-------+---+
#|Alberto|  2|
#| Dakota|  2|
#+-------+---+
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ€»çš„æ¥è¯´, Pysparkå¹¶æ²¡æœ‰èƒ½æœ‰ä¸€æ¬¡æ€§å¯¹æ•´ä¸ªcolumn namesè¿›è¡Œæ›¿æ¢çš„æ–¹æ³•, åªèƒ½é€šè¿‡ä¸€äº›trické€ä¸ªåˆ—è¿›è¡Œæ“ä½œ. ä»ä¸ªäººå–œå¥½æ¥è¯´, ç¬¬ä¸€ç§å’Œç¬¬äºŒç§å®ç°æ–¹å¼æ„Ÿè§‰ä¼šç›¸å¯¹ç®€å•.&lt;/p&gt;

&lt;p&gt;ä¸»è¦æ–¹æ³•è½¬è½½è‡ªï¼š&lt;a href=&quot;https://codeday.me/bug/20180407/150940.html&quot;&gt;python â€“ å¦‚ä½•æ›´æ”¹pysparkä¸­çš„æ•°æ®æ¡†åˆ—åï¼Ÿ&lt;/a&gt; - &lt;a href=&quot;https://codeday.me/&quot;&gt;ä»£ç æ—¥å¿—&lt;/a&gt;&lt;/p&gt;
</description>
        <pubDate>Thu, 15 Aug 2019 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2019/08/15/%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9Pyspark-DataFrame%E7%9A%84%E5%88%97%E5%90%8D/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/08/15/%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9Pyspark-DataFrame%E7%9A%84%E5%88%97%E5%90%8D/</guid>
        
        <category>Spark</category>
        
        <category>BigData</category>
        
        <category>Programing</category>
        
        
      </item>
    
      <item>
        <title>Spark OOM é—®é¢˜çš„ç†è§£ä¸ä¼˜åŒ–</title>
        <description>&lt;p&gt;[toc]&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;mapæ‰§è¡Œä¸­å†…å­˜æº¢å‡º
mapæ‰§è¡Œä¸­å†…å­˜æº¢å‡ºä»£è¡¨äº†æ‰€æœ‰mapç±»å‹çš„æ“ä½œï¼ŒåŒ…æ‹¬ï¼š&lt;code class=&quot;highlighter-rouge&quot;&gt;flatMap&lt;/code&gt;ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;filter&lt;/code&gt;ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;mapPatitions&lt;/code&gt;ç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;shuffleåå†…å­˜æº¢å‡º
shuffleåå†…å­˜æº¢å‡ºçš„shuffleæ“ä½œåŒ…æ‹¬&lt;code class=&quot;highlighter-rouge&quot;&gt;join&lt;/code&gt;ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;reduceByKey&lt;/code&gt;ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;repartition&lt;/code&gt;ç­‰æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-spark-å†…å­˜æ¨¡å‹&quot;&gt;1. Spark å†…å­˜æ¨¡å‹ï¼š&lt;/h3&gt;

&lt;p&gt;Sparkåœ¨ä¸€ä¸ª&lt;u&gt;Executorä¸­çš„å†…å­˜&lt;/u&gt;åˆ†ä¸ºä¸‰å—ï¼Œä¸€å—æ˜¯executionå†…å­˜ï¼Œä¸€å—æ˜¯storageå†…å­˜ï¼Œä¸€å—æ˜¯otherå†…å­˜ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;executionå†…å­˜æ˜¯æ‰§è¡Œå†…å­˜ï¼Œæ–‡æ¡£ä¸­è¯´joinï¼Œaggregateéƒ½åœ¨è¿™éƒ¨åˆ†å†…å­˜ä¸­æ‰§è¡Œï¼Œshuffleçš„æ•°æ®ä¹Ÿä¼šå…ˆç¼“å­˜åœ¨è¿™ä¸ªå†…å­˜ä¸­ï¼Œæ»¡äº†å†å†™å…¥ç£ç›˜ï¼Œèƒ½å¤Ÿå‡å°‘IOã€‚å…¶å®mapè¿‡ç¨‹ä¹Ÿæ˜¯åœ¨è¿™ä¸ªå†…å­˜ä¸­æ‰§è¡Œçš„ã€‚&lt;/li&gt;
  &lt;li&gt;storageå†…å­˜æ˜¯å­˜å‚¨broadcastï¼Œcacheï¼Œpersistæ•°æ®çš„åœ°æ–¹ã€‚&lt;/li&gt;
  &lt;li&gt;otherå†…å­˜æ˜¯ç¨‹åºæ‰§è¡Œæ—¶é¢„ç•™ç»™è‡ªå·±çš„å†…å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;executionå’Œstorageæ˜¯Spark Executorä¸­å†…å­˜çš„å¤§æˆ·ï¼Œotherå ç”¨å†…å­˜ç›¸å¯¹å°‘å¾ˆå¤šã€‚&lt;/p&gt;

&lt;p&gt;åœ¨spark-1.6.0ä»¥å‰çš„ç‰ˆæœ¬ï¼Œexecutionå’Œstorageçš„å†…å­˜åˆ†é…æ˜¯å›ºå®šçš„ï¼Œä½¿ç”¨çš„å‚æ•°é…ç½®åˆ†åˆ«æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.shuffle.memoryFraction&lt;/code&gt;(executionå†…å­˜å Executoræ€»å†…å­˜å¤§å°ï¼Œdefault 0.2)å’Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.storage.memoryFraction&lt;/code&gt;(storageå†…å­˜å Executorå†…å­˜å¤§å°ï¼Œdefault 0.6). å› ä¸ºæ˜¯1.6.0ä»¥å‰è¿™ä¸¤å—å†…å­˜æ˜¯äº’ç›¸éš”ç¦»çš„ï¼Œè¿™å°±å¯¼è‡´äº†Executorçš„å†…å­˜åˆ©ç”¨ç‡ä¸é«˜ï¼Œè€Œä¸”éœ€è¦æ ¹æ®Applicationçš„å…·ä½“æƒ…å†µï¼Œä½¿ç”¨è€…è‡ªå·±æ¥è°ƒèŠ‚è¿™ä¸¤ä¸ªå‚æ•°æ‰èƒ½ä¼˜åŒ–Sparkçš„å†…å­˜ä½¿ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨spark-1.6.0ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œexecutionå†…å­˜å’Œstorageå†…å­˜å¯ä»¥ç›¸äº’å€Ÿç”¨ï¼Œæé«˜äº†å†…å­˜çš„Sparkä¸­å†…å­˜çš„ä½¿ç”¨ç‡ï¼ŒåŒæ—¶ä¹Ÿå‡å°‘äº†OOMçš„æƒ…å†µã€‚&lt;/p&gt;

&lt;p&gt;åœ¨Spark-1.6.0ååŠ å…¥äº†&lt;strong&gt;å †å¤–å†…å­˜&lt;/strong&gt;ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–äº†Sparkçš„å†…å­˜ä½¿ç”¨ï¼Œå †å¤–å†…å­˜ä½¿ç”¨JVMå †ä»¥å¤–çš„å†…å­˜ï¼Œä¸ä¼šè¢«gcå›æ”¶ï¼Œå¯ä»¥å‡å°‘é¢‘ç¹çš„full gcï¼Œæ‰€ä»¥åœ¨Sparkç¨‹åºä¸­ï¼Œä¼šé•¿æ—¶é—´é€—ç•™å†Sparkç¨‹åºä¸­çš„å¤§å†…å­˜å¯¹è±¡å¯ä»¥ä½¿ç”¨å †å¤–å†…å­˜å­˜å‚¨ã€‚
ä½¿ç”¨å †å¤–å†…å­˜æœ‰ä¸¤ç§æ–¹å¼ï¼Œ
ä¸€ç§æ˜¯åœ¨rddè°ƒç”¨persistçš„æ—¶å€™ä¼ å…¥å‚æ•°&lt;code class=&quot;highlighter-rouge&quot;&gt;StorageLevel.OFF_HEAP&lt;/code&gt;ï¼Œè¿™ç§ä½¿ç”¨æ–¹å¼éœ€è¦é…åˆTachyonä¸€èµ·ä½¿ç”¨ã€‚
å¦å¤–ä¸€ç§æ˜¯ä½¿ç”¨Sparkè‡ªå¸¦çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.memory.offHeap.enabled&lt;/code&gt; é…ç½®ä¸ºtrueè¿›è¡Œä½¿ç”¨ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼åœ¨1.6.0çš„ç‰ˆæœ¬è¿˜ä¸æ”¯æŒä½¿ç”¨ï¼Œåªæ˜¯å¤šäº†è¿™ä¸ªå‚æ•°ï¼Œåœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­ä¼šå¼€æ”¾ã€‚&lt;/p&gt;

&lt;p&gt;OOMçš„é—®é¢˜é€šå¸¸å‡ºç°åœ¨executionè¿™å—å†…å­˜ä¸­ï¼Œå› ä¸ºstorageè¿™å—å†…å­˜åœ¨å­˜æ”¾æ•°æ®æ»¡äº†ä¹‹åï¼Œä¼šç›´æ¥ä¸¢å¼ƒå†…å­˜ä¸­æ—§çš„æ•°æ®ï¼Œå¯¹æ€§èƒ½æœ‰å½±å“ä½†æ˜¯ä¸ä¼šæœ‰OOMçš„é—®é¢˜ã€‚&lt;/p&gt;

&lt;h3 id=&quot;2-å†…å­˜æº¢å‡ºè§£å†³æ–¹æ³•&quot;&gt;2. å†…å­˜æº¢å‡ºè§£å†³æ–¹æ³•ï¼š&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;mapè¿‡ç¨‹äº§ç”Ÿå¤§é‡å¯¹è±¡å¯¼è‡´å†…å­˜æº¢å‡ºï¼š&lt;/p&gt;

    &lt;p&gt;è¿™ç§æº¢å‡ºçš„åŸå› æ˜¯åœ¨å•ä¸ªmapä¸­äº§ç”Ÿäº†å¤§é‡çš„å¯¹è±¡å¯¼è‡´çš„ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

    &lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;nv&quot;&gt;rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;è¿™ä¸ªæ“ä½œåœ¨rddä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½äº§ç”Ÿäº†10000ä¸ªå¯¹è±¡ï¼Œè¿™è‚¯å®šå¾ˆå®¹æ˜“äº§ç”Ÿå†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚é’ˆå¯¹è¿™ç§é—®é¢˜ï¼Œåœ¨ä¸å¢åŠ å†…å­˜çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡å‡å°‘æ¯ä¸ªTaskçš„å¤§å°ï¼Œä»¥ä¾¿è¾¾åˆ°æ¯ä¸ªTaskå³ä½¿äº§ç”Ÿå¤§é‡çš„å¯¹è±¡Executorçš„å†…å­˜ä¹Ÿèƒ½å¤Ÿè£…å¾—ä¸‹ã€‚&lt;strong&gt;å…·ä½“åšæ³•&lt;/strong&gt;å¯ä»¥åœ¨ä¼šäº§ç”Ÿå¤§é‡å¯¹è±¡çš„mapæ“ä½œä¹‹å‰è°ƒç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;repartition&lt;/code&gt;æ–¹æ³•ï¼Œåˆ†åŒºæˆ&lt;u&gt;æ›´å°çš„å—&lt;/u&gt;ä¼ å…¥mapã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;

    &lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt; &lt;span class=&quot;nv&quot;&gt;rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;repartition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;é¢å¯¹è¿™ç§é—®é¢˜æ³¨æ„ï¼Œä¸èƒ½ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;rdd.coalesce&lt;/code&gt;æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åªèƒ½å‡å°‘åˆ†åŒºï¼Œä¸èƒ½å¢åŠ åˆ†åŒºï¼Œä¸ä¼šæœ‰shuffleçš„è¿‡ç¨‹ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æ•°æ®ä¸å¹³è¡¡å¯¼è‡´å†…å­˜æº¢å‡ºï¼š&lt;/p&gt;

    &lt;p&gt;æ•°æ®ä¸å¹³è¡¡é™¤äº†æœ‰å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºå¤–ï¼Œä¹Ÿæœ‰å¯èƒ½å¯¼è‡´æ€§èƒ½çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ³•å’Œä¸Šé¢è¯´çš„ç±»ä¼¼ï¼Œå°±æ˜¯è°ƒç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;repartition&lt;/code&gt;é‡æ–°åˆ†åŒºã€‚è¿™é‡Œå°±ä¸å†ç´¯èµ˜äº†ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;coalesce&lt;/code&gt;è°ƒç”¨å¯¼è‡´å†…å­˜æº¢å‡ºï¼š&lt;/p&gt;

    &lt;p&gt;å› ä¸ºhdfsä¸­ä¸é€‚åˆå­˜å°é—®é¢˜ï¼Œæ‰€ä»¥Sparkè®¡ç®—åå¦‚æœäº§ç”Ÿçš„æ–‡ä»¶å¤ªå°ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;coalesce&lt;/code&gt;åˆå¹¶æ–‡ä»¶å†å­˜å…¥hdfsä¸­ã€‚ä½†æ˜¯è¿™ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚åœ¨&lt;code class=&quot;highlighter-rouge&quot;&gt;coalesce&lt;/code&gt;ä¹‹å‰æœ‰100ä¸ªæ–‡ä»¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€èƒ½å¤Ÿæœ‰100ä¸ªTaskï¼Œç°åœ¨è°ƒç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;coalesce(10)&lt;/code&gt;ï¼Œæœ€ååªäº§ç”Ÿ10ä¸ªæ–‡ä»¶ï¼Œå› ä¸º&lt;code class=&quot;highlighter-rouge&quot;&gt;coalesce&lt;/code&gt;å¹¶ä¸æ˜¯shuffleæ“ä½œï¼Œè¿™æ„å‘³ç€&lt;code class=&quot;highlighter-rouge&quot;&gt;coalesce&lt;/code&gt;å¹¶ä¸æ˜¯æŒ‰ç…§æˆ‘åŸæœ¬æƒ³çš„é‚£æ ·å…ˆæ‰§è¡Œ100ä¸ªTaskï¼Œå†å°†Taskçš„æ‰§è¡Œç»“æœåˆå¹¶æˆ10ä¸ªï¼Œè€Œæ˜¯ä»å¤´åˆ°ä½åªæœ‰10ä¸ªTaskåœ¨æ‰§è¡Œï¼ŒåŸæœ¬100ä¸ªæ–‡ä»¶æ˜¯åˆ†å¼€æ‰§è¡Œçš„ï¼Œç°åœ¨æ¯ä¸ªTaskåŒæ—¶ä¸€æ¬¡è¯»å–10ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨çš„å†…å­˜æ˜¯åŸæ¥çš„10å€ï¼Œè¿™å¯¼è‡´äº†OOMã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯ä»¤ç¨‹åºæŒ‰ç…§æˆ‘ä»¬æƒ³çš„å…ˆæ‰§è¡Œ100ä¸ªTaskå†å°†ç»“æœåˆå¹¶æˆ10ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªé—®é¢˜åŒæ ·å¯ä»¥é€šè¿‡&lt;code class=&quot;highlighter-rouge&quot;&gt;repartition&lt;/code&gt;è§£å†³ï¼Œè°ƒç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;repartition(10)&lt;/code&gt;ï¼Œå› ä¸ºè¿™å°±æœ‰ä¸€ä¸ªshuffleçš„è¿‡ç¨‹ï¼Œshuffleå‰åæ˜¯ä¸¤ä¸ªStageï¼Œä¸€ä¸ª100ä¸ªåˆ†åŒºï¼Œä¸€ä¸ªæ˜¯10ä¸ªåˆ†åŒºï¼Œå°±èƒ½æŒ‰ç…§æˆ‘ä»¬çš„æƒ³æ³•æ‰§è¡Œã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;shuffleåå†…å­˜æº¢å‡º:&lt;/p&gt;

    &lt;p&gt;shuffleå†…å­˜æº¢å‡ºçš„æƒ…å†µå¯ä»¥è¯´éƒ½æ˜¯shuffleåï¼Œ&lt;u&gt;å•ä¸ªæ–‡ä»¶è¿‡å¤§&lt;/u&gt;å¯¼è‡´çš„ã€‚
åœ¨Sparkä¸­ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;join&lt;/code&gt;ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;reduceByKey&lt;/code&gt;è¿™ä¸€ç±»å‹çš„è¿‡ç¨‹ï¼Œéƒ½ä¼šæœ‰shuffleçš„è¿‡ç¨‹ï¼Œåœ¨shuffleçš„ä½¿ç”¨ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªpartitionerï¼Œå¤§éƒ¨åˆ†Sparkä¸­çš„shuffleæ“ä½œï¼Œé»˜è®¤çš„partitioneréƒ½æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;HashPatitioner&lt;/code&gt;ï¼Œé»˜è®¤å€¼æ˜¯çˆ¶RDDä¸­&lt;u&gt;æœ€å¤§çš„åˆ†åŒºæ•°&lt;/u&gt;, è¿™ä¸ªå‚æ•°é€šè¿‡ä¸‹é¢ä¸¤ä¸ªå‚æ•°æ§åˆ¶:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;RDD: &lt;code class=&quot;highlighter-rouge&quot;&gt;spark.default.parallelism&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;DataFrame: &lt;code class=&quot;highlighter-rouge&quot;&gt;spark.sql.shuffle.partitions&lt;/code&gt;&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.default.parallelism&lt;/code&gt;å‚æ•°åªå¯¹&lt;code class=&quot;highlighter-rouge&quot;&gt;HashPartitioner&lt;/code&gt;æœ‰æ•ˆï¼Œæ‰€ä»¥å¦‚æœæ˜¯åˆ«çš„Partitioneræˆ–è€…è‡ªå·±å®ç°çš„Partitionerå°±ä¸èƒ½ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.default.parallelism&lt;/code&gt;è¿™ä¸ªå‚æ•°æ¥æ§åˆ¶shuffleçš„å¹¶å‘é‡äº†ã€‚å¦‚æœæ˜¯åˆ«çš„partitionerå¯¼è‡´çš„shuffleå†…å­˜æº¢å‡ºï¼Œå°±éœ€è¦ä»partitionerçš„ä»£ç å¢åŠ partitionsçš„æ•°é‡ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;standaloneæ¨¡å¼ä¸‹èµ„æºåˆ†é…ä¸å‡åŒ€å¯¼è‡´å†…å­˜æº¢å‡ºï¼š
 åœ¨standaloneçš„æ¨¡å¼ä¸‹å¦‚æœé…ç½®äº†&lt;code class=&quot;highlighter-rouge&quot;&gt;--total-executor-cores&lt;/code&gt; å’Œ &lt;code class=&quot;highlighter-rouge&quot;&gt;--executor-memory&lt;/code&gt; è¿™ä¸¤ä¸ªå‚æ•°ï¼Œä½†æ˜¯æ²¡æœ‰é…ç½®&lt;code class=&quot;highlighter-rouge&quot;&gt;--executor-cores&lt;/code&gt;è¿™ä¸ªå‚æ•°çš„è¯ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´ï¼Œæ¯ä¸ªExecutorçš„&lt;strong&gt;memory&lt;/strong&gt;æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯&lt;strong&gt;cores&lt;/strong&gt;çš„æ•°é‡ä¸åŒï¼Œé‚£ä¹ˆåœ¨coresæ•°é‡å¤šçš„Executorä¸­ï¼Œç”±äºèƒ½å¤ŸåŒæ—¶æ‰§è¡Œå¤šä¸ªTaskï¼Œå°±å®¹æ˜“å¯¼è‡´å†…å­˜æº¢å‡ºçš„æƒ…å†µã€‚è¿™ç§æƒ…å†µçš„è§£å†³æ–¹æ³•å°±æ˜¯åŒæ—¶é…ç½®&lt;code class=&quot;highlighter-rouge&quot;&gt;--executor-cores&lt;/code&gt;æˆ–è€…&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.executor.cores&lt;/code&gt;å‚æ•°ï¼Œç¡®ä¿Executorèµ„æºåˆ†é…å‡åŒ€ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;åœ¨RDDä¸­ï¼Œå…±ç”¨å¯¹è±¡èƒ½å¤Ÿå‡å°‘OOMçš„æƒ…å†µï¼š&lt;/p&gt;

    &lt;p&gt;è¿™ä¸ªæ¯”è¾ƒç‰¹æ®Šï¼Œæœ‰ä¸€ç§æƒ…å†µï¼Œç±»ä¼¼è¿™æ ·&lt;/p&gt;

    &lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;flatMap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;key&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;å¯¼è‡´OOMï¼Œä½†æ˜¯åœ¨åŒæ ·çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨&lt;/p&gt;

    &lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;flatMap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;key&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;å°±ä¸ä¼šæœ‰OOMçš„é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºæ¯æ¬¡&lt;code class=&quot;highlighter-rouge&quot;&gt;(&quot;key&quot;,&quot;value&quot;)&lt;/code&gt;éƒ½äº§ç”Ÿä¸€ä¸ªTupleå¯¹è±¡ï¼Œè€Œâ€keyâ€+â€valueâ€ï¼Œä¸ç®¡å¤šå°‘ä¸ªï¼Œéƒ½åªæœ‰ä¸€ä¸ªå¯¹è±¡ï¼ŒæŒ‡å‘å¸¸é‡æ± ã€‚å…·ä½“æµ‹è¯•å¦‚ä¸‹ï¼š&lt;/p&gt;

    &lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;scala&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;key&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;key&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;res0&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;false&lt;/span&gt;
   
&lt;span class=&quot;n&quot;&gt;scala&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;key&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;value&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;key&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;value&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;res0&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;è¿™ä¸ªä¾‹å­è¯´æ˜(â€œkeyâ€,â€valueâ€)å’Œ(â€œkeyâ€,â€valueâ€)åœ¨å†…å­˜ä¸­æ˜¯å­˜åœ¨ä¸åŒä½ç½®çš„,ä¹Ÿå°±æ˜¯å­˜äº†ä¸¤ä»½,ä½†æ˜¯â€keyâ€+â€valueâ€è™½ç„¶å‡ºç°äº†ä¸¤æ¬¡,ä½†æ˜¯åªå­˜äº†ä¸€ä»½,åœ¨åŒä¸€ä¸ªåœ°å€,è¿™ç”¨åˆ°äº†JVMå¸¸é‡æ± çš„çŸ¥è¯†. äºæ˜¯ä¹,å¦‚æœRDDä¸­æœ‰å¤§é‡çš„é‡å¤æ•°æ®,æˆ–è€…Arrayä¸­éœ€è¦å­˜å¤§é‡é‡å¤æ•°æ®çš„æ—¶å€™æˆ‘ä»¬éƒ½å¯ä»¥å°†é‡å¤æ•°æ®è½¬åŒ–ä¸ºString,èƒ½å¤Ÿæœ‰æ•ˆçš„å‡å°‘å†…å­˜ä½¿ç”¨.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;3-ä¼˜åŒ–ç­–ç•¥&quot;&gt;3. ä¼˜åŒ–ç­–ç•¥ï¼š&lt;/h3&gt;

&lt;p&gt;è¿™ä¸€éƒ¨åˆ†ä¸»è¦è®°å½•ä¸€ä¸‹åˆ°spark-1.6.1ç‰ˆæœ¬ï¼Œç¬”è€…è§‰å¾—æœ‰ä¼˜åŒ–æ€§èƒ½ä½œç”¨çš„ä¸€äº›å‚æ•°é…ç½®å’Œä¸€äº›ä»£ç ä¼˜åŒ–æŠ€å·§ï¼Œåœ¨å‚æ•°ä¼˜åŒ–éƒ¨åˆ†ï¼Œå¦‚æœç¬”è€…è§‰å¾—é»˜è®¤å€¼æ˜¯æœ€ä¼˜çš„äº†ï¼Œè¿™é‡Œå°±ä¸å†è®°å½•ã€‚&lt;/p&gt;
&lt;h4 id=&quot;ä»£ç ä¼˜åŒ–æŠ€å·§&quot;&gt;ä»£ç ä¼˜åŒ–æŠ€å·§ï¼š&lt;/h4&gt;
&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;mapPartitions&lt;/code&gt;ä»£æ›¿å¤§éƒ¨åˆ†&lt;code class=&quot;highlighter-rouge&quot;&gt;map&lt;/code&gt;æ“ä½œï¼Œæˆ–è€…è¿ç»­ä½¿ç”¨çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;map&lt;/code&gt;æ“ä½œï¼š&lt;/p&gt;

    &lt;p&gt;è¿™é‡Œéœ€è¦ç¨å¾®è®²ä¸€ä¸‹RDDå’ŒDataFrameçš„åŒºåˆ«ã€‚&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;RDDå¼ºè°ƒçš„æ˜¯&lt;strong&gt;ä¸å¯å˜å¯¹è±¡&lt;/strong&gt;ï¼Œæ¯ä¸ªRDDéƒ½æ˜¯ä¸å¯å˜çš„ï¼Œå½“è°ƒç”¨RDDçš„mapç±»å‹æ“ä½œçš„æ—¶å€™ï¼Œéƒ½æ˜¯äº§ç”Ÿä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™å°±å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœå¯¹ä¸€ä¸ªRDDè°ƒç”¨å¤§é‡çš„mapç±»å‹æ“ä½œçš„è¯ï¼Œæ¯ä¸ªmapæ“ä½œä¼šäº§ç”Ÿä¸€ä¸ªåˆ°å¤šä¸ªRDDå¯¹è±¡ï¼Œè¿™è™½ç„¶ä¸ä¸€å®šä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œä½†æ˜¯ä¼šäº§ç”Ÿå¤§é‡çš„ä¸­é—´æ•°æ®ï¼Œ&lt;u&gt;å¢åŠ äº†gcæ“ä½œ&lt;/u&gt;ã€‚å¦å¤–RDDåœ¨è°ƒç”¨actionæ“ä½œçš„æ—¶å€™ï¼Œä¼šå‡ºå‘Stageçš„åˆ’åˆ†ï¼Œä½†æ˜¯åœ¨æ¯ä¸ªStageå†…éƒ¨å¯ä¼˜åŒ–çš„éƒ¨åˆ†æ˜¯ä¸ä¼šè¿›è¡Œä¼˜åŒ–çš„ï¼Œä¾‹å¦‚&lt;code class=&quot;highlighter-rouge&quot;&gt;rdd.map(_+1).map(_+1)&lt;/code&gt;ï¼Œè¿™ä¸ªæ“ä½œåœ¨æ•°å€¼å‹RDDä¸­æ˜¯ç­‰ä»·äºrdd.map(_+2)çš„ï¼Œä½†æ˜¯RDDå†…éƒ¨ä¸ä¼šå¯¹è¿™ä¸ªè¿‡ç¨‹è¿›è¡Œä¼˜åŒ–ã€‚&lt;/li&gt;
      &lt;li&gt;DataFrameåˆ™ä¸åŒï¼ŒDataFrameç”±äºæœ‰ç±»å‹ä¿¡æ¯æ‰€ä»¥æ˜¯&lt;strong&gt;å¯å˜çš„&lt;/strong&gt;ï¼Œå¹¶ä¸”åœ¨å¯ä»¥ä½¿ç”¨sqlçš„ç¨‹åºä¸­ï¼Œéƒ½æœ‰é™¤äº†è§£é‡Šå™¨å¤–ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªsqlä¼˜åŒ–å™¨ï¼ŒDataFrameä¹Ÿä¸ä¾‹å¤–ï¼Œæœ‰ä¸€ä¸ªä¼˜åŒ–å™¨Catalystï¼Œå…·ä½“ä»‹ç»çœ‹åé¢å‚è€ƒçš„æ–‡ç« ã€‚&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;ä¸Šé¢è¯´åˆ°çš„è¿™äº›RDDçš„å¼Šç«¯ï¼Œæœ‰ä¸€éƒ¨åˆ†å°±å¯ä»¥ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;mapPartitions&lt;/code&gt;è¿›è¡Œä¼˜åŒ–ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;mapPartitions&lt;/code&gt;å¯ä»¥åŒæ—¶æ›¿ä»£&lt;code class=&quot;highlighter-rouge&quot;&gt;rdd.map&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;rdd.filter&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;rdd.flatMap&lt;/code&gt;çš„ä½œç”¨ï¼Œæ‰€ä»¥åœ¨é•¿æ“ä½œä¸­ï¼Œå¯ä»¥åœ¨&lt;code class=&quot;highlighter-rouge&quot;&gt;mapPartitons&lt;/code&gt;ä¸­å°†RDDå¤§é‡çš„æ“ä½œå†™åœ¨ä¸€èµ·ï¼Œé¿å…äº§ç”Ÿå¤§é‡çš„ä¸­é—´rddå¯¹è±¡ï¼Œå¦å¤–æ˜¯mapPartitionsåœ¨ä¸€ä¸ªpartitionä¸­å¯ä»¥å¤ç”¨å¯å˜ç±»å‹ï¼Œè¿™ä¹Ÿèƒ½å¤Ÿé¿å…é¢‘ç¹çš„åˆ›å»ºæ–°å¯¹è±¡ã€‚ä½¿ç”¨mapPartitionsçš„å¼Šç«¯å°±æ˜¯ç‰ºç‰²äº†ä»£ç çš„æ˜“è¯»æ€§ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;broadcast join&lt;/code&gt;å’Œæ™®é€š&lt;code class=&quot;highlighter-rouge&quot;&gt;join&lt;/code&gt;ï¼š&lt;/p&gt;

    &lt;p&gt;åœ¨å¤§æ•°æ®åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤§é‡æ•°æ®çš„ç§»åŠ¨å¯¹æ€§èƒ½çš„å½±å“ä¹Ÿæ˜¯å·¨å¤§çš„ã€‚åŸºäºè¿™ä¸ªæ€æƒ³ï¼Œåœ¨ä¸¤ä¸ªRDDè¿›è¡Œjoinæ“ä½œçš„æ—¶å€™ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªRDDç›¸å¯¹å°å¾ˆå¤šï¼Œå¯ä»¥å°†å°çš„RDDè¿›è¡Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;collect&lt;/code&gt;æ“ä½œç„¶åè®¾ç½®ä¸º&lt;code class=&quot;highlighter-rouge&quot;&gt;broadcast&lt;/code&gt;å˜é‡ï¼Œè¿™æ ·åšä¹‹åï¼Œå¦ä¸€ä¸ªRDDå°±å¯ä»¥ä½¿ç”¨mapæ“ä½œè¿›è¡Œjoinï¼Œè¿™æ ·èƒ½å¤Ÿæœ‰æ•ˆçš„å‡å°‘ç›¸å¯¹å¤§å¾ˆå¤šçš„é‚£ä¸ªRDDçš„æ•°æ®ç§»åŠ¨ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å…ˆ&lt;code class=&quot;highlighter-rouge&quot;&gt;filter&lt;/code&gt;åœ¨&lt;code class=&quot;highlighter-rouge&quot;&gt;join&lt;/code&gt;ï¼š&lt;/p&gt;

    &lt;p&gt;è¿™ä¸ªå°±æ˜¯&lt;strong&gt;è°“è¯ä¸‹æ¨&lt;/strong&gt;ï¼Œè¿™ä¸ªå¾ˆæ˜¾ç„¶ï¼Œfilterä¹‹åå†joinï¼Œshuffleçš„æ•°æ®é‡ä¼šå‡å°‘ï¼Œè¿™é‡Œæä¸€ç‚¹æ˜¯spark-sqlçš„ä¼˜åŒ–å™¨å·²ç»å¯¹è¿™éƒ¨åˆ†æœ‰ä¼˜åŒ–äº†ï¼Œä¸éœ€è¦ç”¨æˆ·æ˜¾ç¤ºçš„æ“ä½œï¼Œä¸ªäººå®ç°rddçš„è®¡ç®—çš„æ—¶å€™éœ€è¦æ³¨æ„è¿™ä¸ªã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;partitonByä¼˜åŒ–ï¼š&lt;/p&gt;

    &lt;p&gt;è¿™ä¸€éƒ¨åˆ†åœ¨å¦ä¸€ç¯‡æ–‡ç« ã€Šspark partitionerä½¿ç”¨æŠ€å·§ ã€‹æœ‰è¯¦ç»†ä»‹ç»ï¼Œè¿™é‡Œä¸è¯´äº†ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;combineByKeyçš„ä½¿ç”¨ï¼š
 è¿™ä¸ªæ“ä½œåœ¨Map-Reduceä¸­ä¹Ÿæœ‰ï¼Œè¿™é‡Œä¸¾ä¸ªä¾‹å­ï¼š&lt;code class=&quot;highlighter-rouge&quot;&gt;rdd.groupByKey().mapValue(_.sum)&lt;/code&gt;æ¯”&lt;code class=&quot;highlighter-rouge&quot;&gt;rdd.reduceByKey&lt;/code&gt;çš„æ•ˆç‡ä½ï¼ŒåŸå› å¦‚ä¸‹ä¸¤å¹…å›¾æ‰€ç¤º(ç½‘ä¸Šç›—æ¥çš„ï¼Œä¾µåˆ )&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/739727/201801/739727-20180126174937069-1579617042.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/739727/201801/739727-20180126175121959-313725154.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;ä¸Šä¸‹ä¸¤å¹…å›¾çš„åŒºåˆ«å°±æ˜¯ä¸Šé¢é‚£å¹…æœ‰&lt;code class=&quot;highlighter-rouge&quot;&gt;combineByKey&lt;/code&gt;çš„è¿‡ç¨‹å‡å°‘äº†shuffleçš„æ•°æ®é‡ï¼Œä¸‹é¢çš„æ²¡æœ‰ã€‚&lt;code class=&quot;highlighter-rouge&quot;&gt;combineByKey&lt;/code&gt;æ˜¯key-valueå‹rddè‡ªå¸¦çš„APIï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;åœ¨å†…å­˜ä¸è¶³çš„ä½¿ç”¨ï¼Œä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;rdd.persist(StorageLevel.MEMORY_AND_DISK_SER)&lt;/code&gt;ä»£æ›¿&lt;code class=&quot;highlighter-rouge&quot;&gt;rdd.cache()&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;rdd.cache()&lt;/code&gt;å’Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;rdd.persist(Storage.MEMORY_ONLY)&lt;/code&gt;æ˜¯ç­‰ä»·çš„ï¼Œåœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™&lt;code class=&quot;highlighter-rouge&quot;&gt;rdd.cache()&lt;/code&gt;çš„æ•°æ®ä¼šä¸¢å¤±ï¼Œ&lt;u&gt;å†æ¬¡ä½¿ç”¨çš„æ—¶å€™ä¼šé‡ç®—&lt;/u&gt;ï¼Œè€Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;rdd.persist(StorageLevel.MEMORY_AND_DISK_SER)&lt;/code&gt;åœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™ä¼šå­˜å‚¨åœ¨ç£ç›˜ï¼Œé¿å…é‡ç®—ï¼Œåªæ˜¯æ¶ˆè€—ç‚¹IOæ—¶é—´ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;åœ¨sparkä½¿ç”¨hbaseçš„æ—¶å€™ï¼Œsparkå’Œhbaseæ­å»ºåœ¨åŒä¸€ä¸ªé›†ç¾¤ï¼š&lt;/p&gt;

    &lt;p&gt;åœ¨sparkç»“åˆhbaseçš„ä½¿ç”¨ä¸­ï¼Œsparkå’Œhbaseæœ€å¥½æ­å»ºåœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸Šä¸Šï¼Œæˆ–è€…sparkçš„é›†ç¾¤èŠ‚ç‚¹èƒ½å¤Ÿè¦†ç›–hbaseçš„æ‰€æœ‰èŠ‚ç‚¹ã€‚hbaseä¸­çš„æ•°æ®å­˜å‚¨åœ¨HFileä¸­ï¼Œé€šå¸¸å•ä¸ªHFileéƒ½ä¼šæ¯”è¾ƒå¤§ï¼Œå¦å¤–Sparkåœ¨è¯»å–Hbaseçš„æ•°æ®çš„æ—¶å€™ï¼Œä¸æ˜¯æŒ‰ç…§ä¸€ä¸ªHFileå¯¹åº”ä¸€ä¸ªRDDçš„åˆ†åŒºï¼Œè€Œæ˜¯ä¸€ä¸ªregionå¯¹åº”ä¸€ä¸ªRDDåˆ†åŒºã€‚æ‰€ä»¥åœ¨Sparkè¯»å–Hbaseçš„æ•°æ®æ—¶ï¼Œé€šå¸¸å•ä¸ªRDDéƒ½ä¼šæ¯”è¾ƒå¤§ï¼Œå¦‚æœä¸æ˜¯æ­å»ºåœ¨åŒä¸€ä¸ªé›†ç¾¤ï¼Œæ•°æ®ç§»åŠ¨ä¼šè€—è´¹å¾ˆå¤šçš„æ—¶é—´ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;å‚æ•°ä¼˜åŒ–éƒ¨åˆ†&quot;&gt;å‚æ•°ä¼˜åŒ–éƒ¨åˆ†ï¼š&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.driver.memory&lt;/code&gt; (default 1G)ï¼š&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;è¿™ä¸ªå‚æ•°ç”¨æ¥è®¾ç½®Driverçš„å†…å­˜ã€‚åœ¨Sparkç¨‹åºä¸­ï¼ŒSparkContextï¼ŒDAGScheduleréƒ½æ˜¯è¿è¡Œåœ¨Driverç«¯çš„ã€‚å¯¹åº”rddçš„Stageåˆ‡åˆ†ä¹Ÿæ˜¯åœ¨Driverç«¯è¿è¡Œï¼Œå¦‚æœç”¨æˆ·è‡ªå·±å†™çš„ç¨‹åºæœ‰è¿‡å¤šçš„æ­¥éª¤ï¼Œåˆ‡åˆ†å‡ºè¿‡å¤šçš„Stageï¼Œè¿™éƒ¨åˆ†ä¿¡æ¯æ¶ˆè€—çš„æ˜¯Driverçš„å†…å­˜ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦è°ƒå¤§Driverçš„å†…å­˜ã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.rdd.compress&lt;/code&gt; (default false) ï¼š&lt;/p&gt;

    &lt;p&gt;è¿™ä¸ªå‚æ•°åœ¨å†…å­˜åƒç´§çš„æ—¶å€™ï¼Œåˆéœ€è¦persistæ•°æ®æœ‰è‰¯å¥½çš„æ€§èƒ½ï¼Œå°±å¯ä»¥è®¾ç½®è¿™ä¸ªå‚æ•°ä¸ºtrueï¼Œè¿™æ ·åœ¨ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;persist(StorageLevel.MEMORY_ONLY_SER)&lt;/code&gt;çš„æ—¶å€™ï¼Œå°±èƒ½å¤Ÿå‹ç¼©å†…å­˜ä¸­çš„rddæ•°æ®ã€‚å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œå°±æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™ä¼šå ç”¨CPUçš„è§£å‹æ—¶é—´ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.serializer&lt;/code&gt; (default &lt;code class=&quot;highlighter-rouge&quot;&gt;org.apache.spark.serializer.JavaSerializer&lt;/code&gt; )&lt;/p&gt;

    &lt;p&gt;å»ºè®®è®¾ç½®ä¸º &lt;code class=&quot;highlighter-rouge&quot;&gt;org.apache.spark.serializer.KryoSerializer&lt;/code&gt;ï¼Œå› ä¸ºKryoSerializeræ¯”JavaSerializerå¿«ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šæœ‰äº›Objectä¼šåºåˆ—åŒ–å¤±è´¥ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æ˜¾ç¤ºçš„å¯¹åºåˆ—åŒ–å¤±è´¥çš„ç±»è¿›è¡ŒKryoSerializerçš„æ³¨å†Œï¼Œè¿™ä¸ªæ—¶å€™è¦é…ç½®spark.kryo.registratorå‚æ•°æˆ–è€…ä½¿ç”¨å‚ç…§å¦‚ä¸‹ä»£ç ï¼š&lt;/p&gt;

    &lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;valconf&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;newSparkConf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;setMaster&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(...).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;setAppName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(...)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;registerKryoClasses&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;classOf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;MyClass1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;classOf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;MyClass2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;valsc&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;newSparkContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.memory.storageFraction&lt;/code&gt; (default 0.5)&lt;/p&gt;

    &lt;p&gt;â€˜è¿™ä¸ªå‚æ•°è®¾ç½®å†…å­˜è¡¨ç¤º Executorå†…å­˜ä¸­ storage/(storage+execution)ï¼Œè™½ç„¶spark-1.6.0+çš„ç‰ˆæœ¬å†…å­˜storageå’Œexecutionçš„å†…å­˜å·²ç»æ˜¯å¯ä»¥äº’ç›¸å€Ÿç”¨çš„äº†ï¼Œä½†æ˜¯å€Ÿç”¨å’Œèµå›ä¹Ÿæ˜¯éœ€è¦æ¶ˆè€—æ€§èƒ½çš„ï¼Œæ‰€ä»¥å¦‚æœæ˜çŸ¥é“ç¨‹åºä¸­storageæ˜¯å¤šæ˜¯å°‘å°±å¯ä»¥è°ƒèŠ‚ä¸€ä¸‹è¿™ä¸ªå‚æ•°ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.locality.wait&lt;/code&gt; (default 3s)ï¼š&lt;/p&gt;

    &lt;p&gt;sparkä¸­æœ‰4ç§æœ¬åœ°åŒ–æ‰§è¡Œlevelï¼Œ
&lt;code class=&quot;highlighter-rouge&quot;&gt;PROCESS_LOCAL&lt;/code&gt;-&amp;gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;NODE_LOCAL&lt;/code&gt;-&amp;gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;RACK_LOCAL&lt;/code&gt;-&amp;gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ANY&lt;/code&gt;,
ä¸€ä¸ªtaskæ‰§è¡Œå®Œï¼Œç­‰å¾…spark.locality.waitæ—¶é—´å¦‚æœï¼Œç¬¬ä¸€æ¬¡ç­‰å¾…PROCESSçš„Taskåˆ°è¾¾ï¼Œå¦‚æœæ²¡æœ‰ï¼Œç­‰å¾…ä»»åŠ¡çš„ç­‰çº§ä¸‹è°ƒåˆ°NODEå†ç­‰å¾…spark.locality.waitæ—¶é—´ï¼Œä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°ANYã€‚åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯å¦èƒ½å¤Ÿå¾ˆå¥½çš„æ‰§è¡Œæœ¬åœ°æ–‡ä»¶å¯¹æ€§èƒ½çš„å½±å“ä¹Ÿæ˜¯å¾ˆå¤§çš„ã€‚å¦‚æœRDDçš„æ¯ä¸ªåˆ†åŒºæ•°æ®æ¯”è¾ƒå¤šï¼Œæ¯ä¸ªåˆ†åŒºå¤„ç†æ—¶é—´è¿‡é•¿ï¼Œå°±åº”è¯¥æŠŠ spark.locality.wait é€‚å½“è°ƒå¤§ä¸€ç‚¹ï¼Œè®©Taskèƒ½å¤Ÿæœ‰æ›´å¤šçš„æ—¶é—´ç­‰å¾…æœ¬åœ°æ•°æ®ã€‚ç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨persistæˆ–è€…cacheåï¼Œè¿™ä¸¤ä¸ªæ“ä½œè¿‡åï¼Œåœ¨æœ¬åœ°æœºå™¨è°ƒç”¨å†…å­˜ä¸­ä¿å­˜çš„æ•°æ®æ•ˆç‡ä¼šå¾ˆé«˜ï¼Œä½†æ˜¯å¦‚æœéœ€è¦è·¨æœºå™¨ä¼ è¾“å†…å­˜ä¸­çš„æ•°æ®ï¼Œæ•ˆç‡å°±ä¼šå¾ˆä½ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.speculation&lt;/code&gt; (default false):&lt;/p&gt;

    &lt;p&gt;ä¸€ä¸ªå¤§çš„é›†ç¾¤ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„æ€§èƒ½ä¼šæœ‰å·®å¼‚ï¼Œspark.speculationè¿™ä¸ªå‚æ•°è¡¨ç¤ºç©ºé—²çš„èµ„æºèŠ‚ç‚¹ä¼šä¸ä¼šå°è¯•æ‰§è¡Œè¿˜åœ¨è¿è¡Œï¼Œå¹¶ä¸”è¿è¡Œæ—¶é—´è¿‡é•¿çš„Taskï¼Œé¿å…å•ä¸ªèŠ‚ç‚¹è¿è¡Œé€Ÿåº¦è¿‡æ…¢å¯¼è‡´æ•´ä¸ªä»»åŠ¡å¡åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚è¿™ä¸ªå‚æ•°æœ€å¥½è®¾ç½®ä¸ºtrueã€‚ä¸ä¹‹ç›¸é…åˆå¯ä»¥ä¸€èµ·è®¾ç½®çš„å‚æ•°æœ‰&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.speculation.*&lt;/code&gt;å¼€å¤´çš„å‚æ•°ã€‚å‚è€ƒä¸­æœ‰æ–‡ç« è¯¦ç»†è¯´æ˜è¿™ä¸ªå‚æ•°ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;http://www.jianshu.com/p/c0181667daa0&lt;/li&gt;
  &lt;li&gt;http://www.csdn.net/article/2015-06-18/2824958&lt;/li&gt;
  &lt;li&gt;https://chenzhongpu.gitbooks.io/bigdatanotes/content/SparkSQLOptimizer/index.html&lt;/li&gt;
  &lt;li&gt;http://book.51cto.com/art/201409/453045.html&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/yhb315279058/article/details/51035631&lt;/p&gt;

</description>
        <pubDate>Sat, 10 Aug 2019 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2019/08/10/Spark-OOM%E9%97%AE%E9%A2%98%E7%90%86%E8%A7%A3%E4%B8%8E%E4%BC%98%E5%8C%96/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/08/10/Spark-OOM%E9%97%AE%E9%A2%98%E7%90%86%E8%A7%A3%E4%B8%8E%E4%BC%98%E5%8C%96/</guid>
        
        <category>Spark</category>
        
        <category>Programing</category>
        
        <category>BigData</category>
        
        
      </item>
    
      <item>
        <title>æ·±å…¥ç†è§£Spark Shuffle</title>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;

&lt;h2 id=&quot;shuffleå¸¦æ¥çš„é—®é¢˜&quot;&gt;Shuffleå¸¦æ¥çš„é—®é¢˜&lt;/h2&gt;

&lt;p&gt;åœ¨Sparkå¤§è§„æ¨¡æ•°æ®å¤„ç†ä¸­ï¼Œå› ä¸ºshuffleåå‡ºç°OOMé—®é¢˜éå¸¸å¸¸è§, æ·±å…¥ç†è§£shuffleå‰å…ˆä»å®é™…é—®é¢˜å‡ºå‘.&lt;/p&gt;

&lt;h3 id=&quot;æŠ¥é”™æç¤º&quot;&gt;æŠ¥é”™æç¤º&lt;/h3&gt;

&lt;h4 id=&quot;sparksql-shuffleæ“ä½œå¸¦æ¥çš„æŠ¥é”™&quot;&gt;SparkSQL shuffleæ“ä½œå¸¦æ¥çš„æŠ¥é”™&lt;/h4&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;org.apache.spark.shuffle.MetadataFetchFailedException: 
Missing an output location &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;shuffle 0
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;org.apache.spark.shuffle.FetchFailedException:
Failed to connect to &lt;span class=&quot;nb&quot;&gt;hostname&lt;/span&gt;/192.168.xx.xxx:50268
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;rddçš„shuffleæ“ä½œå¸¦æ¥çš„æŠ¥é”™&quot;&gt;RDDçš„shuffleæ“ä½œå¸¦æ¥çš„æŠ¥é”™&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;WARN TaskSetManager: Lost task 17.1 in stage 4.1 (TID 1386, spark050013): java.io.FileNotFoundException: /data04/spark/tmp/blockmgr-817d372f-c359-4a00-96dd-8f6554aa19cd/2f/temp_shuffle_e22e013a-5392-4edb-9874-a196a1dad97c (æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•)
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;FetchFailed(BlockManagerId(6083b277-119a-49e8-8a49-3539690a2a3f-S155, spark050013, 8533), shuffleId=1, mapId=143, reduceId=3, message=
org.apache.spark.shuffle.FetchFailedException: Error in opening FileSegmentManagedBuffer{file=/data04/spark/tmp/blockmgr-817d372f-c359-4a00-96dd-8f6554aa19cd/0e/shuffle_1_143_0.data, offset=997061, length=112503}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;åŸå› &quot;&gt;åŸå› &lt;/h3&gt;

&lt;p&gt;shuffleåˆ†ä¸º&lt;code class=&quot;highlighter-rouge&quot;&gt;shuffle write&lt;/code&gt;å’Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;shuffle read&lt;/code&gt;ä¸¤éƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;shuffle write&lt;/code&gt;çš„åˆ†åŒºæ•°ç”±ä¸Šä¸€é˜¶æ®µçš„RDDåˆ†åŒºæ•°æ§åˆ¶ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;shuffle read&lt;/code&gt;çš„åˆ†åŒºæ•°åˆ™æ˜¯ç”±Sparkæä¾›çš„ä¸€äº›å‚æ•°æ§åˆ¶ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;shuffle write&lt;/code&gt;å¯ä»¥ç®€å•ç†è§£ä¸ºç±»ä¼¼äº&lt;code class=&quot;highlighter-rouge&quot;&gt;saveAsLocalDiskFile&lt;/code&gt;çš„æ“ä½œï¼Œå°†è®¡ç®—çš„ä¸­é—´ç»“æœæŒ‰æŸç§è§„åˆ™ä¸´æ—¶æ”¾åˆ°å„ä¸ªexecutoræ‰€åœ¨çš„æœ¬åœ°ç£ç›˜ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;shuffle read&lt;/code&gt;çš„æ—¶å€™æ•°æ®çš„åˆ†åŒºæ•°åˆ™æ˜¯ç”±sparkæä¾›çš„ä¸€äº›å‚æ•°æ§åˆ¶ã€‚å¯ä»¥æƒ³åˆ°çš„æ˜¯ï¼Œå¦‚æœè¿™ä¸ªå‚æ•°å€¼è®¾ç½®çš„å¾ˆå°ï¼ŒåŒæ—¶&lt;code class=&quot;highlighter-rouge&quot;&gt;shuffle read&lt;/code&gt;çš„é‡å¾ˆå¤§ï¼Œé‚£ä¹ˆå°†ä¼šå¯¼è‡´ä¸€ä¸ªtaskéœ€è¦å¤„ç†çš„æ•°æ®éå¸¸å¤§ã€‚ç»“æœå¯¼è‡´&lt;code class=&quot;highlighter-rouge&quot;&gt;JVM crash&lt;/code&gt;ï¼Œä»è€Œå¯¼è‡´å–shuffleæ•°æ®å¤±è´¥ï¼ŒåŒæ—¶executorä¹Ÿä¸¢å¤±äº†ï¼Œçœ‹åˆ°&lt;code class=&quot;highlighter-rouge&quot;&gt;Failed to connect to host&lt;/code&gt;çš„é”™è¯¯ï¼Œä¹Ÿå°±æ˜¯executor lostçš„æ„æ€ã€‚æœ‰æ—¶å€™å³ä½¿ä¸ä¼šå¯¼è‡´&lt;code class=&quot;highlighter-rouge&quot;&gt;JVM crash&lt;/code&gt;ä¹Ÿä¼šé€ æˆé•¿æ—¶é—´çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;gc&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&quot;è§£å†³åŠæ³•&quot;&gt;è§£å†³åŠæ³•&lt;/h3&gt;

&lt;p&gt;çŸ¥é“åŸå› åé—®é¢˜å°±å¥½è§£å†³äº†ï¼Œä¸»è¦ä»shuffleçš„æ•°æ®é‡å’Œå¤„ç†shuffleæ•°æ®çš„åˆ†åŒºæ•°ä¸¤ä¸ªè§’åº¦å…¥æ‰‹ã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;å‡å°‘shuffleæ•°æ®&lt;/p&gt;

    &lt;p&gt;æ€è€ƒæ˜¯å¦å¯ä»¥ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;map side join&lt;/code&gt;æˆ–æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;broadcast join&lt;/code&gt;æ¥è§„é¿shuffleçš„äº§ç”Ÿã€‚&lt;/p&gt;

    &lt;p&gt;å°†ä¸å¿…è¦çš„æ•°æ®åœ¨shuffleå‰è¿›è¡Œè¿‡æ»¤ï¼Œæ¯”å¦‚åŸå§‹æ•°æ®æœ‰20ä¸ªå­—æ®µï¼Œåªè¦é€‰å–éœ€è¦çš„å­—æ®µè¿›è¡Œå¤„ç†å³å¯ï¼Œå°†ä¼šå‡å°‘ä¸€å®šçš„shuffleæ•°æ®ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;SparkSQLå’ŒDataFrameçš„&lt;code class=&quot;highlighter-rouge&quot;&gt;join&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;group by&lt;/code&gt;ç­‰æ“ä½œ&lt;/p&gt;

    &lt;p&gt;é€šè¿‡&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.sql.shuffle.partitions&lt;/code&gt;æ§åˆ¶åˆ†åŒºæ•°ï¼Œé»˜è®¤ä¸º200ï¼Œæ ¹æ®shuffleçš„é‡ä»¥åŠè®¡ç®—çš„å¤æ‚åº¦æé«˜è¿™ä¸ªå€¼ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rddçš„&lt;code class=&quot;highlighter-rouge&quot;&gt;join&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;groupBy&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;reduceByKey&lt;/code&gt;ç­‰æ“ä½œ&lt;/p&gt;

    &lt;p&gt;é€šè¿‡&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.default.parallelism&lt;/code&gt;æ§åˆ¶&lt;code class=&quot;highlighter-rouge&quot;&gt;shuffle read&lt;/code&gt;ä¸&lt;code class=&quot;highlighter-rouge&quot;&gt;reduce&lt;/code&gt;å¤„ç†çš„åˆ†åŒºæ•°ï¼Œé»˜è®¤ä¸ºè¿è¡Œä»»åŠ¡çš„coreçš„æ€»æ•°ï¼ˆmesosç»†ç²’åº¦æ¨¡å¼ä¸º8ä¸ªï¼Œlocalæ¨¡å¼ä¸ºæœ¬åœ°çš„coreæ€»æ•°ï¼‰ï¼Œå®˜æ–¹å»ºè®®ä¸ºè®¾ç½®æˆè¿è¡Œä»»åŠ¡çš„coreçš„2-3å€ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æé«˜executorçš„å†…å­˜&lt;/p&gt;

    &lt;p&gt;é€šè¿‡&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.executor.memory&lt;/code&gt;é€‚å½“æé«˜executorçš„memoryå€¼ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æ˜¯å¦å­˜åœ¨æ•°æ®å€¾æ–œçš„é—®é¢˜&lt;/p&gt;

    &lt;p&gt;ç©ºå€¼æ˜¯å¦å·²ç»è¿‡æ»¤ï¼Ÿå¼‚å¸¸æ•°æ®ï¼ˆæŸä¸ªkeyæ•°æ®ç‰¹åˆ«å¤§ï¼‰æ˜¯å¦å¯ä»¥å•ç‹¬å¤„ç†ï¼Ÿè€ƒè™‘æ”¹å˜æ•°æ®åˆ†åŒºè§„åˆ™ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/lsshlsw/article/details/51213610&lt;/p&gt;

&lt;h2 id=&quot;spark-shuffleçš„åŸºæœ¬åŸç†ä¸ç‰¹æ€§&quot;&gt;Spark Shuffleçš„åŸºæœ¬åŸç†ä¸ç‰¹æ€§&lt;/h2&gt;

&lt;p&gt;ä¸MapReduceè®¡ç®—æ¡†æ¶ä¸€æ ·ï¼ŒSparkçš„Shuffleå®ç°å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨DAGé˜¶æ®µä»¥shuffleä¸ºç•Œï¼Œåˆ’åˆ†stageï¼Œä¸Šæ¸¸stageåšmap taskï¼Œæ¯ä¸ªmap taskå°†è®¡ç®—ç»“æœæ•°æ®åˆ†æˆå¤šä»½ï¼Œæ¯ä¸€ä»½å¯¹åº”åˆ°ä¸‹æ¸¸stageçš„æ¯ä¸ªpartitionä¸­ï¼Œå¹¶å°†å…¶ä¸´æ—¶å†™åˆ°ç£ç›˜ï¼Œè¯¥è¿‡ç¨‹å«åšshuffle writeï¼›ä¸‹æ¸¸stageåšreduce taskï¼Œæ¯ä¸ªreduce taské€šè¿‡ç½‘ç»œæ‹‰å–ä¸Šæ¸¸stageä¸­æ‰€æœ‰map taskçš„æŒ‡å®šåˆ†åŒºç»“æœæ•°æ®ï¼Œè¯¥è¿‡ç¨‹å«åšshuffle readï¼Œæœ€åå®Œæˆreduceçš„ä¸šåŠ¡é€»è¾‘ã€‚ä¸¾ä¸ªæ —å­ï¼Œå‡å¦‚ä¸Šæ¸¸stageæœ‰100ä¸ªmap taskï¼Œä¸‹æ¸¸stageæœ‰1000ä¸ªreduce taskï¼Œé‚£ä¹ˆè¿™100ä¸ªmap taskä¸­æ¯ä¸ªmap taskéƒ½ä¼šå¾—åˆ°1000ä»½æ•°æ®ï¼Œè€Œ1000ä¸ªreduce taskä¸­çš„æ¯ä¸ªreduce taskéƒ½ä¼šæ‹‰å–ä¸Šæ¸¸100ä¸ªmap taskå¯¹åº”çš„é‚£ä»½æ•°æ®ï¼Œå³ç¬¬ä¸€ä¸ªreduce taskä¼šæ‹‰å–æ‰€æœ‰map taskç»“æœæ•°æ®çš„ç¬¬ä¸€ä»½ï¼Œä»¥æ­¤ç±»æ¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://sharkdtu.com/images/spark-shuffle-overview.png&quot;&gt;&lt;img src=&quot;http://sharkdtu.com/images/spark-shuffle-overview.png&quot; alt=&quot;spark-shuffle-overview&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;åœ¨mapé˜¶æ®µï¼Œé™¤äº†mapçš„ä¸šåŠ¡é€»è¾‘å¤–ï¼Œè¿˜æœ‰shuffle writeçš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°åºåˆ—åŒ–ã€ç£ç›˜IOç­‰è€—æ—¶æ“ä½œï¼›åœ¨reduceé˜¶æ®µï¼Œé™¤äº†reduceçš„ä¸šåŠ¡é€»è¾‘å¤–ï¼Œè¿˜æœ‰å‰é¢shuffle readè¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°ç½‘ç»œIOã€ååºåˆ—åŒ–ç­‰è€—æ—¶æ“ä½œã€‚æ‰€ä»¥æ•´ä¸ªshuffleè¿‡ç¨‹æ˜¯æå…¶æ˜‚è´µçš„ï¼Œsparkåœ¨shuffleçš„å®ç°ä¸Šä¹Ÿåšäº†å¾ˆå¤šä¼˜åŒ–æ”¹è¿›ï¼Œéšç€ç‰ˆæœ¬çš„è¿­ä»£å‘å¸ƒï¼Œspark shuffleçš„å®ç°ä¹Ÿé€æ­¥å¾—åˆ°æ”¹è¿›ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»spark shuffleçš„å®ç°æ¼”è¿›è¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;h2 id=&quot;spark-shuffleå®ç°æ¼”è¿›&quot;&gt;Spark Shuffleå®ç°æ¼”è¿›&lt;/h2&gt;

&lt;p&gt;Sparkåœ¨1.1ä»¥å‰çš„ç‰ˆæœ¬ä¸€ç›´æ˜¯é‡‡ç”¨Hash Shuffleçš„å®ç°çš„æ–¹å¼ï¼Œåˆ°1.1ç‰ˆæœ¬æ—¶å‚è€ƒHadoop MapReduceçš„å®ç°å¼€å§‹å¼•å…¥Sort Shuffleï¼Œåœ¨1.5ç‰ˆæœ¬æ—¶å¼€å§‹Tungstené’¨ä¸è®¡åˆ’ï¼Œå¼•å…¥UnSafe Shuffleä¼˜åŒ–å†…å­˜åŠCPUçš„ä½¿ç”¨ï¼Œåœ¨1.6ä¸­å°†Tungstenç»Ÿä¸€åˆ°Sort Shuffleä¸­ï¼Œå®ç°è‡ªæˆ‘æ„ŸçŸ¥é€‰æ‹©æœ€ä½³Shuffleæ–¹å¼ï¼Œåˆ°æœ€è¿‘çš„2.0ç‰ˆæœ¬ï¼ŒHash Shuffleå·²è¢«åˆ é™¤ï¼Œæ‰€æœ‰Shuffleæ–¹å¼å…¨éƒ¨ç»Ÿä¸€åˆ°Sort Shuffleä¸€ä¸ªå®ç°ä¸­ã€‚ä¸‹å›¾æ˜¯spark shuffleå®ç°çš„ä¸€ä¸ªç‰ˆæœ¬æ¼”è¿›ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://sharkdtu.com/images/spark-shuffle-evolution.png&quot;&gt;&lt;img src=&quot;http://sharkdtu.com/images/spark-shuffle-evolution.png&quot; alt=&quot;spark-shuffle-evolution&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;hash-shuffle-v1&quot;&gt;Hash Shuffle v1&lt;/h3&gt;

&lt;p&gt;åœ¨spark-1.1ç‰ˆæœ¬ä»¥å‰ï¼Œsparkå†…éƒ¨å®ç°çš„æ˜¯Hash Shuffleï¼Œå…¶å¤§è‡´åŸç†ä¸å‰é¢åŸºæœ¬åŸç†ä»‹ç»ä¸­æåˆ°çš„åŸºæœ¬ä¸€æ ·ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://sharkdtu.com/images/spark-shuffle-v1.png&quot;&gt;&lt;img src=&quot;http://sharkdtu.com/images/spark-shuffle-v1.png&quot; alt=&quot;spark-shuffle-v1&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;åœ¨mapé˜¶æ®µ(shuffle write)ï¼Œæ¯ä¸ªmapéƒ½ä¼šä¸ºä¸‹æ¸¸stageçš„æ¯ä¸ªpartitionå†™ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œå‡å¦‚ä¸‹æ¸¸stageæœ‰1000ä¸ªpartitionï¼Œé‚£ä¹ˆæ¯ä¸ªmapéƒ½ä¼šç”Ÿæˆ1000ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œä¸€èˆ¬æ¥è¯´ä¸€ä¸ªexecutorä¸Šä¼šè¿è¡Œå¤šä¸ªmap taskï¼Œè¿™æ ·ä¸‹æ¥ï¼Œä¸€ä¸ªexecutorä¸Šä¼šæœ‰éå¸¸å¤šçš„ä¸´æ—¶æ–‡ä»¶ï¼Œå‡å¦‚ä¸€ä¸ªexecutorä¸Šè¿è¡ŒMä¸ªmap taskï¼Œä¸‹æ¸¸stageæœ‰Nä¸ªpartitionï¼Œé‚£ä¹ˆä¸€ä¸ªexecutorä¸Šä¼šç”ŸæˆM&lt;em&gt;Nä¸ªæ–‡ä»¶ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä¸€ä¸ªexecutorä¸Šæœ‰Kä¸ªcoreï¼Œé‚£ä¹ˆexecutoråŒæ—¶å¯è¿è¡ŒKä¸ªtaskï¼Œè¿™æ ·ä¸€æ¥ï¼Œå°±ä¼šåŒæ—¶ç”³è¯·K&lt;/em&gt;Nä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä¸€æ—¦partitionæ•°è¾ƒå¤šï¼ŒåŠ¿å¿…ä¼šè€—å°½executorä¸Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼ŒåŒæ—¶ç”ŸæˆK*Nä¸ªwrite handlerä¹Ÿä¼šå¸¦æ¥å¤§é‡å†…å­˜çš„æ¶ˆè€—ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨reduceé˜¶æ®µ(shuffle read)ï¼Œæ¯ä¸ªreduce taskéƒ½ä¼šæ‹‰å–æ‰€æœ‰mapå¯¹åº”çš„é‚£éƒ¨åˆ†partitionæ•°æ®ï¼Œé‚£ä¹ˆexecutorä¼šæ‰“å¼€æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶å‡†å¤‡ç½‘ç»œä¼ è¾“ï¼Œè¿™é‡Œåˆæ¶‰åŠåˆ°å¤§é‡æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦å¤–ï¼Œå¦‚æœreduceé˜¶æ®µæœ‰combineræ“ä½œï¼Œé‚£ä¹ˆå®ƒä¼šæŠŠç½‘ç»œä¸­æ‹‰åˆ°çš„æ•°æ®ä¿å­˜åœ¨ä¸€ä¸ª&lt;code class=&quot;highlighter-rouge&quot;&gt;HashMap&lt;/code&gt;ä¸­è¿›è¡Œåˆå¹¶æ“ä½œï¼Œå¦‚æœæ•°æ®é‡è¾ƒå¤§ï¼Œå¾ˆå®¹æ˜“å¼•å‘OOMæ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;ç»¼ä¸Šæ‰€è¿°ï¼ŒHash Shuffleå®ç°ç®€å•ä½†æ˜¯ç‰¹åˆ«naiveï¼Œåœ¨å°æ•°æ®é‡ä¸‹è¿è¡Œæ¯”è¾ƒå¿«ï¼Œä¸€æ—¦æ•°æ®é‡è¾ƒå¤§ï¼ŒåŸºæœ¬å°±å®äº†ã€‚å½“ç„¶è¿™ä¸ªç‰ˆæœ¬çš„shuffleä¹Ÿæ˜¯åœ¨sparkæ—©æœŸç‰ˆæœ¬ä¸­ï¼Œéšç€ç‰ˆæœ¬è¿­ä»£çš„è¿›è¡Œï¼Œshuffleçš„å®ç°ä¹Ÿè¶Šæ¥è¶Šæˆç†Ÿã€‚&lt;/p&gt;

&lt;h3 id=&quot;hash-shuffle-v2&quot;&gt;Hash Shuffle v2&lt;/h3&gt;

&lt;p&gt;åœ¨ä¸Šä¸€èŠ‚è®²åˆ°æ¯ä¸ªmap taskéƒ½è¦ç”ŸæˆNä¸ªpartitionæ–‡ä»¶ï¼Œä¸ºäº†å‡å°‘æ–‡ä»¶æ•°ï¼Œåé¢å¼•è¿›äº†ï¼Œç›®çš„æ˜¯å‡å°‘å•ä¸ªexecutorä¸Šçš„æ–‡ä»¶æ•°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸€ä¸ªexecutorä¸Šæ‰€æœ‰çš„map taskç”Ÿæˆçš„åˆ†åŒºæ–‡ä»¶åªæœ‰ä¸€ä»½ï¼Œå³å°†æ‰€æœ‰çš„map taskç›¸åŒçš„åˆ†åŒºæ–‡ä»¶åˆå¹¶ï¼Œè¿™æ ·æ¯ä¸ªexecutorä¸Šæœ€å¤šåªç”ŸæˆNä¸ªåˆ†åŒºæ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://sharkdtu.com/images/spark-shuffle-v2.png&quot;&gt;&lt;img src=&quot;http://sharkdtu.com/images/spark-shuffle-v2.png&quot; alt=&quot;spark-shuffle-v2&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è¡¨é¢ä¸Šçœ‹æ˜¯å‡å°‘äº†æ–‡ä»¶æ•°ï¼Œä½†æ˜¯å‡å¦‚ä¸‹æ¸¸stageçš„åˆ†åŒºæ•°Nå¾ˆå¤§ï¼Œè¿˜æ˜¯ä¼šåœ¨æ¯ä¸ªexecutorä¸Šç”ŸæˆNä¸ªæ–‡ä»¶ï¼ŒåŒæ ·ï¼Œå¦‚æœä¸€ä¸ªexecutorä¸Šæœ‰Kä¸ªcoreï¼Œè¿˜æ˜¯ä¼šå¼€K*Nä¸ªwriter handlerï¼Œæ€»ä½“ä¸Šæ¥è¯´åŸºæœ¬æ²¡å¤ªè§£å†³é—®é¢˜ã€‚å¯¹äºshuffle readé˜¶æ®µè·Ÿv1ç‰ˆä¸€æ ·æ²¡æ”¹è¿›ï¼Œä»ç„¶å®¹æ˜“å¯¼è‡´OOMã€‚&lt;/p&gt;

&lt;h3 id=&quot;sort-shuffle-v1&quot;&gt;Sort Shuffle v1&lt;/h3&gt;

&lt;p&gt;é’ˆå¯¹ä¸Šè¿°Hash Shuffleçš„å¼Šç«¯ï¼Œåœ¨spark 1.1.0ç‰ˆæœ¬ä¸­å¼•å…¥Sort Shuffleï¼Œå®ƒå‚è€ƒäº†Hadoop MapReduceä¸­çš„shuffleå®ç°ï¼Œå¯¹è®°å½•è¿›è¡Œæ’åºæ¥åšshuffleï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://sharkdtu.com/images/spark-shuffle-v3.png&quot;&gt;&lt;img src=&quot;http://sharkdtu.com/images/spark-shuffle-v3.png&quot; alt=&quot;spark-shuffle-v3&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;åœ¨mapé˜¶æ®µ(shuffle write)ï¼Œä¼šæŒ‰ç…§partition idä»¥åŠkeyå¯¹è®°å½•è¿›è¡Œæ’åºï¼Œå°†æ‰€æœ‰partitionçš„æ•°æ®å†™åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶ä¸­çš„è®°å½•é¦–å…ˆæ˜¯æŒ‰ç…§partition idæ’åºä¸€ä¸ªä¸€ä¸ªåˆ†åŒºçš„é¡ºåºæ’åˆ—ï¼Œæ¯ä¸ªpartitionå†…éƒ¨æ˜¯æŒ‰ç…§keyè¿›è¡Œæ’åºå­˜æ”¾ï¼Œmap taskè¿è¡ŒæœŸé—´ä¼šé¡ºåºå†™æ¯ä¸ªpartitionçš„æ•°æ®ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªç´¢å¼•æ–‡ä»¶è®°å½•æ¯ä¸ªpartitionçš„å¤§å°å’Œåç§»é‡ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ªmap taskä¸€æ¬¡åªå¼€ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä¸€ä¸ªå†™æ•°æ®ï¼Œä¸€ä¸ªå†™ç´¢å¼•ï¼Œå¤§å¤§å‡è½»äº†Hash Shuffleå¤§é‡æ–‡ä»¶æè¿°ç¬¦çš„é—®é¢˜ï¼Œå³ä½¿ä¸€ä¸ªexecutoræœ‰Kä¸ªcoreï¼Œé‚£ä¹ˆæœ€å¤šä¸€æ¬¡æ€§å¼€K*2ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨reduceé˜¶æ®µ(shuffle read)ï¼Œreduce taskæ‹‰å–æ•°æ®åšcombineæ—¶ä¸å†æ˜¯é‡‡ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;HashMap&lt;/code&gt;ï¼Œè€Œæ˜¯é‡‡ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;ExternalAppendOnlyMap&lt;/code&gt;ï¼Œè¯¥æ•°æ®ç»“æ„åœ¨åšcombineæ—¶ï¼Œå¦‚æœå†…å­˜ä¸è¶³ï¼Œä¼šåˆ·å†™ç£ç›˜ï¼Œå¾ˆå¤§ç¨‹åº¦çš„ä¿è¯äº†é²æ£’æ€§ï¼Œé¿å…å¤§æ•°æ®æƒ…å†µä¸‹çš„OOMã€‚&lt;/p&gt;

&lt;p&gt;æ€»ä½“ä¸Šçœ‹æ¥Sort Shuffleè§£å†³äº†Hash Shuffleçš„æ‰€æœ‰å¼Šç«¯ï¼Œä½†æ˜¯å› ä¸ºéœ€è¦å…¶shuffleè¿‡ç¨‹éœ€è¦å¯¹è®°å½•è¿›è¡Œæ’åºï¼Œæ‰€ä»¥åœ¨æ€§èƒ½ä¸Šæœ‰æ‰€æŸå¤±ã€‚&lt;/p&gt;

&lt;h3 id=&quot;unsafe-shuffle&quot;&gt;Unsafe Shuffle&lt;/h3&gt;

&lt;p&gt;ä»spark 1.5.0å¼€å§‹ï¼Œsparkå¼€å§‹äº†é’¨ä¸è®¡åˆ’(Tungsten)ï¼Œç›®çš„æ˜¯ä¼˜åŒ–å†…å­˜å’ŒCPUçš„ä½¿ç”¨ï¼Œè¿›ä¸€æ­¥æå‡sparkçš„æ€§èƒ½ã€‚ä¸ºæ­¤ï¼Œå¼•å…¥Unsafe Shuffleï¼Œå®ƒçš„åšæ³•æ˜¯å°†æ•°æ®è®°å½•ç”¨äºŒè¿›åˆ¶çš„æ–¹å¼å­˜å‚¨ï¼Œç›´æ¥åœ¨åºåˆ—åŒ–çš„äºŒè¿›åˆ¶æ•°æ®ä¸Šsortè€Œä¸æ˜¯åœ¨java å¯¹è±¡ä¸Šï¼Œè¿™æ ·ä¸€æ–¹é¢å¯ä»¥å‡å°‘memoryçš„ä½¿ç”¨å’ŒGCçš„å¼€é”€ï¼Œå¦ä¸€æ–¹é¢é¿å…shuffleè¿‡ç¨‹ä¸­é¢‘ç¹çš„åºåˆ—åŒ–ä»¥åŠååºåˆ—åŒ–ã€‚åœ¨æ’åºè¿‡ç¨‹ä¸­ï¼Œå®ƒæä¾›cache-efficient sorterï¼Œä½¿ç”¨ä¸€ä¸ª8 bytesçš„æŒ‡é’ˆï¼ŒæŠŠæ’åºè½¬åŒ–æˆäº†ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„çš„æ’åºï¼Œæå¤§çš„ä¼˜åŒ–äº†æ’åºæ€§èƒ½ã€‚æ›´å¤šTungstenè¯¦ç»†ä»‹ç»è¯·ç§»æ­¥&lt;a href=&quot;https://databricks.com/blog/2015/04/28/project-tungsten-bringing-spark-closer-to-bare-metal.html&quot;&gt;databricksåšå®¢&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯ä½¿ç”¨Unsafe Shuffleæœ‰å‡ ä¸ªé™åˆ¶ï¼Œshuffleé˜¶æ®µä¸èƒ½æœ‰aggregateæ“ä½œï¼Œåˆ†åŒºæ•°ä¸èƒ½è¶…è¿‡ä¸€å®šå¤§å°(224âˆ’1224âˆ’1ï¼Œè¿™æ˜¯å¯ç¼–ç çš„æœ€å¤§parition id)ï¼Œæ‰€ä»¥åƒreduceByKeyè¿™ç±»æœ‰aggregateæ“ä½œçš„ç®—å­æ˜¯ä¸èƒ½ä½¿ç”¨Unsafe Shuffleï¼Œå®ƒä¼šé€€åŒ–é‡‡ç”¨Sort Shuffleã€‚&lt;/p&gt;

&lt;h3 id=&quot;sort-shuffle-v2&quot;&gt;Sort Shuffle v2&lt;/h3&gt;

&lt;p&gt;ä»spark-1.6.0å¼€å§‹ï¼ŒæŠŠSort Shuffleå’ŒUnsafe Shuffleå…¨éƒ¨ç»Ÿä¸€åˆ°Sort Shuffleä¸­ï¼Œå¦‚æœæ£€æµ‹åˆ°æ»¡è¶³Unsafe Shuffleæ¡ä»¶ä¼šè‡ªåŠ¨é‡‡ç”¨Unsafe Shuffleï¼Œå¦åˆ™é‡‡ç”¨Sort Shuffleã€‚ä»spark-2.0.0å¼€å§‹ï¼ŒsparkæŠŠHash Shuffleç§»é™¤ï¼Œå¯ä»¥è¯´ç›®å‰spark-2.0ä¸­åªæœ‰ä¸€ç§Shuffleï¼Œå³ä¸ºSort Shuffleã€‚&lt;/p&gt;

&lt;h2 id=&quot;spark-shuffleç›¸å…³è°ƒä¼˜&quot;&gt;Spark Shuffleç›¸å…³è°ƒä¼˜&lt;/h2&gt;

&lt;p&gt;ä»ä¸Šè¿°shuffleçš„åŸç†ä»‹ç»å¯ä»¥çŸ¥é“ï¼Œshuffleæ˜¯ä¸€ä¸ªæ¶‰åŠåˆ°CPU(åºåˆ—åŒ–ååºåˆ—åŒ–)ã€ç½‘ç»œIO(è·¨èŠ‚ç‚¹æ•°æ®ä¼ è¾“)ä»¥åŠç£ç›˜IO(shuffleä¸­é—´ç»“æœè½åœ°)çš„æ“ä½œï¼Œç”¨æˆ·åœ¨ç¼–å†™sparkåº”ç”¨ç¨‹åºçš„æ—¶å€™åº”å½“å°½å¯èƒ½è€ƒè™‘shuffleç›¸å…³çš„ä¼˜åŒ–ï¼Œæå‡sparkåº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚ä¸‹é¢ç®€å•åˆ—ä¸¾å‡ ç‚¹å…³äºspark shuffleè°ƒä¼˜çš„å‚è€ƒã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å°½é‡å‡å°‘shuffleæ¬¡æ•°&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c1&quot;&gt;// ä¸¤æ¬¡shuffle
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(...).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;repartition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;reduceByKey&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3000&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// ä¸€æ¬¡shuffle
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(...).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;repartition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3000&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;reduceByKey&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;å¿…è¦æ—¶ä¸»åŠ¨shuffleï¼Œé€šå¸¸ç”¨äºæ”¹å˜å¹¶è¡Œåº¦ï¼Œæé«˜åç»­åˆ†å¸ƒå¼è¿è¡Œé€Ÿåº¦&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;repartiton&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;largerNumPartition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(...)...&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;ä½¿ç”¨treeReduce &amp;amp; treeAggregateæ›¿æ¢reduce &amp;amp; aggregateã€‚æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œreduce &amp;amp; aggregateä¸€æ¬¡æ€§èšåˆï¼Œshuffleé‡å¤ªå¤§ï¼Œè€ŒtreeReduce &amp;amp; treeAggregateæ˜¯åˆ†æ‰¹èšåˆï¼Œæ›´ä¸ºä¿é™©ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;ä»€ä¹ˆæ—¶å€™éœ€è¦-shuffle-writer&quot;&gt;ä»€ä¹ˆæ—¶å€™éœ€è¦ shuffle writer&lt;/h3&gt;

&lt;p&gt;å‡å¦‚æˆ‘ä»¬æœ‰ä¸ª spark job ä¾èµ–å…³ç³»å¦‚ä¸‹&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oe9nbfytu.qnssl.com/c/75fd68334b09d27077b70388fa5a9e7b&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬æŠ½è±¡å‡ºæ¥å…¶ä¸­çš„rddå’Œä¾èµ–å…³ç³»ï¼Œå¦‚æœå¯¹è¿™å—ä¸å¤ªæ¸…æ¥šçš„å¯ä»¥å‚è€ƒæˆ‘ä»¬ä¹‹å‰çš„ &lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzI3MjY2MTYzMA==&amp;amp;mid=2247483846&amp;amp;idx=1&amp;amp;sn=ad5c6cb542d67e453972795743022298&amp;amp;scene=21#wechat_redirect&quot;&gt;å½»åº•ææ‡‚spark stage åˆ’åˆ†&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯¹åº”çš„ åˆ’åˆ†åçš„RDDç»“æ„ä¸ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oe9nbfytu.qnssl.com/c/bfa9fb7e1c09bff43c86a729ca2b2622&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æœ€ç»ˆæˆ‘ä»¬å¾—åˆ°äº†æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oe9nbfytu.qnssl.com/c/a6131c4afa406e5b06b930cdea92fcf4&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸­é—´å°±æ¶‰åŠåˆ°shuffle è¿‡ç¨‹ï¼Œå‰ä¸€ä¸ªstage çš„ ShuffleMapTask è¿›è¡Œ shuffle writeï¼Œ æŠŠæ•°æ®å­˜å‚¨åœ¨ blockManager ä¸Šé¢ï¼Œ å¹¶ä¸”æŠŠæ•°æ®ä½ç½®å…ƒä¿¡æ¯ä¸ŠæŠ¥åˆ° driver çš„ mapOutTrack ç»„ä»¶ä¸­ï¼Œ ä¸‹ä¸€ä¸ª stage æ ¹æ®æ•°æ®ä½ç½®å…ƒä¿¡æ¯ï¼Œ è¿›è¡Œ shuffle readï¼Œ æ‹‰å–ä¸Šä¸ªstage çš„è¾“å‡ºæ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;è¿™è¾¹æ–‡ç« è®²è¿°çš„å°±æ˜¯å…¶ä¸­çš„ shuffle write è¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;h3 id=&quot;spark-shuffle-æ¼”è¿›çš„å†å²&quot;&gt;spark shuffle æ¼”è¿›çš„å†å²&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Spark 0.8åŠä»¥å‰ Hash Based Shuffle&lt;/li&gt;
  &lt;li&gt;Spark 0.8.1 ä¸ºHash Based Shuffleå¼•å…¥File Consolidationæœºåˆ¶&lt;/li&gt;
  &lt;li&gt;Spark 0.9 å¼•å…¥ExternalAppendOnlyMap&lt;/li&gt;
  &lt;li&gt;Spark 1.1 å¼•å…¥Sort Based Shuffleï¼Œä½†é»˜è®¤ä»ä¸ºHash Based Shuffle&lt;/li&gt;
  &lt;li&gt;Spark 1.2 é»˜è®¤çš„Shuffleæ–¹å¼æ”¹ä¸ºSort Based Shuffle&lt;/li&gt;
  &lt;li&gt;Spark 1.4 å¼•å…¥Tungsten-Sort Based Shuffle&lt;/li&gt;
  &lt;li&gt;Spark 1.6 Tungsten-sortå¹¶å…¥Sort Based Shuffle&lt;/li&gt;
  &lt;li&gt;Spark 2.0 Hash Based Shuffleé€€å‡ºå†å²èˆå°&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ€»ç»“ä¸€ä¸‹ï¼Œ å°±æ˜¯æœ€å¼€å§‹çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ Hash Based Shuffleï¼Œ è¿™æ—¶å€™æ¯ä¸€ä¸ªMapperä¼šæ ¹æ®Reducerçš„æ•°é‡åˆ›å»ºå‡ºç›¸åº”çš„bucketï¼Œbucketçš„æ•°é‡æ˜¯M &lt;em&gt;R ï¼Œå…¶ä¸­Mæ˜¯Mapçš„ä¸ªæ•°ï¼ŒRæ˜¯Reduceçš„ä¸ªæ•°ã€‚è¿™æ ·ä¼šäº§ç”Ÿå¤§é‡çš„å°æ–‡ä»¶ï¼Œå¯¹æ–‡ä»¶ç³»ç»Ÿå‹åŠ›å¾ˆå¤§ï¼Œè€Œä¸”ä¹Ÿä¸åˆ©äºIOååé‡ã€‚åé¢å¿ä¸äº†äº†å°±åšäº†ä¼˜åŒ–ï¼ŒæŠŠåœ¨ç»Ÿä¸€coreä¸Šè¿è¡Œçš„å¤šä¸ªMapper è¾“å‡ºçš„åˆå¹¶åˆ°åŒä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™æ ·æ–‡ä»¶æ•°ç›®å°±å˜æˆäº† cores&lt;/em&gt; R ä¸ªäº†ï¼Œ&lt;/p&gt;

&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼š&lt;/p&gt;

&lt;p&gt;æœ¬æ¥æ˜¯è¿™æ ·çš„ï¼Œ3ä¸ª map taskï¼Œ 3ä¸ª reducerï¼Œ ä¼šäº§ç”Ÿ 9ä¸ªå°æ–‡ä»¶ï¼Œ&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oe9nbfytu.qnssl.com/c/2a9cddc8267eaf96e3d51822e75fe0b2&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ˜¯ä¸æ˜¯å¾ˆææ€–ï¼Œ åé¢æ”¹é€ ä¹‹å&lt;/p&gt;

&lt;p&gt;4ä¸ªmap taskï¼Œ 4ä¸ªreducerï¼Œ å¦‚æœä¸ä½¿ç”¨ Consolidationæœºåˆ¶ï¼Œ ä¼šäº§ç”Ÿ 16ä¸ªå°æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯ä½†æ˜¯ç°åœ¨è¿™ 4ä¸ª map task åˆ†ä¸¤æ‰¹è¿è¡Œåœ¨ 2ä¸ªcoreä¸Šï¼Œ è¿™æ ·åªä¼šäº§ç”Ÿ 8ä¸ªå°æ–‡ä»¶&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oe9nbfytu.qnssl.com/c/8a4d042d1c8a031a5091521c2c76d262&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨åŒä¸€ä¸ª core ä¸Šå…ˆåè¿è¡Œçš„ä¸¤ä¸ª map taskçš„è¾“å‡ºï¼Œ å¯¹åº”åŒä¸€ä¸ªæ–‡ä»¶çš„ä¸åŒçš„ segmentä¸Šï¼Œ ç§°ä¸ºä¸€ä¸ª FileSegmentï¼Œ å½¢æˆä¸€ä¸ª ShuffleBlockFileï¼Œ&lt;/p&gt;

&lt;p&gt;åé¢å°±å¼•å…¥äº†  Sort Based Shuffleï¼Œ mapç«¯çš„ä»»åŠ¡ä¼šæŒ‰ç…§Partition idä»¥åŠkeyå¯¹è®°å½•è¿›è¡Œæ’åºã€‚åŒæ—¶å°†å…¨éƒ¨ç»“æœå†™åˆ°ä¸€ä¸ªæ•°æ®æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶ç”Ÿæˆä¸€ä¸ªç´¢å¼•æ–‡ä»¶ï¼Œ å†åé¢å°±å°±å¼•å…¥äº† Tungsten-Sort Based Shuffleï¼Œ è¿™ä¸ªæ˜¯ç›´æ¥ä½¿ç”¨å †å¤–å†…å­˜å’Œæ–°çš„å†…å­˜ç®¡ç†æ¨¡å‹ï¼ŒèŠ‚çœäº†å†…å­˜ç©ºé—´å’Œå¤§é‡çš„gcï¼Œ æ˜¯ä¸ºäº†æå‡æ€§èƒ½ã€‚&lt;/p&gt;

&lt;p&gt;ç°åœ¨2.1 åˆ†ä¸ºä¸‰ç§writerï¼Œ åˆ†ä¸º BypassMergeSortShuffleWriterï¼Œ SortShuffleWriter å’Œ UnsafeShuffleWriterï¼Œé¡¾åæ€ä¹‰ï¼Œå¤§å®¶åº”è¯¥å¯ä»¥å¯¹åº”ä¸Šï¼Œæˆ‘ä»¬æœ¬ç€è¿‡æ—¶ä¸è®²çš„åŸåˆ™ï¼Œ æœ¬æ–‡ä¸­åªæè¿°è¿™ä¸‰ç§ writer çš„å®ç°ç»†èŠ‚ï¼Œ Hash Based Shuffle å·²ç»é€€å‡ºå†å²èˆå°äº†ï¼Œæˆ‘å°±ä¸è®²äº†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ä¸‰ç§-writer-çš„åˆ†ç±»&quot;&gt;ä¸‰ç§ writer çš„åˆ†ç±»&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;https://oe9nbfytu.qnssl.com/c/8c6f0cae9d50f699cb3a39f4060ea2fe&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸Šé¢æ˜¯ä½¿ç”¨å“ªç§ writer çš„åˆ¤æ–­ä¾æ®ï¼Œ æ˜¯å¦å¼€å¯ mapSideCombine è¿™ä¸ªåˆ¤æ–­ï¼Œæ˜¯å› ä¸ºæœ‰äº›ç®—å­ä¼šåœ¨ map ç«¯å…ˆè¿›è¡Œä¸€æ¬¡ combineï¼Œ å‡å°‘ä¼ è¾“æ•°æ®ã€‚ å› ä¸º BypassMergeSortShuffleWriter ä¼šä¸´æ—¶è¾“å‡ºReducerä¸ªï¼ˆåˆ†åŒºæ•°ç›®ï¼‰å°æ–‡ä»¶ï¼Œæ‰€ä»¥åˆ†åŒºæ•°å¿…é¡»è¦å°äºä¸€ä¸ªé˜€å€¼ï¼Œé»˜è®¤æ˜¯å°äº200ã€‚&lt;/p&gt;

&lt;p&gt;UnsafeShuffleWriteréœ€è¦Serializeræ”¯æŒrelocationï¼ŒSerializeræ”¯æŒrelocationï¼šåŸå§‹æ•°æ®é¦–å…ˆè¢«åºåˆ—åŒ–å¤„ç†ï¼Œå¹¶ä¸”å†ä¹Ÿä¸éœ€è¦ååºåˆ—ï¼Œåœ¨å…¶å¯¹åº”çš„å…ƒæ•°æ®è¢«æ’åºåï¼Œéœ€è¦Serializeræ”¯æŒrelocationï¼Œåœ¨æŒ‡å®šä½ç½®è¯»å–å¯¹åº”æ•°æ®ã€‚&lt;/p&gt;

&lt;h3 id=&quot;bypassmergesortshufflewriter-å®ç°ç»†èŠ‚&quot;&gt;BypassMergeSortShuffleWriter å®ç°ç»†èŠ‚&lt;/h3&gt;

&lt;p&gt;BypassMergeSortShuffleWriterå’ŒHash Shuffleä¸­çš„HashShuffleWriterå®ç°åŸºæœ¬ä¸€è‡´ï¼Œ å”¯ä¸€çš„åŒºåˆ«åœ¨äºï¼Œmapç«¯çš„å¤šä¸ªè¾“å‡ºæ–‡ä»¶ä¼šè¢«æ±‡æ€»ä¸ºä¸€ä¸ªæ–‡ä»¶ã€‚ æ‰€æœ‰åˆ†åŒºçš„æ•°æ®ä¼šåˆå¹¶ä¸ºåŒä¸€ä¸ªæ–‡ä»¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªç´¢å¼•æ–‡ä»¶ï¼Œæ˜¯ä¸ºäº†ç´¢å¼•åˆ°æ¯ä¸ªåˆ†åŒºçš„èµ·å§‹åœ°å€ï¼Œå¯ä»¥éšæœº access æŸä¸ªpartitionçš„æ‰€æœ‰æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oe9nbfytu.qnssl.com/c/c695dc3a759a5133c38adbd989a03d8d&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æ–¹å¼ä¸å®œæœ‰å¤ªå¤šåˆ†åŒºï¼Œå› ä¸ºè¿‡ç¨‹ä¸­ä¼šå¹¶å‘æ‰“å¼€æ‰€æœ‰åˆ†åŒºå¯¹åº”çš„ä¸´æ—¶æ–‡ä»¶ï¼Œä¼šå¯¹æ–‡ä»¶ç³»ç»Ÿé€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚&lt;/p&gt;

&lt;p&gt;å…·ä½“å®ç°å°±æ˜¯ç»™æ¯ä¸ªåˆ†åŒºåˆ†é…ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œå¯¹æ¯ä¸ª recordçš„key ä½¿ç”¨åˆ†åŒºå™¨ï¼ˆæ¨¡å¼æ˜¯hashï¼Œå¦‚æœç”¨æˆ·è‡ªå®šä¹‰å°±ä½¿ç”¨è‡ªå®šä¹‰çš„åˆ†åŒºå™¨ï¼‰æ‰¾åˆ°å¯¹åº”åˆ†åŒºçš„è¾“å‡ºæ–‡ä»¶å¥æŸ„ï¼Œç›´æ¥å†™å…¥æ–‡ä»¶ï¼Œæ²¡æœ‰åœ¨å†…å­˜ä¸­ä½¿ç”¨ bufferã€‚ æœ€åcopyStreamæ–¹æ³•æŠŠæ‰€æœ‰çš„ä¸´æ—¶åˆ†åŒºæ–‡ä»¶æ‹·è´åˆ°æœ€ç»ˆçš„è¾“å‡ºæ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”è®°å½•æ¯ä¸ªåˆ†åŒºçš„æ–‡ä»¶èµ·å§‹å†™å…¥ä½ç½®ï¼ŒæŠŠè¿™äº›ä½ç½®æ•°æ®å†™å…¥ç´¢å¼•æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;

&lt;h3 id=&quot;sortshufflewriter-å®ç°ç»†èŠ‚&quot;&gt;SortShuffleWriter å®ç°ç»†èŠ‚&lt;/h3&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥å…ˆè€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œå‡å¦‚æˆ‘æœ‰ 100äº¿æ¡æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬çš„å†…å­˜åªæœ‰1Mï¼Œä½†æ˜¯æˆ‘ä»¬ç£ç›˜å¾ˆå¤§ï¼Œ æˆ‘ä»¬ç°åœ¨è¦å¯¹è¿™100äº¿æ¡æ•°æ®è¿›è¡Œæ’åºï¼Œæ˜¯æ²¡æ³•æŠŠæ‰€æœ‰çš„æ•°æ®ä¸€æ¬¡æ€§çš„loadè¿›è¡Œå†…å­˜è¿›è¡Œæ’åºçš„ï¼Œè¿™å°±æ¶‰åŠåˆ°ä¸€ä¸ªå¤–éƒ¨æ’åºçš„é—®é¢˜ï¼Œæˆ‘ä»¬çš„1Må†…å­˜åªèƒ½è£…è¿›1äº¿æ¡æ•°æ®ï¼Œæ¯æ¬¡éƒ½åªèƒ½å¯¹è¿™ 1äº¿æ¡æ•°æ®è¿›è¡Œæ’åºï¼Œæ’å¥½åºåè¾“å‡ºåˆ°ç£ç›˜ï¼Œæ€»å…±è¾“å‡º100ä¸ªæ–‡ä»¶ï¼Œæœ€åæ€ä¹ˆæŠŠè¿™100ä¸ªæ–‡ä»¶è¿›è¡Œmergeæˆä¸€ä¸ªå…¨å±€æœ‰åºçš„å¤§æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥æ¯ä¸ªæ–‡ä»¶ï¼ˆæœ‰åºçš„ï¼‰éƒ½å–ä¸€éƒ¨åˆ†å¤´éƒ¨æ•°æ®æœ€ä¸ºä¸€ä¸ª bufferï¼Œ å¹¶ä¸”æŠŠè¿™ 100ä¸ª bufferæ”¾åœ¨ä¸€ä¸ªå †é‡Œé¢ï¼Œè¿›è¡Œå †æ’åºï¼Œæ¯”è¾ƒæ–¹å¼å°±æ˜¯å¯¹æ‰€æœ‰å †å…ƒç´ ï¼ˆbufferï¼‰çš„headå…ƒç´ è¿›è¡Œæ¯”è¾ƒå¤§å°ï¼Œ ç„¶åä¸æ–­çš„æŠŠæ¯ä¸ªå †é¡¶çš„ buffer çš„head å…ƒç´  pop å‡ºæ¥è¾“å‡ºåˆ°æœ€ç»ˆæ–‡ä»¶ä¸­ï¼Œ ç„¶åç»§ç»­å †æ’åºï¼Œç»§ç»­è¾“å‡ºã€‚å¦‚æœå“ªä¸ªbuffer ç©ºäº†ï¼Œå°±å»å¯¹åº”çš„æ–‡ä»¶ä¸­ç»§ç»­è¡¥å……ä¸€éƒ¨åˆ†æ•°æ®ã€‚æœ€ç»ˆå°±å¾—åˆ°ä¸€ä¸ªå…¨å±€æœ‰åºçš„å¤§æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ èƒ½æƒ³é€šæˆ‘ä¸Šé¢ä¸¾çš„ä¾‹å­ï¼Œå°±å·®ä¸å¤šææ¸…æ¥šsortshufflewirterçš„å®ç°åŸç†äº†ï¼Œå› ä¸ºè§£å†³çš„æ˜¯åŒä¸€ä¸ªé—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;SortShuffleWriter ä¸­çš„å¤„ç†æ­¥éª¤å°±æ˜¯&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä½¿ç”¨ PartitionedAppendOnlyMap æˆ–è€… PartitionedPairBuffer åœ¨å†…å­˜ä¸­è¿›è¡Œæ’åºï¼Œ  æ’åºçš„ K æ˜¯ï¼ˆpartitionIdï¼Œ hashï¼ˆkeyï¼‰ï¼‰ è¿™æ ·ä¸€ä¸ªå…ƒç»„ã€‚&lt;/li&gt;
  &lt;li&gt;å¦‚æœè¶…è¿‡å†…å­˜ limitï¼Œ æˆ‘ spill åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­å…ƒç´ ä¹Ÿæ˜¯æœ‰åºçš„ï¼Œé¦–å…ˆæ˜¯æŒ‰ç…§ partitionIdçš„æ’åºï¼Œå¦‚æœ partitionId ç›¸åŒï¼Œ å†æ ¹æ® hashï¼ˆkeyï¼‰è¿›è¡Œæ¯”è¾ƒæ’åº&lt;/li&gt;
  &lt;li&gt;å¦‚æœéœ€è¦è¾“å‡ºå…¨å±€æœ‰åºçš„æ–‡ä»¶çš„æ—¶å€™ï¼Œå°±éœ€è¦å¯¹ä¹‹å‰æ‰€æœ‰çš„è¾“å‡ºæ–‡ä»¶ å’Œ å½“å‰å†…å­˜ä¸­çš„æ•°æ®ç»“æ„ä¸­çš„æ•°æ®è¿›è¡Œ  merge sortï¼Œ è¿›è¡Œå…¨å±€æ’åº&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å’Œæˆ‘ä»¬å¼€å§‹æçš„é‚£ä¸ªé—®é¢˜åŸºæœ¬ç±»ä¼¼ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œéœ€è¦å¯¹ Key ç›¸åŒçš„å…ƒç´ è¿›è¡Œ  aggregationï¼Œ å°±æ˜¯ä½¿ç”¨å®šä¹‰çš„ func è¿›è¡Œèšåˆï¼Œ æ¯”å¦‚ä½ çš„ç®—å­æ˜¯ reduceByKeyï¼ˆ&lt;em&gt;+&lt;/em&gt;ï¼‰, è¿™ä¸ªfunc å°±æ˜¯åŠ æ³•è¿ç®—ï¼Œ å¦‚æœä¸¤ä¸ªkey ç›¸åŒï¼Œ å°±ä¼šå…ˆæ‰¾åˆ°æ‰€æœ‰ç›¸åŒçš„key è¿›è¡Œ reduce(&lt;em&gt;+&lt;/em&gt;) æ“ä½œï¼Œç®—å‡ºä¸€ä¸ªæ€»ç»“æœ Resultï¼Œç„¶åè¾“å‡ºæ•°æ®ï¼ˆKï¼ŒResultï¼‰å…ƒç´ ã€‚&lt;/p&gt;

&lt;p&gt;SortShuffleWriter ä¸­ä½¿ç”¨ ExternalSorter æ¥å¯¹å†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œæ’åºï¼ŒExternalSorterå†…éƒ¨ç»´æŠ¤äº†ä¸¤ä¸ªé›†åˆPartitionedAppendOnlyMapã€PartitionedPairBufferï¼Œ ä¸¤è€…éƒ½æ˜¯ä½¿ç”¨äº† hash table æ•°æ®ç»“æ„ï¼Œ å¦‚æœéœ€è¦è¿›è¡Œ aggregationï¼Œ å°±ä½¿ç”¨ PartitionedAppendOnlyMapï¼ˆæ”¯æŒ lookup æŸä¸ªKeyï¼Œå¦‚æœä¹‹å‰å­˜å‚¨è¿‡ç›¸åŒkeyçš„K-V å…ƒç´ ï¼Œå°±éœ€è¦è¿›è¡Œ aggregationï¼Œç„¶åå†å­˜å…¥aggregationåçš„ K-Vï¼‰ï¼Œ å¦åˆ™ä½¿ç”¨ PartitionedPairBufferï¼ˆåªè¿›è¡Œæ·»K-V å…ƒç´ ï¼‰ï¼Œ&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oe9nbfytu.qnssl.com/c/e8987f6d52e24022dc500e46f7d4dc60&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹ä¸Šå›¾ï¼Œ PartitionedAppendOnlyMap ä¸­çš„ K æ˜¯ï¼ˆPatitionId, Kï¼‰çš„å…ƒç»„ï¼Œ è¿™æ ·å°±æ˜¯å…ˆæŒ‰ç…§partitionIdè¿›è¡Œæ’åºï¼Œå¦‚æœ partitionId ç›¸åŒï¼Œå†æŒ‰ç…§  hashï¼ˆkeyï¼‰å†è¿›è¡Œæ’åºã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oe9nbfytu.qnssl.com/c/6d013affe760f663204e37a272c49718&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é¦–å…ˆçœ‹ä¸‹  AppendOnlyMapï¼Œ è¿™ä¸ªå¾ˆç®€å•å°±æ˜¯ä¸ª hash tableï¼Œå…¶ä¸­çš„ K æ˜¯ï¼ˆPatitionId, hashï¼ˆKeyï¼‰ï¼‰çš„å…ƒç»„ï¼Œ å½“è¦ put(K, V) æ—¶ï¼Œå…ˆ hash(K) æ‰¾å­˜æ”¾ä½ç½®ï¼Œå¦‚æœå­˜æ”¾ä½ç½®å·²ç»è¢«å ç”¨ï¼Œå°±ä½¿ç”¨ Quadratic probing æ¢æµ‹æ–¹æ³•æ¥æ‰¾ä¸‹ä¸€ä¸ªç©ºé—²ä½ç½®ã€‚å¯¹äºå›¾ä¸­çš„ K6 æ¥è¯´ï¼Œç¬¬ä¸‰æ¬¡æŸ¥æ‰¾æ‰¾åˆ° K4 åé¢çš„ç©ºé—²ä½ç½®ï¼Œæ”¾è¿›å»å³å¯ã€‚get(K6) çš„æ—¶å€™ç±»ä¼¼ï¼Œæ‰¾ä¸‰æ¬¡æ‰¾åˆ° K6ï¼Œå–å‡ºç´§æŒ¨ç€çš„ V6ï¼Œä¸å…ˆæ¥çš„ value åš funcï¼Œç»“æœé‡æ–°æ”¾åˆ° V6 çš„ä½ç½®ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹é¢çœ‹ä¸‹  ExternalAppendOnlyMap ç»“æ„ï¼Œ è¿™ä¸ªå°±æ˜¯å†…å­˜ä¸­è£…ä¸ä¸‹æ‰€æœ‰å…ƒç´ ï¼Œå°±æ¶‰åŠåˆ°å¤–éƒ¨æ’åºï¼Œ&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oe9nbfytu.qnssl.com/c/2e961b3cf14084b8e9228690ed431c18&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°æ•´ä¸ªåŸç†å›¾ï¼Œé€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼Œ å†…å­˜ä¸å¤Ÿçš„æ—¶å€™ï¼Œå…ˆspilläº†å››æ¬¡ï¼Œè¾“å‡ºåˆ°æ–‡ä»¶ä¸­çš„å…ƒç´ éƒ½æ˜¯æœ‰åºçš„ï¼Œè¯»å–çš„æ—¶å€™éƒ½æ˜¯æŒ‰åºè¯»å–ï¼Œæœ€åè·Ÿå†…å­˜å‰©ä½™çš„æ•°æ®è¿›è¡Œ å…¨å±€mergeã€‚&lt;/p&gt;

&lt;p&gt;merge è¿‡ç¨‹å°±æ˜¯ æ¯ä¸ªæ–‡ä»¶è¯»å–éƒ¨åˆ†æ•°æ®ï¼ˆStreamBufferï¼‰æ”¾åˆ° mergeHeap é‡Œé¢ï¼Œ å½“å‰å†…å­˜ä¸­çš„ PartitionedAppendOnlyMap ä¹Ÿè¿›è¡Œ sortï¼Œå½¢æˆä¸€ä¸ª sortedMap æ”¾åœ¨ mergeHeap é‡Œé¢ï¼Œ  è¿™ä¸ª heap æ˜¯ä¸€ä¸ª ä¼˜å…ˆé˜Ÿåˆ— PriorityQueueï¼Œ å¹¶ä¸”è‡ªå®šä¹‰äº†æ’åºæ–¹å¼ï¼Œå°±æ˜¯å–å‡ºå †å…ƒç´ StreamBufferçš„headå…ƒç´ è¿›è¡Œæ¯”è¾ƒå¤§å°ï¼Œ&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¿™æ ·çš„è¯ï¼Œæ¯æ¬¡ä»å †é¡¶çš„ StreamBuffer ä¸­ pop å‡ºçš„ head å…ƒç´ å°±æ˜¯å…¨å±€æœ€å°çš„å…ƒç´ ï¼ˆè®°ä½æ˜¯æŒ‰ç…§ï¼ˆpartitionIdï¼Œhashï¼ˆKeyï¼‰ï¼‰æ’åºçš„ï¼‰ï¼Œ å¦‚æœéœ€è¦ aggregationï¼Œ å°±æŠŠè¿™äº›key ç›¸åŒçš„å…ƒç´ æ”¾åœ¨ä¸€ä¸ªä¸€ä¸ª mergeBuffers ä¸­ï¼Œ  ç¬¬ä¸€ä¸ªè¢«æ”¾å…¥ mergeBuffers çš„ StreamBuffer è¢«ç§°ä¸º minBufferï¼Œé‚£ä¹ˆ minKey å°±æ˜¯ minBuffer ä¸­ç¬¬ä¸€ä¸ª record çš„ keyã€‚å½“ merge-combine çš„æ—¶å€™ï¼Œä¸ minKey æœ‰ç›¸åŒçš„Keyçš„records è¢« aggregate ä¸€èµ·ï¼Œç„¶åè¾“å‡ºã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä¸éœ€è¦ aggregationï¼Œ é‚£å°±ç®€å•äº†ï¼Œ ç›´æ¥æŠŠ å †é¡¶çš„ StreamBuffer ä¸­ pop å‡ºçš„ head å…ƒç´  è¿”å›å°±å¥½äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oe9nbfytu.qnssl.com/c/6e5ff58672bcac22e8abbcbb26946ac5&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æœ€ç»ˆè¯»å–çš„æ—¶å€™ï¼Œä»æ•´ä¸ª å…¨å±€ merge åçš„è¯»å–è¿­ä»£å™¨ä¸­è¯»å–çš„æ•°æ®ï¼Œå°±æ˜¯æŒ‰ç…§ partitionId ä»å°åˆ°å¤§æ’åºçš„æ•°æ®ï¼Œ è¯»å–è¿‡ç¨‹ä¸­ä½¿ç”¨å†æŒ‰ç…§ åˆ†åŒºåˆ†æ®µï¼Œ å¹¶ä¸”è®°å½•æ¯ä¸ªåˆ†åŒºçš„æ–‡ä»¶èµ·å§‹å†™å…¥ä½ç½®ï¼ŒæŠŠè¿™äº›ä½ç½®æ•°æ®å†™å…¥ç´¢å¼•æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;

&lt;h2 id=&quot;shuffleç›¸å…³å‚æ•°é…ç½®&quot;&gt;Shuffleç›¸å…³å‚æ•°é…ç½®&lt;/h2&gt;

&lt;p&gt;Shuffleæ˜¯Spark Coreæ¯”è¾ƒå¤æ‚çš„æ¨¡å—ï¼Œå®ƒä¹Ÿæ˜¯éå¸¸å½±å“æ€§èƒ½çš„æ“ä½œä¹‹ä¸€ã€‚å› æ­¤ï¼Œåœ¨è¿™é‡Œæ•´ç†äº†ä¼šå½±å“Shuffleæ€§èƒ½çš„å„é¡¹é…ç½®ã€‚&lt;/p&gt;

&lt;h3 id=&quot;1sparkshufflemanager&quot;&gt;1ï¼spark.shuffle.manager&lt;/h3&gt;

&lt;p&gt;Spark 1.2.0å®˜æ–¹ç‰ˆæœ¬æ”¯æŒä¸¤ç§æ–¹å¼çš„Shuffleï¼Œå³&lt;code class=&quot;highlighter-rouge&quot;&gt;Hash Based Shuffle&lt;/code&gt;å’Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;Sort Based Shuffle&lt;/code&gt;ã€‚å…¶ä¸­åœ¨Spark 1.0ä¹‹å‰ä»…æ”¯æŒ&lt;code class=&quot;highlighter-rouge&quot;&gt;Hash Based Shuffle&lt;/code&gt;ã€‚Spark 1.1å¼•å…¥äº†&lt;code class=&quot;highlighter-rouge&quot;&gt;Sort Based Shuffle&lt;/code&gt;ã€‚Spark 1.2çš„é»˜è®¤Shuffleæœºåˆ¶ä»Hashå˜æˆäº†Sortã€‚å¦‚æœéœ€è¦&lt;code class=&quot;highlighter-rouge&quot;&gt;Hash Based Shuffle&lt;/code&gt;ï¼Œåªéœ€å°†&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.shuffle.manager&lt;/code&gt;è®¾ç½®æˆâ€œhashâ€å³å¯ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;é…ç½®æ–¹å¼&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;â€‹    â‘  è¿›å…¥sparkå®‰è£…ç›®å½•çš„confç›®å½•&lt;/p&gt;

&lt;p&gt;â€‹    â‘¡ &lt;code class=&quot;highlighter-rouge&quot;&gt;cp spark-defaults.conf.template spark-defaults.conf&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;â€‹    â‘¢ &lt;code class=&quot;highlighter-rouge&quot;&gt;spark.shuffle.manager=hash&lt;/code&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;åº”ç”¨åœºæ™¯&lt;/p&gt;

    &lt;p&gt;å½“äº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶ä¸æ˜¯å¾ˆå¤šæ—¶ï¼Œæ€§èƒ½å¯èƒ½ä¼šæ¯”sort shuffleè¦å¥½ã€‚
å¦‚æœå¯¹æ€§èƒ½æœ‰æ¯”è¾ƒè‹›åˆ»çš„è¦æ±‚ï¼Œé‚£ä¹ˆå°±è¦ç†è§£è¿™ä¸¤ç§ä¸åŒçš„Shuffleæœºåˆ¶çš„åŸç†ï¼Œç»“åˆå…·ä½“çš„åº”ç”¨åœºæ™¯è¿›è¡Œé€‰æ‹©ã€‚
å¯¹äºä¸éœ€è¦è¿›è¡Œæ’åºä¸”Shuffleäº§ç”Ÿçš„æ–‡ä»¶æ•°é‡ä¸æ˜¯ç‰¹åˆ«å¤šæ—¶ï¼ŒHash Based Shuffleå¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼›å› ä¸ºSort Based Shuffleä¼šæŒ‰ç…§Reducerçš„Partitionè¿›è¡Œæ’åºã€‚
è€ŒSort Based Shuffleçš„ä¼˜åŠ¿å°±åœ¨äºå¯æ‰©å±•æ€§ï¼Œå®ƒçš„å‡ºç°å®é™…ä¸Šå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯è§£å†³Hash Based Shuffleçš„å¯æ‰©å±•æ€§çš„é—®é¢˜ã€‚ç”±äºSort Based Shuffleè¿˜åœ¨ä¸æ–­åœ°æ¼”è¿›ä¸­ï¼Œå› æ­¤å®ƒçš„æ€§èƒ½ä¼šå¾—åˆ°ä¸æ–­æ”¹å–„ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¯¹äºé€‰æ‹©å“ªç§Shuffleï¼Œå¦‚æœæ€§èƒ½è¦æ±‚è‹›åˆ»ï¼Œæœ€å¥½è¿˜æ˜¯é€šè¿‡å®é™…æµ‹è¯•åå†åšå†³å®šã€‚ä¸è¿‡é€‰æ‹©é»˜è®¤çš„Sortï¼Œå¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†çš„åœºæ™¯éœ€è¦ã€‚&lt;/p&gt;

&lt;h3 id=&quot;2sparkshufflespill&quot;&gt;2ï¼spark.shuffle.spill&lt;/h3&gt;

&lt;p&gt;è¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼æ˜¯trueï¼Œç”¨äºæŒ‡å®šShuffleè¿‡ç¨‹ä¸­å¦‚æœå†…å­˜ä¸­çš„æ•°æ®è¶…è¿‡é˜ˆå€¼ï¼ˆå‚è€ƒspark.shuffle.memoryFractionçš„è®¾ç½®ï¼‰æ—¶æ˜¯å¦éœ€è¦å°†éƒ¨åˆ†æ•°æ®ä¸´æ—¶å†™å…¥å¤–éƒ¨å­˜å‚¨ã€‚å¦‚æœè®¾ç½®ä¸ºfalseï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹å°±ä¼šä¸€ç›´ä½¿ç”¨å†…å­˜ï¼Œä¼šæœ‰å†…å­˜æº¢å‡ºçš„é£é™©ã€‚å› æ­¤åªæœ‰åœ¨ç¡®å®šå†…å­˜è¶³å¤Ÿä½¿ç”¨æ—¶ï¼Œæ‰å¯ä»¥å°†è¿™ä¸ªé€‰é¡¹è®¾ç½®ä¸ºfalseã€‚&lt;/p&gt;

&lt;h3 id=&quot;3sparkshufflememoryfraction&quot;&gt;3ï¼spark.shuffle.memoryFraction&lt;/h3&gt;

&lt;p&gt;åœ¨å¯ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.shuffle.spill&lt;/code&gt;çš„æƒ…å†µä¸‹ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.shuffle.memoryFraction&lt;/code&gt;å†³å®šäº†å½“Shuffleè¿‡ç¨‹ä¸­ä½¿ç”¨çš„&lt;u&gt;å†…å­˜è¾¾åˆ°æ€»å†…å­˜å¤šå°‘æ¯”ä¾‹&lt;/u&gt;çš„æ—¶å€™å¼€å§‹spillã€‚åœ¨Spark 1.2.0é‡Œï¼Œè¿™ä¸ªå€¼æ˜¯0.2ã€‚é€šè¿‡è¿™ä¸ªå‚æ•°å¯ä»¥è®¾ç½®Shuffleè¿‡ç¨‹å ç”¨å†…å­˜çš„å¤§å°ï¼Œå®ƒç›´æ¥å½±å“äº†å†™å…¥åˆ°å¤–éƒ¨å­˜å‚¨çš„é¢‘ç‡å’Œåƒåœ¾å›æ”¶çš„é¢‘ç‡ã€‚å¯ä»¥é€‚å½“è°ƒå¤§æ­¤å€¼ï¼Œå¯ä»¥å‡å°‘ç£ç›˜I/Oæ¬¡æ•°ã€‚&lt;/p&gt;

&lt;h3 id=&quot;4sparkshufflesortbypassmergethreshold&quot;&gt;4ï¼spark.shuffle.sort.bypassMergeThreshold&lt;/h3&gt;

&lt;p&gt;è¿™ä¸ªé…ç½®çš„é»˜è®¤å€¼æ˜¯200ï¼Œç”¨äºè®¾ç½®åœ¨Reducerçš„Partitionæ•°ç›®å°‘äºå¤šå°‘çš„æ—¶å€™ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;Sort Based Shuffle&lt;/code&gt;å†…éƒ¨ä¸ä½¿ç”¨&lt;strong&gt;å½’å¹¶æ’åº&lt;/strong&gt;çš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œæ˜¯ç›´æ¥å°†æ¯ä¸ªPartitionå†™å…¥å•ç‹¬çš„æ–‡ä»¶ã€‚è¿™ä¸ªæ–¹å¼å’Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;Hash Based&lt;/code&gt;çš„æ–¹å¼ç±»ä¼¼ï¼ŒåŒºåˆ«å°±æ˜¯åœ¨æœ€åè¿™äº›æ–‡ä»¶è¿˜æ˜¯ä¼šåˆå¹¶æˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªIndexç´¢å¼•æ–‡ä»¶æ¥æ ‡è®°ä¸åŒPartitionçš„ä½ç½®ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªå¯ä»¥çœ‹ä½œ&lt;code class=&quot;highlighter-rouge&quot;&gt;Sort Based Shuffle&lt;/code&gt;åœ¨Shuffleé‡æ¯”è¾ƒå°çš„æ—¶å€™å¯¹äº&lt;code class=&quot;highlighter-rouge&quot;&gt;Hash Based Shuffle&lt;/code&gt;çš„ä¸€ç§æŠ˜ä¸­ã€‚å½“ç„¶äº†å®ƒå’Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;Hash Based Shuffle&lt;/code&gt;ä¸€æ ·ï¼Œä¹Ÿå­˜åœ¨åŒæ—¶æ‰“å¼€æ–‡ä»¶è¿‡å¤šå¯¼è‡´å†…å­˜å ç”¨å¢åŠ çš„é—®é¢˜ã€‚å› æ­¤å¦‚æœGCæ¯”è¾ƒä¸¥é‡æˆ–è€…å†…å­˜æ¯”è¾ƒç´§å¼ ï¼Œå¯ä»¥é€‚å½“é™ä½è¿™ä¸ªå€¼ã€‚&lt;/p&gt;

&lt;h3 id=&quot;5sparkshuffleblocktransferservice&quot;&gt;5ï¼spark.shuffle.blockTransferService&lt;/h3&gt;

&lt;p&gt;åœ¨Spark 1.2.0ä¸­è¿™ä¸ªé…ç½®çš„é»˜è®¤å€¼æ˜¯nettyï¼Œè€Œåœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­æ˜¯nioã€‚å®ƒä¸»è¦æ˜¯ç”¨äºåœ¨å„ä¸ªExecutorä¹‹é—´ä¼ è¾“Shuffleæ•°æ®ã€‚nettyçš„å®ç°æ›´åŠ ç®€æ´ï¼Œä½†å®é™…ä¸Šç”¨æˆ·ä¸ç”¨å¤ªå…³å¿ƒè¿™ä¸ªé€‰é¡¹ã€‚é™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå¦åˆ™é‡‡ç”¨é»˜è®¤é…ç½®å³å¯ã€‚&lt;/p&gt;

&lt;h3 id=&quot;6sparkshuffleconsolidatefiles&quot;&gt;6ï¼spark.shuffle.consolidateFiles&lt;/h3&gt;

&lt;p&gt;è¿™ä¸ªé…ç½®çš„é»˜è®¤å€¼æ˜¯falseã€‚ä¸»è¦æ˜¯ä¸ºäº†è§£å†³åœ¨&lt;code class=&quot;highlighter-rouge&quot;&gt;Hash Based Shuffle&lt;/code&gt;è¿‡ç¨‹ä¸­äº§ç”Ÿè¿‡å¤šæ–‡ä»¶çš„é—®é¢˜ã€‚å¦‚æœé…ç½®é€‰é¡¹ä¸ºtrueï¼Œé‚£ä¹ˆå¯¹äºåŒä¸€ä¸ªCoreä¸Šè¿è¡Œçš„Shuffle Map Taskä¸ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„Shuffleæ–‡ä»¶è€Œæ˜¯é‡ç”¨åŸæ¥çš„ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯consolidateFilesçš„æœºåˆ¶åœ¨Spark 0.8.1å°±å¼•å…¥äº†ï¼Œåˆ°Spark 1.2.0è¿˜æ˜¯æ²¡æœ‰ç¨³å®šä¸‹æ¥ã€‚ä»æºç å®ç°çš„è§’åº¦çœ‹ï¼Œå®ç°æºç æ˜¯éå¸¸ç®€å•çš„ï¼Œä½†æ˜¯ç”±äºæ¶‰åŠæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç­‰é™åˆ¶ï¼Œè¿™ä¸ªç­–ç•¥å¯èƒ½ä¼šå¸¦æ¥å„ç§å„æ ·çš„é—®é¢˜ã€‚ä¸€èˆ¬ä¸å»ºè®®å¼€å¯ã€‚&lt;/p&gt;

&lt;h3 id=&quot;7sparkshufflecompresså’Œsparkshufflespillcompress&quot;&gt;7ï¼spark.shuffle.compresså’Œspark.shuffle.spill.compress&lt;/h3&gt;

&lt;p&gt;è¿™ä¸¤ä¸ªå‚æ•°çš„é»˜è®¤é…ç½®éƒ½æ˜¯trueã€‚&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.shuffle.compress&lt;/code&gt;å’Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.shuffle.spill.compress&lt;/code&gt;éƒ½æ˜¯ç”¨æ¥è®¾ç½®Shuffleè¿‡ç¨‹ä¸­æ˜¯å¦å¯¹Shuffleæ•°æ®è¿›è¡Œå‹ç¼©ã€‚å…¶ä¸­ï¼Œå‰è€…é’ˆå¯¹æœ€ç»ˆå†™å…¥æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„è¾“å‡ºæ–‡ä»¶ï¼›åè€…é’ˆå¯¹åœ¨å¤„ç†è¿‡ç¨‹éœ€è¦å†™å…¥åˆ°å¤–éƒ¨å­˜å‚¨çš„ä¸­é—´æ•°æ®ï¼Œå³é’ˆå¯¹æœ€ç»ˆçš„shuffleè¾“å‡ºæ–‡ä»¶ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;è®¾ç½®&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.shuffle.compress&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;éœ€è¦è¯„ä¼°å‹ç¼©è§£å‹æ—¶é—´å¸¦æ¥çš„æ—¶é—´æ¶ˆè€—å’Œå› ä¸ºæ•°æ®å‹ç¼©å¸¦æ¥çš„æ—¶é—´èŠ‚çœã€‚å¦‚æœç½‘ç»œæˆä¸ºç“¶é¢ˆï¼Œæ¯”å¦‚é›†ç¾¤æ™®éä½¿ç”¨çš„æ˜¯åƒå…†ç½‘ç»œï¼Œé‚£ä¹ˆå°†è¿™ä¸ªé€‰é¡¹è®¾ç½®ä¸ºtrueå¯èƒ½æ›´åˆç†ï¼›å¦‚æœè®¡ç®—æ˜¯CPUå¯†é›†å‹çš„ï¼Œé‚£ä¹ˆå°†è¿™ä¸ªé€‰é¡¹è®¾ç½®ä¸ºfalseå¯èƒ½æ›´å¥½ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;è®¾ç½®&lt;code class=&quot;highlighter-rouge&quot;&gt;spark.shuffle.spill.compress&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;å¦‚æœè®¾ç½®ä¸ºtrueï¼Œä»£è¡¨å¤„ç†çš„ä¸­é—´ç»“æœåœ¨spillåˆ°æœ¬åœ°ç¡¬ç›˜æ—¶éƒ½ä¼šè¿›è¡Œå‹ç¼©ï¼Œåœ¨å°†ä¸­é—´ç»“æœå–å›è¿›è¡Œmergeçš„æ—¶å€™ï¼Œè¦è¿›è¡Œè§£å‹ã€‚å› æ­¤è¦ç»¼åˆè€ƒè™‘CPUç”±äºå¼•å…¥å‹ç¼©ã€è§£å‹çš„æ¶ˆè€—æ—¶é—´å’ŒDisk IOå› ä¸ºå‹ç¼©å¸¦æ¥çš„èŠ‚çœæ—¶é—´çš„æ¯”è¾ƒã€‚åœ¨Disk IOæˆä¸ºç“¶é¢ˆçš„åœºæ™¯ä¸‹ï¼Œè®¾ç½®ä¸ºtrueå¯èƒ½æ¯”è¾ƒåˆé€‚ï¼›å¦‚æœæœ¬åœ°ç¡¬ç›˜æ˜¯SSDï¼Œé‚£ä¹ˆè®¾ç½®ä¸ºfalseå¯èƒ½æ¯”è¾ƒåˆé€‚ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;8sparkreducermaxmbinflight&quot;&gt;8ï¼spark.reducer.maxMbInFlight&lt;/h3&gt;

&lt;p&gt;è¿™ä¸ªå‚æ•°ç”¨äºé™åˆ¶ä¸€ä¸ªReducer Taskå‘å…¶ä»–çš„Executorè¯·æ±‚Shuffleæ•°æ®æ—¶æ‰€å ç”¨çš„æœ€å¤§å†…å­˜æ•°ï¼Œå°¤å…¶æ˜¯å¦‚æœç½‘å¡æ˜¯åƒå…†å’Œåƒå…†ä»¥ä¸‹çš„ç½‘å¡æ—¶ã€‚é»˜è®¤å€¼æ˜¯ è®¾ç½®è¿™ä¸ªå€¼éœ€è¦ç»¼åˆè€ƒè™‘ç½‘å¡å¸¦å®½å’Œå†…å­˜ã€‚&lt;/p&gt;
</description>
        <pubDate>Thu, 08 Aug 2019 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2019/08/08/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Spark-Shuffle/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/08/08/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Spark-Shuffle/</guid>
        
        <category>Spark</category>
        
        <category>Programing</category>
        
        <category>BigData</category>
        
        
      </item>
    
      <item>
        <title>Hiveä¿ç•™å…³é”®å­—å†²çªçš„è§£å†³</title>
        <description>&lt;p&gt;æœ€è¿‘åšHiveè¡¨åˆ›å»ºçš„æ—¶é‡åˆ°ä¸€ä¸ªé—®é¢˜.&lt;/p&gt;

&lt;p&gt;æŠ¥é”™å¦‚ä¸‹:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;FailedPredicateException&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;identifier,&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;useSQL11ReservedKeywordsForIdentifier&lt;span class=&quot;o&quot;&gt;()}&lt;/span&gt;?&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æœ€ååœ¨&lt;a href=&quot;https://community.hortonworks.com/questions/21626/where-should-i-add-hivesupportsql11reservedkeyword.html&quot;&gt;HCC&lt;/a&gt;ä¸Šæ‰¾åˆ°äº†å¯¹åº”çš„è§£å†³åŠæ³•.&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c1&quot;&gt;-- è§£å†³åŠæ³•å¾ˆç®€å•, å°±æ˜¯ç›´æ¥ä¿®æ”¹ä¸€ä¸‹Hiveçš„é…ç½®&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;support&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reserved&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;keywords&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;BTW, é¡ºä¾¿åæ§½ä¸€ä¸‹, ç™¾åº¦åƒæ£è¯ä¸¸, å› ä¸ºå…¬å¸ç”¨ä¸äº†è°·æ­Œ, æ²¡åŠæ³•å»ç™¾åº¦æ‰¾äº†å¥½å‡ é¡µç»“æœéƒ½æ²¡æœ‰ç»“æœ. ç„¶åç”¨äº†bing, ç¬¬å››æ¡å°±å‘ç°äº†ç­”æ¡ˆâ€¦&lt;/p&gt;

</description>
        <pubDate>Fri, 26 Jul 2019 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2019/07/26/Hive%E4%BF%9D%E7%95%99%E5%85%B3%E9%94%AE%E5%AD%97%E5%86%B2%E7%AA%81%E8%A7%A3%E5%86%B3/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/07/26/Hive%E4%BF%9D%E7%95%99%E5%85%B3%E9%94%AE%E5%AD%97%E5%86%B2%E7%AA%81%E8%A7%A3%E5%86%B3/</guid>
        
        <category>Hive</category>
        
        <category>Tricks</category>
        
        <category>Programing</category>
        
        <category>Debug</category>
        
        
      </item>
    
      <item>
        <title>å‰‘æŒ‡Offer-è®¡ç®—æœºç½‘ç»œ</title>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;

&lt;h2 id=&quot;1-è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„&quot;&gt;1. è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/0fa6c237-a909-4e2a-a771-2c5485cd8ce0.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;11-äº”å±‚åè®®&quot;&gt;1.1 äº”å±‚åè®®&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;åº”ç”¨å±‚&lt;/strong&gt; ï¼šä¸ºç‰¹å®šåº”ç”¨ç¨‹åºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œä¾‹å¦‚ HTTPã€DNS ç­‰åè®®ã€‚æ•°æ®å•ä½ä¸ºæŠ¥æ–‡ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ä¼ è¾“å±‚&lt;/strong&gt; ï¼šä¸ºè¿›ç¨‹æä¾›é€šç”¨æ•°æ®ä¼ è¾“æœåŠ¡ã€‚ç”±äºåº”ç”¨å±‚åè®®å¾ˆå¤šï¼Œå®šä¹‰é€šç”¨çš„ä¼ è¾“å±‚åè®®å°±å¯ä»¥æ”¯æŒä¸æ–­å¢å¤šçš„åº”ç”¨å±‚åè®®ã€‚è¿è¾“å±‚åŒ…æ‹¬ä¸¤ç§åè®®ï¼š&lt;strong&gt;ä¼ è¾“æ§åˆ¶åè®® TCP&lt;/strong&gt;ï¼Œæä¾›é¢å‘è¿æ¥ã€å¯é çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œæ•°æ®å•ä½ä¸ºæŠ¥æ–‡æ®µï¼›&lt;strong&gt;ç”¨æˆ·æ•°æ®æŠ¥åè®® UDP&lt;/strong&gt;ï¼Œæä¾›æ— è¿æ¥ã€å°½æœ€å¤§åŠªåŠ›çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œæ•°æ®å•ä½ä¸ºç”¨æˆ·æ•°æ®æŠ¥ã€‚TCP ä¸»è¦æä¾›å®Œæ•´æ€§æœåŠ¡ï¼ŒUDP ä¸»è¦æä¾›åŠæ—¶æ€§æœåŠ¡ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç½‘ç»œå±‚&lt;/strong&gt; ï¼šä¸ºä¸»æœºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚è€Œä¼ è¾“å±‚åè®®æ˜¯ä¸ºä¸»æœºä¸­çš„è¿›ç¨‹æä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚ç½‘ç»œå±‚æŠŠä¼ è¾“å±‚ä¼ é€’ä¸‹æ¥çš„æŠ¥æ–‡æ®µæˆ–è€…ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æ•°æ®é“¾è·¯å±‚&lt;/strong&gt; ï¼šç½‘ç»œå±‚é’ˆå¯¹çš„è¿˜æ˜¯ä¸»æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œè€Œä¸»æœºä¹‹é—´å¯ä»¥æœ‰å¾ˆå¤šé“¾è·¯ï¼Œé“¾è·¯å±‚åè®®å°±æ˜¯ä¸ºåŒä¸€é“¾è·¯çš„ä¸»æœºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚æ•°æ®é“¾è·¯å±‚æŠŠç½‘ç»œå±‚ä¼ ä¸‹æ¥çš„åˆ†ç»„å°è£…æˆå¸§ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç‰©ç†å±‚&lt;/strong&gt; ï¼šè€ƒè™‘çš„æ˜¯æ€æ ·åœ¨ä¼ è¾“åª’ä½“ä¸Šä¼ è¾“æ•°æ®æ¯”ç‰¹æµï¼Œè€Œä¸æ˜¯æŒ‡å…·ä½“çš„ä¼ è¾“åª’ä½“ã€‚ç‰©ç†å±‚çš„ä½œç”¨æ˜¯å°½å¯èƒ½å±è”½ä¼ è¾“åª’ä½“å’Œé€šä¿¡æ‰‹æ®µçš„å·®å¼‚ï¼Œä½¿æ•°æ®é“¾è·¯å±‚æ„Ÿè§‰ä¸åˆ°è¿™äº›å·®å¼‚ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;12-osi&quot;&gt;1.2. OSI&lt;/h3&gt;

&lt;p&gt;å…¶ä¸­è¡¨ç¤ºå±‚å’Œä¼šè¯å±‚ç”¨é€”å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;è¡¨ç¤ºå±‚&lt;/strong&gt; ï¼šæ•°æ®å‹ç¼©ã€åŠ å¯†ä»¥åŠæ•°æ®æè¿°ï¼Œè¿™ä½¿å¾—åº”ç”¨ç¨‹åºä¸å¿…å…³å¿ƒåœ¨å„å°ä¸»æœºä¸­æ•°æ®å†…éƒ¨æ ¼å¼ä¸åŒçš„é—®é¢˜ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ä¼šè¯å±‚&lt;/strong&gt; ï¼šå»ºç«‹åŠç®¡ç†ä¼šè¯ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;äº”å±‚åè®®æ²¡æœ‰è¡¨ç¤ºå±‚å’Œä¼šè¯å±‚ï¼Œè€Œæ˜¯å°†è¿™äº›åŠŸèƒ½ç•™ç»™åº”ç”¨ç¨‹åºå¼€å‘è€…å¤„ç†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;13-tcpip&quot;&gt;1.3. TCP/IP&lt;/h3&gt;

&lt;p&gt;å®ƒåªæœ‰å››å±‚ï¼Œç›¸å½“äºäº”å±‚åè®®ä¸­æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚åˆå¹¶ä¸ºç½‘ç»œæ¥å£å±‚ã€‚&lt;/p&gt;

&lt;p&gt;TCP/IP ä½“ç³»ç»“æ„ä¸ä¸¥æ ¼éµå¾ª OSI åˆ†å±‚æ¦‚å¿µï¼Œåº”ç”¨å±‚å¯èƒ½ä¼šç›´æ¥ä½¿ç”¨ IP å±‚æˆ–è€…ç½‘ç»œæ¥å£å±‚ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/48d79be8-085b-4862-8a9d-18402eb93b31.png&quot; width=&quot;300&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;14-æ•°æ®åœ¨å„å±‚ä¹‹é—´çš„ä¼ é€’è¿‡ç¨‹&quot;&gt;1.4 æ•°æ®åœ¨å„å±‚ä¹‹é—´çš„ä¼ é€’è¿‡ç¨‹&lt;/h3&gt;

&lt;p&gt;åœ¨å‘ä¸‹çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ·»åŠ ä¸‹å±‚åè®®æ‰€éœ€è¦çš„é¦–éƒ¨æˆ–è€…å°¾éƒ¨ï¼Œè€Œåœ¨å‘ä¸Šçš„è¿‡ç¨‹ä¸­ä¸æ–­æ‹†å¼€é¦–éƒ¨å’Œå°¾éƒ¨ã€‚&lt;/p&gt;

&lt;p&gt;è·¯ç”±å™¨åªæœ‰ä¸‹é¢ä¸‰å±‚åè®®ï¼Œå› ä¸ºè·¯ç”±å™¨ä½äºç½‘ç»œæ ¸å¿ƒä¸­ï¼Œä¸éœ€è¦ä¸ºè¿›ç¨‹æˆ–è€…åº”ç”¨ç¨‹åºæä¾›æœåŠ¡ï¼Œå› æ­¤ä¹Ÿå°±ä¸éœ€è¦ä¼ è¾“å±‚å’Œåº”ç”¨å±‚ã€‚&lt;/p&gt;

&lt;h2 id=&quot;2-http&quot;&gt;2. HTTP&lt;/h2&gt;

&lt;h3 id=&quot;21-åŸºç¡€æ¦‚å¿µ&quot;&gt;2.1 åŸºç¡€æ¦‚å¿µ&lt;/h3&gt;

&lt;h4 id=&quot;211-uri&quot;&gt;2.1.1 URI&lt;/h4&gt;

&lt;p&gt;URI åŒ…å« URL å’Œ URNã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/8441b2c4-dca7-4d6b-8efb-f22efccaf331.png&quot; width=&quot;550&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;212-è¯·æ±‚å’Œå“åº”æŠ¥æ–‡&quot;&gt;2.1.2 è¯·æ±‚å’Œå“åº”æŠ¥æ–‡&lt;/h4&gt;

&lt;h5 id=&quot;2121-è¯·æ±‚æŠ¥æ–‡&quot;&gt;2.1.2.1 è¯·æ±‚æŠ¥æ–‡&lt;/h5&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/HTTP_RequestMessageExample.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;2122-å“åº”æŠ¥æ–‡&quot;&gt;2.1.2.2 å“åº”æŠ¥æ–‡&lt;/h5&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/HTTP_ResponseMessageExample.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;22-http-æ–¹æ³•&quot;&gt;2.2 HTTP æ–¹æ³•&lt;/h3&gt;

&lt;p&gt;å®¢æˆ·ç«¯å‘é€çš„ &lt;strong&gt;è¯·æ±‚æŠ¥æ–‡&lt;/strong&gt; ç¬¬ä¸€è¡Œä¸ºè¯·æ±‚è¡Œï¼ŒåŒ…å«äº†æ–¹æ³•å­—æ®µã€‚&lt;/p&gt;

&lt;h4 id=&quot;221-get&quot;&gt;2.2.1 GET&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;è·å–èµ„æº&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å½“å‰ç½‘ç»œè¯·æ±‚ä¸­ï¼Œç»å¤§éƒ¨åˆ†ä½¿ç”¨çš„æ˜¯ GET æ–¹æ³•ã€‚&lt;/p&gt;

&lt;h4 id=&quot;222-head&quot;&gt;2.2.2 HEAD&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;è·å–æŠ¥æ–‡é¦–éƒ¨&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å’Œ GET æ–¹æ³•ç±»ä¼¼ï¼Œä½†æ˜¯ä¸è¿”å›æŠ¥æ–‡å®ä½“ä¸»ä½“éƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;p&gt;ä¸»è¦ç”¨äºç¡®è®¤ URL çš„æœ‰æ•ˆæ€§ä»¥åŠèµ„æºæ›´æ–°çš„æ—¥æœŸæ—¶é—´ç­‰ã€‚&lt;/p&gt;

&lt;h4 id=&quot;223-post&quot;&gt;2.2.3 POST&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;ä¼ è¾“å®ä½“ä¸»ä½“&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;POST ä¸»è¦ç”¨æ¥ä¼ è¾“æ•°æ®ï¼Œè€Œ GET ä¸»è¦ç”¨æ¥è·å–èµ„æºã€‚&lt;/p&gt;

&lt;p&gt;æ›´å¤š POST ä¸ GET çš„æ¯”è¾ƒè¯·è§ç¬¬ä¹ç« ã€‚&lt;/p&gt;

&lt;h4 id=&quot;223-put&quot;&gt;2.2.3 PUT&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;ä¸Šä¼ æ–‡ä»¶&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç”±äºè‡ªèº«ä¸å¸¦éªŒè¯æœºåˆ¶ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œå› æ­¤å­˜åœ¨å®‰å…¨æ€§é—®é¢˜ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨è¯¥æ–¹æ³•ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;PUT /new.html HTTP/1.1
Host: example.com
Content-type: text/html
Content-length: 16

&lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&lt;/span&gt;New File&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;224-patch&quot;&gt;2.2.4 PATCH&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;å¯¹èµ„æºè¿›è¡Œéƒ¨åˆ†ä¿®æ”¹&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;PUT ä¹Ÿå¯ä»¥ç”¨äºä¿®æ”¹èµ„æºï¼Œä½†æ˜¯åªèƒ½å®Œå…¨æ›¿ä»£åŸå§‹èµ„æºï¼ŒPATCH å…è®¸éƒ¨åˆ†ä¿®æ”¹ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;PATCH /file.txt HTTP/1.1
Host: www.example.com
Content-Type: application/example
If-Match: &quot;e0023aa4e&quot;
Content-Length: 100

[description of changes]
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;225-delete&quot;&gt;2.2.5 DELETE&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;åˆ é™¤æ–‡ä»¶&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ä¸ PUT åŠŸèƒ½ç›¸åï¼Œå¹¶ä¸”åŒæ ·ä¸å¸¦éªŒè¯æœºåˆ¶ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;DELETE /file.html HTTP/1.1
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;226-options&quot;&gt;2.2.6 OPTIONS&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;æŸ¥è¯¢æ”¯æŒçš„æ–¹æ³•&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æŸ¥è¯¢æŒ‡å®šçš„ URL èƒ½å¤Ÿæ”¯æŒçš„æ–¹æ³•ã€‚&lt;/p&gt;

&lt;p&gt;ä¼šè¿”å› &lt;code class=&quot;highlighter-rouge&quot;&gt;Allow: GET, POST, HEAD, OPTIONS&lt;/code&gt; è¿™æ ·çš„å†…å®¹ã€‚&lt;/p&gt;

&lt;h4 id=&quot;227-connect&quot;&gt;2.2.7 CONNECT&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;è¦æ±‚åœ¨ä¸ä»£ç†æœåŠ¡å™¨é€šä¿¡æ—¶å»ºç«‹éš§é“&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ä½¿ç”¨ SSLï¼ˆSecure Sockets Layerï¼Œå®‰å…¨å¥—æ¥å±‚ï¼‰å’Œ TLSï¼ˆTransport Layer Securityï¼Œä¼ è¾“å±‚å®‰å…¨ï¼‰åè®®æŠŠé€šä¿¡å†…å®¹åŠ å¯†åç»ç½‘ç»œéš§é“ä¼ è¾“ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;CONNECT www.example.com:443 HTTP/1.1Copy to clipboardErrorCopied
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/dc00f70e-c5c8-4d20-baf1-2d70014a97e3.jpg&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;229-trace&quot;&gt;2.2.9 TRACE&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;è¿½è¸ªè·¯å¾„&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æœåŠ¡å™¨ä¼šå°†é€šä¿¡è·¯å¾„è¿”å›ç»™å®¢æˆ·ç«¯ã€‚&lt;/p&gt;

&lt;p&gt;å‘é€è¯·æ±‚æ—¶ï¼Œåœ¨ Max-Forwards é¦–éƒ¨å­—æ®µä¸­å¡«å…¥æ•°å€¼ï¼Œæ¯ç»è¿‡ä¸€ä¸ªæœåŠ¡å™¨å°±ä¼šå‡ 1ï¼Œå½“æ•°å€¼ä¸º 0 æ—¶å°±åœæ­¢ä¼ è¾“ã€‚&lt;/p&gt;

&lt;p&gt;é€šå¸¸ä¸ä¼šä½¿ç”¨ TRACEï¼Œå¹¶ä¸”å®ƒå®¹æ˜“å—åˆ° XST æ”»å‡»ï¼ˆCross-Site Tracingï¼Œè·¨ç«™è¿½è¸ªï¼‰ã€‚&lt;/p&gt;

&lt;h3 id=&quot;23-http-çŠ¶æ€ç &quot;&gt;2.3 HTTP çŠ¶æ€ç &lt;/h3&gt;

&lt;p&gt;æœåŠ¡å™¨è¿”å›çš„ &lt;strong&gt;å“åº”æŠ¥æ–‡&lt;/strong&gt; ä¸­ç¬¬ä¸€è¡Œä¸ºçŠ¶æ€è¡Œï¼ŒåŒ…å«äº†çŠ¶æ€ç ä»¥åŠåŸå› çŸ­è¯­ï¼Œç”¨æ¥å‘ŠçŸ¥å®¢æˆ·ç«¯è¯·æ±‚çš„ç»“æœã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;çŠ¶æ€ç &lt;/th&gt;
      &lt;th&gt;ç±»åˆ«&lt;/th&gt;
      &lt;th&gt;å«ä¹‰&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1XX&lt;/td&gt;
      &lt;td&gt;Informationalï¼ˆä¿¡æ¯æ€§çŠ¶æ€ç ï¼‰&lt;/td&gt;
      &lt;td&gt;æ¥æ”¶çš„è¯·æ±‚æ­£åœ¨å¤„ç†&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2XX&lt;/td&gt;
      &lt;td&gt;Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰&lt;/td&gt;
      &lt;td&gt;è¯·æ±‚æ­£å¸¸å¤„ç†å®Œæ¯•&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3XX&lt;/td&gt;
      &lt;td&gt;Redirectionï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰&lt;/td&gt;
      &lt;td&gt;éœ€è¦è¿›è¡Œé™„åŠ æ“ä½œä»¥å®Œæˆè¯·æ±‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4XX&lt;/td&gt;
      &lt;td&gt;Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰&lt;/td&gt;
      &lt;td&gt;æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5XX&lt;/td&gt;
      &lt;td&gt;Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰&lt;/td&gt;
      &lt;td&gt;æœåŠ¡å™¨å¤„ç†è¯·æ±‚å‡ºé”™&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h4 id=&quot;231-1xx-ä¿¡æ¯&quot;&gt;2.3.1 1XX ä¿¡æ¯&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;100 Continue&lt;/strong&gt; ï¼šè¡¨æ˜åˆ°ç›®å‰ä¸ºæ­¢éƒ½å¾ˆæ­£å¸¸ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­å‘é€è¯·æ±‚æˆ–è€…å¿½ç•¥è¿™ä¸ªå“åº”ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;232-2xx-æˆåŠŸ&quot;&gt;2.3.2 2XX æˆåŠŸ&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;200 OK&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;204 No Content&lt;/strong&gt; ï¼šè¯·æ±‚å·²ç»æˆåŠŸå¤„ç†ï¼Œä½†æ˜¯è¿”å›çš„å“åº”æŠ¥æ–‡ä¸åŒ…å«å®ä½“çš„ä¸»ä½“éƒ¨åˆ†ã€‚ä¸€èˆ¬åœ¨åªéœ€è¦ä»å®¢æˆ·ç«¯å¾€æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦è¿”å›æ•°æ®æ—¶ä½¿ç”¨ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;206 Partial Content&lt;/strong&gt; ï¼šè¡¨ç¤ºå®¢æˆ·ç«¯è¿›è¡Œäº†èŒƒå›´è¯·æ±‚ï¼Œå“åº”æŠ¥æ–‡åŒ…å«ç”± Content-Range æŒ‡å®šèŒƒå›´çš„å®ä½“å†…å®¹ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;233-3xx-é‡å®šå‘&quot;&gt;2.3.3 3XX é‡å®šå‘&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;301 Moved Permanently&lt;/strong&gt; ï¼šæ°¸ä¹…æ€§é‡å®šå‘&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;302 Found&lt;/strong&gt; ï¼šä¸´æ—¶æ€§é‡å®šå‘&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;303 See Other&lt;/strong&gt; ï¼šå’Œ 302 æœ‰ç€ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯ 303 æ˜ç¡®è¦æ±‚å®¢æˆ·ç«¯åº”è¯¥é‡‡ç”¨ GET æ–¹æ³•è·å–èµ„æºã€‚&lt;/li&gt;
  &lt;li&gt;æ³¨ï¼šè™½ç„¶ HTTP åè®®è§„å®š 301ã€302 çŠ¶æ€ä¸‹é‡å®šå‘æ—¶ä¸å…è®¸æŠŠ POST æ–¹æ³•æ”¹æˆ GET æ–¹æ³•ï¼Œä½†æ˜¯å¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šåœ¨ 301ã€302 å’Œ 303 çŠ¶æ€ä¸‹çš„é‡å®šå‘æŠŠ POST æ–¹æ³•æ”¹æˆ GET æ–¹æ³•ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;304 Not Modified&lt;/strong&gt; ï¼šå¦‚æœè¯·æ±‚æŠ¥æ–‡é¦–éƒ¨åŒ…å«ä¸€äº›æ¡ä»¶ï¼Œä¾‹å¦‚ï¼šIf-Matchï¼ŒIf-Modified-Sinceï¼ŒIf-None-Matchï¼ŒIf-Rangeï¼ŒIf-Unmodified-Sinceï¼Œå¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™æœåŠ¡å™¨ä¼šè¿”å› 304 çŠ¶æ€ç ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;307 Temporary Redirect&lt;/strong&gt; ï¼šä¸´æ—¶é‡å®šå‘ï¼Œä¸ 302 çš„å«ä¹‰ç±»ä¼¼ï¼Œä½†æ˜¯ 307 è¦æ±‚æµè§ˆå™¨ä¸ä¼šæŠŠé‡å®šå‘è¯·æ±‚çš„ POST æ–¹æ³•æ”¹æˆ GET æ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;234-4xx-å®¢æˆ·ç«¯é”™è¯¯&quot;&gt;2.3.4 4XX å®¢æˆ·ç«¯é”™è¯¯&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;400 Bad Request&lt;/strong&gt; ï¼šè¯·æ±‚æŠ¥æ–‡ä¸­å­˜åœ¨è¯­æ³•é”™è¯¯ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;401 Unauthorized&lt;/strong&gt; ï¼šè¯¥çŠ¶æ€ç è¡¨ç¤ºå‘é€çš„è¯·æ±‚éœ€è¦æœ‰è®¤è¯ä¿¡æ¯ï¼ˆBASIC è®¤è¯ã€DIGEST è®¤è¯ï¼‰ã€‚å¦‚æœä¹‹å‰å·²è¿›è¡Œè¿‡ä¸€æ¬¡è¯·æ±‚ï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·è®¤è¯å¤±è´¥ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;403 Forbidden&lt;/strong&gt; ï¼šè¯·æ±‚è¢«æ‹’ç»ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;404 Not Found&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;235-5xx-æœåŠ¡å™¨é”™è¯¯&quot;&gt;2.3.5 5XX æœåŠ¡å™¨é”™è¯¯&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;500 Internal Server Error&lt;/strong&gt; ï¼šæœåŠ¡å™¨æ­£åœ¨æ‰§è¡Œè¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;503 Service Unavailable&lt;/strong&gt; ï¼šæœåŠ¡å™¨æš‚æ—¶å¤„äºè¶…è´Ÿè½½æˆ–æ­£åœ¨è¿›è¡Œåœæœºç»´æŠ¤ï¼Œç°åœ¨æ— æ³•å¤„ç†è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;24-http-é¦–éƒ¨&quot;&gt;2.4 HTTP é¦–éƒ¨&lt;/h3&gt;

&lt;p&gt;æœ‰ 4 ç§ç±»å‹çš„é¦–éƒ¨å­—æ®µï¼šé€šç”¨é¦–éƒ¨å­—æ®µã€è¯·æ±‚é¦–éƒ¨å­—æ®µã€å“åº”é¦–éƒ¨å­—æ®µå’Œå®ä½“é¦–éƒ¨å­—æ®µã€‚&lt;/p&gt;

&lt;p&gt;å„ç§é¦–éƒ¨å­—æ®µåŠå…¶å«ä¹‰å¦‚ä¸‹ï¼ˆä¸éœ€è¦å…¨è®°ï¼Œä»…ä¾›æŸ¥é˜…ï¼‰ï¼š&lt;/p&gt;

&lt;h4 id=&quot;241-é€šç”¨é¦–éƒ¨å­—æ®µ&quot;&gt;2.4.1 é€šç”¨é¦–éƒ¨å­—æ®µ&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;é¦–éƒ¨å­—æ®µå&lt;/th&gt;
      &lt;th&gt;è¯´æ˜&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Cache-Control&lt;/td&gt;
      &lt;td&gt;æ§åˆ¶ç¼“å­˜çš„è¡Œä¸º&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Connection&lt;/td&gt;
      &lt;td&gt;æ§åˆ¶ä¸å†è½¬å‘ç»™ä»£ç†çš„é¦–éƒ¨å­—æ®µã€ç®¡ç†æŒä¹…è¿æ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Date&lt;/td&gt;
      &lt;td&gt;åˆ›å»ºæŠ¥æ–‡çš„æ—¥æœŸæ—¶é—´&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Pragma&lt;/td&gt;
      &lt;td&gt;æŠ¥æ–‡æŒ‡ä»¤&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Trailer&lt;/td&gt;
      &lt;td&gt;æŠ¥æ–‡æœ«ç«¯çš„é¦–éƒ¨ä¸€è§ˆ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Transfer-Encoding&lt;/td&gt;
      &lt;td&gt;æŒ‡å®šæŠ¥æ–‡ä¸»ä½“çš„ä¼ è¾“ç¼–ç æ–¹å¼&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Upgrade&lt;/td&gt;
      &lt;td&gt;å‡çº§ä¸ºå…¶ä»–åè®®&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Via&lt;/td&gt;
      &lt;td&gt;ä»£ç†æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Warning&lt;/td&gt;
      &lt;td&gt;é”™è¯¯é€šçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h4 id=&quot;242-è¯·æ±‚é¦–éƒ¨å­—æ®µ&quot;&gt;2.4.2 è¯·æ±‚é¦–éƒ¨å­—æ®µ&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;é¦–éƒ¨å­—æ®µå&lt;/th&gt;
      &lt;th&gt;è¯´æ˜&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Accept&lt;/td&gt;
      &lt;td&gt;ç”¨æˆ·ä»£ç†å¯å¤„ç†çš„åª’ä½“ç±»å‹&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Accept-Charset&lt;/td&gt;
      &lt;td&gt;ä¼˜å…ˆçš„å­—ç¬¦é›†&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Accept-Encoding&lt;/td&gt;
      &lt;td&gt;ä¼˜å…ˆçš„å†…å®¹ç¼–ç &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Accept-Language&lt;/td&gt;
      &lt;td&gt;ä¼˜å…ˆçš„è¯­è¨€ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Authorization&lt;/td&gt;
      &lt;td&gt;Web è®¤è¯ä¿¡æ¯&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Expect&lt;/td&gt;
      &lt;td&gt;æœŸå¾…æœåŠ¡å™¨çš„ç‰¹å®šè¡Œä¸º&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;From&lt;/td&gt;
      &lt;td&gt;ç”¨æˆ·çš„ç”µå­é‚®ç®±åœ°å€&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Host&lt;/td&gt;
      &lt;td&gt;è¯·æ±‚èµ„æºæ‰€åœ¨æœåŠ¡å™¨&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;If-Match&lt;/td&gt;
      &lt;td&gt;æ¯”è¾ƒå®ä½“æ ‡è®°ï¼ˆETagï¼‰&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;If-Modified-Since&lt;/td&gt;
      &lt;td&gt;æ¯”è¾ƒèµ„æºçš„æ›´æ–°æ—¶é—´&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;If-None-Match&lt;/td&gt;
      &lt;td&gt;æ¯”è¾ƒå®ä½“æ ‡è®°ï¼ˆä¸ If-Match ç›¸åï¼‰&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;If-Range&lt;/td&gt;
      &lt;td&gt;èµ„æºæœªæ›´æ–°æ—¶å‘é€å®ä½“ Byte çš„èŒƒå›´è¯·æ±‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;If-Unmodified-Since&lt;/td&gt;
      &lt;td&gt;æ¯”è¾ƒèµ„æºçš„æ›´æ–°æ—¶é—´ï¼ˆä¸ If-Modified-Since ç›¸åï¼‰&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Max-Forwards&lt;/td&gt;
      &lt;td&gt;æœ€å¤§ä¼ è¾“é€è·³æ•°&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Proxy-Authorization&lt;/td&gt;
      &lt;td&gt;ä»£ç†æœåŠ¡å™¨è¦æ±‚å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Range&lt;/td&gt;
      &lt;td&gt;å®ä½“çš„å­—èŠ‚èŒƒå›´è¯·æ±‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Referer&lt;/td&gt;
      &lt;td&gt;å¯¹è¯·æ±‚ä¸­ URI çš„åŸå§‹è·å–æ–¹&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;TE&lt;/td&gt;
      &lt;td&gt;ä¼ è¾“ç¼–ç çš„ä¼˜å…ˆçº§&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;User-Agent&lt;/td&gt;
      &lt;td&gt;HTTP å®¢æˆ·ç«¯ç¨‹åºçš„ä¿¡æ¯&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h4 id=&quot;243-å“åº”é¦–éƒ¨å­—æ®µ&quot;&gt;2.4.3 å“åº”é¦–éƒ¨å­—æ®µ&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;é¦–éƒ¨å­—æ®µå&lt;/th&gt;
      &lt;th&gt;è¯´æ˜&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Accept-Ranges&lt;/td&gt;
      &lt;td&gt;æ˜¯å¦æ¥å—å­—èŠ‚èŒƒå›´è¯·æ±‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Age&lt;/td&gt;
      &lt;td&gt;æ¨ç®—èµ„æºåˆ›å»ºç»è¿‡æ—¶é—´&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ETag&lt;/td&gt;
      &lt;td&gt;èµ„æºçš„åŒ¹é…ä¿¡æ¯&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Location&lt;/td&gt;
      &lt;td&gt;ä»¤å®¢æˆ·ç«¯é‡å®šå‘è‡³æŒ‡å®š URI&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Proxy-Authenticate&lt;/td&gt;
      &lt;td&gt;ä»£ç†æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Retry-After&lt;/td&gt;
      &lt;td&gt;å¯¹å†æ¬¡å‘èµ·è¯·æ±‚çš„æ—¶æœºè¦æ±‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Server&lt;/td&gt;
      &lt;td&gt;HTTP æœåŠ¡å™¨çš„å®‰è£…ä¿¡æ¯&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Vary&lt;/td&gt;
      &lt;td&gt;ä»£ç†æœåŠ¡å™¨ç¼“å­˜çš„ç®¡ç†ä¿¡æ¯&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;WWW-Authenticate&lt;/td&gt;
      &lt;td&gt;æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h4 id=&quot;244-å®ä½“é¦–éƒ¨å­—æ®µ&quot;&gt;2.4.4 å®ä½“é¦–éƒ¨å­—æ®µ&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;é¦–éƒ¨å­—æ®µå&lt;/th&gt;
      &lt;th&gt;è¯´æ˜&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Allow&lt;/td&gt;
      &lt;td&gt;èµ„æºå¯æ”¯æŒçš„ HTTP æ–¹æ³•&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Content-Encoding&lt;/td&gt;
      &lt;td&gt;å®ä½“ä¸»ä½“é€‚ç”¨çš„ç¼–ç æ–¹å¼&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Content-Language&lt;/td&gt;
      &lt;td&gt;å®ä½“ä¸»ä½“çš„è‡ªç„¶è¯­è¨€&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Content-Length&lt;/td&gt;
      &lt;td&gt;å®ä½“ä¸»ä½“çš„å¤§å°&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Content-Location&lt;/td&gt;
      &lt;td&gt;æ›¿ä»£å¯¹åº”èµ„æºçš„ URI&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Content-MD5&lt;/td&gt;
      &lt;td&gt;å®ä½“ä¸»ä½“çš„æŠ¥æ–‡æ‘˜è¦&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Content-Range&lt;/td&gt;
      &lt;td&gt;å®ä½“ä¸»ä½“çš„ä½ç½®èŒƒå›´&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Content-Type&lt;/td&gt;
      &lt;td&gt;å®ä½“ä¸»ä½“çš„åª’ä½“ç±»å‹&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Expires&lt;/td&gt;
      &lt;td&gt;å®ä½“ä¸»ä½“è¿‡æœŸçš„æ—¥æœŸæ—¶é—´&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Last-Modified&lt;/td&gt;
      &lt;td&gt;èµ„æºçš„æœ€åä¿®æ”¹æ—¥æœŸæ—¶é—´&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;25-å…·ä½“åº”ç”¨&quot;&gt;2.5 å…·ä½“åº”ç”¨&lt;/h3&gt;

&lt;h4 id=&quot;251-è¿æ¥ç®¡ç†&quot;&gt;2.5.1 è¿æ¥ç®¡ç†&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/HTTP1_x_Connections.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;2511-çŸ­è¿æ¥ä¸é•¿è¿æ¥&quot;&gt;2.5.1.1 çŸ­è¿æ¥ä¸é•¿è¿æ¥&lt;/h5&gt;

&lt;p&gt;å½“æµè§ˆå™¨è®¿é—®ä¸€ä¸ªåŒ…å«å¤šå¼ å›¾ç‰‡çš„ HTML é¡µé¢æ—¶ï¼Œé™¤äº†è¯·æ±‚è®¿é—®çš„ HTML é¡µé¢èµ„æºï¼Œè¿˜ä¼šè¯·æ±‚å›¾ç‰‡èµ„æºã€‚å¦‚æœæ¯è¿›è¡Œä¸€æ¬¡ HTTP é€šä¿¡å°±è¦æ–°å»ºä¸€ä¸ª TCP è¿æ¥ï¼Œé‚£ä¹ˆå¼€é”€ä¼šå¾ˆå¤§ã€‚&lt;/p&gt;

&lt;p&gt;é•¿è¿æ¥åªéœ€è¦å»ºç«‹ä¸€æ¬¡ TCP è¿æ¥å°±èƒ½è¿›è¡Œå¤šæ¬¡ HTTP é€šä¿¡ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä» HTTP/1.1 å¼€å§‹é»˜è®¤æ˜¯é•¿è¿æ¥çš„ï¼Œå¦‚æœè¦æ–­å¼€è¿æ¥ï¼Œéœ€è¦ç”±å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨ç«¯æå‡ºæ–­å¼€ï¼Œä½¿ç”¨ &lt;code class=&quot;highlighter-rouge&quot;&gt;Connection : close&lt;/code&gt;ï¼›&lt;/li&gt;
  &lt;li&gt;åœ¨ HTTP/1.1 ä¹‹å‰é»˜è®¤æ˜¯çŸ­è¿æ¥çš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨é•¿è¿æ¥ï¼Œåˆ™ä½¿ç”¨ &lt;code class=&quot;highlighter-rouge&quot;&gt;Connection : Keep-Alive&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;2512-æµæ°´çº¿&quot;&gt;2.5.1.2 æµæ°´çº¿&lt;/h5&gt;

&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒHTTP è¯·æ±‚æ˜¯æŒ‰é¡ºåºå‘å‡ºçš„ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚åªæœ‰åœ¨å½“å‰è¯·æ±‚æ”¶åˆ°å“åº”ä¹‹åæ‰ä¼šè¢«å‘å‡ºã€‚ç”±äºå—åˆ°ç½‘ç»œå»¶è¿Ÿå’Œå¸¦å®½çš„é™åˆ¶ï¼Œåœ¨ä¸‹ä¸€ä¸ªè¯·æ±‚è¢«å‘é€åˆ°æœåŠ¡å™¨ä¹‹å‰ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…å¾ˆé•¿æ—¶é—´ã€‚&lt;/p&gt;

&lt;p&gt;æµæ°´çº¿æ˜¯åœ¨åŒä¸€æ¡é•¿è¿æ¥ä¸Šè¿ç»­å‘å‡ºè¯·æ±‚ï¼Œè€Œä¸ç”¨ç­‰å¾…å“åº”è¿”å›ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å»¶è¿Ÿã€‚&lt;/p&gt;

&lt;h4 id=&quot;252-cookie&quot;&gt;2.5.2 Cookie&lt;/h4&gt;

&lt;p&gt;HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸»è¦æ˜¯ä¸ºäº†è®© HTTP åè®®å°½å¯èƒ½ç®€å•ï¼Œä½¿å¾—å®ƒèƒ½å¤Ÿå¤„ç†å¤§é‡äº‹åŠ¡ã€‚HTTP/1.1 å¼•å…¥ Cookie æ¥ä¿å­˜çŠ¶æ€ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;p&gt;Cookie æ˜¯æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨å¹¶ä¿å­˜åœ¨æœ¬åœ°çš„ä¸€å°å—æ•°æ®ï¼Œå®ƒä¼šåœ¨æµè§ˆå™¨ä¹‹åå‘åŒä¸€æœåŠ¡å™¨å†æ¬¡å‘èµ·è¯·æ±‚æ—¶è¢«æºå¸¦ä¸Šï¼Œç”¨äºå‘ŠçŸ¥æœåŠ¡ç«¯ä¸¤ä¸ªè¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€æµè§ˆå™¨ã€‚ç”±äºä¹‹åæ¯æ¬¡è¯·æ±‚éƒ½ä¼šéœ€è¦æºå¸¦ Cookie æ•°æ®ï¼Œå› æ­¤ä¼šå¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€ï¼ˆå°¤å…¶æ˜¯åœ¨ç§»åŠ¨ç¯å¢ƒä¸‹ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;Cookie æ›¾ä¸€åº¦ç”¨äºå®¢æˆ·ç«¯æ•°æ®çš„å­˜å‚¨ï¼Œå› ä¸ºå½“æ—¶å¹¶æ²¡æœ‰å…¶å®ƒåˆé€‚çš„å­˜å‚¨åŠæ³•è€Œä½œä¸ºå”¯ä¸€çš„å­˜å‚¨æ‰‹æ®µï¼Œä½†ç°åœ¨éšç€ç°ä»£æµè§ˆå™¨å¼€å§‹æ”¯æŒå„ç§å„æ ·çš„å­˜å‚¨æ–¹å¼ï¼ŒCookie æ¸æ¸è¢«æ·˜æ±°ã€‚æ–°çš„æµè§ˆå™¨ API å·²ç»å…è®¸å¼€å‘è€…ç›´æ¥å°†æ•°æ®å­˜å‚¨åˆ°æœ¬åœ°ï¼Œå¦‚ä½¿ç”¨ Web storage APIï¼ˆæœ¬åœ°å­˜å‚¨å’Œä¼šè¯å­˜å‚¨ï¼‰æˆ– IndexedDBã€‚&lt;/p&gt;

&lt;h4 id=&quot;2521-ç”¨é€”&quot;&gt;2.5.2.1 ç”¨é€”&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ã€æ¸¸æˆåˆ†æ•°æˆ–å…¶å®ƒéœ€è¦è®°å½•çš„ä¿¡æ¯ï¼‰&lt;/li&gt;
  &lt;li&gt;ä¸ªæ€§åŒ–è®¾ç½®ï¼ˆå¦‚ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®ã€ä¸»é¢˜ç­‰ï¼‰&lt;/li&gt;
  &lt;li&gt;æµè§ˆå™¨è¡Œä¸ºè·Ÿè¸ªï¼ˆå¦‚è·Ÿè¸ªåˆ†æç”¨æˆ·è¡Œä¸ºç­‰ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;2522-åˆ›å»ºè¿‡ç¨‹&quot;&gt;2.5.2.2 åˆ›å»ºè¿‡ç¨‹&lt;/h5&gt;

&lt;p&gt;æœåŠ¡å™¨å‘é€çš„å“åº”æŠ¥æ–‡åŒ…å« Set-Cookie é¦–éƒ¨å­—æ®µï¼Œå®¢æˆ·ç«¯å¾—åˆ°å“åº”æŠ¥æ–‡åæŠŠ Cookie å†…å®¹ä¿å­˜åˆ°æµè§ˆå™¨ä¸­ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-pseudocode&quot;&gt;HTTP/1.0 200 OK
Content-type: text/html
Set-Cookie: yummy_cookie=choco
Set-Cookie: tasty_cookie=strawberry

[page content]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®¢æˆ·ç«¯ä¹‹åå¯¹åŒä¸€ä¸ªæœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œä¼šä»æµè§ˆå™¨ä¸­å–å‡º Cookie ä¿¡æ¯å¹¶é€šè¿‡ Cookie è¯·æ±‚é¦–éƒ¨å­—æ®µå‘é€ç»™æœåŠ¡å™¨ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;GET /sample_page.html HTTP/1.1
Host: www.example.org
Cookie: yummy_cookie=choco; tasty_cookie=strawberry
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;2523-åˆ†ç±»&quot;&gt;2.5.2.3 åˆ†ç±»&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;ä¼šè¯æœŸ Cookieï¼šæµè§ˆå™¨å…³é—­ä¹‹åå®ƒä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»…åœ¨ä¼šè¯æœŸå†…æœ‰æ•ˆã€‚&lt;/li&gt;
  &lt;li&gt;æŒä¹…æ€§ Cookieï¼šæŒ‡å®šè¿‡æœŸæ—¶é—´ï¼ˆExpiresï¼‰æˆ–æœ‰æ•ˆæœŸï¼ˆmax-ageï¼‰ä¹‹åå°±æˆä¸ºäº†æŒä¹…æ€§çš„ Cookieã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;2524-ä½œç”¨åŸŸ&quot;&gt;2.5.2.4 ä½œç”¨åŸŸ&lt;/h5&gt;

&lt;p&gt;Domain æ ‡è¯†æŒ‡å®šäº†å“ªäº›ä¸»æœºå¯ä»¥æ¥å— Cookieã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸ºå½“å‰æ–‡æ¡£çš„ä¸»æœºï¼ˆä¸åŒ…å«å­åŸŸåï¼‰ã€‚å¦‚æœæŒ‡å®šäº† Domainï¼Œåˆ™ä¸€èˆ¬åŒ…å«å­åŸŸåã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½® Domain=mozilla.orgï¼Œåˆ™ Cookie ä¹ŸåŒ…å«åœ¨å­åŸŸåä¸­ï¼ˆå¦‚ developer.mozilla.orgï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;Path æ ‡è¯†æŒ‡å®šäº†ä¸»æœºä¸‹çš„å“ªäº›è·¯å¾„å¯ä»¥æ¥å— Cookieï¼ˆè¯¥ URL è·¯å¾„å¿…é¡»å­˜åœ¨äºè¯·æ±‚ URL ä¸­ï¼‰ã€‚ä»¥å­—ç¬¦ %x2F (â€œ/â€) ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦ï¼Œå­è·¯å¾„ä¹Ÿä¼šè¢«åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œè®¾ç½® Path=/docsï¼Œåˆ™ä»¥ä¸‹åœ°å€éƒ½ä¼šåŒ¹é…ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;/docs&lt;/li&gt;
  &lt;li&gt;/docs/Web/&lt;/li&gt;
  &lt;li&gt;/docs/Web/HTTP&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;2525--javascript&quot;&gt;2.5.2.5  JavaScript&lt;/h5&gt;

&lt;p&gt;æµè§ˆå™¨é€šè¿‡ &lt;code class=&quot;highlighter-rouge&quot;&gt;document.cookie&lt;/code&gt; å±æ€§å¯åˆ›å»ºæ–°çš„ Cookieï¼Œä¹Ÿå¯é€šè¿‡è¯¥å±æ€§è®¿é—®é HttpOnly æ ‡è®°çš„ Cookieã€‚&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cookie&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;yummy_cookie=choco&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cookie&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;tasty_cookie=strawberry&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;2526-httponly&quot;&gt;2.5.2.6 HttpOnly&lt;/h5&gt;

&lt;p&gt;æ ‡è®°ä¸º HttpOnly çš„ Cookie ä¸èƒ½è¢« JavaScript è„šæœ¬è°ƒç”¨ã€‚è·¨ç«™è„šæœ¬æ”»å‡» (XSS) å¸¸å¸¸ä½¿ç”¨ JavaScript çš„ &lt;code class=&quot;highlighter-rouge&quot;&gt;document.cookie&lt;/code&gt; API çªƒå–ç”¨æˆ·çš„ Cookie ä¿¡æ¯ï¼Œå› æ­¤ä½¿ç”¨ HttpOnly æ ‡è®°å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å… XSS æ”»å‡»ã€‚&lt;/p&gt;

&lt;div class=&quot;language-http highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;err&quot;&gt;Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;2527-secure&quot;&gt;2.5.2.7 Secure&lt;/h5&gt;

&lt;p&gt;æ ‡è®°ä¸º Secure çš„ Cookie åªèƒ½é€šè¿‡è¢« HTTPS åè®®åŠ å¯†è¿‡çš„è¯·æ±‚å‘é€ç»™æœåŠ¡ç«¯ã€‚ä½†å³ä¾¿è®¾ç½®äº† Secure æ ‡è®°ï¼Œæ•æ„Ÿä¿¡æ¯ä¹Ÿä¸åº”è¯¥é€šè¿‡ Cookie ä¼ è¾“ï¼Œå› ä¸º Cookie æœ‰å…¶å›ºæœ‰çš„ä¸å®‰å…¨æ€§ï¼ŒSecure æ ‡è®°ä¹Ÿæ— æ³•æä¾›ç¡®å®çš„å®‰å…¨ä¿éšœã€‚&lt;/p&gt;

&lt;h5 id=&quot;2528-session&quot;&gt;2.5.2.8 Session&lt;/h5&gt;

&lt;p&gt;é™¤äº†å¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯é€šè¿‡ Cookie å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ Session å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„ä¿¡æ¯æ›´åŠ å®‰å…¨ã€‚&lt;/p&gt;

&lt;p&gt;Session å¯ä»¥å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€æ•°æ®åº“æˆ–è€…å†…å­˜ä¸­ã€‚ä¹Ÿå¯ä»¥å°† Session å­˜å‚¨åœ¨ Redis è¿™ç§å†…å­˜å‹æ•°æ®åº“ä¸­ï¼Œæ•ˆç‡ä¼šæ›´é«˜ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ Session ç»´æŠ¤ç”¨æˆ·ç™»å½•çŠ¶æ€çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç”¨æˆ·è¿›è¡Œç™»å½•æ—¶ï¼Œç”¨æˆ·æäº¤åŒ…å«ç”¨æˆ·åå’Œå¯†ç çš„è¡¨å•ï¼Œæ”¾å…¥ HTTP è¯·æ±‚æŠ¥æ–‡ä¸­ï¼›&lt;/li&gt;
  &lt;li&gt;æœåŠ¡å™¨éªŒè¯è¯¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœæ­£ç¡®åˆ™æŠŠç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ° Redis ä¸­ï¼Œå®ƒåœ¨ Redis ä¸­çš„ Key ç§°ä¸º Session IDï¼›&lt;/li&gt;
  &lt;li&gt;æœåŠ¡å™¨è¿”å›çš„å“åº”æŠ¥æ–‡çš„ Set-Cookie é¦–éƒ¨å­—æ®µåŒ…å«äº†è¿™ä¸ª Session IDï¼Œå®¢æˆ·ç«¯æ”¶åˆ°å“åº”æŠ¥æ–‡ä¹‹åå°†è¯¥ Cookie å€¼å­˜å…¥æµè§ˆå™¨ä¸­ï¼›&lt;/li&gt;
  &lt;li&gt;å®¢æˆ·ç«¯ä¹‹åå¯¹åŒä¸€ä¸ªæœåŠ¡å™¨è¿›è¡Œè¯·æ±‚æ—¶ä¼šåŒ…å«è¯¥ Cookie å€¼ï¼ŒæœåŠ¡å™¨æ”¶åˆ°ä¹‹åæå–å‡º Session IDï¼Œä» Redis ä¸­å–å‡ºç”¨æˆ·ä¿¡æ¯ï¼Œç»§ç»­ä¹‹å‰çš„ä¸šåŠ¡æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åº”è¯¥æ³¨æ„ Session ID çš„å®‰å…¨æ€§é—®é¢˜ï¼Œä¸èƒ½è®©å®ƒè¢«æ¶æ„æ”»å‡»è€…è½»æ˜“è·å–ï¼Œé‚£ä¹ˆå°±ä¸èƒ½äº§ç”Ÿä¸€ä¸ªå®¹æ˜“è¢«çŒœåˆ°çš„ Session ID å€¼ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦ç»å¸¸é‡æ–°ç”Ÿæˆ Session IDã€‚åœ¨å¯¹å®‰å…¨æ€§è¦æ±‚æé«˜çš„åœºæ™¯ä¸‹ï¼Œä¾‹å¦‚è½¬è´¦ç­‰æ“ä½œï¼Œé™¤äº†ä½¿ç”¨ Session ç®¡ç†ç”¨æˆ·çŠ¶æ€ä¹‹å¤–ï¼Œè¿˜éœ€è¦å¯¹ç”¨æˆ·è¿›è¡Œé‡æ–°éªŒè¯ï¼Œæ¯”å¦‚é‡æ–°è¾“å…¥å¯†ç ï¼Œæˆ–è€…ä½¿ç”¨çŸ­ä¿¡éªŒè¯ç ç­‰æ–¹å¼ã€‚&lt;/p&gt;

&lt;h5 id=&quot;2529-æµè§ˆå™¨ç¦ç”¨-cookie&quot;&gt;2.5.2.9 æµè§ˆå™¨ç¦ç”¨ Cookie&lt;/h5&gt;

&lt;p&gt;æ­¤æ—¶æ— æ³•ä½¿ç”¨ Cookie æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œåªèƒ½ä½¿ç”¨ Sessionã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸èƒ½å†å°† Session ID å­˜æ”¾åˆ° Cookie ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨ URL é‡å†™æŠ€æœ¯ï¼Œå°† Session ID ä½œä¸º URL çš„å‚æ•°è¿›è¡Œä¼ é€’ã€‚&lt;/p&gt;

&lt;h5 id=&quot;25210-cookie-ä¸-session-é€‰æ‹©&quot;&gt;2.5.2.10 Cookie ä¸ Session é€‰æ‹©&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;Cookie åªèƒ½å­˜å‚¨ ASCII ç å­—ç¬¦ä¸²ï¼Œè€Œ Session åˆ™å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œå› æ­¤åœ¨è€ƒè™‘æ•°æ®å¤æ‚æ€§æ—¶é¦–é€‰ Sessionï¼›&lt;/li&gt;
  &lt;li&gt;Cookie å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ï¼Œå®¹æ˜“è¢«æ¶æ„æŸ¥çœ‹ã€‚å¦‚æœéè¦å°†ä¸€äº›éšç§æ•°æ®å­˜åœ¨ Cookie ä¸­ï¼Œå¯ä»¥å°† Cookie å€¼è¿›è¡ŒåŠ å¯†ï¼Œç„¶ååœ¨æœåŠ¡å™¨è¿›è¡Œè§£å¯†ï¼›&lt;/li&gt;
  &lt;li&gt;å¯¹äºå¤§å‹ç½‘ç«™ï¼Œå¦‚æœç”¨æˆ·æ‰€æœ‰çš„ä¿¡æ¯éƒ½å­˜å‚¨åœ¨ Session ä¸­ï¼Œé‚£ä¹ˆå¼€é”€æ˜¯éå¸¸å¤§çš„ï¼Œå› æ­¤ä¸å»ºè®®å°†æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯éƒ½å­˜å‚¨åˆ° Session ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;253-ç¼“å­˜&quot;&gt;2.5.3 ç¼“å­˜&lt;/h4&gt;

&lt;h5 id=&quot;2531-ä¼˜ç‚¹&quot;&gt;2.5.3.1 ä¼˜ç‚¹&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;ç¼“è§£æœåŠ¡å™¨å‹åŠ›ï¼›&lt;/li&gt;
  &lt;li&gt;é™ä½å®¢æˆ·ç«¯è·å–èµ„æºçš„å»¶è¿Ÿï¼šç¼“å­˜é€šå¸¸ä½äºå†…å­˜ä¸­ï¼Œè¯»å–ç¼“å­˜çš„é€Ÿåº¦æ›´å¿«ã€‚å¹¶ä¸”ç¼“å­˜æœåŠ¡å™¨åœ¨åœ°ç†ä½ç½®ä¸Šä¹Ÿæœ‰å¯èƒ½æ¯”æºæœåŠ¡å™¨æ¥å¾—è¿‘ï¼Œä¾‹å¦‚æµè§ˆå™¨ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;2532-å®ç°æ–¹æ³•&quot;&gt;2.5.3.2 å®ç°æ–¹æ³•&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;è®©ä»£ç†æœåŠ¡å™¨è¿›è¡Œç¼“å­˜ï¼›&lt;/li&gt;
  &lt;li&gt;è®©å®¢æˆ·ç«¯æµè§ˆå™¨è¿›è¡Œç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;2533-cache-control&quot;&gt;2.5.3.3 Cache-Control&lt;/h5&gt;

&lt;p&gt;HTTP/1.1 é€šè¿‡ Cache-Control é¦–éƒ¨å­—æ®µæ¥æ§åˆ¶ç¼“å­˜ã€‚&lt;/p&gt;

&lt;h6 id=&quot;25331-ç¦æ­¢è¿›è¡Œç¼“å­˜&quot;&gt;2.5.3.3.1 ç¦æ­¢è¿›è¡Œç¼“å­˜&lt;/h6&gt;

&lt;p&gt;no-store æŒ‡ä»¤è§„å®šä¸èƒ½å¯¹è¯·æ±‚æˆ–å“åº”çš„ä»»ä½•ä¸€éƒ¨åˆ†è¿›è¡Œç¼“å­˜ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Cache-Control: no-storeCopy to clipboardErrorCopied
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h6 id=&quot;25332-å¼ºåˆ¶ç¡®è®¤ç¼“å­˜&quot;&gt;2.5.3.3.2 å¼ºåˆ¶ç¡®è®¤ç¼“å­˜&lt;/h6&gt;

&lt;p&gt;no-cache æŒ‡ä»¤è§„å®šç¼“å­˜æœåŠ¡å™¨éœ€è¦å…ˆå‘æºæœåŠ¡å™¨éªŒè¯ç¼“å­˜èµ„æºçš„æœ‰æ•ˆæ€§ï¼Œåªæœ‰å½“ç¼“å­˜èµ„æºæœ‰æ•ˆæ—¶æ‰èƒ½ä½¿ç”¨è¯¥ç¼“å­˜å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚è¿›è¡Œå“åº”ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Cache-Control: no-cacheCopy to clipboardErrorCopied
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h6 id=&quot;25333-ç§æœ‰ç¼“å­˜å’Œå…¬å…±ç¼“å­˜&quot;&gt;2.5.3.3.3 ç§æœ‰ç¼“å­˜å’Œå…¬å…±ç¼“å­˜&lt;/h6&gt;

&lt;p&gt;private æŒ‡ä»¤è§„å®šäº†å°†èµ„æºä½œä¸ºç§æœ‰ç¼“å­˜ï¼Œåªèƒ½è¢«å•ç‹¬ç”¨æˆ·ä½¿ç”¨ï¼Œä¸€èˆ¬å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Cache-Control: privateCopy to clipboardErrorCopied
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;public æŒ‡ä»¤è§„å®šäº†å°†èµ„æºä½œä¸ºå…¬å…±ç¼“å­˜ï¼Œå¯ä»¥è¢«å¤šä¸ªç”¨æˆ·ä½¿ç”¨ï¼Œä¸€èˆ¬å­˜å‚¨åœ¨ä»£ç†æœåŠ¡å™¨ä¸­ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Cache-Control: publicCopy to clipboardErrorCopied
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h6 id=&quot;25334-ç¼“å­˜è¿‡æœŸæœºåˆ¶&quot;&gt;2.5.3.3.4 ç¼“å­˜è¿‡æœŸæœºåˆ¶&lt;/h6&gt;

&lt;p&gt;max-age æŒ‡ä»¤å‡ºç°åœ¨è¯·æ±‚æŠ¥æ–‡ï¼Œå¹¶ä¸”ç¼“å­˜èµ„æºçš„ç¼“å­˜æ—¶é—´å°äºè¯¥æŒ‡ä»¤æŒ‡å®šçš„æ—¶é—´ï¼Œé‚£ä¹ˆå°±èƒ½æ¥å—è¯¥ç¼“å­˜ã€‚&lt;/p&gt;

&lt;p&gt;max-age æŒ‡ä»¤å‡ºç°åœ¨å“åº”æŠ¥æ–‡ï¼Œè¡¨ç¤ºç¼“å­˜èµ„æºåœ¨ç¼“å­˜æœåŠ¡å™¨ä¸­ä¿å­˜çš„æ—¶é—´ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Cache-Control: max-age=31536000
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Expires é¦–éƒ¨å­—æ®µä¹Ÿå¯ä»¥ç”¨äºå‘ŠçŸ¥ç¼“å­˜æœåŠ¡å™¨è¯¥èµ„æºä»€ä¹ˆæ—¶å€™ä¼šè¿‡æœŸã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Expires: Wed, 04 Jul 2012 08:26:05 GMT
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;åœ¨ HTTP/1.1 ä¸­ï¼Œä¼šä¼˜å…ˆå¤„ç† max-age æŒ‡ä»¤ï¼›&lt;/li&gt;
  &lt;li&gt;åœ¨ HTTP/1.0 ä¸­ï¼Œmax-age æŒ‡ä»¤ä¼šè¢«å¿½ç•¥æ‰ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;2534-ç¼“å­˜éªŒè¯&quot;&gt;2.5.3.4 ç¼“å­˜éªŒè¯&lt;/h5&gt;

&lt;p&gt;éœ€è¦å…ˆäº†è§£ ETag é¦–éƒ¨å­—æ®µçš„å«ä¹‰ï¼Œå®ƒæ˜¯èµ„æºçš„å”¯ä¸€æ ‡è¯†ã€‚URL ä¸èƒ½å”¯ä¸€è¡¨ç¤ºèµ„æºï¼Œä¾‹å¦‚ &lt;code class=&quot;highlighter-rouge&quot;&gt;http://www.google.com/&lt;/code&gt; æœ‰ä¸­æ–‡å’Œè‹±æ–‡ä¸¤ä¸ªèµ„æºï¼Œåªæœ‰ ETag æ‰èƒ½å¯¹è¿™ä¸¤ä¸ªèµ„æºè¿›è¡Œå”¯ä¸€æ ‡è¯†ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;ETag: &quot;82e22293907ce725faf67773957acd12&quot;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥å°†ç¼“å­˜èµ„æºçš„ ETag å€¼æ”¾å…¥ If-None-Match é¦–éƒ¨ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯¥è¯·æ±‚åï¼Œåˆ¤æ–­ç¼“å­˜èµ„æºçš„ ETag å€¼å’Œèµ„æºçš„æœ€æ–° ETag å€¼æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™è¡¨ç¤ºç¼“å­˜èµ„æºæœ‰æ•ˆï¼Œè¿”å› 304 Not Modifiedã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;If-None-Match: &quot;82e22293907ce725faf67773957acd12&quot;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Last-Modified é¦–éƒ¨å­—æ®µä¹Ÿå¯ä»¥ç”¨äºç¼“å­˜éªŒè¯ï¼Œå®ƒåŒ…å«åœ¨æºæœåŠ¡å™¨å‘é€çš„å“åº”æŠ¥æ–‡ä¸­ï¼ŒæŒ‡ç¤ºæºæœåŠ¡å™¨å¯¹èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´ã€‚ä½†æ˜¯å®ƒæ˜¯ä¸€ç§å¼±æ ¡éªŒå™¨ï¼Œå› ä¸ºåªèƒ½ç²¾ç¡®åˆ°ä¸€ç§’ï¼Œæ‰€ä»¥å®ƒé€šå¸¸ä½œä¸º ETag çš„å¤‡ç”¨æ–¹æ¡ˆã€‚å¦‚æœå“åº”é¦–éƒ¨å­—æ®µé‡Œå«æœ‰è¿™ä¸ªä¿¡æ¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨åç»­çš„è¯·æ±‚ä¸­å¸¦ä¸Š If-Modified-Since æ¥éªŒè¯ç¼“å­˜ã€‚æœåŠ¡å™¨åªåœ¨æ‰€è¯·æ±‚çš„èµ„æºåœ¨ç»™å®šçš„æ—¥æœŸæ—¶é—´ä¹‹åå¯¹å†…å®¹è¿›è¡Œè¿‡ä¿®æ”¹çš„æƒ…å†µä¸‹æ‰ä¼šå°†èµ„æºè¿”å›ï¼ŒçŠ¶æ€ç ä¸º 200 OKã€‚å¦‚æœè¯·æ±‚çš„èµ„æºä»é‚£æ—¶èµ·æœªç»ä¿®æ”¹ï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ªä¸å¸¦æœ‰å®ä½“ä¸»ä½“çš„ 304 Not Modified å“åº”æŠ¥æ–‡ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Last-Modified: Wed, 21 Oct 2015 07:28:00 GMT
If-Modified-Since: Wed, 21 Oct 2015 07:28:00 GMT
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;254-å†…å®¹åå•†&quot;&gt;2.5.4 å†…å®¹åå•†&lt;/h4&gt;

&lt;p&gt;é€šè¿‡å†…å®¹åå•†è¿”å›æœ€åˆé€‚çš„å†…å®¹ï¼Œä¾‹å¦‚æ ¹æ®æµè§ˆå™¨çš„é»˜è®¤è¯­è¨€é€‰æ‹©è¿”å›ä¸­æ–‡ç•Œé¢è¿˜æ˜¯è‹±æ–‡ç•Œé¢ã€‚&lt;/p&gt;

&lt;h5 id=&quot;2541-ç±»å‹&quot;&gt;2.5.4.1 ç±»å‹&lt;/h5&gt;

&lt;p&gt;&lt;strong&gt;2.5.4.1.1 æœåŠ¡ç«¯é©±åŠ¨å‹&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å®¢æˆ·ç«¯è®¾ç½®ç‰¹å®šçš„ HTTP é¦–éƒ¨å­—æ®µï¼Œä¾‹å¦‚ Acceptã€Accept-Charsetã€Accept-Encodingã€Accept-Languageï¼ŒæœåŠ¡å™¨æ ¹æ®è¿™äº›å­—æ®µè¿”å›ç‰¹å®šçš„èµ„æºã€‚&lt;/p&gt;

&lt;p&gt;å®ƒå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æœåŠ¡å™¨å¾ˆéš¾çŸ¥é“å®¢æˆ·ç«¯æµè§ˆå™¨çš„å…¨éƒ¨ä¿¡æ¯ï¼›&lt;/li&gt;
  &lt;li&gt;å®¢æˆ·ç«¯æä¾›çš„ä¿¡æ¯ç›¸å½“å†—é•¿ï¼ˆHTTP/2 åè®®çš„é¦–éƒ¨å‹ç¼©æœºåˆ¶ç¼“è§£äº†è¿™ä¸ªé—®é¢˜ï¼‰ï¼Œå¹¶ä¸”å­˜åœ¨éšç§é£é™©ï¼ˆHTTP æŒ‡çº¹è¯†åˆ«æŠ€æœ¯ï¼‰ï¼›&lt;/li&gt;
  &lt;li&gt;ç»™å®šçš„èµ„æºéœ€è¦è¿”å›ä¸åŒçš„å±•ç°å½¢å¼ï¼Œå…±äº«ç¼“å­˜çš„æ•ˆç‡ä¼šé™ä½ï¼Œè€ŒæœåŠ¡å™¨ç«¯çš„å®ç°ä¼šè¶Šæ¥è¶Šå¤æ‚ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;2.5.4.1.2 ä»£ç†é©±åŠ¨å‹&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æœåŠ¡å™¨è¿”å› 300 Multiple Choices æˆ–è€… 406 Not Acceptableï¼Œå®¢æˆ·ç«¯ä»ä¸­é€‰å‡ºæœ€åˆé€‚çš„é‚£ä¸ªèµ„æºã€‚&lt;/p&gt;

&lt;h5 id=&quot;2542-vary&quot;&gt;2.5.4.2 Vary&lt;/h5&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Vary: Accept-Language
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ä½¿ç”¨å†…å®¹åå•†çš„æƒ…å†µä¸‹ï¼Œåªæœ‰å½“ç¼“å­˜æœåŠ¡å™¨ä¸­çš„ç¼“å­˜æ»¡è¶³å†…å®¹åå•†æ¡ä»¶æ—¶ï¼Œæ‰èƒ½ä½¿ç”¨è¯¥ç¼“å­˜ï¼Œå¦åˆ™åº”è¯¥å‘æºæœåŠ¡å™¨è¯·æ±‚è¯¥èµ„æºã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªåŒ…å« Accept-Language é¦–éƒ¨å­—æ®µçš„è¯·æ±‚ä¹‹åï¼ŒæºæœåŠ¡å™¨è¿”å›çš„å“åº”åŒ…å« &lt;code class=&quot;highlighter-rouge&quot;&gt;Vary: Accept-Language&lt;/code&gt; å†…å®¹ï¼Œç¼“å­˜æœåŠ¡å™¨å¯¹è¿™ä¸ªå“åº”è¿›è¡Œç¼“å­˜ä¹‹åï¼Œåœ¨å®¢æˆ·ç«¯ä¸‹ä¸€æ¬¡è®¿é—®åŒä¸€ä¸ª URL èµ„æºï¼Œå¹¶ä¸” Accept-Language ä¸ç¼“å­˜ä¸­çš„å¯¹åº”çš„å€¼ç›¸åŒæ—¶æ‰ä¼šè¿”å›è¯¥ç¼“å­˜ã€‚&lt;/p&gt;

&lt;h4 id=&quot;255-å†…å®¹ç¼–ç &quot;&gt;2.5.5 å†…å®¹ç¼–ç &lt;/h4&gt;

&lt;p&gt;å†…å®¹ç¼–ç å°†å®ä½“ä¸»ä½“è¿›è¡Œå‹ç¼©ï¼Œä»è€Œå‡å°‘ä¼ è¾“çš„æ•°æ®é‡ã€‚&lt;/p&gt;

&lt;p&gt;å¸¸ç”¨çš„å†…å®¹ç¼–ç æœ‰ï¼šgzipã€compressã€deflateã€identityã€‚&lt;/p&gt;

&lt;p&gt;æµè§ˆå™¨å‘é€ Accept-Encoding é¦–éƒ¨ï¼Œå…¶ä¸­åŒ…å«æœ‰å®ƒæ‰€æ”¯æŒçš„å‹ç¼©ç®—æ³•ï¼Œä»¥åŠå„è‡ªçš„ä¼˜å…ˆçº§ã€‚æœåŠ¡å™¨åˆ™ä»ä¸­é€‰æ‹©ä¸€ç§ï¼Œä½¿ç”¨è¯¥ç®—æ³•å¯¹å“åº”çš„æ¶ˆæ¯ä¸»ä½“è¿›è¡Œå‹ç¼©ï¼Œå¹¶ä¸”å‘é€ Content-Encoding é¦–éƒ¨æ¥å‘ŠçŸ¥æµè§ˆå™¨å®ƒé€‰æ‹©äº†å“ªä¸€ç§ç®—æ³•ã€‚ç”±äºè¯¥å†…å®¹åå•†è¿‡ç¨‹æ˜¯åŸºäºç¼–ç ç±»å‹æ¥é€‰æ‹©èµ„æºçš„å±•ç°å½¢å¼çš„ï¼Œå“åº”æŠ¥æ–‡çš„ Vary é¦–éƒ¨å­—æ®µè‡³å°‘è¦åŒ…å« Content-Encodingã€‚&lt;/p&gt;

&lt;h4 id=&quot;256-èŒƒå›´è¯·æ±‚&quot;&gt;2.5.6 èŒƒå›´è¯·æ±‚&lt;/h4&gt;

&lt;p&gt;å¦‚æœç½‘ç»œå‡ºç°ä¸­æ–­ï¼ŒæœåŠ¡å™¨åªå‘é€äº†ä¸€éƒ¨åˆ†æ•°æ®ï¼ŒèŒƒå›´è¯·æ±‚å¯ä»¥ä½¿å¾—å®¢æˆ·ç«¯åªè¯·æ±‚æœåŠ¡å™¨æœªå‘é€çš„é‚£éƒ¨åˆ†æ•°æ®ï¼Œä»è€Œé¿å…æœåŠ¡å™¨é‡æ–°å‘é€æ‰€æœ‰æ•°æ®ã€‚&lt;/p&gt;

&lt;h5 id=&quot;2561-range&quot;&gt;2.5.6.1 Range&lt;/h5&gt;

&lt;p&gt;åœ¨è¯·æ±‚æŠ¥æ–‡ä¸­æ·»åŠ  Range é¦–éƒ¨å­—æ®µæŒ‡å®šè¯·æ±‚çš„èŒƒå›´ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;GET /z4d4kWk.jpg HTTP/1.1
Host: i.imgur.com
Range: bytes=0-1023
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¯·æ±‚æˆåŠŸçš„è¯æœåŠ¡å™¨è¿”å›çš„å“åº”åŒ…å« 206 Partial Content çŠ¶æ€ç ã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;HTTP/1.1 206 Partial Content
Content-Range: bytes 0-1023/146515
Content-Length: 1024
...
(binary content)
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;2562-accept-ranges&quot;&gt;2.5.6.2 Accept-Ranges&lt;/h5&gt;

&lt;p&gt;å“åº”é¦–éƒ¨å­—æ®µ Accept-Ranges ç”¨äºå‘ŠçŸ¥å®¢æˆ·ç«¯æ˜¯å¦èƒ½å¤„ç†èŒƒå›´è¯·æ±‚ï¼Œå¯ä»¥å¤„ç†ä½¿ç”¨ bytesï¼Œå¦åˆ™ä½¿ç”¨ noneã€‚&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Accept-Ranges: bytesCopy to clipboardErrorCopied
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;2563-å“åº”çŠ¶æ€ç &quot;&gt;2.5.6.3 å“åº”çŠ¶æ€ç &lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;åœ¨è¯·æ±‚æˆåŠŸçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 206 Partial Content çŠ¶æ€ç ã€‚&lt;/li&gt;
  &lt;li&gt;åœ¨è¯·æ±‚çš„èŒƒå›´è¶Šç•Œçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 416 Requested Range Not Satisfiable çŠ¶æ€ç ã€‚&lt;/li&gt;
  &lt;li&gt;åœ¨ä¸æ”¯æŒèŒƒå›´è¯·æ±‚çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 200 OK çŠ¶æ€ç ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;257-åˆ†å—ä¼ è¾“ç¼–ç &quot;&gt;2.5.7 åˆ†å—ä¼ è¾“ç¼–ç &lt;/h4&gt;

&lt;p&gt;Chunked Transfer Encodingï¼Œå¯ä»¥æŠŠæ•°æ®åˆ†å‰²æˆå¤šå—ï¼Œè®©æµè§ˆå™¨é€æ­¥æ˜¾ç¤ºé¡µé¢ã€‚&lt;/p&gt;

&lt;h4 id=&quot;258-å¤šéƒ¨åˆ†å¯¹è±¡é›†åˆ&quot;&gt;2.5.8 å¤šéƒ¨åˆ†å¯¹è±¡é›†åˆ&lt;/h4&gt;

&lt;p&gt;ä¸€ä»½æŠ¥æ–‡ä¸»ä½“å†…å¯å«æœ‰å¤šç§ç±»å‹çš„å®ä½“åŒæ—¶å‘é€ï¼Œæ¯ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨ boundary å­—æ®µå®šä¹‰çš„åˆ†éš”ç¬¦è¿›è¡Œåˆ†éš”ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½å¯ä»¥æœ‰é¦–éƒ¨å­—æ®µã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ï¼Œä¸Šä¼ å¤šä¸ªè¡¨å•æ—¶å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Content-Type: multipart/form-data; boundary=AaB03x

--AaB03x
Content-Disposition: form-data; name=&quot;submit-name&quot;

Larry
--AaB03x
Content-Disposition: form-data; name=&quot;files&quot;; filename=&quot;file1.txt&quot;
Content-Type: text/plain

... contents of file1.txt ...
--AaB03x--
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;259-è™šæ‹Ÿä¸»æœº&quot;&gt;2.5.9 è™šæ‹Ÿä¸»æœº&lt;/h4&gt;

&lt;p&gt;HTTP/1.1 ä½¿ç”¨è™šæ‹Ÿä¸»æœºæŠ€æœ¯ï¼Œä½¿å¾—ä¸€å°æœåŠ¡å™¨æ‹¥æœ‰å¤šä¸ªåŸŸåï¼Œå¹¶ä¸”åœ¨é€»è¾‘ä¸Šå¯ä»¥çœ‹æˆå¤šä¸ªæœåŠ¡å™¨ã€‚&lt;/p&gt;

&lt;h4 id=&quot;2510-é€šä¿¡æ•°æ®è½¬å‘&quot;&gt;2.5.10 é€šä¿¡æ•°æ®è½¬å‘&lt;/h4&gt;

&lt;h5 id=&quot;25101-ä»£ç†&quot;&gt;2.5.10.1 ä»£ç†&lt;/h5&gt;

&lt;p&gt;ä»£ç†æœåŠ¡å™¨æ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶ä¸”è½¬å‘ç»™å…¶å®ƒæœåŠ¡å™¨ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ä»£ç†çš„ä¸»è¦ç›®çš„æ˜¯ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç¼“å­˜&lt;/li&gt;
  &lt;li&gt;è´Ÿè½½å‡è¡¡&lt;/li&gt;
  &lt;li&gt;ç½‘ç»œè®¿é—®æ§åˆ¶&lt;/li&gt;
  &lt;li&gt;è®¿é—®æ—¥å¿—è®°å½•&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä»£ç†æœåŠ¡å™¨åˆ†ä¸ºæ­£å‘ä»£ç†å’Œåå‘ä»£ç†ä¸¤ç§ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç”¨æˆ·å¯Ÿè§‰å¾—åˆ°æ­£å‘ä»£ç†çš„å­˜åœ¨ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/a314bb79-5b18-4e63-a976-3448bffa6f1b.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;è€Œåå‘ä»£ç†ä¸€èˆ¬ä½äºå†…éƒ¨ç½‘ç»œä¸­ï¼Œç”¨æˆ·å¯Ÿè§‰ä¸åˆ°ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/2d09a847-b854-439c-9198-b29c65810944.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;25102-ç½‘å…³&quot;&gt;2.5.10.2 ç½‘å…³&lt;/h5&gt;

&lt;p&gt;ä¸ä»£ç†æœåŠ¡å™¨ä¸åŒçš„æ˜¯ï¼Œç½‘å…³æœåŠ¡å™¨ä¼šå°† HTTP è½¬åŒ–ä¸ºå…¶å®ƒåè®®è¿›è¡Œé€šä¿¡ï¼Œä»è€Œè¯·æ±‚å…¶å®ƒé HTTP æœåŠ¡å™¨çš„æœåŠ¡ã€‚&lt;/p&gt;

&lt;h5 id=&quot;25103-éš§é“&quot;&gt;2.5.10.3 éš§é“&lt;/h5&gt;

&lt;p&gt;ä½¿ç”¨ SSL ç­‰åŠ å¯†æ‰‹æ®µï¼Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€æ¡å®‰å…¨çš„é€šä¿¡çº¿è·¯ã€‚&lt;/p&gt;

&lt;h3 id=&quot;26-https&quot;&gt;2.6 HTTPS&lt;/h3&gt;

&lt;p&gt;HTTP æœ‰ä»¥ä¸‹å®‰å…¨æ€§é—®é¢˜ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä½¿ç”¨æ˜æ–‡è¿›è¡Œé€šä¿¡ï¼Œå†…å®¹å¯èƒ½ä¼šè¢«çªƒå¬ï¼›&lt;/li&gt;
  &lt;li&gt;ä¸éªŒè¯é€šä¿¡æ–¹çš„èº«ä»½ï¼Œé€šä¿¡æ–¹çš„èº«ä»½æœ‰å¯èƒ½é­é‡ä¼ªè£…ï¼›&lt;/li&gt;
  &lt;li&gt;æ— æ³•è¯æ˜æŠ¥æ–‡çš„å®Œæ•´æ€§ï¼ŒæŠ¥æ–‡æœ‰å¯èƒ½é­ç¯¡æ”¹ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;HTTPS å¹¶ä¸æ˜¯æ–°åè®®ï¼Œè€Œæ˜¯è®© HTTP å…ˆå’Œ SSLï¼ˆSecure Sockets Layerï¼‰é€šä¿¡ï¼Œå†ç”± SSL å’Œ TCP é€šä¿¡ï¼Œä¹Ÿå°±æ˜¯è¯´ HTTPS ä½¿ç”¨äº†éš§é“è¿›è¡Œé€šä¿¡ã€‚&lt;/p&gt;

&lt;p&gt;é€šè¿‡ä½¿ç”¨ SSLï¼ŒHTTPS å…·æœ‰äº†åŠ å¯†ï¼ˆé˜²çªƒå¬ï¼‰ã€è®¤è¯ï¼ˆé˜²ä¼ªè£…ï¼‰å’Œå®Œæ•´æ€§ä¿æŠ¤ï¼ˆé˜²ç¯¡æ”¹ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/ssl-offloading.jpg&quot; width=&quot;600&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;261-åŠ å¯†&quot;&gt;2.6.1 åŠ å¯†&lt;/h4&gt;

&lt;h5 id=&quot;2611-å¯¹ç§°å¯†é’¥åŠ å¯†&quot;&gt;2.6.1.1 å¯¹ç§°å¯†é’¥åŠ å¯†&lt;/h5&gt;

&lt;p&gt;å¯¹ç§°å¯†é’¥åŠ å¯†ï¼ˆSymmetric-Key Encryptionï¼‰ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨åŒä¸€å¯†é’¥ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¼˜ç‚¹ï¼šè¿ç®—é€Ÿåº¦å¿«ï¼›&lt;/li&gt;
  &lt;li&gt;ç¼ºç‚¹ï¼šæ— æ³•å®‰å…¨åœ°å°†å¯†é’¥ä¼ è¾“ç»™é€šä¿¡æ–¹ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/7fffa4b8-b36d-471f-ad0c-a88ee763bb76.png&quot; width=&quot;600&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;2612-éå¯¹ç§°å¯†é’¥åŠ å¯†&quot;&gt;2.6.1.2 éå¯¹ç§°å¯†é’¥åŠ å¯†&lt;/h5&gt;

&lt;p&gt;éå¯¹ç§°å¯†é’¥åŠ å¯†ï¼Œåˆç§°å…¬å¼€å¯†é’¥åŠ å¯†ï¼ˆPublic-Key Encryptionï¼‰ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨ä¸åŒçš„å¯†é’¥ã€‚&lt;/p&gt;

&lt;p&gt;å…¬å¼€å¯†é’¥æ‰€æœ‰äººéƒ½å¯ä»¥è·å¾—ï¼Œé€šä¿¡å‘é€æ–¹è·å¾—æ¥æ”¶æ–¹çš„å…¬å¼€å¯†é’¥ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨å…¬å¼€å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°é€šä¿¡å†…å®¹åä½¿ç”¨ç§æœ‰å¯†é’¥è§£å¯†ã€‚&lt;/p&gt;

&lt;p&gt;éå¯¹ç§°å¯†é’¥é™¤äº†ç”¨æ¥åŠ å¯†ï¼Œè¿˜å¯ä»¥ç”¨æ¥è¿›è¡Œç­¾åã€‚å› ä¸ºç§æœ‰å¯†é’¥æ— æ³•è¢«å…¶ä»–äººè·å–ï¼Œå› æ­¤é€šä¿¡å‘é€æ–¹ä½¿ç”¨å…¶ç§æœ‰å¯†é’¥è¿›è¡Œç­¾åï¼Œé€šä¿¡æ¥æ”¶æ–¹ä½¿ç”¨å‘é€æ–¹çš„å…¬å¼€å¯†é’¥å¯¹ç­¾åè¿›è¡Œè§£å¯†ï¼Œå°±èƒ½åˆ¤æ–­è¿™ä¸ªç­¾åæ˜¯å¦æ­£ç¡®ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¼˜ç‚¹ï¼šå¯ä»¥æ›´å®‰å…¨åœ°å°†å…¬å¼€å¯†é’¥ä¼ è¾“ç»™é€šä¿¡å‘é€æ–¹ï¼›&lt;/li&gt;
  &lt;li&gt;ç¼ºç‚¹ï¼šè¿ç®—é€Ÿåº¦æ…¢ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/39ccb299-ee99-4dd1-b8b4-2f9ec9495cb4.png&quot; width=&quot;600&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;2613-https-é‡‡ç”¨çš„åŠ å¯†æ–¹å¼&quot;&gt;2.6.1.3 HTTPS é‡‡ç”¨çš„åŠ å¯†æ–¹å¼&lt;/h5&gt;

&lt;p&gt;HTTPS é‡‡ç”¨æ··åˆçš„åŠ å¯†æœºåˆ¶ï¼Œä½¿ç”¨éå¯¹ç§°å¯†é’¥åŠ å¯†ç”¨äºä¼ è¾“å¯¹ç§°å¯†é’¥æ¥ä¿è¯ä¼ è¾“è¿‡ç¨‹çš„å®‰å…¨æ€§ï¼Œä¹‹åä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†è¿›è¡Œé€šä¿¡æ¥ä¿è¯é€šä¿¡è¿‡ç¨‹çš„æ•ˆç‡ã€‚ï¼ˆä¸‹å›¾ä¸­çš„ Session Key å°±æ˜¯å¯¹ç§°å¯†é’¥ï¼‰&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/How-HTTPS-Works.png&quot; width=&quot;600&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;262-è®¤è¯&quot;&gt;2.6.2 è®¤è¯&lt;/h4&gt;

&lt;p&gt;é€šè¿‡ä½¿ç”¨ &lt;strong&gt;è¯ä¹¦&lt;/strong&gt; æ¥å¯¹é€šä¿¡æ–¹è¿›è¡Œè®¤è¯ã€‚&lt;/p&gt;

&lt;p&gt;æ•°å­—è¯ä¹¦è®¤è¯æœºæ„ï¼ˆCAï¼ŒCertificate Authorityï¼‰æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨åŒæ–¹éƒ½å¯ä¿¡èµ–çš„ç¬¬ä¸‰æ–¹æœºæ„ã€‚&lt;/p&gt;

&lt;p&gt;æœåŠ¡å™¨çš„è¿è¥äººå‘˜å‘ CA æå‡ºå…¬å¼€å¯†é’¥çš„ç”³è¯·ï¼ŒCA åœ¨åˆ¤æ˜æå‡ºç”³è¯·è€…çš„èº«ä»½ä¹‹åï¼Œä¼šå¯¹å·²ç”³è¯·çš„å…¬å¼€å¯†é’¥åšæ•°å­—ç­¾åï¼Œç„¶ååˆ†é…è¿™ä¸ªå·²ç­¾åçš„å…¬å¼€å¯†é’¥ï¼Œå¹¶å°†è¯¥å…¬å¼€å¯†é’¥æ”¾å…¥å…¬å¼€å¯†é’¥è¯ä¹¦åç»‘å®šåœ¨ä¸€èµ·ã€‚&lt;/p&gt;

&lt;p&gt;è¿›è¡Œ HTTPS é€šä¿¡æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæŠŠè¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å–å¾—å…¶ä¸­çš„å…¬å¼€å¯†é’¥ä¹‹åï¼Œå…ˆä½¿ç”¨æ•°å­—ç­¾åè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œå°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/2017-06-11-ca.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;263-å®Œæ•´æ€§ä¿æŠ¤&quot;&gt;2.6.3 å®Œæ•´æ€§ä¿æŠ¤&lt;/h4&gt;

&lt;p&gt;SSL æä¾›æŠ¥æ–‡æ‘˜è¦åŠŸèƒ½æ¥è¿›è¡Œå®Œæ•´æ€§ä¿æŠ¤ã€‚&lt;/p&gt;

&lt;p&gt;HTTP ä¹Ÿæä¾›äº† MD5 æŠ¥æ–‡æ‘˜è¦åŠŸèƒ½ï¼Œä½†ä¸æ˜¯å®‰å…¨çš„ã€‚ä¾‹å¦‚æŠ¥æ–‡å†…å®¹è¢«ç¯¡æ”¹ä¹‹åï¼ŒåŒæ—¶é‡æ–°è®¡ç®— MD5 çš„å€¼ï¼Œé€šä¿¡æ¥æ”¶æ–¹æ˜¯æ— æ³•æ„è¯†åˆ°å‘ç”Ÿäº†ç¯¡æ”¹ã€‚&lt;/p&gt;

&lt;p&gt;HTTPS çš„æŠ¥æ–‡æ‘˜è¦åŠŸèƒ½ä¹‹æ‰€ä»¥å®‰å…¨ï¼Œæ˜¯å› ä¸ºå®ƒç»“åˆäº†åŠ å¯†å’Œè®¤è¯è¿™ä¸¤ä¸ªæ“ä½œã€‚è¯•æƒ³ä¸€ä¸‹ï¼ŒåŠ å¯†ä¹‹åçš„æŠ¥æ–‡ï¼Œé­åˆ°ç¯¡æ”¹ä¹‹åï¼Œä¹Ÿå¾ˆéš¾é‡æ–°è®¡ç®—æŠ¥æ–‡æ‘˜è¦ï¼Œå› ä¸ºæ— æ³•è½»æ˜“è·å–æ˜æ–‡ã€‚&lt;/p&gt;

&lt;h4 id=&quot;264-https-çš„ç¼ºç‚¹&quot;&gt;2.6.4 HTTPS çš„ç¼ºç‚¹&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;å› ä¸ºéœ€è¦è¿›è¡ŒåŠ å¯†è§£å¯†ç­‰è¿‡ç¨‹ï¼Œå› æ­¤é€Ÿåº¦ä¼šæ›´æ…¢ï¼›&lt;/li&gt;
  &lt;li&gt;éœ€è¦æ”¯ä»˜è¯ä¹¦æˆæƒçš„é«˜é¢è´¹ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;27-http20&quot;&gt;2.7 HTTP/2.0&lt;/h3&gt;

&lt;h4 id=&quot;271-http1x-ç¼ºé™·&quot;&gt;2.7.1 HTTP/1.x ç¼ºé™·&lt;/h4&gt;

&lt;p&gt;HTTP/1.x å®ç°ç®€å•æ˜¯ä»¥ç‰ºç‰²æ€§èƒ½ä¸ºä»£ä»·çš„ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨å¤šä¸ªè¿æ¥æ‰èƒ½å®ç°å¹¶å‘å’Œç¼©çŸ­å»¶è¿Ÿï¼›&lt;/li&gt;
  &lt;li&gt;ä¸ä¼šå‹ç¼©è¯·æ±‚å’Œå“åº”é¦–éƒ¨ï¼Œä»è€Œå¯¼è‡´ä¸å¿…è¦çš„ç½‘ç»œæµé‡ï¼›&lt;/li&gt;
  &lt;li&gt;ä¸æ”¯æŒæœ‰æ•ˆçš„èµ„æºä¼˜å…ˆçº§ï¼Œè‡´ä½¿åº•å±‚ TCP è¿æ¥çš„åˆ©ç”¨ç‡ä½ä¸‹ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;272-äºŒè¿›åˆ¶åˆ†å¸§å±‚&quot;&gt;2.7.2 äºŒè¿›åˆ¶åˆ†å¸§å±‚&lt;/h4&gt;

&lt;p&gt;HTTP/2.0 å°†æŠ¥æ–‡åˆ†æˆ HEADERS å¸§å’Œ DATA å¸§ï¼Œå®ƒä»¬éƒ½æ˜¯äºŒè¿›åˆ¶æ ¼å¼çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/86e6a91d-a285-447a-9345-c5484b8d0c47.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œåªä¼šæœ‰ä¸€ä¸ª TCP è¿æ¥å­˜åœ¨ï¼Œå®ƒæ‰¿è½½äº†ä»»æ„æ•°é‡çš„åŒå‘æ•°æ®æµï¼ˆStreamï¼‰ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸€ä¸ªæ•°æ®æµï¼ˆStreamï¼‰éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦å’Œå¯é€‰çš„ä¼˜å…ˆçº§ä¿¡æ¯ï¼Œç”¨äºæ‰¿è½½åŒå‘ä¿¡æ¯ã€‚&lt;/li&gt;
  &lt;li&gt;æ¶ˆæ¯ï¼ˆMessageï¼‰æ˜¯ä¸é€»è¾‘è¯·æ±‚æˆ–å“åº”å¯¹åº”çš„å®Œæ•´çš„ä¸€ç³»åˆ—å¸§ã€‚&lt;/li&gt;
  &lt;li&gt;å¸§ï¼ˆFrameï¼‰æ˜¯æœ€å°çš„é€šä¿¡å•ä½ï¼Œæ¥è‡ªä¸åŒæ•°æ®æµçš„å¸§å¯ä»¥äº¤é”™å‘é€ï¼Œç„¶åå†æ ¹æ®æ¯ä¸ªå¸§å¤´çš„æ•°æ®æµæ ‡è¯†ç¬¦é‡æ–°ç»„è£…ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/af198da1-2480-4043-b07f-a3b91a88b815.png&quot; width=&quot;650&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;273-æœåŠ¡ç«¯æ¨é€&quot;&gt;2.7.3 æœåŠ¡ç«¯æ¨é€&lt;/h4&gt;

&lt;p&gt;HTTP/2.0 åœ¨å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªèµ„æºæ—¶ï¼Œä¼šæŠŠç›¸å…³çš„èµ„æºä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°±ä¸éœ€è¦å†æ¬¡å‘èµ·è¯·æ±‚äº†ã€‚ä¾‹å¦‚å®¢æˆ·ç«¯è¯·æ±‚ page.html é¡µé¢ï¼ŒæœåŠ¡ç«¯å°±æŠŠ script.js å’Œ style.css ç­‰ä¸ä¹‹ç›¸å…³çš„èµ„æºä¸€èµ·å‘ç»™å®¢æˆ·ç«¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/e3f1657c-80fc-4dfa-9643-bf51abd201c6.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;274-é¦–éƒ¨å‹ç¼©&quot;&gt;2.7.4 é¦–éƒ¨å‹ç¼©&lt;/h4&gt;

&lt;p&gt;HTTP/1.1 çš„é¦–éƒ¨å¸¦æœ‰å¤§é‡ä¿¡æ¯ï¼Œè€Œä¸”æ¯æ¬¡éƒ½è¦é‡å¤å‘é€ã€‚&lt;/p&gt;

&lt;p&gt;HTTP/2.0 è¦æ±‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ—¶ç»´æŠ¤å’Œæ›´æ–°ä¸€ä¸ªåŒ…å«ä¹‹å‰è§è¿‡çš„é¦–éƒ¨å­—æ®µè¡¨ï¼Œä»è€Œé¿å…äº†é‡å¤ä¼ è¾“ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ä»…å¦‚æ­¤ï¼ŒHTTP/2.0 ä¹Ÿä½¿ç”¨ Huffman ç¼–ç å¯¹é¦–éƒ¨å­—æ®µè¿›è¡Œå‹ç¼©ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/_u4E0B_u8F7D.png&quot; width=&quot;650&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;28-http11-æ–°ç‰¹æ€§&quot;&gt;2.8 HTTP/1.1 æ–°ç‰¹æ€§&lt;/h3&gt;

&lt;p&gt;è¯¦ç»†å†…å®¹è¯·è§ä¸Šæ–‡&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;é»˜è®¤æ˜¯é•¿è¿æ¥&lt;/li&gt;
  &lt;li&gt;æ”¯æŒæµæ°´çº¿&lt;/li&gt;
  &lt;li&gt;æ”¯æŒåŒæ—¶æ‰“å¼€å¤šä¸ª TCP è¿æ¥&lt;/li&gt;
  &lt;li&gt;æ”¯æŒè™šæ‹Ÿä¸»æœº&lt;/li&gt;
  &lt;li&gt;æ–°å¢çŠ¶æ€ç  100&lt;/li&gt;
  &lt;li&gt;æ”¯æŒåˆ†å—ä¼ è¾“ç¼–ç &lt;/li&gt;
  &lt;li&gt;æ–°å¢ç¼“å­˜å¤„ç†æŒ‡ä»¤ max-age&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;29-get-å’Œ-post-æ¯”è¾ƒ&quot;&gt;2.9 GET å’Œ POST æ¯”è¾ƒ&lt;/h3&gt;

&lt;h4 id=&quot;291-ä½œç”¨&quot;&gt;2.9.1 ä½œç”¨&lt;/h4&gt;

&lt;p&gt;GET ç”¨äºè·å–èµ„æºï¼Œè€Œ POST ç”¨äºä¼ è¾“å®ä½“ä¸»ä½“ã€‚&lt;/p&gt;

&lt;h4 id=&quot;292-å‚æ•°&quot;&gt;2.9.2 å‚æ•°&lt;/h4&gt;

&lt;p&gt;GET å’Œ POST çš„è¯·æ±‚éƒ½èƒ½ä½¿ç”¨é¢å¤–çš„å‚æ•°ï¼Œä½†æ˜¯ GET çš„å‚æ•°æ˜¯ä»¥æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°åœ¨ URL ä¸­ï¼Œè€Œ POST çš„å‚æ•°å­˜å‚¨åœ¨å®ä½“ä¸»ä½“ä¸­ã€‚ä¸èƒ½å› ä¸º POST å‚æ•°å­˜å‚¨åœ¨å®ä½“ä¸»ä½“ä¸­å°±è®¤ä¸ºå®ƒçš„å®‰å…¨æ€§æ›´é«˜ï¼Œå› ä¸ºç…§æ ·å¯ä»¥é€šè¿‡ä¸€äº›æŠ“åŒ…å·¥å…·ï¼ˆFiddlerï¼‰æŸ¥çœ‹ã€‚&lt;/p&gt;

&lt;p&gt;å› ä¸º URL åªæ”¯æŒ ASCII ç ï¼Œå› æ­¤ GET çš„å‚æ•°ä¸­å¦‚æœå­˜åœ¨ä¸­æ–‡ç­‰å­—ç¬¦å°±éœ€è¦å…ˆè¿›è¡Œç¼–ç ã€‚ä¾‹å¦‚ &lt;code class=&quot;highlighter-rouge&quot;&gt;ä¸­æ–‡&lt;/code&gt; ä¼šè½¬æ¢ä¸º &lt;code class=&quot;highlighter-rouge&quot;&gt;%E4%B8%AD%E6%96%87&lt;/code&gt;ï¼Œè€Œç©ºæ ¼ä¼šè½¬æ¢ä¸º &lt;code class=&quot;highlighter-rouge&quot;&gt;%20&lt;/code&gt;ã€‚POST å‚æ•°æ”¯æŒæ ‡å‡†å­—ç¬¦é›†ã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;GET /test/demo_form.asp?name1=value1&amp;amp;name2=value2 HTTP/1.1Copy to clipboardErrorCopied
POST /test/demo_form.asp HTTP/1.1
Host: w3schools.com
name1=value1&amp;amp;name2=value2Copy to clipboardErrorCopied
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;293-å®‰å…¨&quot;&gt;2.9.3 å®‰å…¨&lt;/h4&gt;

&lt;p&gt;å®‰å…¨çš„ HTTP æ–¹æ³•ä¸ä¼šæ”¹å˜æœåŠ¡å™¨çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªæ˜¯å¯è¯»çš„ã€‚&lt;/p&gt;

&lt;p&gt;GET æ–¹æ³•æ˜¯å®‰å…¨çš„ï¼Œè€Œ POST å´ä¸æ˜¯ï¼Œå› ä¸º POST çš„ç›®çš„æ˜¯ä¼ é€å®ä½“ä¸»ä½“å†…å®¹ï¼Œè¿™ä¸ªå†…å®¹å¯èƒ½æ˜¯ç”¨æˆ·ä¸Šä¼ çš„è¡¨å•æ•°æ®ï¼Œä¸Šä¼ æˆåŠŸä¹‹åï¼ŒæœåŠ¡å™¨å¯èƒ½æŠŠè¿™ä¸ªæ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå› æ­¤çŠ¶æ€ä¹Ÿå°±å‘ç”Ÿäº†æ”¹å˜ã€‚&lt;/p&gt;

&lt;p&gt;å®‰å…¨çš„æ–¹æ³•é™¤äº† GET ä¹‹å¤–è¿˜æœ‰ï¼šHEADã€OPTIONSã€‚&lt;/p&gt;

&lt;p&gt;ä¸å®‰å…¨çš„æ–¹æ³•é™¤äº† POST ä¹‹å¤–è¿˜æœ‰ PUTã€DELETEã€‚&lt;/p&gt;

&lt;h4 id=&quot;294-å¹‚ç­‰æ€§&quot;&gt;2.9.4 å¹‚ç­‰æ€§&lt;/h4&gt;

&lt;p&gt;å¹‚ç­‰çš„ HTTP æ–¹æ³•ï¼ŒåŒæ ·çš„è¯·æ±‚è¢«æ‰§è¡Œä¸€æ¬¡ä¸è¿ç»­æ‰§è¡Œå¤šæ¬¡çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼ŒæœåŠ¡å™¨çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼Œå¹‚ç­‰æ–¹æ³•ä¸åº”è¯¥å…·æœ‰å‰¯ä½œç”¨ï¼ˆç»Ÿè®¡ç”¨é€”é™¤å¤–ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€æœ‰çš„å®‰å…¨æ–¹æ³•ä¹Ÿéƒ½æ˜¯å¹‚ç­‰çš„ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æ­£ç¡®å®ç°çš„æ¡ä»¶ä¸‹ï¼ŒGETï¼ŒHEADï¼ŒPUT å’Œ DELETE ç­‰æ–¹æ³•éƒ½æ˜¯å¹‚ç­‰çš„ï¼Œè€Œ POST æ–¹æ³•ä¸æ˜¯ã€‚&lt;/p&gt;

&lt;p&gt;GET /pageX HTTP/1.1 æ˜¯å¹‚ç­‰çš„ï¼Œè¿ç»­è°ƒç”¨å¤šæ¬¡ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;GET /pageX HTTP/1.1
GET /pageX HTTP/1.1
GET /pageX HTTP/1.1
GET /pageX HTTP/1.1Copy to clipboardErrorCopied
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;POST /add_row HTTP/1.1 ä¸æ˜¯å¹‚ç­‰çš„ï¼Œå¦‚æœè°ƒç”¨å¤šæ¬¡ï¼Œå°±ä¼šå¢åŠ å¤šè¡Œè®°å½•ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;POST /add_row HTTP/1.1   -&amp;gt; Adds a 1nd row
POST /add_row HTTP/1.1   -&amp;gt; Adds a 2nd row
POST /add_row HTTP/1.1   -&amp;gt; Adds a 3rd rowCopy to clipboardErrorCopied
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;DELETE /idX/delete HTTP/1.1 æ˜¯å¹‚ç­‰çš„ï¼Œå³ä½¿ä¸åŒçš„è¯·æ±‚æ¥æ”¶åˆ°çš„çŠ¶æ€ç ä¸ä¸€æ ·ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;DELETE /idX/delete HTTP/1.1   -&amp;gt; Returns 200 if idX exists
DELETE /idX/delete HTTP/1.1   -&amp;gt; Returns 404 as it just got deleted
DELETE /idX/delete HTTP/1.1   -&amp;gt; Returns 404Copy to clipboardErrorCopied
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;295-å¯ç¼“å­˜&quot;&gt;2.9.5 å¯ç¼“å­˜&lt;/h4&gt;

&lt;p&gt;å¦‚æœè¦å¯¹å“åº”è¿›è¡Œç¼“å­˜ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;è¯·æ±‚æŠ¥æ–‡çš„ HTTP æ–¹æ³•æœ¬èº«æ˜¯å¯ç¼“å­˜çš„ï¼ŒåŒ…æ‹¬ GET å’Œ HEADï¼Œä½†æ˜¯ PUT å’Œ DELETE ä¸å¯ç¼“å­˜ï¼ŒPOST åœ¨å¤šæ•°æƒ…å†µä¸‹ä¸å¯ç¼“å­˜çš„ã€‚&lt;/li&gt;
  &lt;li&gt;å“åº”æŠ¥æ–‡çš„çŠ¶æ€ç æ˜¯å¯ç¼“å­˜çš„ï¼ŒåŒ…æ‹¬ï¼š200, 203, 204, 206, 300, 301, 404, 405, 410, 414, and 501ã€‚&lt;/li&gt;
  &lt;li&gt;å“åº”æŠ¥æ–‡çš„ Cache-Control é¦–éƒ¨å­—æ®µæ²¡æœ‰æŒ‡å®šä¸è¿›è¡Œç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;296-xmlhttprequest&quot;&gt;2.9.6 XMLHttpRequest&lt;/h4&gt;

&lt;p&gt;ä¸ºäº†é˜è¿° POST å’Œ GET çš„å¦ä¸€ä¸ªåŒºåˆ«ï¼Œéœ€è¦å…ˆäº†è§£ XMLHttpRequestï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;XMLHttpRequest æ˜¯ä¸€ä¸ª APIï¼Œå®ƒä¸ºå®¢æˆ·ç«¯æä¾›äº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šè¿‡ URL æ¥è·å–æ•°æ®çš„ç®€å•æ–¹å¼ï¼Œå¹¶ä¸”ä¸ä¼šä½¿æ•´ä¸ªé¡µé¢åˆ·æ–°ã€‚è¿™ä½¿å¾—ç½‘é¡µåªæ›´æ–°ä¸€éƒ¨åˆ†é¡µé¢è€Œä¸ä¼šæ‰“æ‰°åˆ°ç”¨æˆ·ã€‚XMLHttpRequest åœ¨ AJAX ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;åœ¨ä½¿ç”¨ XMLHttpRequest çš„ POST æ–¹æ³•æ—¶ï¼Œæµè§ˆå™¨ä¼šå…ˆå‘é€ Header å†å‘é€ Dataã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨ä¼šè¿™ä¹ˆåšï¼Œä¾‹å¦‚ç«ç‹å°±ä¸ä¼šã€‚&lt;/li&gt;
  &lt;li&gt;è€Œ GET æ–¹æ³• Header å’Œ Data ä¼šä¸€èµ·å‘é€ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;3-socket&quot;&gt;3. Socket&lt;/h2&gt;

&lt;h3 id=&quot;31-io-æ¨¡å‹&quot;&gt;3.1 I/O æ¨¡å‹&lt;/h3&gt;

&lt;p&gt;ä¸€ä¸ªè¾“å…¥æ“ä½œé€šå¸¸åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç­‰å¾…æ•°æ®å‡†å¤‡å¥½&lt;/li&gt;
  &lt;li&gt;ä»å†…æ ¸å‘è¿›ç¨‹å¤åˆ¶æ•°æ®&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¯¹äºä¸€ä¸ªå¥—æ¥å­—ä¸Šçš„è¾“å…¥æ“ä½œï¼Œç¬¬ä¸€æ­¥é€šå¸¸æ¶‰åŠç­‰å¾…æ•°æ®ä»ç½‘ç»œä¸­åˆ°è¾¾ã€‚å½“æ‰€ç­‰å¾…æ•°æ®åˆ°è¾¾æ—¶ï¼Œå®ƒè¢«å¤åˆ¶åˆ°å†…æ ¸ä¸­çš„æŸä¸ªç¼“å†²åŒºã€‚ç¬¬äºŒæ­¥å°±æ˜¯æŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºã€‚&lt;/p&gt;

&lt;p&gt;Unix æœ‰äº”ç§ I/O æ¨¡å‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;é˜»å¡å¼ I/O&lt;/li&gt;
  &lt;li&gt;éé˜»å¡å¼ I/O&lt;/li&gt;
  &lt;li&gt;I/O å¤ç”¨ï¼ˆselect å’Œ pollï¼‰&lt;/li&gt;
  &lt;li&gt;ä¿¡å·é©±åŠ¨å¼ I/Oï¼ˆSIGIOï¼‰&lt;/li&gt;
  &lt;li&gt;å¼‚æ­¥ I/Oï¼ˆAIOï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;311-é˜»å¡å¼-io&quot;&gt;3.1.1 é˜»å¡å¼ I/O&lt;/h4&gt;

&lt;p&gt;åº”ç”¨è¿›ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºä¸­æ‰è¿”å›ã€‚&lt;/p&gt;

&lt;p&gt;åº”è¯¥æ³¨æ„åˆ°ï¼Œåœ¨é˜»å¡çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®ƒåº”ç”¨è¿›ç¨‹è¿˜å¯ä»¥æ‰§è¡Œï¼Œå› æ­¤é˜»å¡ä¸æ„å‘³ç€æ•´ä¸ªæ“ä½œç³»ç»Ÿéƒ½è¢«é˜»å¡ã€‚å› ä¸ºå…¶å®ƒåº”ç”¨è¿›ç¨‹è¿˜å¯ä»¥æ‰§è¡Œï¼Œæ‰€ä»¥ä¸æ¶ˆè€— CPU æ—¶é—´ï¼Œè¿™ç§æ¨¡å‹çš„ CPU åˆ©ç”¨ç‡ä¼šæ¯”è¾ƒé«˜ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹å›¾ä¸­ï¼Œrecvfrom() ç”¨äºæ¥æ”¶ Socket ä¼ æ¥çš„æ•°æ®ï¼Œå¹¶å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹çš„ç¼“å†²åŒº buf ä¸­ã€‚è¿™é‡ŒæŠŠ recvfrom() å½“æˆç³»ç»Ÿè°ƒç”¨ã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kt&quot;&gt;ssize_t&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;recvfrom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sockfd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sockaddr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;socklen_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addrlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Copy&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clipboardErrorCopied&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/1492928416812_4.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;312-éé˜»å¡å¼-io&quot;&gt;3.1.2 éé˜»å¡å¼ I/O&lt;/h4&gt;

&lt;p&gt;åº”ç”¨è¿›ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ä¹‹åï¼Œå†…æ ¸è¿”å›ä¸€ä¸ªé”™è¯¯ç ã€‚åº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯éœ€è¦ä¸æ–­çš„æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ¥è·çŸ¥ I/O æ˜¯å¦å®Œæˆï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºè½®è¯¢ï¼ˆpollingï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;ç”±äº CPU è¦å¤„ç†æ›´å¤šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤è¿™ç§æ¨¡å‹çš„ CPU åˆ©ç”¨ç‡æ¯”è¾ƒä½ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/1492929000361_5.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;313-io-å¤ç”¨&quot;&gt;3.1.3 I/O å¤ç”¨&lt;/h4&gt;

&lt;p&gt;ä½¿ç”¨ select æˆ–è€… poll ç­‰å¾…æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥ç­‰å¾…å¤šä¸ªå¥—æ¥å­—ä¸­çš„ä»»ä½•ä¸€ä¸ªå˜ä¸ºå¯è¯»ã€‚è¿™ä¸€è¿‡ç¨‹ä¼šè¢«é˜»å¡ï¼Œå½“æŸä¸€ä¸ªå¥—æ¥å­—å¯è¯»æ—¶è¿”å›ï¼Œä¹‹åå†ä½¿ç”¨ recvfrom æŠŠæ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°è¿›ç¨‹ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;å®ƒå¯ä»¥è®©å•ä¸ªè¿›ç¨‹å…·æœ‰å¤„ç†å¤šä¸ª I/O äº‹ä»¶çš„èƒ½åŠ›ã€‚åˆè¢«ç§°ä¸º Event Driven I/Oï¼Œå³äº‹ä»¶é©±åŠ¨ I/Oã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä¸€ä¸ª Web æœåŠ¡å™¨æ²¡æœ‰ I/O å¤ç”¨ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ª Socket è¿æ¥éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ã€‚å¦‚æœåŒæ—¶æœ‰å‡ ä¸‡ä¸ªè¿æ¥ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ›å»ºç›¸åŒæ•°é‡çš„çº¿ç¨‹ã€‚ç›¸æ¯”äºå¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹æŠ€æœ¯ï¼ŒI/O å¤ç”¨ä¸éœ€è¦è¿›ç¨‹çº¿ç¨‹åˆ›å»ºå’Œåˆ‡æ¢çš„å¼€é”€ï¼Œç³»ç»Ÿå¼€é”€æ›´å°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/1492929444818_6.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;314-ä¿¡å·é©±åŠ¨-io&quot;&gt;3.1.4 ä¿¡å·é©±åŠ¨ I/O&lt;/h4&gt;

&lt;p&gt;åº”ç”¨è¿›ç¨‹ä½¿ç”¨ sigaction ç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸ç«‹å³è¿”å›ï¼Œåº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ç­‰å¾…æ•°æ®é˜¶æ®µåº”ç”¨è¿›ç¨‹æ˜¯éé˜»å¡çš„ã€‚å†…æ ¸åœ¨æ•°æ®åˆ°è¾¾æ—¶å‘åº”ç”¨è¿›ç¨‹å‘é€ SIGIO ä¿¡å·ï¼Œåº”ç”¨è¿›ç¨‹æ”¶åˆ°ä¹‹ååœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­è°ƒç”¨ recvfrom å°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;ç›¸æ¯”äºéé˜»å¡å¼ I/O çš„è½®è¯¢æ–¹å¼ï¼Œä¿¡å·é©±åŠ¨ I/O çš„ CPU åˆ©ç”¨ç‡æ›´é«˜ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/1492929553651_7.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;315-å¼‚æ­¥-io&quot;&gt;3.1.5 å¼‚æ­¥ I/O&lt;/h4&gt;

&lt;p&gt;åº”ç”¨è¿›ç¨‹æ‰§è¡Œ aio_read ç³»ç»Ÿè°ƒç”¨ä¼šç«‹å³è¿”å›ï¼Œåº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä¸ä¼šè¢«é˜»å¡ï¼Œå†…æ ¸ä¼šåœ¨æ‰€æœ‰æ“ä½œå®Œæˆä¹‹åå‘åº”ç”¨è¿›ç¨‹å‘é€ä¿¡å·ã€‚&lt;/p&gt;

&lt;p&gt;å¼‚æ­¥ I/O ä¸ä¿¡å·é©±åŠ¨ I/O çš„åŒºåˆ«åœ¨äºï¼Œå¼‚æ­¥ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹ I/O å®Œæˆï¼Œè€Œä¿¡å·é©±åŠ¨ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹å¯ä»¥å¼€å§‹ I/Oã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/1492930243286_8.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;316-äº”å¤§-io-æ¨¡å‹æ¯”è¾ƒ&quot;&gt;3.1.6 äº”å¤§ I/O æ¨¡å‹æ¯”è¾ƒ&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;åŒæ­¥ I/Oï¼šå°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºçš„é˜¶æ®µï¼ˆç¬¬äºŒé˜¶æ®µï¼‰ï¼Œåº”ç”¨è¿›ç¨‹ä¼šé˜»å¡ã€‚&lt;/li&gt;
  &lt;li&gt;å¼‚æ­¥ I/Oï¼šç¬¬äºŒé˜¶æ®µåº”ç”¨è¿›ç¨‹ä¸ä¼šé˜»å¡ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åŒæ­¥ I/O åŒ…æ‹¬é˜»å¡å¼ I/Oã€éé˜»å¡å¼ I/Oã€I/O å¤ç”¨å’Œä¿¡å·é©±åŠ¨ I/O ï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µã€‚&lt;/p&gt;

&lt;p&gt;éé˜»å¡å¼ I/O ã€ä¿¡å·é©±åŠ¨ I/O å’Œå¼‚æ­¥ I/O åœ¨ç¬¬ä¸€é˜¶æ®µä¸ä¼šé˜»å¡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/1492928105791_3.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;32-io-å¤ç”¨&quot;&gt;3.2 I/O å¤ç”¨&lt;/h3&gt;

&lt;p&gt;select/poll/epoll éƒ½æ˜¯ I/O å¤šè·¯å¤ç”¨çš„å…·ä½“å®ç°ï¼Œselect å‡ºç°çš„æœ€æ—©ï¼Œä¹‹åæ˜¯ pollï¼Œå†æ˜¯ epollã€‚&lt;/p&gt;

&lt;h4 id=&quot;select&quot;&gt;select&lt;/h4&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd_set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readfds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd_set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;writefds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd_set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exceptfds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeval&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;select å…è®¸åº”ç”¨ç¨‹åºç›‘è§†ä¸€ç»„æ–‡ä»¶æè¿°ç¬¦ï¼Œç­‰å¾…ä¸€ä¸ªæˆ–è€…å¤šä¸ªæè¿°ç¬¦æˆä¸ºå°±ç»ªçŠ¶æ€ï¼Œä»è€Œå®Œæˆ I/O æ“ä½œã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;fd_set ä½¿ç”¨æ•°ç»„å®ç°ï¼Œæ•°ç»„å¤§å°ä½¿ç”¨ FD_SETSIZE å®šä¹‰ï¼Œæ‰€ä»¥åªèƒ½ç›‘å¬å°‘äº FD_SETSIZE æ•°é‡çš„æè¿°ç¬¦ã€‚æœ‰ä¸‰ç§ç±»å‹çš„æè¿°ç¬¦ç±»å‹ï¼šreadsetã€writesetã€exceptsetï¼Œåˆ†åˆ«å¯¹åº”è¯»ã€å†™ã€å¼‚å¸¸æ¡ä»¶çš„æè¿°ç¬¦é›†åˆã€‚&lt;/li&gt;
  &lt;li&gt;timeout ä¸ºè¶…æ—¶å‚æ•°ï¼Œè°ƒç”¨ select ä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰æè¿°ç¬¦çš„äº‹ä»¶åˆ°è¾¾æˆ–è€…ç­‰å¾…çš„æ—¶é—´è¶…è¿‡ timeoutã€‚&lt;/li&gt;
  &lt;li&gt;æˆåŠŸè°ƒç”¨è¿”å›ç»“æœå¤§äº 0ï¼Œå‡ºé”™è¿”å›ç»“æœä¸º -1ï¼Œè¶…æ—¶è¿”å›ç»“æœä¸º 0ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;fd_set&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd_in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd_out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeval&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Reset the sets&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;FD_ZERO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd_in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;FD_ZERO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd_out&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Monitor sock1 for input events&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;FD_SET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd_in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Monitor sock2 for output events&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;FD_SET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd_out&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Find out which socket has the largest numeric value as select requires it&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;largest_sock&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Wait up to 10 seconds&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;tv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tv_sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;tv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tv_usec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Call the select&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;largest_sock&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd_in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd_out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tv&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Check if select actually succeed&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// report error and abort&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// timeout; no event detected&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FD_ISSET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd_in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// input event on sock1&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FD_ISSET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd_out&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// output event on sock2&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Copy&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clipboardErrorCopied&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;poll&quot;&gt;poll&lt;/h4&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pollfd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nfds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Copy&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clipboardErrorCopied&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;poll çš„åŠŸèƒ½ä¸ select ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç­‰å¾…ä¸€ç»„æè¿°ç¬¦ä¸­çš„ä¸€ä¸ªæˆä¸ºå°±ç»ªçŠ¶æ€ã€‚&lt;/p&gt;

&lt;p&gt;poll ä¸­çš„æè¿°ç¬¦æ˜¯ pollfd ç±»å‹çš„æ•°ç»„ï¼Œpollfd çš„å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pollfd&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
               &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;         &lt;span class=&quot;cm&quot;&gt;/* file descriptor */&lt;/span&gt;
               &lt;span class=&quot;kt&quot;&gt;short&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;events&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;     &lt;span class=&quot;cm&quot;&gt;/* requested events */&lt;/span&gt;
               &lt;span class=&quot;kt&quot;&gt;short&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;revents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;cm&quot;&gt;/* returned events */&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Copy&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clipboardErrorCopied&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// The structure for two events&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pollfd&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Monitor sock1 for input&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;fds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;fds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;events&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;POLLIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Monitor sock2 for output&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;fds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;fds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;events&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;POLLOUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Wait 10 seconds&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10000&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Check if poll actually succeed&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// report error and abort&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// timeout; no event detected&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// If we detect the event, zero it out so we can reuse the structure&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;revents&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;POLLIN&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;revents&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// input event on sock1&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;revents&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;POLLOUT&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;revents&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// output event on sock2&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;æ¯”è¾ƒ&quot;&gt;&lt;a href=&quot;https://cyc2018.github.io/CS-Notes/#/notes/Socket?id=æ¯”è¾ƒ&quot;&gt;æ¯”è¾ƒ&lt;/a&gt;&lt;/h2&gt;

&lt;h3 id=&quot;1-åŠŸèƒ½&quot;&gt;&lt;a href=&quot;https://cyc2018.github.io/CS-Notes/#/notes/Socket?id=_1-åŠŸèƒ½&quot;&gt;1. åŠŸèƒ½&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;select å’Œ poll çš„åŠŸèƒ½åŸºæœ¬ç›¸åŒï¼Œä¸è¿‡åœ¨ä¸€äº›å®ç°ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;select ä¼šä¿®æ”¹æè¿°ç¬¦ï¼Œè€Œ poll ä¸ä¼šï¼›&lt;/li&gt;
  &lt;li&gt;select çš„æè¿°ç¬¦ç±»å‹ä½¿ç”¨æ•°ç»„å®ç°ï¼ŒFD_SETSIZE å¤§å°é»˜è®¤ä¸º 1024ï¼Œå› æ­¤é»˜è®¤åªèƒ½ç›‘å¬ 1024 ä¸ªæè¿°ç¬¦ã€‚å¦‚æœè¦ç›‘å¬æ›´å¤šæè¿°ç¬¦çš„è¯ï¼Œéœ€è¦ä¿®æ”¹ FD_SETSIZE ä¹‹åé‡æ–°ç¼–è¯‘ï¼›è€Œ poll æ²¡æœ‰æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼›&lt;/li&gt;
  &lt;li&gt;poll æä¾›äº†æ›´å¤šçš„äº‹ä»¶ç±»å‹ï¼Œå¹¶ä¸”å¯¹æè¿°ç¬¦çš„é‡å¤åˆ©ç”¨ä¸Šæ¯” select é«˜ã€‚&lt;/li&gt;
  &lt;li&gt;å¦‚æœä¸€ä¸ªçº¿ç¨‹å¯¹æŸä¸ªæè¿°ç¬¦è°ƒç”¨äº† select æˆ–è€… pollï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†è¯¥æè¿°ç¬¦ï¼Œä¼šå¯¼è‡´è°ƒç”¨ç»“æœä¸ç¡®å®šã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-é€Ÿåº¦&quot;&gt;&lt;a href=&quot;https://cyc2018.github.io/CS-Notes/#/notes/Socket?id=_2-é€Ÿåº¦&quot;&gt;2. é€Ÿåº¦&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;select å’Œ poll é€Ÿåº¦éƒ½æ¯”è¾ƒæ…¢ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦å°†å…¨éƒ¨æè¿°ç¬¦ä»åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºå¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒºã€‚&lt;/p&gt;

&lt;h3 id=&quot;3-å¯ç§»æ¤æ€§&quot;&gt;&lt;a href=&quot;https://cyc2018.github.io/CS-Notes/#/notes/Socket?id=_3-å¯ç§»æ¤æ€§&quot;&gt;3. å¯ç§»æ¤æ€§&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;å‡ ä¹æ‰€æœ‰çš„ç³»ç»Ÿéƒ½æ”¯æŒ selectï¼Œä½†æ˜¯åªæœ‰æ¯”è¾ƒæ–°çš„ç³»ç»Ÿæ”¯æŒ pollã€‚&lt;/p&gt;

&lt;h2 id=&quot;epoll&quot;&gt;&lt;a href=&quot;https://cyc2018.github.io/CS-Notes/#/notes/Socket?id=epoll&quot;&gt;epoll&lt;/a&gt;&lt;/h2&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;epoll_create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;epoll_ctl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epfd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epoll_event&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ï¼›&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epoll_wait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epfd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epoll_event&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;events&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxevents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Copy&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clipboardErrorCopied&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;epoll_ctl() ç”¨äºå‘å†…æ ¸æ³¨å†Œæ–°çš„æè¿°ç¬¦æˆ–è€…æ˜¯æ”¹å˜æŸä¸ªæ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ã€‚å·²æ³¨å†Œçš„æè¿°ç¬¦åœ¨å†…æ ¸ä¸­ä¼šè¢«ç»´æŠ¤åœ¨ä¸€æ£µçº¢é»‘æ ‘ä¸Šï¼Œé€šè¿‡å›è°ƒå‡½æ•°å†…æ ¸ä¼šå°† I/O å‡†å¤‡å¥½çš„æè¿°ç¬¦åŠ å…¥åˆ°ä¸€ä¸ªé“¾è¡¨ä¸­ç®¡ç†ï¼Œè¿›ç¨‹è°ƒç”¨ epoll_wait() ä¾¿å¯ä»¥å¾—åˆ°äº‹ä»¶å®Œæˆçš„æè¿°ç¬¦ã€‚&lt;/p&gt;

&lt;p&gt;ä»ä¸Šé¢çš„æè¿°å¯ä»¥çœ‹å‡ºï¼Œepoll åªéœ€è¦å°†æè¿°ç¬¦ä»è¿›ç¨‹ç¼“å†²åŒºå‘å†…æ ¸ç¼“å†²åŒºæ‹·è´ä¸€æ¬¡ï¼Œå¹¶ä¸”è¿›ç¨‹ä¸éœ€è¦é€šè¿‡è½®è¯¢æ¥è·å¾—äº‹ä»¶å®Œæˆçš„æè¿°ç¬¦ã€‚&lt;/p&gt;

&lt;p&gt;epoll ä»…é€‚ç”¨äº Linux OSã€‚&lt;/p&gt;

&lt;p&gt;epoll æ¯” select å’Œ poll æ›´åŠ çµæ´»è€Œä¸”æ²¡æœ‰æè¿°ç¬¦æ•°é‡é™åˆ¶ã€‚&lt;/p&gt;

&lt;p&gt;epoll å¯¹å¤šçº¿ç¨‹ç¼–ç¨‹æ›´æœ‰å‹å¥½ï¼Œä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº† epoll_wait() å¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†åŒä¸€ä¸ªæè¿°ç¬¦ä¹Ÿä¸ä¼šäº§ç”Ÿåƒ select å’Œ poll çš„ä¸ç¡®å®šæƒ…å†µã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c1&quot;&gt;// Create the epoll descriptor. Only one is needed per app, and is used to monitor all sockets.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// The function argument is ignored (it was not before, but now it is), so put your favorite number here&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pollingfd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epoll_create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xCAFE&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pollingfd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;c1&quot;&gt;// report error&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Initialize the epoll structure in case more members are added in future&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epoll_event&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ev&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Associate the connection class instance with the event. You can associate anything&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// you want, epoll does not use this information. We store a connection class pointer, pConnection1&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ev&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pConnection1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Monitor for input, and do not automatically rearm the descriptor after the event&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ev&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;events&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EPOLLIN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EPOLLONESHOT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Add the descriptor into the monitoring list. We can do it even if another thread is&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// waiting in epoll_wait - the descriptor will be properly added&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epoll_ctl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epollfd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EPOLL_CTL_ADD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pConnection1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getSocket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ev&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// report error&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Wait for up to 20 events (assuming we have added maybe 200 sockets before that it may happen)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epoll_event&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pevents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Wait for 10 seconds, and retrieve less than 20 epoll_event and store them into epoll_event array&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ready&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epoll_wait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pollingfd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pevents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10000&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Check if epoll actually succeed&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// report error and abort&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// timeout; no event detected&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Check if any events detected&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pevents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;events&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EPOLLIN&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// Get back our connection pointer&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Connection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Connection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pevents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handleReadEvent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Copy&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clipboardErrorCopied&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;å·¥ä½œæ¨¡å¼&quot;&gt;&lt;a href=&quot;https://cyc2018.github.io/CS-Notes/#/notes/Socket?id=å·¥ä½œæ¨¡å¼&quot;&gt;å·¥ä½œæ¨¡å¼&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;epoll çš„æè¿°ç¬¦äº‹ä»¶æœ‰ä¸¤ç§è§¦å‘æ¨¡å¼ï¼šLTï¼ˆlevel triggerï¼‰å’Œ ETï¼ˆedge triggerï¼‰ã€‚&lt;/p&gt;

&lt;h3 id=&quot;1-lt-æ¨¡å¼&quot;&gt;&lt;a href=&quot;https://cyc2018.github.io/CS-Notes/#/notes/Socket?id=_1-lt-æ¨¡å¼&quot;&gt;1. LT æ¨¡å¼&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;å½“ epoll_wait() æ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œå°†æ­¤äº‹ä»¶é€šçŸ¥è¿›ç¨‹ï¼Œè¿›ç¨‹å¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ï¼Œä¸‹æ¬¡è°ƒç”¨ epoll_wait() ä¼šå†æ¬¡é€šçŸ¥è¿›ç¨‹ã€‚æ˜¯é»˜è®¤çš„ä¸€ç§æ¨¡å¼ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒ Blocking å’Œ No-Blockingã€‚&lt;/p&gt;

&lt;h3 id=&quot;2-et-æ¨¡å¼&quot;&gt;&lt;a href=&quot;https://cyc2018.github.io/CS-Notes/#/notes/Socket?id=_2-et-æ¨¡å¼&quot;&gt;2. ET æ¨¡å¼&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;å’Œ LT æ¨¡å¼ä¸åŒçš„æ˜¯ï¼Œé€šçŸ¥ä¹‹åè¿›ç¨‹å¿…é¡»ç«‹å³å¤„ç†äº‹ä»¶ï¼Œä¸‹æ¬¡å†è°ƒç”¨ epoll_wait() æ—¶ä¸ä¼šå†å¾—åˆ°äº‹ä»¶åˆ°è¾¾çš„é€šçŸ¥ã€‚&lt;/p&gt;

&lt;p&gt;å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº† epoll äº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯” LT æ¨¡å¼é«˜ã€‚åªæ”¯æŒ No-Blockingï¼Œä»¥é¿å…ç”±äºä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„é˜»å¡è¯»/é˜»å¡å†™æ“ä½œæŠŠå¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¿æ­»ã€‚&lt;/p&gt;

&lt;h2 id=&quot;åº”ç”¨åœºæ™¯&quot;&gt;&lt;a href=&quot;https://cyc2018.github.io/CS-Notes/#/notes/Socket?id=åº”ç”¨åœºæ™¯&quot;&gt;åº”ç”¨åœºæ™¯&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;å¾ˆå®¹æ˜“äº§ç”Ÿä¸€ç§é”™è§‰è®¤ä¸ºåªè¦ç”¨ epoll å°±å¯ä»¥äº†ï¼Œselect å’Œ poll éƒ½å·²ç»è¿‡æ—¶äº†ï¼Œå…¶å®å®ƒä»¬éƒ½æœ‰å„è‡ªçš„ä½¿ç”¨åœºæ™¯ã€‚&lt;/p&gt;

&lt;h3 id=&quot;1-select-åº”ç”¨åœºæ™¯&quot;&gt;&lt;a href=&quot;https://cyc2018.github.io/CS-Notes/#/notes/Socket?id=_1-select-åº”ç”¨åœºæ™¯&quot;&gt;1. select åº”ç”¨åœºæ™¯&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;select çš„ timeout å‚æ•°ç²¾åº¦ä¸º 1nsï¼Œè€Œ poll å’Œ epoll ä¸º 1msï¼Œå› æ­¤ select æ›´åŠ é€‚ç”¨äºå®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚æ ¸ååº”å †çš„æ§åˆ¶ã€‚&lt;/p&gt;

&lt;p&gt;select å¯ç§»æ¤æ€§æ›´å¥½ï¼Œå‡ ä¹è¢«æ‰€æœ‰ä¸»æµå¹³å°æ‰€æ”¯æŒã€‚&lt;/p&gt;

&lt;h3 id=&quot;2-poll-åº”ç”¨åœºæ™¯&quot;&gt;&lt;a href=&quot;https://cyc2018.github.io/CS-Notes/#/notes/Socket?id=_2-poll-åº”ç”¨åœºæ™¯&quot;&gt;2. poll åº”ç”¨åœºæ™¯&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;poll æ²¡æœ‰æœ€å¤§æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼Œå¦‚æœå¹³å°æ”¯æŒå¹¶ä¸”å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œåº”è¯¥ä½¿ç”¨ poll è€Œä¸æ˜¯ selectã€‚&lt;/p&gt;

&lt;h3 id=&quot;3-epoll-åº”ç”¨åœºæ™¯&quot;&gt;&lt;a href=&quot;https://cyc2018.github.io/CS-Notes/#/notes/Socket?id=_3-epoll-åº”ç”¨åœºæ™¯&quot;&gt;3. epoll åº”ç”¨åœºæ™¯&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;åªéœ€è¦è¿è¡Œåœ¨ Linux å¹³å°ä¸Šï¼Œæœ‰å¤§é‡çš„æè¿°ç¬¦éœ€è¦åŒæ—¶è½®è¯¢ï¼Œå¹¶ä¸”è¿™äº›è¿æ¥æœ€å¥½æ˜¯é•¿è¿æ¥ã€‚&lt;/p&gt;

&lt;p&gt;éœ€è¦åŒæ—¶ç›‘æ§å°äº 1000 ä¸ªæè¿°ç¬¦ï¼Œå°±æ²¡æœ‰å¿…è¦ä½¿ç”¨ epollï¼Œå› ä¸ºè¿™ä¸ªåº”ç”¨åœºæ™¯ä¸‹å¹¶ä¸èƒ½ä½“ç° epoll çš„ä¼˜åŠ¿ã€‚&lt;/p&gt;

&lt;p&gt;éœ€è¦ç›‘æ§çš„æè¿°ç¬¦çŠ¶æ€å˜åŒ–å¤šï¼Œè€Œä¸”éƒ½æ˜¯éå¸¸çŸ­æš‚çš„ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦ä½¿ç”¨ epollã€‚å› ä¸º epoll ä¸­çš„æ‰€æœ‰æè¿°ç¬¦éƒ½å­˜å‚¨åœ¨å†…æ ¸ä¸­ï¼Œé€ æˆæ¯æ¬¡éœ€è¦å¯¹æè¿°ç¬¦çš„çŠ¶æ€æ”¹å˜éƒ½éœ€è¦é€šè¿‡ epoll_ctl() è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œé¢‘ç¹ç³»ç»Ÿè°ƒç”¨é™ä½æ•ˆç‡ã€‚å¹¶ä¸” epoll çš„æè¿°ç¬¦å­˜å‚¨åœ¨å†…æ ¸ï¼Œä¸å®¹æ˜“è°ƒè¯•ã€‚&lt;/p&gt;
</description>
        <pubDate>Tue, 23 Jul 2019 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2019/07/23/%E5%89%91%E6%8C%87Offer_%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/07/23/%E5%89%91%E6%8C%87Offer_%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</guid>
        
        <category>JobHunting</category>
        
        <category>Foundations</category>
        
        <category>OperatingSystem</category>
        
        
      </item>
    
  </channel>
</rss>
